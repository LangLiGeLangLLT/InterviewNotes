<!DOCTYPE html><html><head>
      <title>EffectiveC++&#x6761;&#x6B3E;&#x7B14;&#x8BB0;</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\LiangTong\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.5.0\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      

      
      
      
      
      
      
      

      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <font face="&#x5FAE;&#x8F6F;&#x96C5;&#x9ED1;">
<h1 class="mume-header" id="effective-c">Effective C++</h1>

<hr>
<ul>
<li><a href="#effective-c">Effective C++</a>
<ul>
<li><a href="#1-%E8%AE%A9%E8%87%AA%E5%B7%B1%E4%B9%A0%E6%83%AF-c">1&#x3001;&#x8BA9;&#x81EA;&#x5DF1;&#x4E60;&#x60EF; C++</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-01%E8%A7%86-c-%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%AF%AD%E8%A8%80%E8%81%94%E9%82%A6">&#x6761;&#x6B3E; 01&#xFF1A;&#x89C6; C++ &#x4E3A;&#x4E00;&#x4E2A;&#x8BED;&#x8A00;&#x8054;&#x90A6;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-02%E5%B0%BD%E9%87%8F%E4%BB%A5-constenuminline-%E6%9B%BF%E6%8D%A2-define">&#x6761;&#x6B3E; 02&#xFF1A;&#x5C3D;&#x91CF;&#x4EE5; const&#xFF0C;enum&#xFF0C;inline &#x66FF;&#x6362; #define</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-03%E5%B0%BD%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8-const">&#x6761;&#x6B3E; 03&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x7528; const</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-04%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E8%A2%AB%E4%BD%BF%E7%94%A8%E5%89%8D%E5%B7%B2%E5%85%88%E8%A2%AB%E5%88%9D%E5%A7%8B%E5%8C%96">&#x6761;&#x6B3E; 04&#xFF1A;&#x786E;&#x5B9A;&#x5BF9;&#x8C61;&#x88AB;&#x4F7F;&#x7528;&#x524D;&#x5DF2;&#x5148;&#x88AB;&#x521D;&#x59CB;&#x5316;</a></li>
</ul>
</li>
<li><a href="#2-%E6%9E%84%E9%80%A0%E6%9E%90%E6%9E%84%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97">2&#x3001;&#x6784;&#x9020;/&#x6790;&#x6784;/&#x8D4B;&#x503C;&#x8FD0;&#x7B97;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-05%E4%BA%86%E8%A7%A3-c-%E9%BB%98%E9%BB%98%E7%BC%96%E5%86%99%E5%B9%B6%E8%B0%83%E7%94%A8%E5%93%AA%E4%BA%9B%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 05&#xFF1A;&#x4E86;&#x89E3; C++ &#x9ED8;&#x9ED8;&#x7F16;&#x5199;&#x5E76;&#x8C03;&#x7528;&#x54EA;&#x4E9B;&#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-06%E8%8B%A5%E4%B8%8D%E6%83%B3%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%99%A8%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E5%87%BD%E6%95%B0%E5%B0%B1%E8%AF%A5%E6%98%8E%E7%A1%AE%E6%8B%92%E7%BB%9D">&#x6761;&#x6B3E; 06&#xFF1A;&#x82E5;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x8BE5;&#x660E;&#x786E;&#x62D2;&#x7EDD;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-07%E4%B8%BA%E5%A4%9A%E6%80%81%E5%9F%BA%E7%B1%BB%E5%A3%B0%E6%98%8E-virtual-%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 07&#xFF1A;&#x4E3A;&#x591A;&#x6001;&#x57FA;&#x7C7B;&#x58F0;&#x660E; virtual &#x6790;&#x6784;&#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-08%E5%88%AB%E8%AE%A9%E5%BC%82%E5%B8%B8%E9%80%83%E7%A6%BB%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 08&#xFF1A;&#x522B;&#x8BA9;&#x5F02;&#x5E38;&#x9003;&#x79BB;&#x6790;&#x6784;&#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-09%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%9E%90%E6%9E%84%E5%92%8C%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8-virtual-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 09&#xFF1A;&#x7EDD;&#x4E0D;&#x5728;&#x6790;&#x6784;&#x548C;&#x6784;&#x9020;&#x8FC7;&#x7A0B;&#x4E2D;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-10%E4%BB%A4-operator-%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA-reference-to-this">&#x6761;&#x6B3E; 10&#xFF1A;&#x4EE4; operator= &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference to *this</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-11%E5%9C%A8-operator-%E4%B8%AD%E5%A4%84%E7%90%86%E8%87%AA%E6%88%91%E8%B5%8B%E5%80%BC">&#x6761;&#x6B3E; 11&#xFF1A;&#x5728; operator= &#x4E2D;&#x5904;&#x7406;&#x201C;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x201D;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-12%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%8B%BF%E5%BF%98%E5%85%B6%E6%AF%8F%E4%B8%80%E4%B8%AA%E6%88%90%E5%88%86">&#x6761;&#x6B3E; 12&#xFF1A;&#x590D;&#x5236;&#x5BF9;&#x8C61;&#x65F6;&#x52FF;&#x5FD8;&#x5176;&#x6BCF;&#x4E00;&#x4E2A;&#x6210;&#x5206;</a></li>
</ul>
</li>
<li><a href="#3-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86">3&#x3001;&#x8D44;&#x6E90;&#x7BA1;&#x7406;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-13%E4%BB%A5%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90">&#x6761;&#x6B3E; 13&#xFF1A;&#x4EE5;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;&#x8D44;&#x6E90;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-14%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83-copying-%E8%A1%8C%E4%B8%BA">&#x6761;&#x6B3E; 14&#xFF1A;&#x5728;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7C7B;&#x4E2D;&#x5C0F;&#x5FC3; copying &#x884C;&#x4E3A;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-15%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE">&#x6761;&#x6B3E; 15&#xFF1A;&#x5728;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7C7B;&#x4E2D;&#x63D0;&#x4F9B;&#x5BF9;&#x539F;&#x59CB;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-16%E6%88%90%E5%AF%B9%E4%BD%BF%E7%94%A8-new-%E5%92%8C-delete-%E6%97%B6%E8%A6%81%E9%87%87%E5%8F%96%E7%9B%B8%E5%90%8C%E5%BD%A2%E5%BC%8F">&#x6761;&#x6B3E; 16&#xFF1A;&#x6210;&#x5BF9;&#x4F7F;&#x7528; new &#x548C; delete &#x65F6;&#x8981;&#x91C7;&#x53D6;&#x76F8;&#x540C;&#x5F62;&#x5F0F;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-17%E4%BB%A5%E7%8B%AC%E7%AB%8B%E8%AF%AD%E5%8F%A5%E5%B0%86-newed-%E5%AF%B9%E8%B1%A1%E7%BD%AE%E5%85%A5%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88">&#x6761;&#x6B3E; 17&#xFF1A;&#x4EE5;&#x72EC;&#x7ACB;&#x8BED;&#x53E5;&#x5C06; newed &#x5BF9;&#x8C61;&#x7F6E;&#x5165;&#x667A;&#x80FD;&#x6307;&#x9488;</a></li>
</ul>
</li>
<li><a href="#4-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%A3%B0%E6%98%8E">4&#x3001;&#x8BBE;&#x8BA1;&#x4E0E;&#x58F0;&#x660E;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-18%E8%AE%A9%E6%8E%A5%E5%8F%A3%E5%AE%B9%E6%98%93%E8%A2%AB%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E4%B8%8D%E6%98%93%E8%A2%AB%E8%AF%AF%E7%94%A8">&#x6761;&#x6B3E; 18&#xFF1A;&#x8BA9;&#x63A5;&#x53E3;&#x5BB9;&#x6613;&#x88AB;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x6613;&#x88AB;&#x8BEF;&#x7528;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-19%E8%AE%BE%E8%AE%A1-class-%E7%8A%B9%E5%A6%82%E8%AE%BE%E8%AE%A1-type">&#x6761;&#x6B3E; 19&#xFF1A;&#x8BBE;&#x8BA1; class &#x72B9;&#x5982;&#x8BBE;&#x8BA1; type</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-20%E5%AE%81%E4%BB%A5-pass-by-reference-to-const-%E6%9B%BF%E6%8D%A2-pass-by-value">&#x6761;&#x6B3E; 20&#xFF1A;&#x5B81;&#x4EE5; pass-by-reference-to-const &#x66FF;&#x6362; pass-by-value</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-21%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6-reference">&#x6761;&#x6B3E; 21&#xFF1A;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x522B;&#x5984;&#x60F3;&#x8FD4;&#x56DE;&#x5176; reference</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-22%E5%B0%86%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E4%B8%BA-private">&#x6761;&#x6B3E; 22&#xFF1A;&#x5C06;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x4E3A; private</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-23%E5%AE%81%E4%BB%A5-non-member-non-friend-%E6%9B%BF%E6%8D%A2-member-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 23&#xFF1A;&#x5B81;&#x4EE5; non-member&#x3001;non-friend &#x66FF;&#x6362; member &#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-24%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AF%B7%E4%B8%BA%E6%AD%A4%E9%87%87%E7%94%A8-non-member-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 24&#xFF1A;&#x82E5;&#x6240;&#x6709;&#x53C2;&#x6570;&#x7686;&#x9700;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x8BF7;&#x4E3A;&#x6B64;&#x91C7;&#x7528; non-member &#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-25%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%BC%82%E5%B8%B8%E7%9A%84-swap-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 25&#xFF1A;&#x8003;&#x8651;&#x5199;&#x51FA;&#x4E00;&#x4E2A;&#x4E0D;&#x629B;&#x5F02;&#x5E38;&#x7684; swap &#x51FD;&#x6570;</a></li>
</ul>
</li>
<li><a href="#5-%E5%AE%9E%E7%8E%B0">5&#x3001;&#x5B9E;&#x73B0;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-26%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BB%B6%E5%90%8E%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%BC%8F%E7%9A%84%E5%87%BA%E7%8E%B0%E6%97%B6%E9%97%B4">&#x6761;&#x6B3E; 26&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x5EF6;&#x540E;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5F0F;&#x7684;&#x51FA;&#x73B0;&#x65F6;&#x95F4;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-27%E5%B0%BD%E9%87%8F%E5%B0%91%E5%81%9A%E8%BD%AC%E5%9E%8B%E5%8A%A8%E4%BD%9C">&#x6761;&#x6B3E; 27&#xFF1A;&#x5C3D;&#x91CF;&#x5C11;&#x505A;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-28%E9%81%BF%E5%85%8D%E8%BF%94%E5%9B%9E-handles-%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E6%88%90%E5%88%86">&#x6761;&#x6B3E; 28&#xFF1A;&#x907F;&#x514D;&#x8FD4;&#x56DE; handles &#x6307;&#x5411;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x6210;&#x5206;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-29%E4%B8%BA%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E8%80%8C%E5%8A%AA%E5%8A%9B%E6%98%AF%E5%80%BC%E5%BE%97%E7%9A%84">&#x6761;&#x6B3E; 29&#xFF1A;&#x4E3A;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x201D;&#x800C;&#x52AA;&#x529B;&#x662F;&#x503C;&#x5F97;&#x7684;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-30%E9%80%8F%E5%BD%BB%E4%BA%86%E8%A7%A3-inlining-%E7%9A%84%E9%87%8C%E9%87%8C%E5%A4%96%E5%A4%96">&#x6761;&#x6B3E; 30&#xFF1A;&#x900F;&#x5F7B;&#x4E86;&#x89E3; inlining &#x7684;&#x91CC;&#x91CC;&#x5916;&#x5916;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-31%E5%B0%86%E6%96%87%E4%BB%B6%E9%97%B4%E7%9A%84%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E5%85%B3%E7%B3%BB%E9%99%8D%E8%87%B3%E6%9C%80%E4%BD%8E">&#x6761;&#x6B3E; 31&#xFF1A;&#x5C06;&#x6587;&#x4EF6;&#x95F4;&#x7684;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x5173;&#x7CFB;&#x964D;&#x81F3;&#x6700;&#x4F4E;</a></li>
</ul>
</li>
<li><a href="#6-%E7%BB%A7%E6%89%BF%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1">6&#x3001;&#x7EE7;&#x627F;&#x4E0E;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8BBE;&#x8BA1;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-32%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84-public-%E7%BB%A7%E6%89%BF%E5%A1%91%E6%A8%A1%E5%87%BA-is-a-%E5%85%B3%E7%B3%BB">&#x6761;&#x6B3E; 32&#xFF1A;&#x786E;&#x5B9A;&#x4F60;&#x7684; public &#x7EE7;&#x627F;&#x5851;&#x6A21;&#x51FA; is-a &#x5173;&#x7CFB;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-33%E9%81%BF%E5%85%8D%E9%81%AE%E6%8E%A9%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0">&#x6761;&#x6B3E; 33&#xFF1A;&#x907F;&#x514D;&#x906E;&#x63A9;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x540D;&#x79F0;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-34%E5%8C%BA%E5%88%86%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 34&#xFF1A;&#x533A;&#x5206;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x548C;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-35%E8%80%83%E8%99%91-virtual-%E5%87%BD%E6%95%B0%E4%BB%A5%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9">&#x6761;&#x6B3E; 35&#xFF1A;&#x8003;&#x8651; virtual &#x51FD;&#x6570;&#x4EE5;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x9009;&#x62E9;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-36%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84-non-virtual-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 36&#xFF1A;&#x7EDD;&#x4E0D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; non-virtual &#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-37%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E7%BC%BA%E7%9C%81%E5%8F%82%E6%95%B0%E5%80%BC">&#x6761;&#x6B3E; 37&#xFF1A;&#x7EDD;&#x4E0D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-38%E9%80%9A%E8%BF%87%E5%A4%8D%E5%90%88%E5%A1%91%E6%A8%A1%E5%87%BA-has-a-%E6%88%96%E6%A0%B9%E6%8D%AE%E6%9F%90%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%87%BA">&#x6761;&#x6B3E; 38&#xFF1A;&#x901A;&#x8FC7;&#x590D;&#x5408;&#x5851;&#x6A21;&#x51FA; has-a &#x6216;&#x201C;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#x201D;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-39%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8-private-%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 39&#xFF1A;&#x660E;&#x667A;&#x800C;&#x5BA1;&#x614E;&#x5730;&#x4F7F;&#x7528; private &#x7EE7;&#x627F;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-40%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 40&#xFF1A;&#x660E;&#x667A;&#x800C;&#x5BA1;&#x614E;&#x5730;&#x4F7F;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;</a></li>
</ul>
</li>
<li><a href="#7-%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B">7&#x3001;&#x6A21;&#x677F;&#x4E0E;&#x6CDB;&#x578B;&#x7F16;&#x7A0B;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-41%E4%BA%86%E8%A7%A3%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81">&#x6761;&#x6B3E; 41&#xFF1A;&#x4E86;&#x89E3;&#x9690;&#x5F0F;&#x63A5;&#x53E3;&#x548C;&#x7F16;&#x8BD1;&#x671F;&#x591A;&#x6001;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-42%E4%BA%86%E8%A7%A3-typename-%E7%9A%84%E5%8F%8C%E9%87%8D%E6%84%8F%E4%B9%89">&#x6761;&#x6B3E; 42&#xFF1A;&#x4E86;&#x89E3; typename &#x7684;&#x53CC;&#x91CD;&#x610F;&#x4E49;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-43%E5%AD%A6%E4%B9%A0%E5%A4%84%E7%90%86%E6%A8%A1%E6%9D%BF%E5%8C%96%E5%9F%BA%E7%B1%BB%E5%86%85%E7%9A%84%E5%90%8D%E7%A7%B0">&#x6761;&#x6B3E; 43&#xFF1A;&#x5B66;&#x4E60;&#x5904;&#x7406;&#x6A21;&#x677F;&#x5316;&#x57FA;&#x7C7B;&#x5185;&#x7684;&#x540D;&#x79F0;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-44%E5%B0%86%E4%B8%8E%E5%8F%82%E6%95%B0%E6%97%A0%E5%85%B3%E7%9A%84%E4%BB%A3%E7%A0%81%E6%8A%BD%E7%A6%BB-templates">&#x6761;&#x6B3E; 44&#xFF1A;&#x5C06;&#x4E0E;&#x53C2;&#x6570;&#x65E0;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x62BD;&#x79BB; templates</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-45%E8%BF%90%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E6%8E%A5%E6%94%B6%E6%89%80%E6%9C%89%E5%85%BC%E5%AE%B9%E7%B1%BB%E5%9E%8B">&#x6761;&#x6B3E; 45&#xFF1A;&#x8FD0;&#x7528;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6A21;&#x677F;&#x63A5;&#x6536;&#x6240;&#x6709;&#x517C;&#x5BB9;&#x7C7B;&#x578B;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-46%E9%9C%80%E8%A6%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%97%B6%E8%AF%B7%E4%B8%BA%E6%A8%A1%E6%9D%BF%E5%AE%9A%E4%B9%89%E9%9D%9E%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 46&#xFF1A;&#x9700;&#x8981;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x65F6;&#x8BF7;&#x4E3A;&#x6A21;&#x677F;&#x5B9A;&#x4E49;&#x975E;&#x6210;&#x5458;&#x51FD;&#x6570;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-47%E8%AF%B7%E4%BD%BF%E7%94%A8-traits-classes-%E8%A1%A8%E7%8E%B0%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF">&#x6761;&#x6B3E; 47&#xFF1A;&#x8BF7;&#x4F7F;&#x7528; traits classes &#x8868;&#x73B0;&#x7C7B;&#x578B;&#x4FE1;&#x606F;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-48%E8%AE%A4%E8%AF%86-template-%E5%85%83%E7%BC%96%E7%A8%8B">&#x6761;&#x6B3E; 48&#xFF1A;&#x8BA4;&#x8BC6; template &#x5143;&#x7F16;&#x7A0B;</a></li>
</ul>
</li>
<li><a href="#8-%E5%AE%9A%E5%88%B6-new-%E5%92%8C-delete">8&#x3001;&#x5B9A;&#x5236; new &#x548C; delete</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-49%E4%BA%86%E8%A7%A3-new-handler-%E7%9A%84%E8%A1%8C%E4%B8%BA">&#x6761;&#x6B3E; 49&#xFF1A;&#x4E86;&#x89E3; new-handler &#x7684;&#x884C;&#x4E3A;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-50%E4%BA%86%E8%A7%A3-new-%E5%92%8C-delete-%E7%9A%84%E5%90%88%E7%90%86%E6%9B%BF%E6%8D%A2%E6%97%B6%E6%9C%BA">&#x6761;&#x6B3E; 50&#xFF1A;&#x4E86;&#x89E3; new &#x548C; delete &#x7684;&#x5408;&#x7406;&#x66FF;&#x6362;&#x65F6;&#x673A;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-51%E7%BC%96%E5%86%99-new-%E5%92%8C-delete-%E6%97%B6%E9%9C%80%E5%9B%BA%E5%AE%88%E5%B8%B8%E8%A7%84">&#x6761;&#x6B3E; 51&#xFF1A;&#x7F16;&#x5199; new &#x548C; delete &#x65F6;&#x9700;&#x56FA;&#x5B88;&#x5E38;&#x89C4;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-52%E5%86%99%E4%BA%86-placement-new-%E4%B9%9F%E8%A6%81%E5%86%99-placement-delete">&#x6761;&#x6B3E; 52&#xFF1A;&#x5199;&#x4E86; placement new &#x4E5F;&#x8981;&#x5199; placement delete</a></li>
</ul>
</li>
<li><a href="#9-%E6%9D%82%E9%A1%B9%E8%AE%A8%E8%AE%BA">9&#x3001;&#x6742;&#x9879;&#x8BA8;&#x8BBA;</a>
<ul>
<li><a href="#%E6%9D%A1%E6%AC%BE-53%E4%B8%8D%E8%A6%81%E8%BD%BB%E5%BF%BD%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E8%AD%A6%E5%91%8A">&#x6761;&#x6B3E; 53&#xFF1A;&#x4E0D;&#x8981;&#x8F7B;&#x5FFD;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x8B66;&#x544A;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-54%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%86%9F%E6%82%89%E5%8C%85%E6%8B%AC-tr1-%E5%9C%A8%E5%86%85%E7%9A%84%E6%A0%87%E5%87%86%E7%A8%8B%E5%BA%8F%E5%BA%93">&#x6761;&#x6B3E; 54&#xFF1A;&#x8BA9;&#x81EA;&#x5DF1;&#x719F;&#x6089;&#x5305;&#x62EC; TR1 &#x5728;&#x5185;&#x7684;&#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;</a></li>
<li><a href="#%E6%9D%A1%E6%AC%BE-55%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%86%9F%E6%82%89-boost">&#x6761;&#x6B3E; 55&#xFF1A;&#x8BA9;&#x81EA;&#x5DF1;&#x719F;&#x6089; Boost</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 class="mume-header" id="1-%E8%AE%A9%E8%87%AA%E5%B7%B1%E4%B9%A0%E6%83%AF-c">1&#x3001;&#x8BA9;&#x81EA;&#x5DF1;&#x4E60;&#x60EF; C++</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-01%E8%A7%86-c-%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%AF%AD%E8%A8%80%E8%81%94%E9%82%A6">&#x6761;&#x6B3E; 01&#xFF1A;&#x89C6; C++ &#x4E3A;&#x4E00;&#x4E2A;&#x8BED;&#x8A00;&#x8054;&#x90A6;</h3>

<ul>
<li>C++ &#x9AD8;&#x6548;&#x7F16;&#x7A0B;&#x5B88;&#x5219;&#x89C6;&#x72B6;&#x51B5;&#x800C;&#x53D8;&#x5316;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x4F60;&#x4F7F;&#x7528; C++ &#x7684;&#x90A3;&#x4E00;&#x90E8;&#x5206;&#x3002;</li>
</ul>
<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-02%E5%B0%BD%E9%87%8F%E4%BB%A5-constenuminline-%E6%9B%BF%E6%8D%A2-define">&#x6761;&#x6B3E; 02&#xFF1A;&#x5C3D;&#x91CF;&#x4EE5; const&#xFF0C;enum&#xFF0C;inline &#x66FF;&#x6362; #define</h3>

<ul>
<li>&#x5BF9;&#x4E8E;&#x5355;&#x7EAF;&#x5E38;&#x91CF;&#xFF0C;&#x6700;&#x597D;&#x4EE5; const &#x5BF9;&#x8C61;&#x6216; enums &#x66FF;&#x6362; #defines&#x3002;</li>
<li>&#x5BF9;&#x4E8E;&#x5F62;&#x4F3C;&#x51FD;&#x6570;&#x7684;&#x5B8F;&#xFF08;macros&#xFF09;&#xFF0C;&#x6700;&#x597D;&#x6539;&#x7528; inline &#x51FD;&#x6570;&#x66FF;&#x6362; #defines&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">/* &#x4EE5;&#x4E00;&#x4E2A;&#x5E38;&#x91CF;&#x66FF;&#x6362;&#x5B8F;&#xFF08;#define&#xFF09; */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> ASPECT_RATIO 1.653</span>

<span class="token keyword">const</span> <span class="token keyword">double</span> AspectRatio <span class="token operator">=</span> <span class="token number">1.653</span><span class="token punctuation">;</span>   <span class="token comment">// &#x5927;&#x5199;&#x540D;&#x79F0;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x5B8F;</span>
                                    <span class="token comment">// &#x56E0;&#x6B64;&#x8FD9;&#x91CC;&#x6539;&#x53D8;&#x540D;&#x79F0;&#x5199;&#x6CD5;</span>





<span class="token comment">/* class &#x4E13;&#x5C5E;&#x5E38;&#x91CF; */</span>
<span class="token comment">// &#x4E3A;&#x786E;&#x4FDD;&#x6B64;&#x5E38;&#x91CF;&#x81F3;&#x591A;&#x53EA;&#x6709;&#x4E00;&#x4EFD;&#x5B9E;&#x4F53;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x8BA9;&#x5B83;&#x6210;&#x4E3A;&#x4E00;&#x4E2A; static &#x6210;&#x5458;</span>
<span class="token keyword">class</span> <span class="token class-name">GamePlayer</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> NumTurns <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5E38;&#x91CF;&#x58F0;&#x660E;&#x5F0F;</span>
    <span class="token keyword">int</span> scores<span class="token punctuation">[</span>NumTurns<span class="token punctuation">]</span><span class="token punctuation">;</span>               <span class="token comment">// &#x4F7F;&#x7528;&#x8BE5;&#x5E38;&#x91CF;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x53D6;&#x67D0;&#x4E2A; class &#x4E13;&#x5C5E;&#x5E38;&#x91CF;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x6216;&#x7F16;&#x8BD1;&#x5668;&#x575A;&#x6301;&#x8981;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x5F0F;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x5C31;&#x5FC5;&#x987B;&#x53E6;&#x5916;&#x63D0;&#x4F9B;&#x5B9A;&#x4E49;&#x5F0F;&#x5982;&#x4E0B;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> GamePlayer<span class="token operator">::</span>NumTurns<span class="token punctuation">;</span>     <span class="token comment">// NumTurns &#x7684;&#x5B9A;&#x4E49;&#xFF1B;</span>
                                    <span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x6CA1;&#x6709;&#x7ED9;&#x4E88;&#x6570;&#x503C;</span>
                                    <span class="token comment">// &#x7531;&#x4E8E; class &#x5E38;&#x91CF;&#x5DF2;&#x5728;&#x58F0;&#x660E;&#x65F6;&#x83B7;&#x5F97;&#x521D;&#x503C;</span>
                                    <span class="token comment">//&#xFF08;&#x4F8B;&#x5982;&#x5148;&#x524D;&#x58F0;&#x660E; NumTurns &#x65F6;&#x4E3A;&#x5B83;&#x8BBE;&#x521D;&#x503C; 5&#xFF09;</span>
                                    <span class="token comment">// &#x56E0;&#x6B64;&#x5B9A;&#x4E49;&#x65F6;&#x4E0D;&#x53EF;&#x4EE5;&#x518D;&#x8BBE;&#x521D;&#x503C;</span>

<span class="token comment">// &#x65E7;&#x5F0F;&#x7F16;&#x8BD1;&#x5668;&#x4E5F;&#x8BB8;&#x4E0D;&#x652F;&#x6301;&#x4E0A;&#x8FF0;&#x8BED;&#x6CD5;&#xFF0C;&#x5B83;&#x4EEC;&#x4E0D;&#x5141;&#x8BB8; static &#x6210;&#x5458;&#x5728;&#x5176;&#x58F0;&#x660E;&#x5F0F;&#x4E0A;&#x83B7;&#x5F97;&#x521D;&#x503C;</span>
<span class="token keyword">class</span> <span class="token class-name">CostEstimate</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">double</span> FudgeFactor<span class="token punctuation">;</span>    <span class="token comment">// static class &#x5E38;&#x91CF;&#x58F0;&#x660E;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x4F4D;&#x4E8E;&#x5934;&#x6587;&#x4EF6;&#x5185;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">double</span> CostEstimate<span class="token operator">::</span>FudgeFactor <span class="token operator">=</span> <span class="token number">1.35</span><span class="token punctuation">;</span>  <span class="token comment">// static class &#x5E38;&#x91CF;&#x5B9A;&#x4E49;</span>
                                                <span class="token comment">// &#x4F4D;&#x4E8E;&#x5B9E;&#x73B0;&#x6587;&#x4EF6;&#x5185;</span>





<span class="token comment">/* &#x679A;&#x4E3E;&#x7C7B;&#x578B; */</span>
<span class="token keyword">class</span> <span class="token class-name">GamePlayer</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">enum</span> <span class="token punctuation">{</span> NumTurns <span class="token operator">=</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">// &quot;the enum hack&quot;&#x2014;&#x2014; &#x4EE4; NumTurns</span>
                                <span class="token comment">// &#x6210;&#x4E3A; 5 &#x7684;&#x4E00;&#x4E2A;&#x8BB0;&#x53F7;&#x540D;&#x79F0;</span>
    <span class="token keyword">int</span> scores<span class="token punctuation">[</span>NumTurns<span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token comment">// &#x8FD9;&#x5C31;&#x6CA1;&#x95EE;&#x9898;&#x4E86;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">/* &#x51FD;&#x6570;&#x8C03;&#x7528; */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> CALL_WITH_MAX(a, b) f((a) &gt; (b) ? (a) : (b))</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">callWithMax</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span>a <span class="token operator">&gt;</span> b <span class="token operator">?</span> a <span class="token operator">:</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-03%E5%B0%BD%E5%8F%AF%E8%83%BD%E4%BD%BF%E7%94%A8-const">&#x6761;&#x6B3E; 03&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x7528; const</h3>

<ul>
<li>&#x5C06;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x58F0;&#x660E;&#x4E3A; const &#x53EF;&#x5E2E;&#x52A9;&#x7F16;&#x8BD1;&#x5668;&#x4FA6;&#x6D4B;&#x51FA;&#x9519;&#x8BEF;&#x7528;&#x6CD5;&#x3002;const &#x53EF;&#x88AB;&#x65BD;&#x52A0;&#x4E8E;&#x4EFB;&#x4F55;&#x4F5C;&#x7528;&#x57DF;&#x5185;&#x7684;&#x5BF9;&#x8C61;&#x3001;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x3001;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x3001;&#x6210;&#x5458;&#x51FD;&#x6570;&#x672C;&#x4F53;&#x3002;</li>
<li>&#x7F16;&#x8BD1;&#x5668;&#x5F3A;&#x5236;&#x5B9E;&#x65BD; bitwise constness&#xFF0C;&#x4F46;&#x4F60;&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#x65F6;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x201C;&#x6982;&#x5FF5;&#x4E0A;&#x7684;&#x5E38;&#x91CF;&#x6027;&#x201D;&#xFF08;conceptual constness&#xFF09;&#x3002;</li>
<li>&#x5F53; const &#x548C; non-const &#x6210;&#x5458;&#x51FD;&#x6570;&#x6709;&#x7740;&#x5B9E;&#x8D28;&#x7B49;&#x4EF7;&#x7684;&#x5B9E;&#x73B0;&#x65F6;&#xFF0C;&#x4EE4; non-const &#x7248;&#x672C;&#x8C03;&#x7528; const &#x7248;&#x672C;&#x53EF;&#x907F;&#x514D;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x5982;&#x679C;&#x5173;&#x952E;&#x5B57; const &#x51FA;&#x73B0;&#x5728;&#x661F;&#x53F7;&#x5DE6;&#x8FB9;&#xFF0C;&#x8868;&#x793A;&#x88AB;&#x6307;&#x7269;&#x662F;&#x5E38;&#x91CF;</span>
<span class="token comment">// &#x5982;&#x679C;&#x51FA;&#x73B0;&#x5728;&#x661F;&#x53F7;&#x53F3;&#x8FB9;&#xFF0C;&#x8868;&#x793A;&#x6307;&#x9488;&#x81EA;&#x8EAB;&#x662F;&#x5E38;&#x91CF;</span>
<span class="token comment">// &#x5982;&#x679C;&#x51FA;&#x73B0;&#x5728;&#x661F;&#x53F7;&#x4E24;&#x8FB9;&#xFF0C;&#x8868;&#x793A;&#x88AB;&#x6307;&#x7269;&#x548C;&#x6307;&#x9488;&#x4E24;&#x8005;&#x90FD;&#x662F;&#x5E38;&#x91CF;</span>
<span class="token keyword">char</span> greeting<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> greeting<span class="token punctuation">;</span>                 <span class="token comment">// non-const pointer, non-const data</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> greeting<span class="token punctuation">;</span>           <span class="token comment">// non-const pointer, const data</span>
<span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> p <span class="token operator">=</span> greeting<span class="token punctuation">;</span>           <span class="token comment">// const pointer, non-const data</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> p <span class="token operator">=</span> greeting<span class="token punctuation">;</span>     <span class="token comment">// const pointer, const data</span>





<span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">*</span> pw<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// f1 &#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x4E00;&#x4E2A;</span>
                                <span class="token comment">// &#x5E38;&#x91CF;&#x7684;&#xFF08;&#x4E0D;&#x53D8;&#x7684;&#xFF09;Widget &#x5BF9;&#x8C61;</span>
<span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span>Widget <span class="token keyword">const</span> <span class="token operator">*</span> pw<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// f2 &#x4E5F;&#x662F;</span>





std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">::</span>iterator iter <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// iter &#x7684;&#x4F5C;&#x7528;&#x50CF;&#x4E2A; T* const</span>
<span class="token operator">*</span>iter <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x6539;&#x53D8; iter &#x6240;&#x6307;&#x7269;</span>
<span class="token operator">++</span>iter<span class="token punctuation">;</span>         <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;iter &#x662F; const</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">::</span>const_iterator cIter <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cIter &#x7684;&#x4F5C;&#x7528;&#x50CF;&#x4E2A; const T*</span>
<span class="token operator">*</span>cIter <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>    <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;*cIter &#x662F; const</span>
<span class="token operator">++</span>cIter<span class="token punctuation">;</span>        <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x6539;&#x53D8; cIter</span>





<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> b <span class="token operator">=</span> c<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>      <span class="token comment">// &#x5176;&#x5B9E;&#x662F;&#x60F3;&#x505A;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#xFF08;comparison&#xFF09;&#x52A8;&#x4F5C;&#xFF01;</span>
                        <span class="token comment">// &#x5C06; operator* &#x7684;&#x56DE;&#x4F20;&#x503C;&#x58F0;&#x660E;&#x4E3A; const</span>
                        <span class="token comment">// &#x53EF;&#x4EE5;&#x9884;&#x9632;&#x90A3;&#x4E2A;&#x201C;&#x6CA1;&#x610F;&#x601D;&#x7684;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;&#x201D;</span>





<span class="token keyword">class</span> <span class="token class-name">TextBlock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span> <span class="token keyword">const</span>     <span class="token comment">// operator[] for</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> text<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                              <span class="token comment">// const &#x5BF9;&#x8C61;</span>
    <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span>                 <span class="token comment">// operator[] for</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> text<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                              <span class="token comment">// non-const &#x5BF9;&#x8C61;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

TextBlock <span class="token function">tb</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> tb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8C03;&#x7528; non-const TextBlock::operator[]</span>
<span class="token keyword">const</span> TextBlock <span class="token function">ctb</span><span class="token punctuation">(</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> ctb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// &#x8C03;&#x7528; const TextBlock::operator[]</span>

std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> tb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6CA1;&#x95EE;&#x9898; &#x2014;&#x2014; &#x8BFB;&#x4E00;&#x4E2A; non-const TextBlock</span>
tb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;x&apos;</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6CA1;&#x95EE;&#x9898; &#x2014;&#x2014; &#x5199;&#x4E00;&#x4E2A; non-const TextBlock</span>
std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> ctb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// &#x6CA1;&#x95EE;&#x9898; &#x2014;&#x2014; &#x8BFB;&#x4E00;&#x4E2A; const TextBlock</span>
ctb<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;x&apos;</span><span class="token punctuation">;</span>           <span class="token comment">// &#x9519;&#x8BEF;&#xFF01; &#x2014;&#x2014; &#x5199;&#x4E00;&#x4E2A; const TextBlock</span>





<span class="token keyword">class</span> <span class="token class-name">CTextBlock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>size_t <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">char</span><span class="token operator">*</span> pText<span class="token punctuation">;</span>
    <span class="token keyword">mutable</span> std<span class="token operator">::</span>size_t textLength<span class="token punctuation">;</span>         <span class="token comment">// &#x8FD9;&#x4E9B;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x53EF;&#x80FD;&#x603B;&#x662F;</span>
    <span class="token keyword">mutable</span> <span class="token keyword">bool</span> lengthIsValid<span class="token punctuation">;</span>             <span class="token comment">// &#x4F1A;&#x88AB;&#x66F4;&#x6539;&#xFF0C;&#x5373;&#x4F7F;&#x5728;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                          <span class="token comment">// const &#x6210;&#x5458;&#x51FD;&#x6570;&#x5185;&#x3002;</span>
std<span class="token operator">::</span>size_t CTextBlock<span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lengthIsValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        textLength <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">strlen</span><span class="token punctuation">(</span>pText<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#xFF0C;</span>
        lengthIsValid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>               <span class="token comment">// &#x4E5F;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x3002;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> textLength<span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">/* &#x5728; const &#x548C; non-const &#x6210;&#x5458;&#x51FD;&#x6570;&#x4E2D;&#x907F;&#x514D;&#x91CD;&#x590D; */</span>
<span class="token comment">// &#x4EE5;&#x4E0B;&#x91CD;&#x590D;&#x4E86;&#x4E00;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x4F8B;&#x5982;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x3001;&#x4E24;&#x6B21; return &#x8BED;&#x53E5;&#x7B49;&#x7B49;</span>
<span class="token keyword">class</span> <span class="token class-name">TextBlock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x8FB9;&#x754C;&#x68C0;&#x9A8C; &#xFF08;bounds checking&#xFF09;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x5FD7;&#x8BB0;&#x6570;&#x636E;&#x8BBF;&#x95EE; &#xFF08;log access data&#xFF09;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x68C0;&#x9A8C;&#x6570;&#x636E;&#x5B8C;&#x6574;&#x6027;&#xFF08;verify data integrity&#xFF09;</span>
        <span class="token keyword">return</span> text<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x8FB9;&#x754C;&#x68C0;&#x9A8C; &#xFF08;bounds checking&#xFF09;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x5FD7;&#x8BB0;&#x6570;&#x636E;&#x8BBF;&#x95EE; &#xFF08;log access data&#xFF09;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x68C0;&#x9A8C;&#x6570;&#x636E;&#x5B8C;&#x6574;&#x6027;&#xFF08;verify data integrity&#xFF09;</span>
        <span class="token keyword">return</span> text<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string text<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x907F;&#x514D;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x7684;&#x5B89;&#x5168;&#x505A;&#x6CD5; &#x2014;&#x2014; &#x5373;&#x4F7F;&#x8FC7;&#x7A0B;&#x4E2D;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;</span>
<span class="token keyword">class</span> <span class="token class-name">TextBlock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token comment">// &#x4E00;&#x5982;&#x65E2;&#x5F80;</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> text<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t position<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">const_cast</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>                  <span class="token comment">// &#x5C06; op[] &#x8FD4;&#x56DE;&#x503C;&#x7684; const &#x8F6C;&#x9664;</span>
            <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">const</span> TextBlock<span class="token operator">&amp;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span>    <span class="token comment">// &#x4E3A; *this &#x52A0;&#x4E0A; const</span>
                <span class="token punctuation">[</span>position<span class="token punctuation">]</span>                          <span class="token comment">// &#x8C03;&#x7528; const op[]</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-04%E7%A1%AE%E5%AE%9A%E5%AF%B9%E8%B1%A1%E8%A2%AB%E4%BD%BF%E7%94%A8%E5%89%8D%E5%B7%B2%E5%85%88%E8%A2%AB%E5%88%9D%E5%A7%8B%E5%8C%96">&#x6761;&#x6B3E; 04&#xFF1A;&#x786E;&#x5B9A;&#x5BF9;&#x8C61;&#x88AB;&#x4F7F;&#x7528;&#x524D;&#x5DF2;&#x5148;&#x88AB;&#x521D;&#x59CB;&#x5316;</h3>

<ul>
<li>&#x4E3A;&#x5185;&#x7F6E;&#x578B;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x624B;&#x5DE5;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x56E0;&#x4E3A; C++ &#x4E0D;&#x4FDD;&#x8BC1;&#x521D;&#x59CB;&#x5316;&#x5B83;&#x4EEC;&#x3002;</li>
<li>&#x6784;&#x9020;&#x51FD;&#x6570;&#x6700;&#x597D;&#x4F7F;&#x7528;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#xFF08;member initialization list&#xFF09;&#xFF0C;&#x800C;&#x4E0D;&#x8981;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x672C;&#x4F53;&#x4F7F;&#x7528;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#xFF08;assignment&#xFF09;&#x3002;&#x521D;&#x503C;&#x5217;&#x5217;&#x51FA;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x5176;&#x6392;&#x5217;&#x6B21;&#x5E8F;&#x5E94;&#x8BE5;&#x548C;&#x5B83;&#x4EEC;&#x5728; class &#x4E2D;&#x7684;&#x58F0;&#x660E;&#x6B21;&#x5E8F;&#x76F8;&#x540C;&#x3002;</li>
<li>&#x4E3A;&#x514D;&#x9664;&#x201C;&#x8DE8;&#x7F16;&#x8BD1;&#x5355;&#x5143;&#x4E4B;&#x521D;&#x59CB;&#x5316;&#x6B21;&#x5E8F;&#x201D;&#x95EE;&#x9898;&#xFF0C;&#x8BF7;&#x4EE5; local static &#x5BF9;&#x8C61;&#x66FF;&#x6362; non-local static &#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                  <span class="token comment">// &#x5BF9; int &#x8FDB;&#x884C;&#x624B;&#x5DE5;&#x521D;&#x59CB;&#x5316;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> text <span class="token operator">=</span> <span class="token string">&quot;A C-style string&quot;</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5BF9;&#x6307;&#x9488;&#x8FDB;&#x884C;&#x624B;&#x5DE5;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x4EA6;&#x89C1;&#x6761;&#x6B3E; 3&#xFF09;</span>

<span class="token keyword">double</span> d<span class="token punctuation">;</span>
std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> d<span class="token punctuation">;</span>      <span class="token comment">// &#x4EE5;&#x8BFB;&#x53D6; input stream &#x7684;&#x65B9;&#x5F0F;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;</span>





<span class="token comment">// &#x91CD;&#x8981;&#x7684;&#x662F;&#x522B;&#x6DF7;&#x6DC6;&#x4E86;&#x8D4B;&#x503C;&#xFF08;assignment&#xFF09;&#x548C;&#x521D;&#x59CB;&#x5316;&#xFF08;initialization&#xFF09;</span>
<span class="token keyword">class</span> <span class="token class-name">PhoneNumber</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">ABEntry</span> <span class="token punctuation">{</span>     <span class="token comment">// ABEntry = &quot;Address Book Entry&quot;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ABEntry</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> address<span class="token punctuation">,</span>
            <span class="token keyword">const</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span>PhoneNumber<span class="token operator">&gt;</span><span class="token operator">&amp;</span> phones<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string theName<span class="token punctuation">;</span>
    std<span class="token operator">::</span>string theAddress<span class="token punctuation">;</span>
    std<span class="token operator">::</span>lits<span class="token operator">&lt;</span>PhoneNumber<span class="token operator">&gt;</span> thePhones<span class="token punctuation">;</span>
    <span class="token keyword">int</span> numTimesConsulted<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
ABEntry<span class="token operator">::</span><span class="token function">ABEntry</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> address<span class="token punctuation">,</span>
                 <span class="token keyword">const</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span>PhoneNumber<span class="token operator">&gt;</span><span class="token operator">&amp;</span> phones<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    theName <span class="token operator">=</span> name<span class="token punctuation">;</span>             <span class="token comment">// &#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x8D4B;&#x503C;&#xFF08;assignment&#xFF09;</span>
    theAddress <span class="token operator">=</span> address<span class="token punctuation">;</span>       <span class="token comment">// &#x800C;&#x975E;&#x521D;&#x59CB;&#x5316;&#xFF08;initialization&#xFF09;</span>
    thePhones <span class="token operator">=</span> phones<span class="token punctuation">;</span>
    numTimesConsulted <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4F7F;&#x7528; member initialization list&#xFF08;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#xFF09;&#x66FF;&#x6362;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;&#xFF1A;</span>
ABEntry<span class="token operator">::</span><span class="token function">ABEntry</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> address<span class="token punctuation">,</span>
                 <span class="token keyword">const</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span>PhoneNumber<span class="token operator">&gt;</span><span class="token operator">&amp;</span> phones<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">theName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">theAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x521D;&#x59CB;&#x5316;&#xFF08;initialization&#xFF09;</span>
      <span class="token function">thePhones</span><span class="token punctuation">(</span>phones<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">numTimesConsulted</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>  <span class="token punctuation">}</span>                                <span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x672C;&#x4F53;&#x4E0D;&#x5FC5;&#x6709;&#x4EFB;&#x4F55;&#x52A8;&#x4F5C;</span>

<span class="token comment">// &#x5047;&#x8BBE; ABEntry &#x6709;&#x4E00;&#x4E2A;&#x65E0;&#x53C2;&#x6570;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x5C06;&#x5B83;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</span>
ABEntry<span class="token operator">::</span><span class="token function">ABEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">theName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token comment">// &#x8C03;&#x7528; theName &#x7684; default &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF1B;</span>
      <span class="token function">theAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// &#x4E3A; theAddress &#x505A;&#x7C7B;&#x4F3C;&#x52A8;&#x4F5C;&#xFF1B;</span>
      <span class="token function">thePhones</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment">// &#x4E3A; thePhones &#x505A;&#x7C7B;&#x4F3C;&#x52A8;&#x4F5C;&#xFF1B;</span>
      <span class="token function">numTimesConsulted</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>      <span class="token comment">// &#x8BB0;&#x5F97;&#x5C06; numTimesConsulted &#x663E;&#x793A;&#x521D;&#x59CB;&#x5316;&#x4E3A; 0</span>
<span class="token punctuation">{</span>  <span class="token punctuation">}</span>

<span class="token comment">// &#x4E3A;&#x907F;&#x514D;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4F55;&#x65F6;&#x5FC5;&#x987B;&#x5728;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#x4E2D;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x4F55;&#x65F6;&#x4E0D;&#x9700;&#x8981;&#xFF0C;&#x6700;&#x7B80;&#x5355;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#xFF1A;</span>
<span class="token comment">// &#x603B;&#x662F;&#x4F7F;&#x7528;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x6709;&#x65F6;&#x5019;&#x7EDD;&#x5BF9;&#x5FC5;&#x8981;&#xFF0C;&#x4E14;&#x53C8;&#x5F80;&#x5F80;&#x6BD4;&#x8D4B;&#x503C;&#x66F4;&#x9AD8;&#x6548;&#x3002;</span>





<span class="token comment">// C++ &#x6709;&#x7740;&#x5341;&#x5206;&#x56FA;&#x5B9A;&#x7684;&#x201C;&#x6210;&#x5458;&#x521D;&#x59CB;&#x5316;&#x6B21;&#x5E8F;&#x201D;&#x3002;</span>
<span class="token comment">// base classes &#x66F4;&#x65E9;&#x4E8E;&#x5176; derived classes &#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;</span>
<span class="token comment">// &#x800C; class &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x603B;&#x662F;&#x4EE5;&#x5176;&#x58F0;&#x660E;&#x6B21;&#x5E8F;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x3002;</span>
<span class="token comment">// &#x56DE;&#x5934;&#x770B;&#x770B; ABEntry&#xFF0C;&#x5176; theName &#x6210;&#x5458;&#x6C38;&#x8FDC;&#x6700;&#x5148;&#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x662F; theAddress&#xFF0C;&#x518D;&#x6765;&#x662F; thePhones&#xFF0C;&#x6700;&#x540E;&#x662F; numTimesConsulted&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x907F;&#x514D;&#x4F60;&#x6216;&#x4F60;&#x7684;&#x68C0;&#x9605;&#x8005;&#x8FF7;&#x60D1;&#xFF0C;&#x5E76;&#x907F;&#x514D;&#x67D0;&#x4E9B;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x6666;&#x6DA9;&#x9519;&#x8BEF;&#xFF0C;</span>
<span class="token comment">// &#x5F53;&#x4F60;&#x5728;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#x4E2D;&#x6761;&#x5217;&#x5404;&#x4E2A;&#x6210;&#x5458;&#x65F6;&#xFF0C;&#x6700;&#x597D;&#x603B;&#x662F;&#x4EE5;&#x5176;&#x58F0;&#x660E;&#x6B21;&#x5E8F;&#x4E3A;&#x6B21;&#x5E8F;&#x3002;</span>
<span class="token comment">// &#x4E0A;&#x8FF0;&#x6240;&#x8C13;&#x6666;&#x6DA9;&#x9519;&#x8BEF;&#xFF0C;&#x6307;&#x7684;&#x662F;&#x4E24;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5E26;&#x6709;&#x6B21;&#x5E8F;&#x6027;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x521D;&#x59CB;&#x5316; array &#x65F6;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5927;&#x5C0F;&#xFF0C;&#x56E0;&#x6B64;&#x4EE3;&#x8868;&#x5927;&#x5C0F;&#x7684;&#x90A3;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5FC5;&#x987B;&#x5148;&#x6709;&#x521D;&#x503C;&#x3002;</span>





<span class="token comment">// &#x201C;&#x4E0D;&#x540C;&#x7F16;&#x8BD1;&#x5355;&#x5143;&#x5185;&#x5B9A;&#x4E49;&#x4E4B; non-local static &#x5BF9;&#x8C61;&#x201D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x6B21;&#x5E8F;</span>
<span class="token keyword">class</span> <span class="token class-name">FileSystem</span> <span class="token punctuation">{</span>          <span class="token comment">// &#x6765;&#x81EA;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x5E93;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>size_t <span class="token function">numDisks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4F17;&#x591A;&#x6210;&#x5458;&#x51FD;&#x6570;&#x4E4B;&#x4E00;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> FileSystem tfs<span class="token punctuation">;</span>      <span class="token comment">// &#x9884;&#x5907;&#x7ED9;&#x5BA2;&#x6237;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF1B;</span>
                            <span class="token comment">// tfs &#x4EE3;&#x8868; &#x201C;the file system&#x201D;</span>

<span class="token keyword">class</span> <span class="token class-name">Directory</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Directory</span><span class="token punctuation">(</span> params <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Directory<span class="token operator">::</span><span class="token function">Directory</span><span class="token punctuation">(</span> params <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>size_t disks <span class="token operator">=</span> tfs<span class="token punctuation">.</span><span class="token function">numDisks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x4F7F;&#x7528; tfs &#x5BF9;&#x8C61;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

Directory <span class="token function">tempDir</span><span class="token punctuation">(</span> params <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x4E3A;&#x4E34;&#x65F6;&#x6587;&#x4EF6;&#x800C;&#x505A;&#x51FA;&#x7684;&#x76EE;&#x5F55;</span>

<span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x6B21;&#x5E8F;&#x7684;&#x91CD;&#x8981;&#x6027;&#x663E;&#x73B0;&#x51FA;&#x6765;&#x4E86;&#xFF1A;&#x9664;&#x975E; tfs &#x5728; tempDir &#x4E4B;&#x524D;&#x5148;&#x88AB;&#x521D;&#x59CB;&#x5316;&#xFF0C;</span>
<span class="token comment">// &#x5426;&#x5219; tempDir &#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4F1A;&#x7528;&#x5230;&#x5C1A;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684; tfs&#x3002;</span>
<span class="token comment">// C++ &#x5BF9;&#x201C;&#x5B9A;&#x4E49;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x7F16;&#x8BD1;&#x5355;&#x5143;&#x5185;&#x7684; non-local static &#x5BF9;&#x8C61;&#x201D;&#x7684;&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5BF9;&#x6B21;&#x5E8F;&#x5E76;&#x65E0;&#x660E;&#x786E;&#x5B9A;&#x4E49;</span>

<span class="token comment">// &#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x4FBF;&#x53EF;&#x5B8C;&#x5168;&#x6D88;&#x9664;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</span>
<span class="token comment">// &#x5C06;&#x6BCF;&#x4E2A; non-local static &#x5BF9;&#x8C61;&#x642C;&#x5230;&#x81EA;&#x5DF1;&#x7684;&#x4E13;&#x5C5E;&#x51FD;&#x6570;&#x5185;</span>
<span class="token comment">// &#xFF08;&#x8BE5;&#x5BF9;&#x8C61;&#x5728;&#x6B64;&#x51FD;&#x6570;&#x5185;&#x88AB;&#x58F0;&#x660E;&#x4E3A; static&#xFF09;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x5B83;&#x6240;&#x542B;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x7136;&#x540E;&#x7528;&#x6237;&#x8C03;&#x7528;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x76F4;&#x63A5;&#x6307;&#x6D89;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;non-local static &#x5BF9;&#x8C61;&#x88AB; local static &#x5BF9;&#x8C61;&#x66FF;&#x6362;&#x4E86;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x662F; Singleton &#x6A21;&#x5F0F;&#x7684;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x5B9E;&#x73B0;&#x624B;&#x6CD5;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x624B;&#x6CD5;&#x7684;&#x57FA;&#x7840;&#x5728;&#x4E8E;&#xFF1A;C++ &#x4FDD;&#x8BC1;&#xFF0C;&#x51FD;&#x6570;&#x5185;&#x7684; local static &#x5BF9;&#x8C61;&#x4F1A;&#x5728;</span>
<span class="token comment">// &#x201C;&#x8BE5;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x671F;&#x95F4;&#x201D;&#x201C;&#x9996;&#x6B21;&#x9047;&#x4E0A;&#x8BE5;&#x5BF9;&#x8C61;&#x4E4B;&#x5B9A;&#x4E49;&#x5F0F;&#x201D;&#x65F6;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x3002;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x4EE5;&#x201C;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x201D;&#xFF08;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411; local static &#x5BF9;&#x8C61;&#xFF09;</span>
<span class="token comment">// &#x66FF;&#x6362;&#x201C;&#x76F4;&#x63A5;&#x8BBF;&#x95EE; non-local static &#x5BF9;&#x8C61;&#x201D;&#xFF0C;&#x5C31;&#x83B7;&#x5F97;&#x4E86;&#x4FDD;&#x8BC1;&#xFF0C;</span>
<span class="token comment">// &#x4FDD;&#x8BC1;&#x4F60;&#x6240;&#x83B7;&#x5F97;&#x7684;&#x90A3;&#x4E2A; reference &#x5C06;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5386;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5BF9;&#x8C61;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">FileSystem</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>       <span class="token comment">// &#x540C;&#x524D;</span>
FileSystem<span class="token operator">&amp;</span> <span class="token function">tfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x6765;&#x66FF;&#x6362; tfs &#x5BF9;&#x8C61;&#xFF1B;</span>
<span class="token punctuation">{</span>                               <span class="token comment">// &#x5B83;&#x5728; FileSystem class &#x4E2D;&#x53EF;&#x80FD;&#x662F;&#x4E2A; static&#x3002;</span>
    <span class="token keyword">static</span> FileSystem fs<span class="token punctuation">;</span>       <span class="token comment">// &#x5B9A;&#x4E49;&#x5E76;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A; local static &#x5BF9;&#x8C61;&#x3002;</span>
    <span class="token keyword">return</span> fs<span class="token punctuation">;</span>                  <span class="token comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x4E0A;&#x8FF0;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Directory</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">// &#x540C;&#x524D;</span>
Directory<span class="token operator">::</span><span class="token function">Directory</span><span class="token punctuation">(</span> params <span class="token punctuation">)</span>  <span class="token comment">// &#x540C;&#x524D;&#xFF0C;&#x4F46;&#x539F;&#x672C;&#x7684; reference to tfs</span>
<span class="token punctuation">{</span>                               <span class="token comment">// &#x73B0;&#x5728;&#x6539;&#x4E3A; tfs()</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>size_t disks <span class="token operator">=</span> <span class="token function">tfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">numDisks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
Directory<span class="token operator">&amp;</span> <span class="token function">tempDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x6765;&#x66FF;&#x6362; tempDir &#x5BF9;&#x8C61;</span>
<span class="token punctuation">{</span>                               <span class="token comment">// &#x5B83;&#x5728; Directory class &#x4E2D;&#x53EF;&#x80FD;&#x662F;&#x4E2A; static&#x3002;</span>
    <span class="token keyword">static</span> Directory td<span class="token punctuation">;</span>        <span class="token comment">// &#x5B9A;&#x4E49;&#x5E76;&#x521D;&#x59CB;&#x5316; local static &#x5BF9;&#x8C61;&#xFF0C;</span>
    <span class="token keyword">return</span> td<span class="token punctuation">;</span>                  <span class="token comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x4E0A;&#x8FF0;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4F46;&#x662F;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x89D2;&#x5EA6;&#x770B;&#xFF0C;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x201C;&#x5185;&#x542B; static &#x5BF9;&#x8C61;&#x201D;&#x7684;&#x4E8B;&#x5B9E;&#x4F7F;&#x5B83;&#x4EEC;</span>
<span class="token comment">// &#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x7CFB;&#x7EDF;&#x4E2D;&#x5E26;&#x6709;&#x4E0D;&#x786E;&#x5B9A;&#x6027;&#x3002;&#x518D;&#x8BF4;&#x4E00;&#x6B21;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x79CD; non-const static</span>
<span class="token comment">// &#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x8BBA;&#x5B83;&#x662F; local &#x6216; non-local&#xFF0C;&#x5728;&#x591A;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E0B;&#x201C;&#x7B49;&#x5F85;&#x67D0;&#x4E8B;&#x53D1;&#x751F;&#x201D;&#x90FD;&#x4F1A;&#x6709;&#x9EBB;&#x70E6;&#x3002;</span>
<span class="token comment">// &#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x9EBB;&#x70E6;&#x7684;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#xFF1A;&#x5728;&#x7A0B;&#x5E8F;&#x7684;&#x5355;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;&#x9636;&#x6BB5;</span>
<span class="token comment">// &#xFF08;single-threaded startup portion&#xFF09;&#x624B;&#x5DE5;&#x8C03;&#x7528;&#x6240;&#x6709; reference-returning &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x53EF;&#x6D88;&#x9664;&#x4E0E;&#x521D;&#x59CB;&#x5316;&#x76F8;&#x5173;&#x7684;&#x201C;&#x7ADE;&#x901F;&#x5F62;&#x52BF;&#xFF08;race conditions&#xFF09;&#x201D;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="2-%E6%9E%84%E9%80%A0%E6%9E%90%E6%9E%84%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97">2&#x3001;&#x6784;&#x9020;/&#x6790;&#x6784;/&#x8D4B;&#x503C;&#x8FD0;&#x7B97;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-05%E4%BA%86%E8%A7%A3-c-%E9%BB%98%E9%BB%98%E7%BC%96%E5%86%99%E5%B9%B6%E8%B0%83%E7%94%A8%E5%93%AA%E4%BA%9B%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 05&#xFF1A;&#x4E86;&#x89E3; C++ &#x9ED8;&#x9ED8;&#x7F16;&#x5199;&#x5E76;&#x8C03;&#x7528;&#x54EA;&#x4E9B;&#x51FD;&#x6570;</h3>

<ul>
<li>&#x7F16;&#x8BD1;&#x5668;&#x53EF;&#x4EE5;&#x6697;&#x81EA;&#x4E3A; class &#x521B;&#x5EFA; default &#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;copy assignment &#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x4EE5;&#x53CA;&#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// empty class&#xFF08;&#x7A7A;&#x7C7B;&#xFF09;&#x4E0D;&#x518D;&#x662F;&#x4E2A; empty class&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x81EA;&#x5DF1;&#x6CA1;&#x58F0;&#x660E;&#xFF0C;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x5C31;&#x4F1A;&#x4E3A;&#x5B83;&#x58F0;&#x660E;&#xFF08;&#x7F16;&#x8BD1;&#x5668;&#x7248;&#x672C;&#x7684;&#xFF09;&#x4E00;&#x4E2A; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x4E00;&#x4E2A; </span>
<span class="token comment">// copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x548C;&#x4E00;&#x4E2A;&#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x6B64;&#x5916;&#x5982;&#x679C;&#x4F60;&#x6CA1;&#x6709;&#x58F0;&#x660E;&#x4EFB;&#x4F55;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4E5F;&#x4F1A;&#x4E3A;&#x4F60;&#x58F0;&#x660E;&#x4E00;&#x4E2A; default &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x90FD;&#x662F; public &#x4E14; inline&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x5199;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Empty</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x5C31;&#x597D;&#x50CF;&#x4F60;&#x5199;&#x4E0B;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Empty</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token function">Empty</span><span class="token punctuation">(</span><span class="token keyword">const</span> Empty<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

    Empty<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Empty<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Empty e1<span class="token punctuation">;</span>           <span class="token comment">// default &#x6784;&#x9020;&#x51FD;&#x6570;</span>
                    <span class="token comment">// &#x6790;&#x6784;&#x51FD;&#x6570;</span>
Empty <span class="token function">e2</span><span class="token punctuation">(</span>e1<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
e2 <span class="token operator">=</span> e1<span class="token punctuation">;</span>            <span class="token comment">// copy assignment &#x64CD;&#x4F5C;&#x7B26;</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">NamedObject</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">NamedObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">NamedObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string nameValue<span class="token punctuation">;</span>
    T objectValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

NamedObject<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">no1</span><span class="token punctuation">(</span><span class="token string">&quot;Smallest Prime Number&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
NamedObject<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">no2</span><span class="token punctuation">(</span>no1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8C03;&#x7528; copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">NamedObject</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// &#x4EE5;&#x4E0B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x5982;&#x4ECA;&#x4E0D;&#x518D;&#x63A5;&#x53D7;&#x4E00;&#x4E2A; const &#x540D;&#x79F0;&#xFF0C;&#x56E0;&#x4E3A; nameValue</span>
    <span class="token comment">// &#x5982;&#x4ECA;&#x662F;&#x4E2A; reference-to-non-const string&#x3002;&#x5148;&#x524D;&#x90A3;&#x4E2A; char* &#x6784;&#x9020;&#x51FD;&#x6570;</span>
    <span class="token comment">// &#x5DF2;&#x7ECF;&#x8FC7;&#x53BB;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5FC5;&#x987B;&#x6709;&#x4E2A; string &#x53EF;&#x4F9B;&#x6307;&#x6D89;&#x3002;</span>
    <span class="token function">NamedObject</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string name<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token comment">// &#x5982;&#x524D;&#xFF0C;&#x5047;&#x8BBE;&#x5E76;&#x672A;&#x58F0;&#x660E; operator=</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string<span class="token operator">&amp;</span> nameValue<span class="token punctuation">;</span>     <span class="token comment">// &#x8FD9;&#x5982;&#x4ECA;&#x662F;&#x4E2A; reference</span>
    <span class="token keyword">const</span> T objectValue<span class="token punctuation">;</span>        <span class="token comment">// &#x8FD9;&#x5982;&#x4ECA;&#x662F;&#x4E2A; const</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token operator">::</span>string <span class="token function">newDog</span><span class="token punctuation">(</span><span class="token string">&quot;Persephone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>string <span class="token function">oldDog</span><span class="token punctuation">(</span><span class="token string">&quot;Satch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
NamedObject<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">p</span><span class="token punctuation">(</span>newDog<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5F53;&#x521D;&#x64B0;&#x5199;&#x81F3;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x72D7; Persephone</span>
                                    <span class="token comment">// &#x5373;&#x5C06;&#x5EA6;&#x8FC7;&#x5176;&#x7B2C;&#x4E8C;&#x4E2A;&#x751F;&#x65E5;&#x3002;</span>
NamedObject<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">s</span><span class="token punctuation">(</span>oldDog<span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6211;&#x5C0F;&#x65F6;&#x5019;&#x517B;&#x7684;&#x72D7; Satch &#x5219;&#x662F; 36 &#x5C81;&#xFF0C;</span>
                                    <span class="token comment">// &#x2014;&#x2014; &#x5982;&#x679C;&#x5979;&#x8FD8;&#x6D3B;&#x7740;</span>

p <span class="token operator">=</span> s<span class="token punctuation">;</span>                              <span class="token comment">// &#x73B0;&#x5728; p &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8BE5;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1F;</span>

<span class="token comment">// C++ &#x7684;&#x54CD;&#x5E94;&#x662F;&#x62D2;&#x7EDD;&#x7F16;&#x8BD1;&#x90A3;&#x4E00;&#x884C;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x6253;&#x7B97;&#x5728;&#x4E00;&#x4E2A;&#x201C;&#x5185;&#x542B; reference &#x6210;&#x5458;&#x201D;&#x7684; class &#x5185;&#x652F;&#x6301;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#xFF08;assignment&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x5FC5;&#x987B;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-06%E8%8B%A5%E4%B8%8D%E6%83%B3%E4%BD%BF%E7%94%A8%E7%BC%96%E8%AF%91%E5%99%A8%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9A%84%E5%87%BD%E6%95%B0%E5%B0%B1%E8%AF%A5%E6%98%8E%E7%A1%AE%E6%8B%92%E7%BB%9D">&#x6761;&#x6B3E; 06&#xFF1A;&#x82E5;&#x4E0D;&#x60F3;&#x4F7F;&#x7528;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x8BE5;&#x660E;&#x786E;&#x62D2;&#x7EDD;</h3>

<ul>
<li>&#x4E3A;&#x9A73;&#x56DE;&#x7F16;&#x8BD1;&#x5668;&#x81EA;&#x52A8;&#xFF08;&#x6697;&#x81EA;&#xFF09;&#x63D0;&#x4F9B;&#x7684;&#x673A;&#x80FD;&#xFF0C;&#x53EF;&#x5C06;&#x76F8;&#x5E94;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E3A; private &#x5E76;&#x4E14;&#x4E0D;&#x4E88;&#x5B9E;&#x73B0;&#x3002;&#x4F7F;&#x7528;&#x50CF; Uncopyable &#x8FD9;&#x6837;&#x7684; base class &#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">HomeForSale</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

HomeForSale h1<span class="token punctuation">;</span>
HomeForSale h2<span class="token punctuation">;</span>
HomeForSale <span class="token function">h3</span><span class="token punctuation">(</span>h1<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x4F01;&#x56FE;&#x62F7;&#x8D1D; h1 &#x2014;&#x2014; &#x4E0D;&#x8BE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;</span>
h1 <span class="token operator">=</span> h2<span class="token punctuation">;</span>                <span class="token comment">// &#x4F01;&#x56FE;&#x62F7;&#x8D1D; h2 &#x2014;&#x2014; &#x4E5F;&#x4E0D;&#x8BE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeForSale</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">HomeForSale</span><span class="token punctuation">(</span><span class="token keyword">const</span> HomeForSale<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// &#x53EA;&#x6709;&#x58F0;&#x660E;</span>
    HomeForSale<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> HomeForSale<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x4E0D;&#x614E;&#x5728; member &#x51FD;&#x6570;&#x6216; friend &#x51FD;&#x6570;&#x4E4B;&#x5185;&#x90A3;&#x4E48;&#x505A;&#xFF0C;&#x8F6E;&#x5230;&#x8FDE;&#x63A5;&#x5668;&#x53D1;&#x51FA;&#x62B1;&#x6028;&#x3002;</span>
<span class="token comment">// &#x5C06;&#x8FDE;&#x63A5;&#x671F;&#x9519;&#x8BEF;&#x79FB;&#x81F3;&#x7F16;&#x8BD1;&#x671F;&#x662F;&#x53EF;&#x80FD;&#x7684;&#xFF08;&#x800C;&#x4E14;&#x90A3;&#x662F;&#x597D;&#x4E8B;&#xFF0C;&#x6BD5;&#x7ADF;&#x6108;&#x65E9;&#x4FA6;&#x6D4B;&#x51FA;&#x9519;&#x8BEF;&#x6108;&#x597D;&#xFF09;</span>
<span class="token keyword">class</span> <span class="token class-name">Uncopyable</span> <span class="token punctuation">{</span>
<span class="token keyword">protected</span><span class="token operator">:</span>                              <span class="token comment">// &#x5141;&#x8BB8; derived &#x5BF9;&#x8C61;&#x6784;&#x9020;&#x548C;&#x6790;&#x6784;</span>
    <span class="token function">Uncopyable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">Uncopyable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token function">Uncopyable</span><span class="token punctuation">(</span><span class="token keyword">const</span> Uncopyable<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4F46;&#x963B;&#x6B62; copying</span>
    Uncopyable<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Uncopyable<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E3A;&#x6C42;&#x963B;&#x6B62; HomeForSale &#x5BF9;&#x8C61;&#x62F7;&#x8D1D;&#xFF0C;&#x6211;&#x4EEC;&#x552F;&#x4E00;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x7EE7;&#x627F; Uncopyable&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">HomeForSale</span> <span class="token operator">:</span> <span class="token keyword">private</span> Uncopyable <span class="token punctuation">{</span>        <span class="token comment">// class &#x4E0D;&#x518D;&#x58F0;&#x660E;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x6216;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                              <span class="token comment">// copy assign. &#x64CD;&#x4F5C;&#x7B26;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-07%E4%B8%BA%E5%A4%9A%E6%80%81%E5%9F%BA%E7%B1%BB%E5%A3%B0%E6%98%8E-virtual-%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 07&#xFF1A;&#x4E3A;&#x591A;&#x6001;&#x57FA;&#x7C7B;&#x58F0;&#x660E; virtual &#x6790;&#x6784;&#x51FD;&#x6570;</h3>

<ul>
<li>polymorphic&#xFF08;&#x5E26;&#x591A;&#x6001;&#x6027;&#x8D28;&#x7684;&#xFF09;base classes &#x5E94;&#x8BE5;&#x58F0;&#x660E;&#x4E00;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C; class &#x5E26;&#x6709;&#x4EFB;&#x4F55; virtual &#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x5C31;&#x5E94;&#x8BE5;&#x62E5;&#x6709;&#x4E00;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</li>
<li>Classes &#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x5982;&#x679C;&#x4E0D;&#x662F;&#x4F5C;&#x4E3A; base classes &#x4F7F;&#x7528;&#xFF0C;&#x6216;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x5177;&#x5907;&#x591A;&#x6001;&#x6027;&#xFF08;polymorphically&#xFF09;&#xFF0C;&#x5C31;&#x4E0D;&#x8BE5;&#x58F0;&#x660E; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span>  <span class="token class-name">TimeKeeper</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">TimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">TimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">AtomicClock</span> <span class="token operator">:</span> <span class="token keyword">public</span> TimeKeeper <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">// &#x539F;&#x5B50;&#x949F;</span>
<span class="token keyword">class</span> <span class="token class-name">WaterClock</span> <span class="token operator">:</span> <span class="token keyword">public</span> TimeKeeper <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// &#x6C34;&#x949F;</span>
<span class="token keyword">class</span> <span class="token class-name">WristWatch</span> <span class="token operator">:</span> <span class="token keyword">public</span> TimeKeeper <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// &#x8155;&#x8868;</span>

TimeKeeper<span class="token operator">*</span> <span class="token function">getTimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x4E00;&#x4E2A;</span>
                                    <span class="token comment">// TimeKeeper &#x6D3E;&#x751F;&#x7C7B;&#x7684;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5BF9;&#x8C61;</span>

TimeKeeper<span class="token operator">*</span> ptk <span class="token operator">=</span> <span class="token function">getTimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4ECE; TimeKeeper &#x7EE7;&#x627F;&#x4F53;&#x7CFB;</span>
                                        <span class="token comment">// &#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x8FD0;&#x7528;&#x5B83;...</span>
<span class="token keyword">delete</span> ptk<span class="token punctuation">;</span>                             <span class="token comment">// &#x91CA;&#x653E;&#x5B83;&#xFF0C;&#x907F;&#x514D;&#x8D44;&#x6E90;&#x6CC4;&#x9732;</span>

<span class="token comment">// &#x95EE;&#x9898;&#x51FA;&#x5728; getTimeKeeper &#x8FD4;&#x56DE;&#x7684;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x4E2A; derived class &#x5BF9;&#x8C61;&#xFF08;&#x4F8B;&#x5982; AtomicClock&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x4E2A;&#x5BF9;&#x8C61;&#x5374;&#x7ECF;&#x7531;&#x4E00;&#x4E2A; base class &#x6307;&#x9488;&#xFF08;&#x4F8B;&#x5982;&#x4E00;&#x4E2A; TimeKeeper* &#x6307;&#x9488;&#xFF09;&#x88AB;&#x5220;&#x9664;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x76EE;&#x524D;&#x7684; base class&#xFF08;TimeKeeper&#xFF09;&#x6709;&#x4E2A; non-virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F;&#x4EE5;&#x4E00;&#x4E2A;&#x5F15;&#x6765;&#x707E;&#x96BE;&#x7684;&#x79D8;&#x8BC0;&#xFF0C;&#x56E0;&#x4E3A; C++ &#x660E;&#x767D;&#x6307;&#x51FA;&#xFF0C;</span>
<span class="token comment">// &#x5F53; derived class &#x5BF9;&#x8C61;&#x7ECF;&#x7531;&#x4E00;&#x4E2A; base class &#x6307;&#x9488;&#x88AB;&#x5220;&#x9664;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x8BE5; base class &#x5E26;&#x7740;&#x4E00;&#x4E2A; non-virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x5176;&#x7ED3;&#x679C;&#x672A;&#x6709;&#x5B9A;&#x4E49;&#x2014;&#x2014;&#x5B9E;&#x9645;&#x6267;&#x884C;&#x65F6;&#x901A;&#x5E38;&#x53D1;&#x751F;&#x7684;&#x662F;&#x5BF9;&#x8C61;&#x7684; derived &#x6210;&#x5206;&#x6CA1;&#x88AB;&#x9500;&#x6BC1;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; getTimeKeeper &#x8FD4;&#x56DE;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x4E2A; AtomicClock &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x5176;&#x5185;&#x7684; AtomicClock &#x6210;&#x5206;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x58F0;&#x660E;&#x4E8E; AtomicClock class &#x5185;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;&#x5F88;&#x53EF;&#x80FD;&#x6CA1;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;</span>
<span class="token comment">// &#x800C; AtomicClock &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E5F;&#x672A;&#x80FD;&#x6267;&#x884C;&#x8D77;&#x6765;&#x3002;</span>

<span class="token comment">// &#x6D88;&#x9664;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x7684;&#x505A;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x7ED9; base class &#x4E00;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x6B64;&#x540E;&#x5220;&#x9664; derived class &#x5BF9;&#x8C61;&#x5C31;&#x4F1A;&#x5982;&#x4F60;&#x60F3;&#x8981;&#x7684;&#x90A3;&#x822C;&#x3002;</span>
<span class="token comment">// &#x662F;&#x7684;&#xFF0C;&#x5B83;&#x4F1A;&#x9500;&#x6BC1;&#x6574;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5305;&#x62EC;&#x6240;&#x6709; derived class &#x6210;&#x5206;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">TimeKeeper</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">TimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">TimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
TimeKeeper<span class="token operator">*</span> ptk <span class="token operator">=</span> <span class="token function">getTimeKeeper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">delete</span> ptk<span class="token punctuation">;</span>         <span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x884C;&#x4E3A;&#x6B63;&#x786E;&#x3002;</span>





<span class="token comment">// &#x5982;&#x679C; class &#x4E0D;&#x542B; virtual &#x51FD;&#x6570;&#xFF0C;&#x901A;&#x5E38;&#x8868;&#x793A;&#x5B83;&#x5E76;&#x4E0D;&#x610F;&#x56FE;&#x88AB;&#x7528;&#x4F5C;&#x4E00;&#x4E2A; base class&#x3002;</span>
<span class="token comment">// &#x5F53; class &#x4E0D;&#x4F01;&#x56FE;&#x88AB;&#x5F53;&#x4F5C; base class&#xFF0C;&#x4EE4;&#x5176;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E3A; virtual &#x5F80;&#x5F80;&#x662F;&#x4E2A;&#x998A;&#x4E3B;&#x610F;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>               <span class="token comment">// &#x4E00;&#x4E2A;&#x4E8C;&#x7EF4;&#x7A7A;&#x95F4;&#x70B9;&#xFF08;2D point&#xFF09;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> xCoord<span class="token punctuation">,</span> <span class="token keyword">int</span> yCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5982;&#x679C; Point class &#x5185;&#x542B; virtual &#x51FD;&#x6570;&#xFF0C;&#x5176;&#x5BF9;&#x8C61;&#x4F53;&#x79EF;&#x4F1A;&#x589E;&#x52A0;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#xFF0C;&#x65E0;&#x7AEF;&#x5730;&#x5C06;&#x6240;&#x6709; classes &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E3A; virtual&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x50CF;&#x4ECE;&#x672A;&#x58F0;&#x660E;&#x5B83;&#x4EEC;&#x4E3A; virtual &#x4E00;&#x6837;&#xFF0C;&#x90FD;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">SpecialString</span> <span class="token operator">:</span> <span class="token keyword">public</span> std<span class="token operator">::</span>string <span class="token punctuation">{</span>   <span class="token comment">// &#x998A;&#x4E3B;&#x610F;&#xFF01;std::string &#x6709;&#x4E2A;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// non-virtual &#x6790;&#x6784;&#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

SpecialString<span class="token operator">*</span> pss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SpecialString</span><span class="token punctuation">(</span><span class="token string">&quot;Impending Doom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>string<span class="token operator">*</span> ps<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
ps <span class="token operator">=</span> pss<span class="token punctuation">;</span>           <span class="token comment">// SpecialString* =&gt; std::string*</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">delete</span> ps<span class="token punctuation">;</span>          <span class="token comment">// &#x672A;&#x6709;&#x5B9A;&#x4E49;&#xFF01;&#x73B0;&#x5B9E;&#x4E2D; *ps &#x7684; SpecialString &#x8D44;&#x6E90;&#x4F1A;&#x6CC4;&#x6F0F;&#xFF0C;</span>
                    <span class="token comment">// &#x56E0;&#x4E3A; SpecialString &#x6790;&#x6784;&#x51FD;&#x6570;&#x6CA1;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>

<span class="token comment">// &#x76F8;&#x540C;&#x7684;&#x5206;&#x6790;&#x9002;&#x7528;&#x4E8E;&#x4EFB;&#x4F55;&#x4E0D;&#x5E26; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x7684; class&#xFF0C;</span>
<span class="token comment">// &#x5305;&#x62EC;&#x6240;&#x6709; STL &#x5BB9;&#x5668;&#x5982; vector&#xFF0C;list&#xFF0C;set&#xFF0C;tr1::unordered_map &#x7B49;&#x7B49;&#x3002;</span>





<span class="token comment">// pure virtual &#x51FD;&#x6570;&#x5BFC;&#x81F4; abstract&#xFF08;&#x62BD;&#x8C61;&#xFF09;classes &#x2014;&#x2014; &#x4E5F;&#x5C31;&#x662F;</span>
<span class="token comment">// &#x4E0D;&#x80FD;&#x88AB;&#x5B9E;&#x4F53;&#x5316;&#xFF08;instantiated&#xFF09;&#x7684; class&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">AWOV</span> <span class="token punctuation">{</span>                <span class="token comment">// AWOV = &quot;Abstract w/o Virtuals&quot;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AWOV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// &#x58F0;&#x660E; pure virtual &#x6790;&#x6784;&#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A; class &#x6709;&#x4E00;&#x4E2A; pure virtual &#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x662F;&#x4E2A;&#x62BD;&#x8C61; class&#xFF0C;</span>
<span class="token comment">// &#x53C8;&#x7531;&#x4E8E;&#x5B83;&#x6709;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x62C5;&#x5FC3;&#x6790;&#x6784;&#x51FD;&#x6570;&#x7684;&#x95EE;&#x9898;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x7A8D;&#x95E8;&#xFF1A;&#x4F60;&#x5FC5;&#x987B;&#x4E3A;&#x8FD9;&#x4E2A; pure virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x4E00;&#x4EFD;&#x5B9A;&#x4E49;&#xFF1A;</span>
AWOV<span class="token operator">::</span><span class="token operator">~</span>AWOV <span class="token punctuation">{</span>  <span class="token punctuation">}</span>            <span class="token comment">// pure virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x7684;&#x5B9A;&#x4E49;</span>

<span class="token comment">// &#x6790;&#x6784;&#x51FD;&#x6570;&#x7684;&#x8FD0;&#x4F5C;&#x65B9;&#x5F0F;&#x662F;&#xFF0C;&#x6700;&#x6DF1;&#x5C42;&#x6D3E;&#x751F;&#xFF08;most derived&#xFF09;&#x7684;&#x90A3;&#x4E2A; class &#x5176;&#x6790;&#x6784;&#x51FD;&#x6570;&#x6700;&#x5148;&#x88AB;&#x8C03;&#x7528;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x662F;&#x5176;&#x6BCF;&#x4E00;&#x4E2A; base class &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x5728; AWOV &#x7684; derived classes &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E2D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9; ~AWOV &#x7684;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x5FC5;&#x987B;&#x4E3A;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x4E00;&#x4EFD;&#x5B9A;&#x4E49;&#x3002;</span>





<span class="token comment">// &#x201C;&#x7ED9; base classes &#x4E00;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x53EA;&#x9002;&#x7528;&#x4E8E; polymorphic&#xFF08;&#x5E26;&#x591A;&#x6001;&#x6027;&#x8D28;&#x7684;&#xFF09;base classes &#x8EAB;&#x4E0A;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x79CD; base classes &#x7684;&#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x662F;</span>
<span class="token comment">// &#x4E3A;&#x4E86;&#x7528;&#x6765;&#x201C;&#x901A;&#x8FC7; base class &#x63A5;&#x53E3;&#x5904;&#x7406; derived class &#x5BF9;&#x8C61;&#x201D;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-08%E5%88%AB%E8%AE%A9%E5%BC%82%E5%B8%B8%E9%80%83%E7%A6%BB%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 08&#xFF1A;&#x522B;&#x8BA9;&#x5F02;&#x5E38;&#x9003;&#x79BB;&#x6790;&#x6784;&#x51FD;&#x6570;</h3>

<ul>
<li>&#x6790;&#x6784;&#x51FD;&#x6570;&#x7EDD;&#x5BF9;&#x4E0D;&#x8981;&#x5410;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x88AB;&#x6790;&#x6784;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x6790;&#x6784;&#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x6355;&#x6349;&#x4EFB;&#x4F55;&#x5F02;&#x5E38;&#xFF0C;&#x7136;&#x540E;&#x541E;&#x4E0B;&#x5B83;&#x4EEC;&#xFF08;&#x4E0D;&#x4F20;&#x64AD;&#xFF09;&#x6216;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#x3002;</li>
<li>&#x5982;&#x679C;&#x5BA2;&#x6237;&#x9700;&#x8981;&#x5BF9;&#x67D0;&#x4E2A;&#x64CD;&#x4F5C;&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x629B;&#x51FA;&#x7684;&#x5F02;&#x5E38;&#x505A;&#x51FA;&#x53CD;&#x5E94;&#xFF0C;&#x90A3;&#x4E48; class &#x5E94;&#x8BE5;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x51FD;&#x6570;&#xFF08;&#x800C;&#x975E;&#x5728;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E2D;&#xFF09;&#x6267;&#x884C;&#x8BE5;&#x64CD;&#x4F5C;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">~</span><span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>       <span class="token comment">// &#x5047;&#x8BBE;&#x8FD9;&#x4E2A;&#x53EF;&#x80FD;&#x5410;&#x51FA;&#x4E00;&#x4E2A;&#x5F02;&#x5E38;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>                           <span class="token comment">// v &#x5728;&#x8FD9;&#x91CC;&#x88AB;&#x81EA;&#x52A8;&#x9500;&#x6BC1;</span>

<span class="token comment">// &#x5F53; vector v &#x88AB;&#x9500;&#x6BC1;&#xFF0C;&#x5B83;&#x6709;&#x8D23;&#x4EFB;&#x9500;&#x6BC1;&#x5176;&#x5185;&#x542B;&#x7684;&#x6240;&#x6709; Widgets&#x3002;</span>
<span class="token comment">// &#x5047;&#x8BBE; v &#x5185;&#x542B;&#x5341;&#x4E2A; Widgets&#xFF0C;&#x800C;&#x5728;&#x6790;&#x6784;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x671F;&#x95F4;&#xFF0C;&#x6709;&#x4E2A;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#x3002;</span>
<span class="token comment">// &#x5176;&#x4ED6;&#x4E5D;&#x4E2A; Widgets &#x8FD8;&#x662F;&#x5E94;&#x8BE5;&#x88AB;&#x9500;&#x6BC1;&#xFF08;&#x5426;&#x5219;&#x5B83;&#x4EEC;&#x4FDD;&#x5B58;&#x7684;&#x4EFB;&#x4F55;&#x8D44;&#x6E90;&#x90FD;&#x4F1A;&#x53D1;&#x751F;&#x6CC4;&#x6F0F;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x6B64; v &#x5E94;&#x8BE5;&#x8C03;&#x7528;&#x5B83;&#x4EEC;&#x5404;&#x4E2A;&#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;&#x4F46;&#x5047;&#x8BBE;&#x5728;&#x90A3;&#x4E9B;&#x8C03;&#x7528;&#x671F;&#x95F4;&#xFF0C;</span>
<span class="token comment">// &#x7B2C;&#x4E8C;&#x4E2A; Widget &#x6790;&#x6784;&#x51FD;&#x6570;&#x53C8;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x4E2A;&#x540C;&#x65F6;&#x4F5C;&#x7528;&#x7684;&#x5F02;&#x5E38;&#xFF0C;&#x8FD9;&#x5BF9; C++ &#x800C;&#x8A00;&#x592A;&#x591A;&#x4E86;&#x3002;</span>
<span class="token comment">// &#x5728;&#x4E24;&#x4E2A;&#x5F02;&#x5E38;&#x540C;&#x65F6;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7A0B;&#x5E8F;&#x82E5;&#x4E0D;&#x662F;&#x7ED3;&#x675F;&#x6267;&#x884C;&#x5C31;&#x662F;&#x5BFC;&#x81F4;&#x4E0D;&#x660E;&#x786E;&#x884C;&#x4E3A;&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x6267;&#x884C;&#x4E00;&#x4E2A;&#x52A8;&#x4F5C;&#xFF0C;&#x800C;&#x8BE5;&#x52A8;&#x4F5C;&#x8FD9;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x5931;&#x8D25;&#x65F6;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x8BE5;&#x600E;&#x4E48;&#x529E;&#xFF1F;</span>
<span class="token keyword">class</span> <span class="token class-name">DBConnection</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> DBConnection <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;</span>
                                        <span class="token comment">// DBConnection &#x5BF9;&#x8C61;&#xFF1B;</span>
                                        <span class="token comment">// &#x4E3A;&#x6C42;&#x7B80;&#x5316;&#x6682;&#x7565;&#x53C2;&#x6570;&#x3002;</span>
    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x5173;&#x95ED;&#x8054;&#x673A;&#xFF1B;&#x5931;&#x8D25;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E3A;&#x786E;&#x4FDD;&#x5BA2;&#x6237;&#x4E0D;&#x5FD8;&#x8BB0;&#x5728; DBConnection &#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;&#x8C03;&#x7528; close()&#xFF0C;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x5408;&#x7406;&#x7684;&#x60F3;&#x6CD5;&#x662F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x7BA1;&#x7406; DBConnection &#x8D44;&#x6E90;&#x7684; class&#xFF0C;</span>
<span class="token comment">// &#x5E76;&#x5728;&#x5176;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528; close&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">DBConn</span> <span class="token punctuation">{</span>          <span class="token comment">// &#x8FD9;&#x4E2A; class &#x7528;&#x6765;&#x7BA1;&#x7406; DBConnection &#x5BF9;&#x8C61;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">~</span><span class="token function">DBConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">// &#x786E;&#x4FDD;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#x603B;&#x662F;&#x4F1A;&#x88AB;&#x5173;&#x95ED;</span>
    <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    DBConnection db<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4FBF;&#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x5199;&#x51FA;&#x8FD9;&#x6837;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</span>
<span class="token punctuation">{</span>                                           <span class="token comment">// &#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x533A;&#x5757;&#xFF08;block&#xFF09;&#x3002;</span>
    DBConn <span class="token function">dbc</span><span class="token punctuation">(</span>DBConnection<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x5EFA;&#x7ACB; DBConnection &#x5BF9;&#x8C61;&#x5E76;</span>
                                            <span class="token comment">// &#x4EA4;&#x7ED9; DBConn &#x5BF9;&#x8C61;&#x4EE5;&#x4FBF;&#x7BA1;&#x7406;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x901A;&#x8FC7; DBConn &#x7684;&#x63A5;&#x53E3;</span>
                                            <span class="token comment">// &#x4F7F;&#x7528; DBConnection &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token punctuation">}</span>                                           <span class="token comment">// &#x5728;&#x533A;&#x5757;&#x7ED3;&#x675F;&#x70B9;&#xFF0C;DBConn &#x5BF9;&#x8C61;</span>
                                            <span class="token comment">// &#x88AB;&#x9500;&#x6BC1;&#xFF0C;&#x56E0;&#x800C;&#x81EA;&#x52A8;</span>
                                            <span class="token comment">// &#x4E3A; DBConnection &#x5BF9;&#x8C61;&#x8C03;&#x7528; close</span>

<span class="token comment">// &#x53EA;&#x8981;&#x8C03;&#x7528; close &#x6210;&#x529F;&#xFF0C;&#x4E00;&#x5207;&#x90FD;&#x7F8E;&#x597D;&#x3002;&#x4F46;&#x5982;&#x679C;&#x8BE5;&#x8C03;&#x7528;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#xFF0C;DBConn &#x6790;&#x6784;&#x51FD;&#x6570;&#x4F1A;&#x4F20;&#x64AD;&#x8BE5;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x662F;&#x5141;&#x8BB8;&#x5B83;&#x79BB;&#x5F00;&#x8FD9;&#x4E2A;&#x6790;&#x6784;&#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x4E24;&#x4E2A;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8FD9;&#x4E00;&#x95EE;&#x9898;&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C; close &#x629B;&#x51FA;&#x5F02;&#x5E38;&#x5C31;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#x3002;&#x901A;&#x5E38;&#x901A;&#x8FC7;&#x8C03;&#x7528; abort &#x5B8C;&#x6210;&#xFF1A;</span>
DBConn<span class="token operator">::</span><span class="token operator">~</span><span class="token function">DBConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x5236;&#x4F5C;&#x8FD0;&#x8F6C;&#x8BB0;&#x5F55;&#xFF0C;&#x8BB0;&#x4E0B;&#x5BF9; close &#x7684;&#x8C03;&#x7528;&#x5931;&#x8D25;&#xFF1B;</span>
        std<span class="token operator">::</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x5982;&#x679C;&#x7A0B;&#x5E8F;&#x906D;&#x9047;&#x4E00;&#x4E2A;&#x201C;&#x4E8E;&#x6790;&#x6784;&#x671F;&#x95F4;&#x53D1;&#x751F;&#x7684;&#x9519;&#x8BEF;&#x201D;&#x540E;&#x65E0;&#x6CD5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;</span>
<span class="token comment">// &#x201C;&#x5F3A;&#x8FEB;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#x201D;&#x662F;&#x4E2A;&#x5408;&#x7406;&#x9009;&#x9879;&#x3002;</span>

<span class="token comment">// &#x541E;&#x4E0B;&#x56E0;&#x8C03;&#x7528; close &#x800C;&#x53D1;&#x751F;&#x7684;&#x5F02;&#x5E38;&#xFF1A;</span>
DBConn<span class="token operator">::</span><span class="token operator">~</span><span class="token function">DBConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// &#x5236;&#x4F5C;&#x8FD0;&#x8F6C;&#x8BB0;&#x5F55;&#xFF0C;&#x8BB0;&#x4E0B;&#x5BF9; close &#x7684;&#x8C03;&#x7528;&#x5931;&#x8D25;&#xFF1B;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x4E00;&#x822C;&#x800C;&#x8A00;&#xFF0C;&#x5C06;&#x5F02;&#x5E38;&#x541E;&#x6389;&#x662F;&#x4E2A;&#x574F;&#x4E3B;&#x610F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x538B;&#x5236;&#x4E86;&#x201C;&#x67D0;&#x4E9B;&#x52A8;&#x4F5C;&#x5931;&#x8D25;&#x201D;&#x7684;&#x91CD;&#x8981;&#x4FE1;&#x606F;&#xFF01;</span>
<span class="token comment">// &#x7136;&#x800C;&#x6709;&#x65F6;&#x5019;&#x541E;&#x4E0B;&#x5F02;&#x5E38;&#x4E5F;&#x6BD4;&#x8D1F;&#x62C5;&#x201C;&#x8349;&#x7387;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#x201D;&#x6216;&#x201C;&#x4E0D;&#x660E;&#x786E;&#x884C;&#x4E3A;&#x5E26;&#x6765;&#x7684;&#x98CE;&#x9669;&#x201D;&#x597D;&#x3002;</span>

<span class="token comment">// &#x4E00;&#x4E2A;&#x8F83;&#x4F73;&#x7684;&#x7B56;&#x7565;&#x662F;&#x91CD;&#x65B0;&#x8BBE;&#x8BA1; DBConn &#x63A5;&#x53E3;&#xFF0C;&#x4F7F;&#x5176;&#x5BA2;&#x6237;&#x6709;&#x673A;&#x4F1A;&#x5BF9;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x95EE;&#x9898;&#x4F5C;&#x51FA;&#x53CD;&#x5E94;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">DBconn</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// &#x4F9B;&#x5BA2;&#x6237;&#x4F7F;&#x7528;&#x7684;&#x65B0;&#x51FD;&#x6570;</span>
    <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        closed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">DBConn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>closed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>               <span class="token comment">// &#x5173;&#x95ED;&#x8FDE;&#x63A5;&#xFF08;&#x5982;&#x679C;&#x5BA2;&#x6237;&#x4E0D;&#x90A3;&#x4E48;&#x505A;&#x7684;&#x8BDD;&#xFF09;</span>
                db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token comment">// &#x5982;&#x679C;&#x5173;&#x95ED;&#x52A8;&#x4F5C;&#x5931;&#x8D25;&#xFF0C;</span>
                <span class="token comment">// &#x5236;&#x4F5C;&#x8FD0;&#x8F6C;&#x8BB0;&#x5F55;&#xFF0C;&#x8BB0;&#x4E0B;&#x5BF9; close &#x7684;&#x8C03;&#x7528;&#x5931;&#x8D25;&#xFF1B;  // &#x8BB0;&#x4E0B;&#x6765;&#x5E76;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                      <span class="token comment">// &#x6216;&#x541E;&#x4E0B;&#x5F02;&#x5E38;&#x3002;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    DBConnection db<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> closed<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// &#x7531;&#x5BA2;&#x6237;&#x81EA;&#x5DF1;&#x8C03;&#x7528; close &#x5E76;&#x4E0D;&#x4F1A;&#x5BF9;&#x5B83;&#x4EEC;&#x5E26;&#x6765;&#x8D1F;&#x62C5;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x662F;&#x7ED9;&#x4ED6;&#x4EEC;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x9519;&#x8BEF;&#x7684;&#x673A;&#x4F1A;&#xFF0C;&#x5426;&#x5219;&#x4ED6;&#x4EEC;&#x6CA1;&#x6709;&#x673A;&#x4F1A;&#x54CD;&#x5E94;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4ED6;&#x4EEC;&#x4E0D;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A;&#x673A;&#x4F1A;&#x6709;&#x7528;&#xFF08;&#x6216;&#x8BB8;&#x4ED6;&#x4EEC;&#x575A;&#x4FE1;&#x4E0D;&#x4F1A;&#x6709;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x5B83;&#xFF0C;&#x4F9D;&#x8D56; DBConn &#x6790;&#x6784;&#x51FD;&#x6570;&#x53BB;&#x8C03;&#x7528; close&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x771F;&#x6709;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x2014;&#x2014;&#x5982;&#x679C; close &#x7684;&#x786E;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x2014;&#x2014;&#x800C;&#x4E14; DBConn &#x541E;&#x4E0B;&#x8BE5;&#x5F02;&#x5E38;&#x6216;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#xFF0C;</span>
<span class="token comment">// &#x5BA2;&#x6237;&#x6CA1;&#x6709;&#x7ACB;&#x573A;&#x62B1;&#x6028;&#xFF0C;&#x6BD5;&#x7ADF;&#x4ED6;&#x4EEC;&#x66FE;&#x6709;&#x673A;&#x4F1A;&#x7B2C;&#x4E00;&#x624B;&#x5904;&#x7406;&#x95EE;&#x9898;&#xFF0C;&#x800C;&#x4ED6;&#x4EEC;&#x9009;&#x62E9;&#x4E86;&#x653E;&#x5F03;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-09%E7%BB%9D%E4%B8%8D%E5%9C%A8%E6%9E%90%E6%9E%84%E5%92%8C%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B%E4%B8%AD%E8%B0%83%E7%94%A8-virtual-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 09&#xFF1A;&#x7EDD;&#x4E0D;&#x5728;&#x6790;&#x6784;&#x548C;&#x6784;&#x9020;&#x8FC7;&#x7A0B;&#x4E2D;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;</h3>

<ul>
<li>&#x5728;&#x6784;&#x9020;&#x548C;&#x6790;&#x6784;&#x671F;&#x95F4;&#x4E0D;&#x8981;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x7C7B;&#x8C03;&#x7528;&#x4ECE;&#x4E0D;&#x4E0B;&#x964D;&#x81F3; derived class&#xFF08;&#x6BD4;&#x8D77;&#x5F53;&#x524D;&#x6267;&#x884C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;&#x6790;&#x6784;&#x51FD;&#x6570;&#x7684;&#x90A3;&#x5C42;&#xFF09;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span>                             <span class="token comment">// &#x6240;&#x6709;&#x4EA4;&#x6613;&#x7684; base class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// &#x505A;&#x51FA;&#x4E00;&#x4EFD;&#x56E0;&#x7C7B;&#x578B;&#x4E0D;&#x540C;&#x800C;&#x4E0D;&#x540C;</span>
                                                <span class="token comment">// &#x7684;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#xFF08;log entry&#xFF09;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Transaction<span class="token operator">::</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// base class &#x6784;&#x9020;&#x51FD;&#x6570;&#x4E4B;&#x5B9E;&#x73B0;</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x6700;&#x540E;&#x52A8;&#x4F5C;&#x662F;&#x5FD7;&#x8BB0;&#x8FD9;&#x7B14;&#x4EA4;&#x6613;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BuyTransaction</span> <span class="token operator">:</span> <span class="token keyword">public</span> Transaction <span class="token punctuation">{</span>     <span class="token comment">// derived class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5FD7;&#x8BB0;&#xFF08;log&#xFF09;&#x6B64;&#x578B;&#x4EA4;&#x6613;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SellTransaction</span> <span class="token operator">:</span> <span class="token keyword">public</span> Transaction <span class="token punctuation">{</span>    <span class="token comment">// derived class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5FD7;&#x8BB0;&#xFF08;log&#xFF09;&#x6B64;&#x578B;&#x4EA4;&#x6613;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

BuyTransaction b<span class="token punctuation">;</span>
<span class="token comment">// &#x8FD9;&#x65F6;&#x5019;&#x88AB;&#x8C03;&#x7528;&#x7684; logTransaction &#x662F; Transaction &#x5185;&#x7684;&#x7248;&#x672C;&#xFF0C;</span>
<span class="token comment">// &#x4E0D;&#x662F; BuyTransaction &#x5185;&#x7684;&#x7248;&#x672C; &#x2014;&#x2014; &#x5373;&#x4F7F;&#x76EE;&#x524D;&#x5373;&#x5C06;&#x5EFA;&#x7ACB;&#x7684;&#x5BF9;&#x8C61;&#x7C7B;&#x578B;&#x662F; BuyTransaction&#x3002;</span>
<span class="token comment">// base class &#x6784;&#x9020;&#x671F;&#x95F4; virtual &#x51FD;&#x6570;&#x7EDD;&#x4E0D;&#x4F1A;&#x4E0B;&#x964D;&#x5230; derived classes &#x9636;&#x5C42;&#x3002;</span>
<span class="token comment">// &#x5728; base class &#x6784;&#x9020;&#x671F;&#x95F4;&#xFF0C;virtual &#x51FD;&#x6570;&#x4E0D;&#x662F; virtual &#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x7531;&#x4E8E; base class &#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x6267;&#x884C;&#x66F4;&#x65E9;&#x4E8E; derived class &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x5F53; base class &#x6784;&#x9020;&#x51FD;&#x6570;&#x6267;&#x884C;&#x65F6; derived class &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5C1A;&#x672A;&#x521D;&#x59CB;&#x5316;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x6B64;&#x671F;&#x95F4;&#x8C03;&#x7528;&#x7684; virtual &#x51FD;&#x6570;&#x4E0B;&#x964D;&#x81F3; derived classes &#x9636;&#x5C42;&#xFF0C;</span>
<span class="token comment">// &#x8981;&#x77E5;&#x9053; derived class &#x7684;&#x51FD;&#x6570;&#x51E0;&#x4E4E;&#x5FC5;&#x7136;&#x53D6;&#x7528; local &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x4E9B;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5C1A;&#x672A;&#x521D;&#x59CB;&#x5316;&#x3002;</span>

<span class="token comment">// &#x5BF9;&#x8C61;&#x5728; derived class &#x6784;&#x9020;&#x51FD;&#x6570;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x524D;&#x4E0D;&#x4F1A;&#x6210;&#x4E3A;&#x4E00;&#x4E2A; derived class &#x5BF9;&#x8C61;&#x3002;</span>





<span class="token comment">// &#x5982;&#x679C; Transaction &#x6709;&#x591A;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6BCF;&#x4E2A;&#x90FD;&#x9700;&#x6267;&#x884C;&#x67D0;&#x4E9B;&#x76F8;&#x540C;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x907F;&#x514D;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x7684;&#x4E00;&#x4E2A;&#x4F18;&#x79C0;&#x505A;&#x6CD5;&#x662F;&#x628A;&#x5171;&#x540C;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4EE3;&#x7801;</span>
<span class="token comment">// &#xFF08;&#x5176;&#x4E2D;&#x5305;&#x62EC;&#x5BF9; logTransaction &#x7684;&#x8C03;&#x7528;&#xFF09;&#x653E;&#x8FDB;&#x4E00;&#x4E2A;&#x521D;&#x59CB;&#x5316;&#x51FD;&#x6570;&#x5982; init &#x5185;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                                 <span class="token comment">// &#x8C03;&#x7528; non-virtual</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x8FD9;&#x91CC;&#x8C03;&#x7528; virtual&#xFF01;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4F46;&#x4F60;&#x5982;&#x4F55;&#x786E;&#x4FDD;&#x6BCF;&#x6B21;&#x4E00;&#x6709; Transaction &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E0A;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x4F1A;&#x6709;&#x9002;&#x5F53;&#x7248;&#x672C;&#x7684; logTransaction &#x88AB;&#x8C03;&#x7528;&#x5462;&#xFF1F;&#x5F88;&#x663E;&#x7136;&#xFF0C;&#x5728; Transaction</span>
<span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;s&#xFF09;&#x5185;&#x5BF9;&#x7740;&#x5BF9;&#x8C61;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;&#x662F;&#x4E00;&#x79CD;&#x9519;&#x8BEF;&#x505A;&#x6CD5;&#x3002;</span>

<span class="token comment">// &#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#x662F;&#xFF1A;</span>
<span class="token comment">// &#x5728; class Transaction &#x5185;&#x5C06; logTransaction &#x51FD;&#x6570;&#x6539;&#x4E3A; non-virtual&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x8981;&#x6C42; derived class &#x6784;&#x9020;&#x51FD;&#x6570;&#x4F20;&#x9012;&#x5FC5;&#x8981;&#x4FE1;&#x606F;&#x7ED9; Transaction &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x540E;&#x90A3;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4FBF;&#x53EF;&#x5B89;&#x5168;&#x5730;&#x8C03;&#x7528; non-virtual logTransaction&#x3002;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> logInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">logTransaction</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> logInfo<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>  <span class="token comment">// &#x5982;&#x4ECA;&#x662F;&#x4E2A;</span>
                                                            <span class="token comment">// non-virtual &#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Transaction<span class="token operator">::</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> logInfo<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">logTransaction</span><span class="token punctuation">(</span>logInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5982;&#x4ECA;&#x662F;&#x4E2A;</span>
                                    <span class="token comment">// non-virtual &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BuyTransaction</span> <span class="token operator">:</span> <span class="token keyword">public</span> Transaction <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">BuyTransaction</span><span class="token punctuation">(</span> parameters <span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token function">createLogString</span><span class="token punctuation">(</span> parameters <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// &#x5C06; log &#x4FE1;&#x606F;</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>                                     <span class="token comment">// &#x4F20;&#x7ED9; base class &#x6784;&#x9020;&#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>string <span class="token function">createLogString</span><span class="token punctuation">(</span> parameters <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#x7531;&#x4E8E;&#x4F60;&#x65E0;&#x6CD5;&#x4F7F;&#x7528; virtual &#x51FD;&#x6570;&#x4ECE; base classes &#x5411;&#x4E0B;&#x8C03;&#x7528;&#xFF0C;</span>
<span class="token comment">// &#x5728;&#x6784;&#x9020;&#x671F;&#x95F4;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x85C9;&#x7531;&#x201C;&#x4EE4; derived classes &#x5C06;&#x5FC5;&#x8981;&#x7684;&#x6784;&#x9020;&#x4FE1;&#x606F;</span>
<span class="token comment">// &#x5411;&#x4E0A;&#x4F20;&#x9012;&#x81F3; base class &#x6784;&#x9020;&#x51FD;&#x6570;&#x201D; &#x66FF;&#x6362;&#x4E4B;&#x800C;&#x52A0;&#x4EE5;&#x5F25;&#x8865;&#x3002;</span>

<span class="token comment">// &#x4EE4; createLogString &#x51FD;&#x6570;&#x4E3A; static&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;&#x610F;&#x5916;&#x6307;&#x5411;&#x201C;&#x521D;&#x671F;&#x672A;&#x6210;&#x719F;&#x4E4B;</span>
<span class="token comment">// BuyTransaction &#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x672A;&#x521D;&#x59CB;&#x5316;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x201D;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-10%E4%BB%A4-operator-%E8%BF%94%E5%9B%9E%E4%B8%80%E4%B8%AA-reference-to-this">&#x6761;&#x6B3E; 10&#xFF1A;&#x4EE4; operator= &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference to *this</h3>

<ul>
<li>&#x4EE4;&#x8D4B;&#x503C;&#xFF08;assignment&#xFF09;&#x64CD;&#x4F5C;&#x7B26;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference to *this&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
x <span class="token operator">=</span> y <span class="token operator">=</span> z <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>         <span class="token comment">// &#x8D4B;&#x503C;&#x8FDE;&#x9501;&#x5F62;&#x5F0F;</span>

<span class="token comment">// &#x8D4B;&#x503C;&#x91C7;&#x7528;&#x53F3;&#x7ED3;&#x5408;&#x5F8B;&#xFF0C;&#x6240;&#x4EE5;&#x4E0A;&#x8FF0;&#x8FDE;&#x9501;&#x8D4B;&#x503C;&#x88AB;&#x89E3;&#x6790;&#x4E3A;&#xFF1A;</span>
x <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>z <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>




<span class="token comment">// &#x4E3A;&#x4E86;&#x5B9E;&#x73B0;&#x201C;&#x8FDE;&#x9501;&#x8D4B;&#x503C;&#x201D;&#xFF0C;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#x7B26;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x64CD;&#x4F5C;&#x7B26;&#x7684;&#x5DE6;&#x4FA7;&#x5B9E;&#x53C2;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    Widget<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>       <span class="token comment">// &#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F;&#x4E2A; reference</span>
    <span class="token punctuation">{</span>                                           <span class="token comment">// &#x6307;&#x5411;&#x5F53;&#x524D;&#x5BF9;&#x8C61;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>                           <span class="token comment">// &#x8FD4;&#x56DE;&#x5DE6;&#x4FA7;&#x5BF9;&#x8C61;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x534F;&#x8BAE;&#x4E0D;&#x4EC5;&#x9002;&#x7528;&#x4E8E;&#x4EE5;&#x4E0A;&#x7684;&#x6807;&#x51C6;&#x8D4B;&#x503C;&#x5F62;&#x5F0F;&#xFF0C;&#x4E5F;&#x9002;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x8D4B;&#x503C;&#x76F8;&#x5173;&#x8FD0;&#x7B97;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    Widget<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>      <span class="token comment">// &#x8FD9;&#x4E2A;&#x534F;&#x8BAE;&#x9002;&#x7528;&#x4E8E;</span>
    <span class="token punctuation">{</span>                                           <span class="token comment">// +=&#xFF0C;-=&#xFF0C;*=&#xFF0C; &#x7B49;&#x7B49;&#x3002;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Widget<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> rhs<span class="token punctuation">)</span>     <span class="token comment">// &#x6B64;&#x51FD;&#x6570;&#x4E5F;&#x9002;&#x7528;&#xFF0C;&#x5373;&#x4F7F;</span>
    <span class="token punctuation">{</span>                               <span class="token comment">// &#x6B64;&#x4E00;&#x64CD;&#x4F5C;&#x7B26;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x4E0D;&#x7B26;&#x534F;&#x5B9A;&#x3002;</span>
        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-11%E5%9C%A8-operator-%E4%B8%AD%E5%A4%84%E7%90%86%E8%87%AA%E6%88%91%E8%B5%8B%E5%80%BC">&#x6761;&#x6B3E; 11&#xFF1A;&#x5728; operator= &#x4E2D;&#x5904;&#x7406;&#x201C;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x201D;</h3>

<ul>
<li>
<p>&#x786E;&#x4FDD;&#x5F53;&#x5BF9;&#x8C61;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x65F6; operator= &#x6709;&#x826F;&#x597D;&#x884C;&#x4E3A;&#x3002;&#x5176;&#x4E2D;&#x6280;&#x672F;&#x5305;&#x62EC;&#x6BD4;&#x8F83;&#x201C;&#x6765;&#x6E90;&#x5BF9;&#x8C61;&#x201D;&#x548C;&#x201C;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x201D;&#x7684;&#x5730;&#x5740;&#x3001;&#x7CBE;&#x5FC3;&#x5468;&#x5230;&#x7684;&#x8BED;&#x53E5;&#x987A;&#x5E8F;&#x3001;&#x4EE5;&#x53CA; copy-and-swap&#x3002;</p>
</li>
<li>
<p>&#x786E;&#x5B9A;&#x4EFB;&#x4F55;&#x51FD;&#x6570;&#x5982;&#x679C;&#x64CD;&#x4F5C;&#x4E00;&#x4E2A;&#x4EE5;&#x4E0A;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x800C;&#x5176;&#x4E2D;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x5176;&#x884C;&#x4E3A;&#x4ECD;&#x7136;&#x6B63;&#x786E;&#x3002;</p>
</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Widget w<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
w <span class="token operator">=</span> w<span class="token punctuation">;</span>              <span class="token comment">// &#x8D4B;&#x503C;&#x7ED9;&#x81EA;&#x5DF1;</span>

a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6F5C;&#x5728;&#x7684;&#x81EA;&#x6211;&#x8D4B;&#x503C;</span>
<span class="token comment">// &#x5982;&#x679C; i &#x548C; j &#x6709;&#x76F8;&#x540C;&#x7684;&#x503C;&#xFF0C;&#x8FD9;&#x4FBF;&#x662F;&#x4E2A;&#x81EA;&#x6211;&#x8D4B;&#x503C;</span>

<span class="token operator">*</span>px <span class="token operator">=</span> <span class="token operator">*</span>py<span class="token punctuation">;</span>          <span class="token comment">// &#x6F5C;&#x5728;&#x7684;&#x81EA;&#x6211;&#x8D4B;&#x503C;</span>
<span class="token comment">// &#x5982;&#x679C; px &#x548C; py &#x6070;&#x5DE7;&#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x4E1C;&#x897F;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x3002;</span>

<span class="token comment">// &#x4E00;&#x4E2A; base class &#x7684; reference &#x6216; pointer &#x53EF;&#x4EE5;&#x6307;&#x5411;&#x4E00;&#x4E2A; derived class &#x5BF9;&#x8C61;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token keyword">const</span> Base<span class="token operator">&amp;</span> rb<span class="token punctuation">,</span> Derived<span class="token operator">*</span> pd<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// rb &#x548C; *pd &#x6709;&#x53EF;&#x80FD;&#x5176;&#x5B9E;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</span>





<span class="token keyword">class</span> <span class="token class-name">Bitmap</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Bitmap<span class="token operator">*</span> pb<span class="token punctuation">;</span>         <span class="token comment">// &#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x4ECE; heap &#x5206;&#x914D;&#x800C;&#x5F97;&#x7684;&#x5BF9;&#x8C61;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4E0B;&#x9762;&#x662F; operator= &#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF0C;&#x8868;&#x9762;&#x4E0A;&#x770B;&#x8D77;&#x6765;&#x5408;&#x7406;&#xFF0C;&#x4F46;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x51FA;&#x73B0;&#x65F6;&#x5E76;&#x4E0D;&#x5B89;&#x5168;</span>
<span class="token comment">// &#xFF08;&#x5B83;&#x4E5F;&#x4E0D;&#x5177;&#x5907;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x6027;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x7A0D;&#x540E;&#x624D;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E2A;&#x4E3B;&#x9898;&#xFF09;&#x3002;</span>
Widget<span class="token operator">&amp;</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>   <span class="token comment">// &#x4E00;&#x4EFD;&#x4E0D;&#x5B89;&#x5168;&#x7684; operator= &#x5B9E;&#x73B0;&#x7248;&#x672C;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">delete</span> pd<span class="token punctuation">;</span>                                  <span class="token comment">// &#x505C;&#x6B62;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x7684; bitmap&#xFF0C;</span>
    pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Bitmap</span><span class="token punctuation">(</span><span class="token operator">*</span>rhs<span class="token punctuation">.</span>pb<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x4F7F;&#x7528; rhs&apos;s bitmap &#x7684;&#x526F;&#x672C;&#xFF08;&#x590D;&#x4EF6;&#xFF09;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>                               <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 10&#x3002;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x91CC;&#x7684;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x95EE;&#x9898;&#x662F;&#xFF0C;operator= &#x51FD;&#x6570;&#x5185;&#x7684; *this&#xFF08;&#x8D4B;&#x503C;&#x7684;&#x76EE;&#x7684;&#x7AEF;&#xFF09;&#x548C; rhs &#x6709;</span>
<span class="token comment">// &#x53EF;&#x80FD;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x679C;&#x771F;&#x5982;&#x6B64; delete &#x5C31;&#x4E0D;&#x53EA;&#x662F;&#x9500;&#x6BC1;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x7684; bitmap&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x4E5F;&#x9500;&#x6BC1; rhs &#x7684; bitmap&#x3002;&#x5728;&#x51FD;&#x6570;&#x672B;&#x5C3E;&#xFF0C;Widget&#x2014;&#x2014;&#x5B83;&#x539F;&#x672C;&#x4E0D;&#x8BE5;&#x88AB;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;</span>
<span class="token comment">// &#x6539;&#x53D8;&#x7684;&#x2014;&#x2014;&#x53D1;&#x73B0;&#x81EA;&#x5DF1;&#x6301;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#xFF01;</span>

<span class="token comment">// &#x6B32;&#x963B;&#x6B62;&#x8FD9;&#x79CD;&#x9519;&#x8BEF;&#xFF0C;&#x4F20;&#x7EDF;&#x505A;&#x6CD5;&#x662F;&#x85C9;&#x7531; operator= &#x6700;&#x524D;&#x9762;&#x7684;&#x4E00;&#x4E2A;&#x201C;&#x8BC1;&#x540C;&#x6D4B;&#x8BD5;&#xFF08;identity test&#xFF09;&#x201D;</span>
<span class="token comment">// &#x8FBE;&#x5230;&#x201C;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x201D;&#x7684;&#x68C0;&#x9A8C;&#x76EE;&#x7684;&#xFF1A;</span>
Widget<span class="token operator">&amp;</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8BC1;&#x540C;&#x6D4B;&#x8BD5;&#xFF08;identity test&#xFF09;&#xFF1A;</span>
                                        <span class="token comment">// &#x5982;&#x679C;&#x662F;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#xFF0C;&#x5C31;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x3002;</span>
    <span class="token keyword">delete</span> pb<span class="token punctuation">;</span>
    pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Bitmap</span><span class="token punctuation">(</span><span class="token operator">*</span>rhs<span class="token punctuation">.</span>pb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x65B0;&#x7248;&#x672C;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#x5F02;&#x5E38;&#x65B9;&#x9762;&#x7684;&#x9EBB;&#x70E6;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x201C;new Bitmap&#x201D;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#xFF08;&#x4E0D;&#x8BBA;&#x662F;&#x56E0;&#x4E3A;&#x5206;&#x914D;&#x65F6;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x6216;&#x56E0;&#x4E3A; Bitmap &#x7684;</span>
<span class="token comment">// copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF09;&#xFF0C;Widget &#x6700;&#x7EC8;&#x4F1A;&#x6301;&#x6709;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x5757;&#x88AB;&#x5220;&#x9664;&#x7684; Bitmap&#x3002;</span>
<span class="token comment">// &#x4F60;&#x65E0;&#x6CD5;&#x5B89;&#x5168;&#x5730;&#x5220;&#x9664;&#x5B83;&#x4EEC;&#xFF0C;&#x751A;&#x81F3;&#x65E0;&#x6CD5;&#x5B89;&#x5168;&#x5730;&#x8BFB;&#x53D6;&#x5B83;&#x4EEC;&#x3002;</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x53EA;&#x9700;&#x6CE8;&#x610F;&#x5728;&#x8D4B;&#x503C; pb &#x6240;&#x6307;&#x4E1C;&#x897F;&#x4E4B;&#x524D;&#x522B;&#x5220;&#x9664; pb&#xFF1A;</span>
Widget<span class="token operator">&amp;</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Bitmap<span class="token operator">*</span> pOrig <span class="token operator">=</span> pb<span class="token punctuation">;</span>             <span class="token comment">// &#x8BB0;&#x4F4F;&#x539F;&#x5148;&#x7684; pb</span>
    pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Bitmap</span><span class="token punctuation">(</span><span class="token operator">*</span>rhs<span class="token punctuation">.</span>pb<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4EE4; pb &#x6307;&#x5411; *pb &#x7684;&#x4E00;&#x4E2A;&#x9644;&#x4EF6;&#xFF08;&#x526F;&#x672C;&#xFF09;</span>
    <span class="token keyword">delete</span> pOrig<span class="token punctuation">;</span>                   <span class="token comment">// &#x5220;&#x9664;&#x539F;&#x5148;&#x7684; pb</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x5BF9;&#x539F; bitmap &#x505A;&#x4E86;&#x4E00;&#x4EFD;&#x590D;&#x4EF6;&#x3001;&#x5220;&#x9664;&#x539F; bitmap&#x3001;&#x7136;&#x540E;&#x6307;&#x5411;&#x65B0;&#x5236;&#x9020;&#x7684;&#x90A3;&#x4E2A;&#x590D;&#x4EF6;&#x3002;</span>





<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x5F88;&#x5173;&#x5FC3;&#x6548;&#x7387;&#xFF0C;&#x53EF;&#x4EE5;&#x628A;&#x201C;&#x8BC1;&#x540C;&#x6D4B;&#x8BD5;&#x201D;&#xFF08;identity test&#xFF09;&#x518D;&#x6B21;&#x653E;&#x56DE;&#x51FD;&#x6570;&#x8D77;&#x59CB;&#x5904;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x800C;&#x8FD9;&#x6837;&#x505A;&#x4E4B;&#x524D;&#x5148;&#x95EE;&#x95EE;&#x81EA;&#x5DF1;&#xFF0C;&#x4F60;&#x4F30;&#x8BA1;&#x201C;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x201D;&#x7684;&#x53D1;&#x751F;&#x9891;&#x7387;&#x6709;&#x591A;&#x9AD8;&#xFF1F;&#x56E0;&#x4E3A;&#x8FD9;&#x9879;&#x6D4B;&#x8BD5;</span>
<span class="token comment">// &#x4E5F;&#x9700;&#x8981;&#x6210;&#x672C;&#x3002;</span>
<span class="token comment">// &#x5728; operator= &#x51FD;&#x6570;&#x5185;&#x624B;&#x5DE5;&#x6392;&#x5217;&#x7684;&#x8BED;&#x53E5;&#xFF08;&#x786E;&#x4FDD;&#x4EE3;&#x7801;&#x4E0D;&#x4F46;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x201D;&#x800C;&#x4E14;&#x201C;&#x201D;&#x81EA;&#x6211;&#x8D4B;&#x503C;&#x5B89;&#x5168;&#xFF09;</span>
<span class="token comment">// &#x7684;&#x4E00;&#x4E2A;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x662F;&#xFF0C;&#x4F7F;&#x7528;&#x6240;&#x8C13;&#x7684; copy and swap &#x6280;&#x672F;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x4EA4;&#x6362; *this &#x548C; rhs &#x7684;&#x6570;&#x636E;&#xFF1B;&#x8BE6;&#x89C1;&#x6761;&#x6B3E; 29</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Widget<span class="token operator">&amp;</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Widget <span class="token function">temp</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4E3A; rhs &#x6570;&#x636E;&#x5236;&#x4F5C;&#x4E00;&#x4EFD;&#x590D;&#x4EF6;&#xFF08;&#x526F;&#x672C;&#xFF09;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x5C06; *this &#x6570;&#x636E;&#x548C;&#x4E0A;&#x8FF0;&#x590D;&#x4EF6;&#x7684;&#x6570;&#x636E;&#x4EA4;&#x6362;&#xFF0C;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5229;&#x7528;&#x4EE5;&#x4E0B;&#x4E8B;&#x5B9E;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x67D0; class &#x7684; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x53EF;&#x80FD;&#x88AB;&#x58F0;&#x660E;&#x4E3A;&#x201C;&#x4EE5; by value &#x65B9;&#x5F0F;&#x63A5;&#x53D7;&#x5B9E;&#x53C2;&#x201D;&#xFF1B;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x4EE5; by value &#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x4E1C;&#x897F;&#x4F1A;&#x9020;&#x6210;&#x4E00;&#x4EFD;&#x590D;&#x4EF6;/&#x526F;&#x672C;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 20&#xFF09;&#xFF1A;</span>
Widget<span class="token operator">&amp;</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span>Widget rhs<span class="token punctuation">)</span>      <span class="token comment">// rhs &#x662F;&#x88AB;&#x4F20;&#x5BF9;&#x8C61;&#x7684;&#x4E00;&#x4EFD;&#x590D;&#x4EF6;&#xFF08;&#x526F;&#x672C;&#xFF09;</span>
<span class="token punctuation">{</span>                                           <span class="token comment">// &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x662F; pass by value.</span>
    <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token comment">// &#x5C06; *this &#x7684;&#x6570;&#x636E;&#x548C;&#x590D;&#x4EF6;/&#x526F;&#x672C;&#x7684;&#x6570;&#x636E;&#x4E92;&#x6362;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x6211;&#x4E2A;&#x4EBA;&#x6BD4;&#x8F83;&#x5FE7;&#x8651;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x5B83;&#x4E3A;&#x4E86;&#x4F36;&#x4FD0;&#x5DE7;&#x5999;&#x7684;&#x4FEE;&#x8865;&#x800C;&#x727A;&#x7272;&#x4E86;&#x6E05;&#x6670;&#x6027;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C;&#x5C06;&#x201C;copying &#x52A8;&#x4F5C;&#x201D;&#x4ECE;&#x51FD;&#x6570;&#x672C;&#x4F53;&#x5185;&#x79FB;&#x81F3;&#x201C;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x6784;&#x9020;&#x9636;&#x6BB5;&#x201D;&#x5374;&#x53EF;&#x4EE4;&#x7F16;&#x8BD1;</span>
<span class="token comment">// &#x5668;&#x6709;&#x65F6;&#x751F;&#x6210;&#x66F4;&#x9AD8;&#x6548;&#x7684;&#x4EE3;&#x7801;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-12%E5%A4%8D%E5%88%B6%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%8B%BF%E5%BF%98%E5%85%B6%E6%AF%8F%E4%B8%80%E4%B8%AA%E6%88%90%E5%88%86">&#x6761;&#x6B3E; 12&#xFF1A;&#x590D;&#x5236;&#x5BF9;&#x8C61;&#x65F6;&#x52FF;&#x5FD8;&#x5176;&#x6BCF;&#x4E00;&#x4E2A;&#x6210;&#x5206;</h3>

<ul>
<li>Copying &#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x786E;&#x4FDD;&#x8D4B;&#x503C;&#x201C;&#x5BF9;&#x8C61;&#x5185;&#x7684;&#x6240;&#x6709;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x201D;&#x53CA;&#x201C;&#x6240;&#x6709; base class &#x6210;&#x5206;&#x201D;&#x3002;</li>
<li>&#x4E0D;&#x8981;&#x5C1D;&#x8BD5;&#x4EE5;&#x67D0;&#x4E2A; copying &#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x53E6;&#x4E00;&#x4E2A; copying &#x51FD;&#x6570;&#x3002;&#x5E94;&#x8BE5;&#x5C06;&#x5171;&#x540C;&#x673A;&#x80FD;&#x653E;&#x8FDB;&#x7B2C;&#x4E09;&#x4E2A;&#x51FD;&#x6570;&#x4E2D;&#xFF0C;&#x5E76;&#x6709;&#x4E24;&#x4E2A; copying &#x51FD;&#x6570;&#x5171;&#x540C;&#x8C03;&#x7528;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">void</span> <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> funcName<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5236;&#x9020;&#x4E00;&#x4E2A; log entry</span>
<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">Customer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Customer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Customer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Customer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Customer<span class="token operator">::</span><span class="token function">Customer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Customer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>                           <span class="token comment">// &#x590D;&#x5236; rhs &#x7684;&#x6570;&#x636E;</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;Customer copy constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Customer<span class="token operator">&amp;</span> Customer<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Customer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;Customer copy assignment operator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    name <span class="token operator">=</span> rhs<span class="token punctuation">.</span>name<span class="token punctuation">;</span>                            <span class="token comment">// &#x590D;&#x5236; rhs &#x7684;&#x6570;&#x636E;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>                               <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 10</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x91CC;&#x7684;&#x6BCF;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x770B;&#x8D77;&#x6765;&#x90FD;&#x5F88;&#x597D;&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x4E0A;&#x6BCF;&#x4EF6;&#x4E8B;&#x60C5;&#x4E5F;&#x7684;&#x786E;&#x90FD;&#x597D;&#xFF0C;&#x76F4;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x52A0;&#x5165;&#x6218;&#x5C40;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x65E5;&#x671F;</span>
<span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x540C;&#x524D;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
    Date lastTransaction<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x4E3A; class &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x540C;&#x65F6;&#x4FEE;&#x6539; copying &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#xFF08;&#x4F60;&#x4E5F;&#x9700;&#x8981;&#x4FEE;&#x6539; class &#x7684;&#x6240;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4EE5;&#x53CA;&#x4EFB;&#x4F55;&#x975E;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#x7684; operator=&#xFF09;</span>





<span class="token keyword">class</span> <span class="token class-name">PriorityCustomer</span> <span class="token operator">:</span> <span class="token keyword">public</span> Customer <span class="token punctuation">{</span>      <span class="token comment">// &#x4E00;&#x4E2A; derived class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">PriorityCustomer</span><span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    PriorityCustomer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> priority<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

PriorityCustomer<span class="token operator">::</span><span class="token function">PriorityCustomer</span><span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">priority</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>priority<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;PriorityCustomer copy constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

PriorityCustomer<span class="token operator">&amp;</span> PriorityCustomer<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;PriorityCustomer copy assignment operator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    priority <span class="token operator">=</span> rhs<span class="token punctuation">.</span>priority<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// PriorityCustomer &#x7684; copying &#x51FD;&#x6570;&#x590D;&#x5236;&#x4E86; PriorityCustomer &#x58F0;&#x660E;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6BCF;&#x4E2A; PriorityCustomer &#x8FD8;&#x5185;&#x542B;&#x5B83;&#x6240;&#x7EE7;&#x627F;&#x7684; Customer &#x6210;&#x5458;&#x53D8;&#x91CF;&#x590D;&#x4EF6;&#xFF08;&#x526F;&#x672C;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x4E9B;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5374;&#x672A;&#x88AB;&#x590D;&#x5236;&#x3002;</span>

<span class="token comment">// &#x4F60;&#x5E94;&#x8BE5;&#x8BA9; derived class &#x7684; copying &#x51FD;&#x6570;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x7684; base class &#x51FD;&#x6570;&#xFF1A;</span>
PriorityCustomer<span class="token operator">::</span><span class="token function">PriorityCustomer</span><span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">Customer</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">// &#x8C03;&#x7528; base class &#x7684; copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
      <span class="token function">priority</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>priority<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;PriorityCustomer copy constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

PriorityCustomer<span class="token operator">&amp;</span>
PriorityCustomer<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> PriorityCustomer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">logCall</span><span class="token punctuation">(</span><span class="token string">&quot;PriorityCustomer copy assignment operator&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Customer<span class="token operator">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x5BF9; base class &#x6210;&#x5206;&#x8FDB;&#x884C;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;</span>
    priority <span class="token operator">=</span> rhs<span class="token punctuation">.</span>priority<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5F53;&#x4F60;&#x7F16;&#x5199;&#x4E00;&#x4E2A; copying &#x51FD;&#x6570;&#xFF0C;&#x8BF7;&#x786E;&#x4FDD;&#xFF08;1&#xFF09;&#x590D;&#x5236;&#x6240;&#x6709; local &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x8C03;&#x7528;&#x6240;&#x6709; base classes &#x5185;&#x7684;&#x9002;&#x5F53;&#x7684; copying &#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x4EE4; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x8C03;&#x7528; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x4E0D;&#x5408;&#x7406;&#x7684;</span>
<span class="token comment">// &#x4EE4; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x8C03;&#x7528; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x540C;&#x6837;&#x65E0;&#x610F;&#x4E49;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x53D1;&#x73B0;&#x4F60;&#x7684; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x548C; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x6709;&#x76F8;&#x8FD1;&#x7684;&#x4EE3;&#x7801;&#xFF0C;</span>
<span class="token comment">// &#x6D88;&#x9664;&#x91CD;&#x590D;&#x4EE3;&#x7801;&#x7684;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x7ED9;&#x4E24;&#x8005;&#x8C03;&#x7528;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x5F80;&#x5F80;&#x662F; private &#x800C;&#x4E14;&#x5E38;&#x88AB;&#x547D;&#x540D;&#x4E3A; init&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#x53EF;&#x4EE5;&#x5B89;&#x5168;&#x6D88;&#x9664; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x548C; copy assignment &#x64CD;&#x4F5C;&#x7B26;</span>
<span class="token comment">// &#x4E4B;&#x95F4;&#x7684;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="3-%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86">3&#x3001;&#x8D44;&#x6E90;&#x7BA1;&#x7406;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-13%E4%BB%A5%E5%AF%B9%E8%B1%A1%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90">&#x6761;&#x6B3E; 13&#xFF1A;&#x4EE5;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;&#x8D44;&#x6E90;</h3>

<ul>
<li>&#x4E3A;&#x9632;&#x6B62;&#x8D44;&#x6E90;&#x6CC4;&#x9732;&#xFF0C;&#x8BF7;&#x4F7F;&#x7528; RAII &#x5BF9;&#x8C61;&#xFF0C;&#x5B83;&#x4EEC;&#x5728;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D;&#x83B7;&#x5F97;&#x8D44;&#x6E90;&#x5E76;&#x5728;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4E2D;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#x3002;</li>
<li>&#x4E24;&#x4E2A;&#x5E38;&#x88AB;&#x4F7F;&#x7528;&#x7684; RAII classes &#x5206;&#x522B;&#x662F; tr1::shared_ptr &#x548C; auto_ptr&#x3002;&#x524D;&#x8005;&#x901A;&#x5E38;&#x662F;&#x8F83;&#x4F73;&#x9009;&#x62E9;&#xFF0C;&#x56E0;&#x4E3A;&#x5176; copy &#x884C;&#x4E3A;&#x6BD4;&#x8F83;&#x76F4;&#x89C2;&#x3002;&#x82E5;&#x9009;&#x62E9; auto_ptr&#xFF0C;&#x590D;&#x5236;&#x52A8;&#x4F5C;&#x4F1A;&#x4F7F;&#x5B83;&#xFF08;&#x88AB;&#x590D;&#x5236;&#x7269;&#xFF09;&#x6307;&#x5411; null&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Investment</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>       <span class="token comment">// &#x201C;&#x6295;&#x8D44;&#x7C7B;&#x578B;&#x201D;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x7684; root class</span>

Investment<span class="token operator">*</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8FD4;&#x56DE;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411; Investment &#x7EE7;&#x627F;</span>
                                    <span class="token comment">// &#x4F53;&#x7CFB;&#x5185;&#x7684;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5BF9;&#x8C61;&#x3002;&#x8C03;&#x7528;&#x8005;&#x6709;&#x8D23;&#x4EFB;&#x5220;&#x9664;&#x5B83;&#x3002;</span>
                                    <span class="token comment">// &#x8FD9;&#x91CC;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#xFF0C;&#x523B;&#x610F;&#x4E0D;&#x5199;&#x53C2;&#x6570;&#x3002;</span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Investment<span class="token operator">*</span> pInv <span class="token operator">=</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8C03;&#x7528; factory &#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">delete</span> pInv<span class="token punctuation">;</span>                                <span class="token comment">// &#x91CA;&#x653E; pInv &#x6240;&#x6307;&#x5BF9;&#x8C61;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x8FD9;&#x770B;&#x8D77;&#x6765;&#x59A5;&#x5F53;&#xFF0C;&#x4F46;&#x82E5;&#x5E72;&#x60C5;&#x51B5;&#x4E0B; f &#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x5220;&#x9664;&#x5B83;&#x5F97;&#x81EA; createInvestment &#x7684;&#x6295;&#x8D44;&#x5BF9;&#x8C61;&#x2014;&#x2014;</span>
<span class="token comment">// &#x6216;&#x8BB8;&#x56E0;&#x4E3A;&#x201C;...&#x201D;&#x533A;&#x57DF;&#x5185;&#x7684;&#x4E00;&#x4E2A;&#x8FC7;&#x65E9;&#x7684; return &#x8BED;&#x53E5;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x4E00;&#x4E2A; return &#x88AB;&#x6267;&#x884C;&#x8D77;&#x6765;&#xFF0C;</span>
<span class="token comment">// &#x63A7;&#x5236;&#x6D41;&#x5C31;&#x7EDD;&#x4E0D;&#x4F1A;&#x89E6;&#x53CA; delete &#x8BED;&#x53E5;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x786E;&#x4FDD; createInvestment &#x8FD4;&#x56DE;&#x7684;&#x8D44;&#x6E90;&#x603B;&#x662F;&#x88AB;&#x91CA;&#x653E;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x5C06;&#x8D44;&#x6E90;&#x653E;&#x8FDB;&#x5BF9;&#x8C61;&#x5185;&#xFF0C;</span>
<span class="token comment">// &#x5F53;&#x63A7;&#x5236;&#x6D41;&#x79BB;&#x5F00; f&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x4F1A;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#x90A3;&#x4E9B;&#x8D44;&#x6E90;&#x3002;</span>





<span class="token comment">// &#x4E0B;&#x9762;&#x793A;&#x8303;&#x5982;&#x4F55;&#x4F7F;&#x7528; auto_ptr &#x4EE5;&#x907F;&#x514D; f &#x51FD;&#x6570;&#x6F5C;&#x5728;&#x7684;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x53EF;&#x80FD;&#x6027;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>auto_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">pInv</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// &#x8C03;&#x7528; factory &#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 <span class="token comment">// &#x4E00;&#x5982;&#x4EE5;&#x5F80;&#x5730;&#x4F7F;&#x7528; pInv</span>
<span class="token punctuation">}</span>                       <span class="token comment">// &#x7ECF;&#x7531; auto_ptr &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x81EA;&#x52A8;&#x5220;&#x9664; pInv</span>





<span class="token comment">// &#x5982;&#x679C;&#x5BF9;&#x8C61;&#x4F1A;&#x88AB;&#x5220;&#x9664;&#x4E00;&#x6B21;&#x4EE5;&#x4E0A;&#xFF0C;&#x4E3A;&#x4E86;&#x9884;&#x9632;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;auto_ptrs &#x6709;&#x4E00;&#x4E2A;&#x4E0D;&#x5BFB;&#x5E38;&#x7684;&#x6027;&#x8D28;&#xFF0C;</span>
<span class="token comment">// &#x82E5;&#x901A;&#x8FC7; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x6216; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x590D;&#x5236;&#x5B83;&#x4EEC;&#xFF0C;&#x5B83;&#x4EEC;&#x4F1A;&#x53D8;&#x6210; null&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x590D;&#x5236;&#x6240;&#x5F97;&#x7684;&#x6307;&#x9488;&#x5C06;&#x53D6;&#x5F97;&#x8D44;&#x6E90;&#x7684;&#x552F;&#x4E00;&#x62E5;&#x6709;&#x6743;&#xFF01;</span>
std<span class="token operator">::</span>auto_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">pInv1</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// pInv1 &#x6307;&#x5411;</span>
                                                      <span class="token comment">// createInvestment &#x8FD4;&#x56DE;&#x7269;&#x3002;</span>
std<span class="token operator">::</span>auto_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">pInv2</span><span class="token punctuation">(</span>pInv1<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x73B0;&#x5728; pInv2 &#x6307;&#x5411;&#x5BF9;&#x8C61;&#xFF0C;</span>
                                            <span class="token comment">// pInv1 &#x88AB;&#x8BBE;&#x4E3A; null&#xFF0C;</span>
pInv1 <span class="token operator">=</span> pInv2<span class="token punctuation">;</span>                              <span class="token comment">// &#x73B0;&#x5728; pInv1 &#x6307;&#x5411;&#x5BF9;&#x8C61;&#xFF0C;</span>
                                            <span class="token comment">// pInv2 &#x88AB;&#x8BBE;&#x4E3A; null</span>





<span class="token comment">// TR1 &#x7684; tr1::shared_ptr&#xFF08;&#x89C1;&#x6761;&#x6B3E; 54&#xFF09;&#x5C31;&#x662F;&#x4E2A; RCSP&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x4EE5;&#x8FD9;&#x4E48;&#x5199; f&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> 
    <span class="token function">pInv</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x8C03;&#x7528; factory &#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x4F7F;&#x7528; pInv &#x4E00;&#x5982;&#x4EE5;&#x5F80;</span>
<span class="token punctuation">}</span>                               <span class="token comment">// &#x7ECF;&#x7531; shared_ptr &#x6790;&#x6784;&#x51FD;&#x6570;&#x81EA;&#x52A8;&#x5220;&#x9664; pInv </span>

<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span>
    <span class="token function">pInv1</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// pInv1 &#x6307;&#x5411;</span>
                                        <span class="token comment">// createInvestment &#x8FD4;&#x56DE;&#x7269;&#x3002;</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span>
    <span class="token function">pInv2</span><span class="token punctuation">(</span>pInv1<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// pInv1 &#x548C; pInv2 &#x6307;&#x5411;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</span>
    pInv1 <span class="token operator">=</span> pInv2<span class="token punctuation">;</span>                      <span class="token comment">// &#x540C;&#x4E0A;&#xFF0C;&#x65E0;&#x4EFB;&#x4F55;&#x6539;&#x53D8;&#x3002;</span>
<span class="token punctuation">}</span>                                       <span class="token comment">// pInv1 &#x548C; pInv2 &#x88AB;&#x9500;&#x6BC1;&#xFF0C;</span>
                                        <span class="token comment">// &#x5B83;&#x4EEC;&#x6240;&#x6307;&#x7684;&#x5BF9;&#x8C61;&#x4E5F;&#x5C31;&#x88AB;&#x81EA;&#x52A8;&#x9500;&#x6BC1;</span>





<span class="token comment">// auto_ptr &#x548C; tr1::shared_ptr &#x4E24;&#x8005;&#x90FD;&#x5728;&#x5176;&#x6790;&#x6784;&#x51FD;&#x6570;&#x5185;&#x505A; delete</span>
<span class="token comment">// &#x800C;&#x4E0D;&#x662F; delete[] &#x52A8;&#x4F5C;&#xFF08;&#x6761;&#x6B3E; 16 &#x5BF9;&#x4E24;&#x8005;&#x7684;&#x4E0D;&#x540C;&#x6709;&#x4E9B;&#x63CF;&#x8FF0;&#xFF09;&#x3002;&#x90A3;&#x610F;&#x5473;</span>
<span class="token comment">// &#x5728;&#x52A8;&#x6001;&#x5206;&#x914D;&#x800C;&#x5F97;&#x7684; array &#x8EAB;&#x4E0A;&#x4F7F;&#x7528; auto_ptr &#x6216; tr1::shared_ptr &#x662F;&#x4E2A;&#x998A;&#x4E3B;&#x610F;&#x3002;</span>
std<span class="token operator">::</span>auto_ptr<span class="token operator">&lt;</span>std<span class="token operator">::</span>string<span class="token operator">&gt;</span>                      <span class="token comment">// &#x998A;&#x4E3B;&#x610F;&#xFF01;&#x4F1A;&#x7528;&#x4E0A;&#x9519;&#x8BEF;&#x7684;</span>
    <span class="token function">aps</span><span class="token punctuation">(</span><span class="token keyword">new</span> std<span class="token operator">::</span>string<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// delete &#x5F62;&#x5F0F;&#x3002;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">spi</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x76F8;&#x540C;&#x95EE;&#x9898;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-14%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E5%B0%8F%E5%BF%83-copying-%E8%A1%8C%E4%B8%BA">&#x6761;&#x6B3E; 14&#xFF1A;&#x5728;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7C7B;&#x4E2D;&#x5C0F;&#x5FC3; copying &#x884C;&#x4E3A;</h3>

<ul>
<li>&#x590D;&#x5236; RAII &#x5BF9;&#x8C61;&#x5FC5;&#x987B;&#x4E00;&#x5E76;&#x590D;&#x5236;&#x5B83;&#x6240;&#x7BA1;&#x7406;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x6240;&#x4EE5;&#x8D44;&#x6E90;&#x7684; copying &#x884C;&#x4E3A;&#x51B3;&#x5B9A; RAII &#x5BF9;&#x8C61;&#x7684; copying &#x884C;&#x4E3A;&#x3002;</li>
<li>&#x666E;&#x904D;&#x800C;&#x5E38;&#x89C1;&#x7684; RAII class copying &#x884C;&#x4E3A;&#x662F;&#xFF1A;&#x6291;&#x5236; copying&#x3001;&#x65BD;&#x884C;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x6CD5;&#xFF08;reference counting&#xFF09;&#x3002;&#x4E0D;&#x8FC7;&#x5176;&#x4ED6;&#x884C;&#x4E3A;&#x4E5F;&#x90FD;&#x53EF;&#x80FD;&#x88AB;&#x5B9E;&#x73B0;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span>Mutex<span class="token operator">*</span> pm<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x9501;&#x5B9A; pm &#x6240;&#x6307;&#x7684;&#x4E92;&#x65A5;&#x5668;</span>
<span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span>Mutex<span class="token operator">*</span> pm<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x5C06;&#x4E92;&#x65A5;&#x5668;&#x89E3;&#x9664;&#x9501;&#x5B9A;</span>

<span class="token comment">// &#x4E3A;&#x786E;&#x4FDD;&#x7EDD;&#x4E0D;&#x4F1A;&#x5FD8;&#x8BB0;&#x5C06;&#x4E00;&#x4E2A;&#x88AB;&#x9501;&#x4F4F;&#x7684; Mutex &#x89E3;&#x9501;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x5E0C;&#x671B;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;</span>
<span class="token comment">// class &#x7528;&#x6765;&#x7BA1;&#x7406;&#x673A;&#x9501;&#x3002;&#x8FD9;&#x6837;&#x7684; class &#x7684;&#x57FA;&#x672C;&#x7ED3;&#x6784;&#x6709; RAII &#x5B88;&#x5219;&#x652F;&#x914D;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x662F;&#x201C;&#x8D44;&#x6E90;&#x5728;&#x6784;&#x9020;&#x6E90;&#x671F;&#x95F4;&#x83B7;&#x5F97;&#xFF0C;&#x5728;&#x6790;&#x6784;&#x671F;&#x95F4;&#x91CA;&#x653E;&#x201D;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Lock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Lock</span><span class="token punctuation">(</span>Mutex<span class="token operator">*</span> pm<span class="token punctuation">)</span>
        <span class="token operator">:</span><span class="token function">mutexPtr</span><span class="token punctuation">(</span>pm<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token function">lock</span><span class="token punctuation">(</span>mutexPtr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>                 <span class="token comment">// &#x83B7;&#x5F97;&#x8D44;&#x6E90;</span>
    <span class="token operator">~</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">unlock</span><span class="token punctuation">(</span>mutexPtr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>       <span class="token comment">// &#x91CA;&#x653E;&#x8D44;&#x6E90;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Mutex<span class="token operator">*</span> mutexPtr<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5BA2;&#x6237;&#x5BF9; Lock &#x7684;&#x7528;&#x6CD5;&#x7B26;&#x5408; RAII &#x65B9;&#x5F0F;&#xFF1A;</span>
Mutex m<span class="token punctuation">;</span>            <span class="token comment">// &#x5B9A;&#x4E49;&#x4F60;&#x9700;&#x8981;&#x7684;&#x4E92;&#x65A5;&#x5668;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">{</span>                   <span class="token comment">// &#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x533A;&#x5757;&#x7528;&#x6765;&#x5B9A;&#x4E49; critical section</span>
    Lock <span class="token function">m1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x9501;&#x5B9A;&#x4E92;&#x65A5;&#x5668;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x6267;&#x884C; critical section &#x5185;&#x7684;&#x64CD;&#x4F5C;</span>
<span class="token punctuation">}</span>                   <span class="token comment">// &#x5728;&#x533A;&#x5757;&#x6700;&#x672B;&#x5C3E;&#xFF0C;&#x81EA;&#x52A8;&#x89E3;&#x9664;&#x4E92;&#x65A5;&#x5668;&#x9501;&#x5B9A;</span>

<span class="token comment">// &#x8FD9;&#x5F88;&#x597D;&#xFF0C;&#x4F46;&#x5982;&#x679C; Lock &#x5BF9;&#x8C61;&#x88AB;&#x590D;&#x5236;&#x3002;&#x8FD9;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1F;</span>
Lock <span class="token function">ml1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x9501;&#x5B9A; m</span>
Lock <span class="token function">ml2</span><span class="token punctuation">(</span>m11<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5C06; ml1 &#x590D;&#x5236;&#x5230; ml2 &#x8EAB;&#x4E0A;&#x3002;&#x8FD9;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1F;</span>





<span class="token comment">// &#x5F53;&#x4E00;&#x4E2A; RAII &#x5BF9;&#x8C61;&#x88AB;&#x590D;&#x5236;&#xFF0C;&#x4F1A;&#x53D1;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1F;</span>
<span class="token comment">// &#x4EE5;&#x4E0B;&#x4E24;&#x79CD;&#x53EF;&#x80FD;&#x9009;&#x62E9;&#xFF1A;</span>

<span class="token comment">// 1. &#x7981;&#x6B62;&#x590D;&#x5236;</span>
<span class="token keyword">class</span> <span class="token class-name">Lock</span> <span class="token operator">:</span> <span class="token keyword">private</span> Uncopyable <span class="token punctuation">{</span>       <span class="token comment">// &#x7981;&#x6B62;&#x590D;&#x5236;&#x3002;&#x89C1;&#x6761;&#x6B3E; 6</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x5982;&#x524D;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2. &#x5BF9;&#x5E95;&#x5C42;&#x8D44;&#x6E90;&#x796D;&#x51FA;&#x201C;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#x6CD5;&#x201D;&#xFF08;reference-count&#xFF09;</span>
<span class="token keyword">class</span> <span class="token class-name">Lock</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Lock</span><span class="token punctuation">(</span>Mutex<span class="token operator">*</span> pm<span class="token punctuation">)</span>            <span class="token comment">// &#x4EE5;&#x67D0;&#x4E2A; Mutex &#x521D;&#x59CB;&#x5316; shared_ptr</span>
        <span class="token operator">:</span> <span class="token function">mutexPtr</span><span class="token punctuation">(</span>pm<span class="token punctuation">,</span> unlock<span class="token punctuation">)</span>          <span class="token comment">// &#x5E76;&#x4EE5; unlock &#x51FD;&#x6570;&#x4E3A;&#x5220;&#x9664;&#x5668;</span>
    <span class="token punctuation">{</span>
        <span class="token function">lock</span><span class="token punctuation">(</span>mutexPtr<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x6761;&#x6B3E; 15 &#x8C08;&#x5230;&#x201C;get&#x201D;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Mutex<span class="token operator">&gt;</span> mutexPtr<span class="token punctuation">;</span>   <span class="token comment">// &#x4F7F;&#x7528; shared_ptr</span>
                                            <span class="token comment">// &#x66FF;&#x6362; raw pointer</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-15%E5%9C%A8%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%B1%BB%E4%B8%AD%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%8E%9F%E5%A7%8B%E8%B5%84%E6%BA%90%E7%9A%84%E8%AE%BF%E9%97%AE">&#x6761;&#x6B3E; 15&#xFF1A;&#x5728;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x7C7B;&#x4E2D;&#x63D0;&#x4F9B;&#x5BF9;&#x539F;&#x59CB;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;</h3>

<ul>
<li>APIs &#x5F80;&#x5F80;&#x8981;&#x6C42;&#x8BBF;&#x95EE;&#x539F;&#x59CB;&#x8D44;&#x6E90;&#xFF08;raw resource&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x4E00;&#x4E2A; RAII class &#x5E94;&#x8BE5;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x201C;&#x53D6;&#x5F97;&#x5176;&#x6240;&#x7BA1;&#x7406;&#x4E4B;&#x8D44;&#x6E90;&#x201D;&#x7684;&#x529E;&#x6CD5;&#x3002;</li>
<li>&#x5BF9;&#x539F;&#x59CB;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x53EF;&#x80FD;&#x7ECF;&#x7531;&#x663E;&#x5F0F;&#x8F6C;&#x6362;&#x6216;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x3002;&#x4E00;&#x822C;&#x800C;&#x8A00;&#x663E;&#x5F0F;&#x8F6C;&#x6362;&#x6BD4;&#x8F83;&#x5B89;&#x5168;&#xFF0C;&#x4F46;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x5BF9;&#x5BA2;&#x6237;&#x6BD4;&#x8F83;&#x65B9;&#x4FBF;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers">std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">pInv</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 13</span>

<span class="token keyword">int</span> <span class="token function">daysHeld</span><span class="token punctuation">(</span><span class="token keyword">const</span> Investment<span class="token operator">*</span> pi<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8FD4;&#x56DE;&#x6295;&#x8D44;&#x5929;&#x6570;</span>

<span class="token keyword">int</span> days <span class="token operator">=</span> <span class="token function">daysHeld</span><span class="token punctuation">(</span>pInv<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>

<span class="token keyword">int</span> days <span class="token operator">=</span> <span class="token function">daysHeld</span><span class="token punctuation">(</span>pInv<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5F88;&#x597D;&#xFF0C;&#x5C06; pInv &#x5185;&#x7684;&#x539F;&#x59CB;&#x6307;&#x9488;</span>
                                        <span class="token comment">// &#x4F20;&#x7ED9; daysHeld</span>





<span class="token keyword">class</span> <span class="token class-name">Investment</span> <span class="token punctuation">{</span>                      <span class="token comment">// investment &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x7684;&#x6839;&#x7C7B;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">isTaxFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Investment<span class="token operator">*</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// factory &#x51FD;&#x6570;</span>

std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span>        <span class="token comment">// &#x4EE4; tr1::shared_ptr</span>
    <span class="token function">pi1</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x7BA1;&#x7406;&#x4E00;&#x7B14;&#x8D44;&#x6E90;&#x3002;</span>

<span class="token keyword">bool</span> taxable1 <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span>pi1<span class="token operator">-&gt;</span><span class="token function">isTaxFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x7ECF;&#x7531; operator-&gt; &#x8BBF;&#x95EE;&#x8D44;&#x6E90;&#x3002;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
std<span class="token operator">::</span>auto_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">pi2</span><span class="token punctuation">(</span><span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4EE4; auto_ptr</span>
                                                        <span class="token comment">// &#x7BA1;&#x7406;&#x4E00;&#x7B14;&#x8D44;&#x6E90;&#x3002;</span>
<span class="token keyword">bool</span> taxable <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>pi2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isTaxFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x7ECF;&#x7531; operator* &#x8BBF;&#x95EE;&#x8D44;&#x6E90;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>





FontHandle <span class="token function">getFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x8FD9;&#x662F;&#x4E2A; C API&#x3002;&#x4E3A;&#x6C42;&#x7B80;&#x5316;&#x6682;&#x7565;&#x53C2;&#x6570;&#x3002;</span>

<span class="token keyword">void</span> <span class="token function">releaseFont</span><span class="token punctuation">(</span>FontHandle fh<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6765;&#x81EA;&#x540C;&#x4E00;&#x7EC4; C API</span>

<span class="token keyword">class</span> <span class="token class-name">Font</span> <span class="token punctuation">{</span>                            <span class="token comment">// RAII class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Font</span><span class="token punctuation">(</span>FontHandle fh<span class="token punctuation">)</span>        <span class="token comment">// &#x83B7;&#x5F97;&#x8D44;&#x6E90;&#xFF1B;</span>
        <span class="token operator">:</span> <span class="token function">f</span><span class="token punctuation">(</span>fh<span class="token punctuation">)</span>                         <span class="token comment">// &#x91C7;&#x7528; pass-by-value</span>
    <span class="token punctuation">{</span>  <span class="token punctuation">}</span>                                <span class="token comment">// &#x56E0;&#x4E3A; C API &#x8FD9;&#x6837;&#x505A;&#x3002;</span>
    <span class="token operator">~</span><span class="token function">Font</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">releaseFont</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>         <span class="token comment">// &#x91CA;&#x653E;&#x8D44;&#x6E90;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Fonthandle f<span class="token punctuation">;</span>                       <span class="token comment">// &#x539F;&#x59CB;&#xFF08;raw&#xFF09;&#x5B57;&#x4F53;&#x8D44;&#x6E90;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5047;&#x8BBE;&#x6709;&#x5927;&#x91CF;&#x4E0E;&#x5B57;&#x4F53;&#x76F8;&#x5173;&#x7684; C API&#xFF0C;&#x5B83;&#x4EEC;&#x5904;&#x7406;&#x7684;&#x662F; FontHandles&#xFF0C;&#x90A3;</span>
<span class="token comment">// &#x4E48;&#x201C;&#x5C06; Font &#x5BF9;&#x8C61;&#x8F6C;&#x6362;&#x4E3A; FontHandle&#x201D; &#x4F1A;&#x662F;&#x4E00;&#x79CD;&#x5F88;&#x9891;&#x7E41;&#x7684;&#x9700;&#x6C42;&#x3002;</span>
<span class="token comment">// Font class &#x53EF;&#x4E3A;&#x6B64;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x663E;&#x793A;&#x8F6C;&#x6362;&#x51FD;&#x6570;&#xFF0C;&#x50CF; get &#x90A3;&#x6837;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Font</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    FontHandle <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> f<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token comment">// &#x663E;&#x793A;&#x8F6C;&#x6362;&#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E0D;&#x5E78;&#x7684;&#x662F;&#x8FD9;&#x4F7F;&#x5F97;&#x5BA2;&#x6237;&#x6BCF;&#x5F53;&#x60F3;&#x8981;&#x4F7F;&#x7528; API &#x65F6;&#x5C31;&#x5FC5;&#x987B;&#x8C03;&#x7528; get&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">changeFontSize</span><span class="token punctuation">(</span>FontHandle f<span class="token punctuation">,</span> <span class="token keyword">int</span> newSize<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// C API</span>
Font <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> newFontSize<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">changeFontSize</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newFontSize<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x660E;&#x767D;&#x5730;&#x5C06; Font &#x8F6C;&#x6362;&#x4E3A; FontHandle</span>

<span class="token comment">// &#x67D0;&#x4E9B;&#x7A0B;&#x5E8F;&#x5458;&#x53EF;&#x80FD;&#x4F1A;&#x8BA4;&#x4E3A;&#xFF0C;&#x5982;&#x6B64;&#x8FD9;&#x822C;&#x5730;&#x5230;&#x5904;&#x8981;&#x6C42;&#x663E;&#x793A;&#x8F6C;&#x6362;&#xFF0C;&#x8DB3;&#x4EE5;&#x4F7F;&#x4EBA;&#x4EEC;</span>
<span class="token comment">// &#x5012;&#x5C3D;&#x80C3;&#x53E3;&#xFF0C;&#x4E0D;&#x518D;&#x613F;&#x610F;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A; class&#xFF0C;&#x4ECE;&#x800C;&#x589E;&#x52A0;&#x4E86; &#x6CC4;&#x6F0F;&#x5B57;&#x4F53;&#x7684;&#x53EF;&#x80FD;</span>
<span class="token comment">// &#x6027;&#xFF0C;&#x800C; Font class &#x7684;&#x4E3B;&#x8981;&#x8BBE;&#x8BA1;&#x76EE;&#x7684;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x8D44;&#x6E90;&#xFF08;&#x5B57;&#x4F53;&#xFF09;&#x6CC4;&#x6F0F;&#x3002;</span>

<span class="token comment">// &#x53E6;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#x662F;&#x4EE4; Font &#x63D0;&#x793A;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x51FD;&#x6570;&#xFF0C;&#x8F6C;&#x578B;&#x4E3A; FontHandle</span>
<span class="token keyword">class</span> <span class="token class-name">Font</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">operator</span> <span class="token function">FontHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>     <span class="token comment">// &#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x51FD;&#x6570;</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> f<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4F7F;&#x5F97;&#x5BA2;&#x6237;&#x8C03;&#x7528; C API &#x65F6;&#x6BD4;&#x8F83;&#x8F7B;&#x677E;&#x4E14;&#x81EA;&#x7136;&#xFF1A;</span>
Font <span class="token function">f</span><span class="token punctuation">(</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> newFontSize<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">changeFontSize</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> neFontSize<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5C06; Font &#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A; FontHandle</span>

<span class="token comment">// &#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x4F1A;&#x589E;&#x52A0;&#x9519;&#x8BEF;&#x53D1;&#x751F;&#x673A;&#x4F1A;&#x3002;&#x4F8B;&#x5982;&#x5BA2;&#x6237;&#x53EF;&#x80FD;&#x4F1A;&#x5728;&#x9700;&#x8981;</span>
<span class="token comment">// Font &#x65F6;&#x610F;&#x5916;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; FontHandle&#xFF1A;</span>
Font <span class="token function">f1</span><span class="token punctuation">(</span><span class="token function">getFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
FontHandle f2 <span class="token operator">=</span> f1<span class="token punctuation">;</span>                 <span class="token comment">// &#x539F;&#x610F;&#x8BC6;&#x8981;&#x62F7;&#x8D1D;&#x4E00;&#x4E2A; Font &#x5BF9;&#x8C61;</span>
                                    <span class="token comment">// &#x5374;&#x53CD;&#x800C;&#x5C06; f1 &#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A;&#x5176;&#x5E95;&#x90E8;&#x7684; FontHandle</span>
                                    <span class="token comment">// &#x7136;&#x540E;&#x624D;&#x590D;&#x5236;&#x5B83;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-16%E6%88%90%E5%AF%B9%E4%BD%BF%E7%94%A8-new-%E5%92%8C-delete-%E6%97%B6%E8%A6%81%E9%87%87%E5%8F%96%E7%9B%B8%E5%90%8C%E5%BD%A2%E5%BC%8F">&#x6761;&#x6B3E; 16&#xFF1A;&#x6210;&#x5BF9;&#x4F7F;&#x7528; new &#x548C; delete &#x65F6;&#x8981;&#x91C7;&#x53D6;&#x76F8;&#x540C;&#x5F62;&#x5F0F;</h3>

<ul>
<li>&#x5982;&#x679C;&#x4F60;&#x5728; new &#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528; []&#xFF0C;&#x5FC5;&#x987B;&#x5728;&#x76F8;&#x5E94;&#x7684; delete &#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4E5F;&#x4F7F;&#x7528; []&#x3002;&#x5982;&#x679C;&#x4F60;&#x5728; new &#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4E0D;&#x4F7F;&#x7528; []&#xFF0C;&#x4E00;&#x5B9A;&#x4E0D;&#x8981;&#x5728;&#x76F8;&#x5E94;&#x7684; delete &#x8868;&#x8FBE;&#x5F0F;&#x4E2D;&#x4F7F;&#x7528; []&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x4EE5;&#x4E0B;&#x52A8;&#x4F5C;&#x6709;&#x4EC0;&#x4E48;&#x9519;&#xFF1F;</span>
std<span class="token operator">::</span>string<span class="token operator">*</span> stringArray <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>string<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">delete</span> stringArray<span class="token punctuation">;</span>
<span class="token comment">// &#x4F7F;&#x7528;&#x4E86; new&#xFF0C;&#x4E5F;&#x642D;&#x914D;&#x4E86;&#x5BF9;&#x5E94;&#x7684; delete&#x3002;&#x4F46;&#x8FD8;&#x662F;&#x6709;&#x67D0;&#x6837;&#x4E1C;&#x897F;&#x5B8C;&#x5168;&#x9519;&#x8BEF;&#xFF1A;</span>
<span class="token comment">// &#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x884C;&#x4E3A;&#x4E0D;&#x660E;&#x786E;&#xFF08;&#x672A;&#x6709;&#x5B9A;&#x4E49;&#xFF09;&#x3002;&#x6700;&#x4F4E;&#x9650;&#x5EA6;&#xFF0C;stringArray &#x6240;&#x542B;&#x7684;</span>
<span class="token comment">// 100 &#x4E2A; string &#x5BF9;&#x8C61;&#x4E2D;&#x7684; 99 &#x4E2A;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x88AB;&#x9002;&#x5F53;&#x5220;&#x9664;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x7684;&#x6790;</span>
<span class="token comment">// &#x6784;&#x51FD;&#x6570;&#x5F88;&#x53EF;&#x80FD;&#x6CA1;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>





std<span class="token operator">::</span>string<span class="token operator">*</span> stringPtr1 <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>string<span class="token punctuation">;</span>
std<span class="token operator">::</span>string<span class="token operator">*</span> stringPtr2 <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>string<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">delete</span> stringPtr1<span class="token punctuation">;</span>          <span class="token comment">// &#x5220;&#x9664;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;</span>
<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> stringPtr2<span class="token punctuation">;</span>        <span class="token comment">// &#x5220;&#x9664;&#x4E00;&#x4E2A;&#x7531;&#x5BF9;&#x8C61;&#x7EC4;&#x6210;&#x7684;&#x6570;&#x7EC4;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x8C03;&#x7528; new &#x65F6;&#x4F7F;&#x7528; []&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x5728;&#x5BF9;&#x5E94;&#x8C03;&#x7528; delete &#x65F6;&#x4E5F;&#x4F7F;&#x7528; []&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x8C03;&#x7528; new &#x65F6;&#x6CA1;&#x6709;&#x4F7F;&#x7528; []&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x4E0D;&#x8BE5;&#x5728;&#x5BF9;&#x5E94;&#x8C03;&#x7528; delete &#x65F6;&#x4F7F;&#x7528; []&#x3002;</span>





<span class="token comment">// &#x8FD9;&#x4E2A;&#x89C4;&#x5219;&#x5BF9;&#x4E8E;&#x559C;&#x6B22;&#x4F7F;&#x7528; typedef &#x7684;&#x4EBA;&#x4E5F;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x610F;&#x5473; typedef &#x4F5C;&#x8005;</span>
<span class="token comment">// &#x5FC5;&#x987B;&#x8BF4;&#x6E05;&#x695A;&#xFF0C;&#x5F53;&#x7A0B;&#x5E8F;&#x5458;&#x4EE5; new &#x521B;&#x5EFA;&#x8FD9;&#x79CD; typedef &#x7C7B;&#x578B;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x8BE5;&#x4EE5;</span>
<span class="token comment">// &#x54EA;&#x4E00;&#x79CD; delete &#x5F62;&#x5F0F;&#x5220;&#x9664;&#x4E4B;&#x3002;&#x8003;&#x8651;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A; typedef&#xFF1A;</span>
<span class="token keyword">typedef</span> std<span class="token operator">::</span>string AddressLines<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6BCF;&#x4E2A;&#x4EBA;&#x7684;&#x5730;&#x5740;&#x6709; 4 &#x884C;&#xFF0C;</span>
                                            <span class="token comment">// &#x6BCF;&#x884C;&#x662F;&#x4E00;&#x4E2A; string</span>

<span class="token comment">// &#x7531;&#x4E8E; AddressLines &#x662F;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x6837;&#x4F7F;&#x7528; new&#xFF1A;</span>
std<span class="token operator">::</span>string<span class="token operator">*</span> pal <span class="token operator">=</span> <span class="token keyword">new</span> AddressLines<span class="token punctuation">;</span>        <span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x201C;new AddressLines&#x201D; &#x8FD4;&#x56DE;</span>
                                            <span class="token comment">// &#x4E00;&#x4E2A; string*&#xFF0C;&#x5C31;&#x50CF;</span>
                                            <span class="token comment">// &#x201C;new string[4]&#x201D;&#x4E00;&#x6837;&#x3002;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x5C31;&#x5FC5;&#x987B;&#x5339;&#x914D;&#x201C;&#x6570;&#x7EC4;&#x5F62;&#x5F0F;&#x201D;&#x7684; delete&#xFF1A;</span>
<span class="token keyword">delete</span> pal<span class="token punctuation">;</span>         <span class="token comment">// &#x884C;&#x4E3A;&#x672A;&#x6709;&#x5B9A;&#x4E49;&#xFF01;</span>
<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pal<span class="token punctuation">;</span>       <span class="token comment">// &#x5F88;&#x597D;&#x3002;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-17%E4%BB%A5%E7%8B%AC%E7%AB%8B%E8%AF%AD%E5%8F%A5%E5%B0%86-newed-%E5%AF%B9%E8%B1%A1%E7%BD%AE%E5%85%A5%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88">&#x6761;&#x6B3E; 17&#xFF1A;&#x4EE5;&#x72EC;&#x7ACB;&#x8BED;&#x53E5;&#x5C06; newed &#x5BF9;&#x8C61;&#x7F6E;&#x5165;&#x667A;&#x80FD;&#x6307;&#x9488;</h3>

<ul>
<li>&#x4EE5;&#x72EC;&#x7ACB;&#x8BED;&#x53E5;&#x5C06; newed &#x5BF9;&#x8C61;&#x5B58;&#x50A8;&#x4E8E;&#xFF08;&#x7F6E;&#x5165;&#xFF09;&#x667A;&#x80FD;&#x6307;&#x9488;&#x5185;&#x3002;&#x5982;&#x679C;&#x4E0D;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x4E00;&#x65E6;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x96BE;&#x4EE5;&#x5BDF;&#x89C9;&#x7684;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">int</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">processWidget</span><span class="token punctuation">(</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> pw<span class="token punctuation">,</span> <span class="token keyword">int</span> priority<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x73B0;&#x5728;&#x8003;&#x8651;&#x8C03;&#x7528; processWidget&#xFF1A;</span>
<span class="token function">processWidget</span><span class="token punctuation">(</span><span class="token keyword">new</span> Widget<span class="token punctuation">,</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x5B83;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;tr1::shared_ptr &#x6784;&#x9020;&#x51FD;&#x6570;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x539F;&#x59CB;&#x6307;&#x9488;&#xFF08;raw pointer&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x8BE5;&#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x4E2A; explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#xFF0C;&#x5C06;&#x5F97;&#x81EA;&#x201C;newWidget&#x201D;&#x7684;</span>
<span class="token comment">// &#x539F;&#x59CB;&#x6307;&#x9488;&#x8F6C;&#x6362;&#x4E3A; processWidget &#x6240;&#x8981;&#x6C42;&#x7684; tr1::shared_ptr&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x5199;&#x6210;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF1A;</span>
<span class="token function">processWidget</span><span class="token punctuation">(</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> Widget<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x4E0A;&#x8FF0;&#x8C03;&#x7528;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x6CC4;&#x6F0F;&#x8D44;&#x6E90;&#x3002;</span>
<span class="token comment">// &#x5728;&#x8C03;&#x7528; processWidget &#x4E4B;&#x524D;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5FC5;&#x987B;&#x521B;&#x5EFA;&#x4EE3;&#x7801;&#xFF0C;&#x505A;&#x4EE5;&#x4E0B;&#x4E09;&#x4EF6;&#x4E8B;&#xFF1A;</span>
<span class="token comment">// &#x8C03;&#x7528; priority</span>
<span class="token comment">// &#x6267;&#x884C;&#x201C;new Widget&#x201D;</span>
<span class="token comment">// &#x8C03;&#x7528; tr1::shared_ptr &#x6784;&#x9020;&#x51FD;&#x6570;</span>

<span class="token comment">// &#x4E07;&#x4E00;&#x5BF9; priority &#x7684;&#x8C03;&#x7528;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#xFF0C;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1F;</span>
<span class="token comment">// &#x5728;&#x6B64;&#x60C5;&#x51B5;&#x4E0B;&#x201C;new Widget&#x201D;&#x8FD4;&#x56DE;&#x7684;&#x6307;&#x9488;&#x5C06;&#x4F1A;&#x9057;&#x5931;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C1A;&#x672A;&#x88AB;&#x7F6E;&#x5165;</span>
<span class="token comment">// tr1::shared_ptr &#x5185;&#xFF0C;&#x540E;&#x8005;&#x662F;&#x6211;&#x4EEC;&#x671F;&#x76FC;&#x7528;&#x6765;&#x9632;&#x536B;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x7684;&#x6B66;&#x5668;&#x3002;</span>
<span class="token comment">// &#x662F;&#x7684;&#xFF0C;&#x5728;&#x5BF9; processWidget &#x7684;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x53EF;&#x80FD;&#x5F15;&#x53D1;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x5728;&#x201C;&#x8D44;&#x6E90;&#x88AB;&#x521B;&#x5EFA;&#xFF08;&#x7ECF;&#x7531;&#x201C;new Widget&#x201D;&#xFF09;&#x201D;&#x548C;&#x201C;&#x8D44;&#x6E90;&#x88AB;&#x8F6C;&#x6362;&#x4E3A;&#x8D44;&#x6E90;</span>
<span class="token comment">// &#x7BA1;&#x7406;&#x5BF9;&#x8C61;&#x201D;&#x4E24;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x4E4B;&#x95F4;&#x6709;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x5E72;&#x6270;&#x3002;</span>

<span class="token comment">// &#x907F;&#x514D;&#x8FD9;&#x7C7B;&#x95EE;&#x9898;&#x7684;&#x65B9;&#x6CD5;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x4F7F;&#x7528;&#x5206;&#x79BB;&#x8BED;&#x53E5;&#xFF0C;&#x5206;&#x522B;&#x5199;&#x51FA;&#xFF08;1&#xFF09;&#x521B;&#x5EFA; Widget&#xFF0C;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x5C06;&#x5B83;&#x7F6E;&#x5165;&#x4E00;&#x4E2A;&#x667A;&#x80FD;&#x6307;&#x9488;&#x5185;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x628A;&#x90A3;&#x4E2A;&#x667A;&#x80FD;&#x6307;&#x9488;&#x4F20;&#x7ED9; processWidget&#xFF1A;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> <span class="token function">pw</span><span class="token punctuation">(</span><span class="token keyword">new</span> Widget<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x5728;&#x5355;&#x72EC;&#x8BED;&#x53E5;&#x5185;&#x4EE5;</span>
                                                <span class="token comment">// &#x667A;&#x80FD;&#x6307;&#x9488;&#x5B58;&#x50A8;</span>
                                                <span class="token comment">// newed &#x6240;&#x5F97;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token function">processWidget</span><span class="token punctuation">(</span>pw<span class="token punctuation">,</span> <span class="token function">priority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="4-%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%A3%B0%E6%98%8E">4&#x3001;&#x8BBE;&#x8BA1;&#x4E0E;&#x58F0;&#x660E;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-18%E8%AE%A9%E6%8E%A5%E5%8F%A3%E5%AE%B9%E6%98%93%E8%A2%AB%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8%E4%B8%8D%E6%98%93%E8%A2%AB%E8%AF%AF%E7%94%A8">&#x6761;&#x6B3E; 18&#xFF1A;&#x8BA9;&#x63A5;&#x53E3;&#x5BB9;&#x6613;&#x88AB;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x6613;&#x88AB;&#x8BEF;&#x7528;</h3>

<ul>
<li>&#x597D;&#x7684;&#x63A5;&#x53E3;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x5BB9;&#x6613;&#x88AB;&#x8BEF;&#x7528;&#x3002;&#x4F60;&#x5E94;&#x8BE5;&#x5728;&#x4F60;&#x7684;&#x6240;&#x6709;&#x63A5;&#x53E3;&#x4E2D;&#x52AA;&#x529B;&#x8FBE;&#x6210;&#x8FD9;&#x4E9B;&#x6027;&#x8D28;&#x3002;</li>
<li>&#x201C;&#x4FC3;&#x8FDB;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#x201D;&#x7684;&#x529E;&#x6CD5;&#x5305;&#x62EC;&#x63A5;&#x53E3;&#x7684;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x4E0E;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#x7684;&#x884C;&#x4E3A;&#x517C;&#x5BB9;&#x3002;</li>
<li>&#x201C;&#x963B;&#x6B62;&#x8BEF;&#x7528;&#x201D;&#x7684;&#x529E;&#x6CD5;&#x5305;&#x62EC;&#x5EFA;&#x7ACB;&#x65B0;&#x7C7B;&#x578B;&#x3001;&#x9650;&#x5236;&#x7C7B;&#x578B;&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x675F;&#x7F1A;&#x5BF9;&#x8C61;&#x503C;&#xFF0C;&#x4EE5;&#x53CA;&#x6D88;&#x9664;&#x5BA2;&#x6237;&#x7684;&#x8D44;&#x6E90;&#x7BA1;&#x7406;&#x8D23;&#x4EFB;&#x3002;</li>
<li>tr1::shared_ptr &#x652F;&#x6301;&#x5B9A;&#x5236;&#x578B;&#x5220;&#x9664;&#x5668;&#xFF08;custom deleter&#xFF09;&#x3002;&#x8FD9;&#x53EF;&#x9632;&#x8303; DLL &#x95EE;&#x9898;&#xFF0C;&#x53EF;&#x88AB;&#x7528;&#x6765;&#x81EA;&#x52A8;&#x89E3;&#x9664;&#x4E92;&#x65A5;&#x9501;&#xFF08;mutexes&#xFF1B;&#x89C1;&#x6761;&#x6B3E; 14&#xFF09;&#x7B49;&#x7B49;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Date <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5E94;&#x8BE5;&#x662F;&#x201C;3,30&#x201D;&#x800C;&#x4E0D;&#x662F;&#x201C;30,3&#x201D;</span>

Date <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5E94;&#x8BE5;&#x662F;&#x201C;3,30&#x201D;&#x800C;&#x4E0D;&#x662F;&#x201C;2,30&#x201D;</span>





<span class="token keyword">struct</span> Day <span class="token punctuation">{</span>
    <span class="token keyword">explicit</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">val</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Month <span class="token punctuation">{</span>
    <span class="token keyword">explicit</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">val</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Year <span class="token punctuation">{</span>
    <span class="token keyword">explicit</span> <span class="token function">Year</span><span class="token punctuation">(</span><span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">val</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Date</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">const</span> Month<span class="token operator">&amp;</span> m<span class="token punctuation">,</span> <span class="token keyword">const</span> Day<span class="token operator">&amp;</span> d<span class="token punctuation">,</span> <span class="token keyword">const</span> Year<span class="token operator">&amp;</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Date <span class="token function">d</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x7C7B;&#x578B;</span>
Date <span class="token function">d</span><span class="token punctuation">(</span><span class="token function">Day</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Year</span><span class="token punctuation">(</span><span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x4E0D;&#x6B63;&#x786E;&#x7684;&#x7C7B;&#x578B;</span>
Date <span class="token function">d</span><span class="token punctuation">(</span><span class="token function">Month</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Year</span><span class="token punctuation">(</span><span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// OK&#xFF0C;&#x7C7B;&#x578B;&#x6B63;&#x786E;&#xFF01;</span>





<span class="token comment">// &#x9884;&#x5148;&#x5B9A;&#x4E49;&#x6240;&#x6709;&#x6709;&#x6548;&#x7684; Months&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Month</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> Month <span class="token function">Jan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x6709;&#x6548;&#x6708;&#x4EFD;&#x3002;</span>
    <span class="token keyword">static</span> Month <span class="token function">Feb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x7A0D;&#x540E;&#x89E3;&#x91CA;&#x4E3A;&#x4EC0;&#x4E48;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// &#x8FD9;&#x4E9B;&#x662F;&#x51FD;&#x6570;&#x800C;&#x975E;&#x5BF9;&#x8C61;&#x3002;</span>
    <span class="token keyword">static</span> Month <span class="token function">Dec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// &#x5176;&#x4ED6;&#x6210;&#x5458;&#x51FD;&#x6570;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Month</span><span class="token punctuation">(</span><span class="token keyword">int</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x963B;&#x6B62;&#x751F;&#x6210;&#x65B0;&#x7684;&#x6708;&#x4EFD;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// &#x8FD9;&#x662F;&#x6708;&#x4EFD;&#x4E13;&#x5C5E;&#x6570;&#x636E;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Date <span class="token function">d</span><span class="token punctuation">(</span>Month<span class="token operator">::</span><span class="token function">Mar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Day</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Year</span><span class="token punctuation">(</span><span class="token number">1995</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>





Investment<span class="token operator">*</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6765;&#x81EA;&#x6761;&#x6B3E; 13&#xFF1A;&#x4E3A;&#x6C42;&#x7B80;&#x5316;&#x6682;&#x7565;&#x53C2;&#x6570;&#x3002;</span>

std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// tr1::shared_ptr &#x63D0;&#x4F9B;&#x7684;&#x67D0;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF1A;&#x4E00;&#x4E2A;&#x662F;&#x88AB;&#x7BA1;</span>
<span class="token comment">// &#x7684;&#x6307;&#x9488;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x5F15;&#x7528;&#x6B21;&#x6570;&#x53D8;&#x6210; 0 &#x65F6;&#x5C06;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x201C;&#x5220;&#x9664;&#x5668;&#x201D;&#x3002;&#x8FD9;&#x542F;&#x53D1;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; null tr1::shared_ptr &#x5E76;&#x4EE5; getRidOfInvestment</span>
<span class="token comment">// &#x4F5C;&#x4E3A;&#x5176;&#x5220;&#x9664;&#x5668;&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span>        <span class="token comment">// &#x4F01;&#x56FE;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; null shared_ptr</span>
    <span class="token function">pInv</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> getRidOfInvestment<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5E76;&#x643A;&#x5E26;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x7684;&#x5220;&#x9664;&#x5668;&#x3002;</span>
                                        <span class="token comment">// &#x6B64;&#x5F0F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// tr1::shared_ptr &#x6784;&#x9020;&#x51FD;&#x6570;&#x575A;&#x6301;&#x5176;&#x7B2C;&#x4E00;&#x53C2;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x800C; 0 &#x4E0D;&#x662F;&#x6307;&#x9488;&#xFF0C;&#x662F;&#x4E2A; int&#x3002;</span>
<span class="token comment">// &#x8F6C;&#x578B;&#xFF08;cast&#xFF09;&#x53EF;&#x4EE5;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span>        <span class="token comment">// &#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; null shared_ptr &#x5E76;&#x4EE5;</span>
    <span class="token function">pInv</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Investment<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// getRidOfInvestment &#x4E3A;&#x5220;&#x9664;&#x5668;</span>
        getRidOfInvestment<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6761;&#x6B3E; 27 &#x63D0;&#x5230; static_cast</span>

<span class="token comment">// &#x5982;&#x679C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0; createInvestment &#x4F7F;&#x5B83;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; tr1::shared_ptr</span>
<span class="token comment">// &#x5E76;&#x5939;&#x5E26; getRidOfInvestment() &#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x5220;&#x9664;&#x5668;&#xFF0C;&#x4EE3;&#x7801;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">retVal</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Investment<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                            getRidOfInvestment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    retVal <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4EE4; retVal &#x6307;&#x5411;&#x6B63;&#x786E;&#x5BF9;&#x8C61;</span>
    <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// tr1::shared_ptr &#x6709;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x597D;&#x7684;&#x6027;&#x8D28;&#x662F;&#xFF1A;&#x5B83;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x201C;&#x6BCF;&#x4E2A;</span>
<span class="token comment">// &#x6307;&#x9488;&#x4E13;&#x5C5E;&#x7684;&#x5220;&#x9664;&#x5668;&#x201D;&#xFF0C;&#x56E0;&#x4E3A;&#x6D88;&#x9664;&#x53E6;&#x4E00;&#x4E2A;&#x6F5C;&#x5728;&#x7684;&#x5BA2;&#x6237;&#x9519;&#x8BEF;&#xFF1A;&#x6240;&#x8C13;&#x7684;&#x201C;cross-DLL problem&#x201D;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span> <span class="token function">createInvestment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Investment<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> Stock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x8FD4;&#x56DE;&#x7684;&#x90A3;&#x4E2A; tr1::shared_ptr &#x53EF;&#x88AB;&#x4F20;&#x9012;&#x7ED9;&#x4EFB;&#x4F55;&#x5176;&#x4ED6; DLLs&#xFF0C;&#x65E0;&#x9700;&#x5728;&#x610F; &#x201C;cross-DLL problem&#x201D;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x6307;&#x5411; Stock &#x7684; tr1::shared_ptrs &#x4F1A;&#x8FFD;&#x8E2A;&#x8BB0;&#x5F55;&#x201C;&#x5F53; Stock &#x7684;&#x5F15;&#x7528;&#x6B21;&#x6570;&#x53D8;&#x6210; 0 &#x65F6;&#x8BE5;&#x8C03;</span>
<span class="token comment">// &#x7528;&#x7684;&#x90A3;&#x4E2A; DLL&apos;s delete&#x201D;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-19%E8%AE%BE%E8%AE%A1-class-%E7%8A%B9%E5%A6%82%E8%AE%BE%E8%AE%A1-type">&#x6761;&#x6B3E; 19&#xFF1A;&#x8BBE;&#x8BA1; class &#x72B9;&#x5982;&#x8BBE;&#x8BA1; type</h3>

<ul>
<li>Class &#x7684;&#x8BBE;&#x8BA1;&#x5C31;&#x662F; type &#x7684;&#x8BBE;&#x8BA1;&#x3002;&#x5728;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x65B0; type &#x4E4B;&#x524D;&#xFF0C;&#x8BF7;&#x786E;&#x5B9A;&#x4F60;&#x5DF2;&#x7ECF;&#x8003;&#x8651;&#x8FC7;&#x672C;&#x6761;&#x6B3E;&#x8986;&#x76D6;&#x7684;&#x6240;&#x6709;&#x8BA8;&#x8BBA;&#x4E3B;&#x9898;&#x3002;
<ul>
<li>&#x65B0; type &#x7684;&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x5982;&#x4F55;&#x88AB;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#xFF1F;</li>
<li>&#x5BF9;&#x8C61;&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x5BF9;&#x8C61;&#x7684;&#x8D4B;&#x503C;&#x8BE5;&#x6709;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x5DEE;&#x522B;&#xFF1F;</li>
<li>&#x65B0; type &#x7684;&#x5BF9;&#x8C61;&#x5982;&#x679C;&#x88AB; passed by value&#xFF08;&#x4EE5;&#x503C;&#x4F20;&#x9012;&#xFF09;&#xFF0C;&#x610F;&#x5473;&#x7740;&#x4EC0;&#x4E48;&#xFF1F;</li>
<li>&#x4EC0;&#x4E48;&#x662F;&#x65B0; type &#x7684;&#x201C;&#x5408;&#x6CD5;&#x503C;&#x201D;&#xFF1F;</li>
<li>&#x4F60;&#x7684;&#x65B0; type &#x9700;&#x8981;&#x914D;&#x5408;&#x67D0;&#x4E2A;&#x7EE7;&#x627F;&#x56FE;&#x7CFB;&#xFF08;inheritance graph&#xFF09;&#x5417;&#xFF1F;</li>
<li>&#x4F60;&#x7684;&#x65B0; type &#x9700;&#x8981;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x8F6C;&#x6362;&#xFF1F;</li>
<li>&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#x7B26;&#x548C;&#x51FD;&#x6570;&#x5BF9;&#x6B64;&#x65B0; type &#x800C;&#x8A00;&#x662F;&#x5408;&#x7406;&#x7684;&#xFF1F;</li>
<li>&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x6807;&#x51C6;&#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x9A73;&#x56DE;&#xFF1F;</li>
<li>&#x8C01;&#x8BE5;&#x53D6;&#x7528;&#x65B0; type &#x7684;&#x6210;&#x5458;&#xFF1F;</li>
<li>&#x4EC0;&#x4E48;&#x662F;&#x65B0; type &#x7684;&#x201C;&#x672A;&#x58F0;&#x660E;&#x63A5;&#x53E3;&#x201D;&#xFF08;undeclared interface&#xFF09;&#xFF1F;</li>
<li>&#x4F60;&#x7684;&#x65B0; type &#x6709;&#x591A;&#x4E48;&#x4E00;&#x822C;&#x5316;&#xFF1F;</li>
<li>&#x4F60;&#x771F;&#x7684;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x65B0; type &#x5417;&#xFF1F;</li>
</ul>
</li>
</ul>
<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-20%E5%AE%81%E4%BB%A5-pass-by-reference-to-const-%E6%9B%BF%E6%8D%A2-pass-by-value">&#x6761;&#x6B3E; 20&#xFF1A;&#x5B81;&#x4EE5; pass-by-reference-to-const &#x66FF;&#x6362; pass-by-value</h3>

<ul>
<li>&#x5C3D;&#x91CF;&#x4EE5; pass-by-reference-to-const &#x66FF;&#x6362; pass-by-value&#x3002;&#x524D;&#x8005;&#x901A;&#x5E38;&#x6BD4;&#x8F83;&#x9AD8;&#x6548;&#xFF0C;&#x5E76;&#x53EF;&#x907F;&#x514D;&#x5207;&#x5272;&#x95EE;&#x9898;&#xFF08;slicing problem&#xFF09;&#x3002;</li>
<li>&#x4EE5;&#x4E0A;&#x89C4;&#x5219;&#x5E76;&#x4E0D;&#x9002;&#x7528;&#x4E8E;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#xFF0C;&#x4EE5;&#x53CA; STL &#x7684;&#x8FED;&#x4EE3;&#x5668;&#x548C;&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x3002;&#x5BF9;&#x5B83;&#x4EEC;&#x800C;&#x8A00;&#xFF0C;pass-by-value &#x5F80;&#x5F80;&#x6BD4;&#x8F83;&#x9002;&#x5F53;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x4E3A;&#x6C42;&#x7B80;&#x5316;&#xFF0C;&#x7701;&#x7565;&#x53C2;&#x6570;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &#x6761;&#x6B3E; 7 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x662F; virtual</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
    std<span class="token operator">::</span>string address<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token operator">:</span> <span class="token keyword">public</span> Person <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// &#x518D;&#x6B21;&#x7701;&#x7565;&#x53C2;&#x6570;</span>
    <span class="token operator">~</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string schoolName<span class="token punctuation">;</span>
    std<span class="token operator">::</span>string schoolAddress<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">bool</span> <span class="token function">validateStudent</span><span class="token punctuation">(</span>Student s<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x51FD;&#x6570;&#x4EE5; by value &#x65B9;&#x5F0F;&#x63A5;&#x53D7;&#x5B66;&#x751F;</span>
Student plato<span class="token punctuation">;</span>                              <span class="token comment">// &#x67CF;&#x62C9;&#x56FE;&#xFF0C;&#x82CF;&#x683C;&#x62C9;&#x5E95;&#x7684;&#x5B66;&#x751F;</span>
<span class="token keyword">bool</span> platoIsOK <span class="token operator">=</span> <span class="token function">validateStudent</span><span class="token punctuation">(</span>plato<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x8C03;&#x7528;&#x51FD;&#x6570;</span>

<span class="token comment">// &#x65E0;&#x7591;&#x5730; Student &#x7684; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x4EE5; plato &#x4E3A;&#x84DD;&#x672C;&#x5C06; s &#x521D;&#x59CB;&#x5316;&#x3002;</span>
<span class="token comment">// &#x540C;&#x6837;&#x660E;&#x663E;&#x5730;&#xFF0C;&#x5F53; validateStudent &#x8FD4;&#x56DE; s &#x4F1A;&#x88AB;&#x9500;&#x6BC1;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#xFF0C;&#x5BF9;&#x6B64;&#x51FD;&#x6570;&#x800C;&#x8A00;&#xFF0C;&#x53C2;&#x6570;&#x7684;&#x4F20;&#x9012;&#x6210;&#x672C;&#x662F;&#x201C;&#x4E00;&#x6B21; Student copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;</span>
<span class="token comment">// &#x52A0;&#x4E0A;&#x4E00;&#x6B21; Student &#x6790;&#x6784;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x201D;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x90A3;&#x8FD8;&#x4E0D;&#x662F;&#x6574;&#x4E2A;&#x6545;&#x4E8B;&#x5594;&#x3002;Student &#x5BF9;&#x8C61;&#x5185;&#x6709;&#x4E24;&#x4E2A; string &#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x6784;&#x9020;&#x4E00;&#x4E2A;</span>
<span class="token comment">// Student &#x5BF9;&#x8C61;&#x4E5F;&#x5C31;&#x6784;&#x9020;&#x4E86;&#x4E24;&#x4E2A; string &#x5BF9;&#x8C61;&#x3002;&#x6B64;&#x5916; Student &#x5BF9;&#x8C61;&#x7EE7;&#x627F;&#x81EA; Person &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x6BCF;&#x6B21;&#x6784;&#x9020; Student &#x5BF9;&#x8C61;&#x4E5F;&#x5FC5;&#x987B;&#x6784;&#x9020;&#x51FA;&#x4E00;&#x4E2A; Person &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x4E00;&#x4E2A; Person &#x5BF9;&#x8C61;&#x53C8;&#x6709;&#x4E24;&#x4E2A; string &#x5BF9;&#x8C61;&#x5728;&#x5176;&#x4E2D;&#xFF0C;&#x56E0;&#x6B64;&#x6BCF;&#x4E00;&#x6B21; Person &#x6784;&#x9020;&#x52A8;&#x4F5C;</span>
<span class="token comment">// &#x53C8;&#x9700;&#x627F;&#x62C5;&#x4E24;&#x4E2A; string &#x6784;&#x9020;&#x52A8;&#x4F5C;&#x3002;</span>
<span class="token comment">// &#x6700;&#x7EC8;&#x7ED3;&#x679C;&#x662F;&#xFF0C;&#x4EE5; by value &#x65B9;&#x5F0F;&#x5E8A;&#x5E95;&#x4E00;&#x4E2A; Student &#x5BF9;&#x8C61;&#x4F1A;&#x5BFC;&#x81F4;&#x8C03;&#x7528;&#x4E00;&#x6B21;</span>
<span class="token comment">// Student copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;&#x4E00;&#x6B21; Person copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;&#x56DB;&#x6B21; string copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x5F53;&#x51FD;&#x6570;&#x5185;&#x7684;&#x90A3;&#x4E2A; Student &#x590D;&#x4EF6;&#x88AB;&#x9500;&#x6BC1;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#x90FD;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;</span>
<span class="token comment">// &#x7684;&#x6790;&#x6784;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4EE5; by value &#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x4E00;&#x4E2A; Student &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x603B;&#x4F53;&#x6210;&#x672C;&#x662F;&#x201C;&#x516D;&#x6B21;&#x6784;&#x9020;&#x51FD;&#x6570;&#x548C;&#x516D;&#x6B21;&#x6790;&#x6784;&#x51FD;&#x6570;&#x201D;&#xFF01;</span>

<span class="token comment">// &#x5982;&#x679C;&#x6709;&#x4EC0;&#x4E48;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x56DE;&#x907F;&#x6240;&#x6709;&#x90A3;&#x4E9B;&#x6784;&#x9020;&#x548C;&#x6790;&#x6784;&#x52A8;&#x4F5C;&#x5C31;&#x592A;&#x597D;&#x4E86;&#x3002;</span>
<span class="token comment">// &#x6709;&#x7684;&#xFF0C;&#x5C31;&#x662F; pass by reference-to-const&#xFF1A;</span>
<span class="token keyword">bool</span> <span class="token function">validateStudent</span><span class="token punctuation">(</span><span class="token keyword">const</span> Student<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x4F20;&#x9012;&#x65B9;&#x5F0F;&#x7684;&#x6548;&#x7387;&#x9AD8;&#x5F97;&#x591A;&#xFF1A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6216;&#x6790;&#x6784;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x65B0;&#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#x3002;</span>





<span class="token comment">// &#x4EE5; by reference &#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x53C2;&#x6570;&#x4E5F;&#x53EF;&#x4EE5;&#x907F;&#x514D; slicing&#xFF08;&#x5BF9;&#x8C61;&#x5207;&#x5272;&#xFF09;&#x95EE;&#x9898;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>           <span class="token comment">// &#x8FD4;&#x56DE;&#x7A97;&#x53E3;&#x540D;&#x79F0;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>       <span class="token comment">// &#x663E;&#x793A;&#x7A97;&#x53E3;&#x548C;&#x5176;&#x5185;&#x5BB9;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">WindowWithScrollBars</span> <span class="token operator">:</span> <span class="token keyword">public</span> Window <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x73B0;&#x5728;&#x5047;&#x8BBE;&#x4F60;&#x5E0C;&#x671B;&#x5199;&#x4E2A;&#x51FD;&#x6570;&#x6253;&#x5370;&#x7A97;&#x53E3;&#x540D;&#x79F0;&#xFF0C;&#x7136;&#x540E;&#x663E;&#x793A;&#x8BE5;&#x7A97;&#x53E3;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x9519;&#x8BEF;&#x793A;&#x8303;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">printNameAndDisplay</span><span class="token punctuation">(</span>Window w<span class="token punctuation">)</span>      <span class="token comment">// &#x4E0D;&#x6B63;&#x786E;&#xFF01;&#x53C2;&#x6570;&#x53EF;&#x80FD;&#x88AB;&#x5207;&#x5272;</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> w<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5F53;&#x4F60;&#x8C03;&#x7528;&#x4E0A;&#x8FF0;&#x51FD;&#x6570;&#x5E76;&#x4EA4;&#x7ED9;&#x5B83;&#x4E00;&#x4E2A; WindowWithScrollBars &#x5BF9;&#x8C61;&#xFF0C;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#x5462;&#xFF1F;</span>
WindowWithScrollBars wwsb<span class="token punctuation">;</span>
<span class="token function">printNameAndDisplay</span><span class="token punctuation">(</span>wwsb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#x53C2;&#x6570; w &#x4F1A;&#x88AB;&#x6784;&#x9020;&#x6210;&#x4E3A;&#x4E00;&#x4E2A; Window &#x5BF9;&#x8C61;&#xFF1B;&#x5B83;&#x662F; passed by value&#xFF0C;&#x8FD8;&#x8BB0;&#x5F97;&#x5417;&#xFF1F;</span>
<span class="token comment">// &#x800C;&#x9020;&#x6210; wwsb &#x201C;&#x4E4B;&#x6240;&#x4EE5;&#x662F;&#x4E2A; WindowWithScrollBars &#x5BF9;&#x8C61;&#x201D;&#x7684;&#x6240;&#x6709;&#x7279;&#x5316;&#x4FE1;&#x606F;&#x90FD;&#x4F1A;&#x88AB;&#x5207;&#x9664;&#x3002;</span>
<span class="token comment">// &#x5728; printNameAndDisplay &#x51FD;&#x6570;&#x5185;&#x4E0D;&#x8BBA;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x539F;&#x672C;&#x662F;&#x4EC0;&#x4E48;&#x7C7B;&#x578B;&#xFF0C;</span>
<span class="token comment">// &#x53C2;&#x6570; w &#x5C31;&#x50CF;&#x4E00;&#x4E2A; Window &#x5BF9;&#x8C61;&#xFF08;&#x56E0;&#x4E3A;&#x5176;&#x7C7B;&#x578B;&#x662F; Window&#xFF09;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x5728; printNameAndDisplay &#x5185;&#x8C03;&#x7528; display &#x8C03;&#x7528;&#x7684;&#x603B;&#x662F; Window::display&#xFF0C;</span>
<span class="token comment">// &#x7EDD;&#x4E0D;&#x4F1A;&#x662F; WindowWithScrollBars::display&#x3002;</span>

<span class="token comment">// &#x89E3;&#x51B3;&#x5207;&#x5272;&#xFF08;slicing&#xFF09;&#x95EE;&#x9898;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x5C31;&#x662F;&#x4EE5; by reference-to-const &#x7684;&#x65B9;&#x5F0F;&#x4F20;&#x9012; w&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">printNameAndDisplay</span><span class="token punctuation">(</span><span class="token keyword">const</span> Window<span class="token operator">&amp;</span> w<span class="token punctuation">)</span>       <span class="token comment">// &#x5F88;&#x597D;&#xFF0C;&#x53C2;&#x6570;&#x4E0D;&#x4F1A;&#x88AB;&#x5207;&#x5272;</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> w<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5982;&#x679C;&#x7AA5;&#x89C6; C++ &#x7F16;&#x8BD1;&#x5668;&#x7684;&#x5E95;&#x5C42;&#xFF0C;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;references &#x5F80;&#x5F80;&#x4EE5;&#x6307;&#x9488;&#x5B9E;&#x73B0;&#x51FA;&#x6765;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x6B64; pass by reference &#x901A;&#x5E38;&#x610F;&#x5473;&#x771F;&#x6B63;&#x4F20;&#x9012;&#x7684;&#x662F;&#x6307;&#x9488;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x5982;&#x679C;&#x4F60;&#x6709;&#x4E2A;&#x5BF9;&#x8C61;&#x5C5E;&#x4E8E;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#xFF08;&#x4F8B;&#x5982; int&#xFF09;&#xFF0C;pass by value</span>
<span class="token comment">// &#x5F80;&#x5F80;&#x6BD4; pass by reference &#x7684;&#x6548;&#x7387;&#x9AD8;&#x4E9B;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-21%E5%BF%85%E9%A1%BB%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%88%AB%E5%A6%84%E6%83%B3%E8%BF%94%E5%9B%9E%E5%85%B6-reference">&#x6761;&#x6B3E; 21&#xFF1A;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x5BF9;&#x8C61;&#x65F6;&#xFF0C;&#x522B;&#x5984;&#x60F3;&#x8FD4;&#x56DE;&#x5176; reference</h3>

<ul>
<li>&#x7EDD;&#x4E0D;&#x8981;&#x8FD4;&#x56DE; pointer &#x6216; reference &#x6307;&#x5411;&#x4E00;&#x4E2A; local stack &#x5BF9;&#x8C61;&#xFF0C;&#x6216;&#x8FD4;&#x56DE; reference &#x6307;&#x5411;&#x4E00;&#x4E2A; heap-allocated &#x5BF9;&#x8C61;&#xFF0C;&#x6216;&#x8FD4;&#x56DE; pointer &#x6216; reference &#x6307;&#x5411;&#x4E00;&#x4E2A; local static &#x5BF9;&#x8C61;&#x800C;&#x6709;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x9700;&#x8981;&#x591A;&#x4E2A;&#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x6761;&#x6B3E; 4 &#x5DF2;&#x7ECF;&#x4E3A;&#x201C;&#x5728;&#x5355;&#x7EBF;&#x7A0B;&#x73AF;&#x5883;&#x4E2D;&#x5408;&#x7406;&#x8FD4;&#x56DE; reference &#x6307;&#x5411;&#x4E00;&#x4E2A; local static &#x5BF9;&#x8C61;&#x201D;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4EFD;&#x8BBE;&#x8BA1;&#x5B9E;&#x4F8B;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Rational</span><span class="token punctuation">(</span><span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment">// &#x6761;&#x6B3E; 24 &#x8BF4;&#x660E;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;</span>
             <span class="token keyword">int</span> denominator <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4E0D;&#x58F0;&#x660E;&#x4E3A; explicit</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> n<span class="token punctuation">,</span> d<span class="token punctuation">;</span>                   <span class="token comment">// &#x5206;&#x5B50;&#xFF08;numerator&#xFF09;&#x548C;&#x5206;&#x6BCD;&#xFF08;denominator&#xFF09;</span>
    <span class="token keyword">friend</span> <span class="token keyword">const</span> Rational       <span class="token comment">// &#x6761;&#x6B3E; 3 &#x8BF4;&#x660E;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F; const</span>
        <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Rational <span class="token function">a</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// a = 1 / 2</span>
Rational <span class="token function">b</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// b = 3 / 5</span>
Rational c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>         <span class="token comment">// c &#x5E94;&#x8BE5;&#x662F; 3 / 10</span>

<span class="token comment">// &#x5982;&#x679C; operator* &#x8981;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x5982;&#x6B64;&#x6570;&#x503C;&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x5FC5;&#x987B;&#x81EA;&#x5DF1;&#x521B;&#x5EFA;&#x90A3;&#x4E2A; Rational &#x5BF9;&#x8C61;&#x3002;</span>





<span class="token comment">// &#x51FD;&#x6570;&#x521B;&#x5EFA;&#x65B0;&#x5BF9;&#x8C61;&#x7684;&#x9014;&#x5F84;&#x6709;&#x4E8C;&#xFF1A;&#x5728; stack &#x7A7A;&#x95F4;&#x6216;&#x5728; heap &#x7A7A;&#x95F4;&#x521B;&#x5EFA;&#x4E4B;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; local &#x53D8;&#x91CF;&#xFF0C;&#x5C31;&#x662F;&#x5728; stack &#x7A7A;&#x95F4;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x6839;&#x636E;&#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#x8BD5;&#x5199; operator* &#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Rational <span class="token function">result</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>n <span class="token operator">*</span> rhs<span class="token punctuation">.</span>n<span class="token punctuation">,</span> lhs<span class="token punctuation">.</span>d <span class="token operator">*</span> rhs<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8B66;&#x544A;&#xFF01;&#x7CDF;&#x7CD5;&#x7684;&#x4EE3;&#x7801;&#xFF01;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411; result&#xFF0C;&#x4F46; result &#x662F;&#x4E2A; local &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x800C; local &#x5BF9;&#x8C61;&#x5728;&#x51FD;&#x6570;&#x9000;&#x51FA;&#x524D;&#x88AB;&#x9500;&#x6BC1;&#x4E86;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#xFF0C;&#x8FD9;&#x4E2A;&#x7248;&#x672C;&#x7684; operator* &#x5E76;&#x672A;&#x8FD4;&#x56DE; reference &#x6307;&#x5411;&#x67D0;&#x4E2A; Rational&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x8FD4;&#x56DE;&#x7684; reference &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x201C;&#x4ECE;&#x524D;&#x7684;&#x201D; Rational&#xFF1B;&#x4E00;&#x4E2A;&#x65E7;&#x65F6;&#x7684; Rational&#xFF1B;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x66FE;&#x7ECF;&#x88AB;&#x5F53;&#x505A; Rational &#x4F46;&#x5982;&#x4ECA;&#x5DF2;&#x7ECF;&#x6210;&#x7A7A;&#x3001;&#x53D1;&#x81ED;&#x3001;&#x8D25;&#x574F;&#x7684;&#x6B8B;&#x9AB8;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5DF2;&#x7ECF;&#x88AB;&#x9500;&#x6BC1;&#x4E86;&#x3002;</span>

<span class="token comment">// &#x4EFB;&#x4F55;&#x51FD;&#x6570;&#x5982;&#x679C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411;&#x67D0;&#x4E2A; local &#x5BF9;&#x8C61;&#xFF0C;&#x90FD;&#x5C06;&#x4E00;&#x8D25;&#x6D82;&#x5730;&#x3002;</span>
<span class="token comment">// &#xFF08;&#x5982;&#x679C;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x4E2A; local &#x5BF9;&#x8C61;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x6837;&#x3002;&#xFF09;</span>





<span class="token comment">// &#x4E8E;&#x662F;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5728; heap &#x5185;&#x6784;&#x9020;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE; reference &#x6307;&#x5411;&#x5B83;&#x3002;</span>
<span class="token comment">// Heap-based &#x5BF9;&#x8C61;&#x7531; new &#x521B;&#x5EFA;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x5F97;&#x5199;&#x4E00;&#x4E2A; heap-based operator* &#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Rational<span class="token operator">*</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Rational</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>n <span class="token operator">*</span> rhs<span class="token punctuation">.</span>n<span class="token punctuation">,</span> lhs<span class="token punctuation">.</span>d <span class="token operator">*</span> rhs<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">*</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x4F60;&#x8FD8;&#x662F;&#x5FC5;&#x987B;&#x4ED8;&#x51FA;&#x4E00;&#x4E2A;&#x201C;&#x6784;&#x9020;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x201D;&#x4EE3;&#x4EF7;&#xFF0C;&#x56E0;&#x4E3A;&#x5206;&#x914D;&#x6240;&#x5F97;&#x7684;&#x5185;&#x5B58;&#x5C06;&#x4EE5;&#x4E00;&#x4E2A;&#x9002;&#x5F53;&#x7684;</span>
<span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;&#x52A8;&#x4F5C;&#x3002;&#x4F46;&#x6B64;&#x5916;&#x4F60;&#x73B0;&#x5728;&#x53C8;&#x6709;&#x53E6;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</span>
<span class="token comment">// &#x8C01;&#x8BE5;&#x5BF9;&#x7740;&#x88AB;&#x4F60; new &#x51FA;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x5B9E;&#x65BD; delete&#xFF1F;</span>

<span class="token comment">// &#x5373;&#x4F7F;&#x8C03;&#x7528;&#x8005;&#x8BDA;&#x5B9E;&#x8C28;&#x614E;&#xFF0C;&#x5E76;&#x4E14;&#x5904;&#x4E8E;&#x826F;&#x597D;&#x610F;&#x8BC6;&#xFF0C;&#x4ED6;&#x4EEC;&#x8FD8;&#x662F;&#x4E0D;&#x592A;&#x80FD;&#x591F;&#x5728;&#x8FD9;&#x6837;</span>
<span class="token comment">// &#x5408;&#x60C5;&#x5408;&#x7406;&#x7684;&#x7528;&#x6CD5;&#x4E0B;&#x963B;&#x6B62;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF1A;</span>
Rational w<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">;</span>
w <span class="token operator">=</span> x <span class="token operator">*</span> y <span class="token operator">*</span> z<span class="token punctuation">;</span>              <span class="token comment">// &#x4E0E; operator* (operator* (x, y), z) &#x76F8;&#x540C;</span>

<span class="token comment">// &#x8FD9;&#x91CC;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x5185;&#x8C03;&#x7528;&#x4E86;&#x4E24;&#x6B21; operator*&#xFF0C;&#x56E0;&#x800C;&#x4E24;&#x6B21;&#x4F7F;&#x7528; new&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x9700;&#x8981;&#x4E24;&#x6B21; delete&#x3002;&#x4F46;&#x5374;&#x6CA1;&#x6709;&#x5408;&#x7406;&#x7684;&#x529E;&#x6CD5;&#x8BA9; operator* &#x4F7F;&#x7528;</span>
<span class="token comment">// &#x8005;&#x8FDB;&#x884C;&#x90A3;&#x4E9B; delete &#x8C03;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5408;&#x7406;&#x7684;&#x529E;&#x6CD5;&#x8BA9;&#x4ED6;&#x4EEC;&#x53D6;&#x5F97; operator*</span>
<span class="token comment">// &#x8FD4;&#x56DE;&#x7684; references &#x80CC;&#x540E;&#x9690;&#x85CF;&#x7684;&#x90A3;&#x4E2A;&#x6307;&#x9488;&#x3002;&#x8FD9;&#x7EDD;&#x5BF9;&#x5BFC;&#x81F4;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x3002;</span>





<span class="token comment">// &#x8BA9; operator* &#x8FD4;&#x56DE;&#x7684;&#x662F; reference &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x88AB;&#x5B9A;&#x4E49;&#x4E0E;&#x51FD;&#x6570;&#x5185;&#x90E8;</span>
<span class="token comment">// &#x7684; static Rantional &#x5BF9;&#x8C61;&#xFF1A;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>                               <span class="token comment">// &#x8B66;&#x544A;&#xFF0C;&#x53C8;&#x4E00;&#x5806;&#x70C2;&#x4EE3;&#x7801;&#x3002;</span>
    <span class="token keyword">static</span> Rational result<span class="token punctuation">;</span>     <span class="token comment">// static &#x5BF9;&#x8C61;&#xFF0C;&#x6B64;&#x51FD;&#x6570;&#x5C06;&#x8FD4;&#x56DE;</span>
                                <span class="token comment">// &#x5176; reference&#x3002;</span>
    result <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>               <span class="token comment">// &#x5C06; lhs &#x4E58;&#x4EE5; rhs&#xFF0C;&#x5E76;&#x5C06;&#x7ED3;&#x679C;</span>
                                <span class="token comment">// &#x7F6E;&#x4E8E; result &#x5185;&#x3002;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x5C31;&#x50CF;&#x6240;&#x6709;&#x7528;&#x4E0A; static &#x5BF9;&#x8C61;&#x7684;&#x8BBE;&#x8BA1;&#x4E00;&#x6837;&#xFF0C;&#x8FD9;&#x4E00;&#x4E2A;&#x4E5F;&#x7ACB;&#x523B;&#x9020;&#x6210;&#x6211;&#x4EEC;&#x5BF9;&#x591A;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x6027;&#x7684;&#x7591;&#x8651;&#x3002;</span>

<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>       <span class="token comment">// &#x4E00;&#x4E2A;&#x9488;&#x5BF9; Rationals</span>
                 <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x800C;&#x5199;&#x7684; operator==</span>
Rational a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>c <span class="token operator">*</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    &#x5F53;&#x4E58;&#x79EF;&#x76F8;&#x7B49;&#x65F6;&#xFF0C;&#x505A;&#x9002;&#x5F53;&#x7684;&#x76F8;&#x5E94;&#x52A8;&#x4F5C;&#xFF1B;
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    &#x5F53;&#x4E58;&#x79EF;&#x4E0D;&#x7B49;&#x65F6;&#xFF0C;&#x505A;&#x9002;&#x5F53;&#x7684;&#x76F8;&#x5E94;&#x52A8;&#x4F5C;&#xFF1B;
<span class="token punctuation">}</span>
<span class="token comment">// &#x731C;&#x60F3;&#x600E;&#x4E48;&#x7740;&#xFF1F;&#x8868;&#x8FBE;&#x5F0F; ((a * b) == (c * d)) &#x603B;&#x662F;</span>
<span class="token comment">// &#x88AB;&#x6838;&#x7B97;&#x4E3A; true&#xFF0C;&#x4E0D;&#x8BBA; a, b, c &#x548C; d &#x7684;&#x503C;&#x662F;&#x4EC0;&#x4E48;&#xFF01;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x5728; operator== &#x88AB;&#x8C03;&#x7528;&#x524D;&#xFF0C;&#x5DF2;&#x6709;&#x4E24;&#x4E2A; operator* &#x8C03;&#x7528;&#x5F0F;&#x8D77;&#x4F5C;&#x7528;&#xFF0C;</span>
<span class="token comment">// &#x6BCF;&#x4E00;&#x4E2A;&#x90FD;&#x8FD4;&#x56DE; reference &#x6307;&#x5411; operator* &#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x7684; static Rational &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64; operator== &#x88AB;&#x8981;&#x6C42;&#x5C06;&#x201C;operator* &#x5185;&#x90E8;&#x5B9A;&#x4E49;&#x7684; static Rational &#x5BF9;&#x8C61;&#x503C;&#x201D;&#x62FF;&#x6765;</span>
<span class="token comment">// &#x548C;&#x201C;operator* &#x5185;&#x7684; static Rational &#x5BF9;&#x8C61;&#x503C;&#x201D;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x6BD4;&#x8F83;&#x7ED3;&#x679C;&#x4E0D;&#x76F8;&#x7B49;&#xFF0C;&#x90A3;&#x624D;&#x5947;&#x602A;&#x5462;&#x3002;</span>





<span class="token comment">// &#x4E00;&#x4E2A;&#x201C;&#x5FC5;&#x987B;&#x8FD4;&#x56DE;&#x65B0;&#x5BF9;&#x8C61;&#x201D;&#x7684;&#x51FD;&#x6570;&#x7684;&#x6B63;&#x786E;&#x5199;&#x6CD5;&#x662F;&#xFF1A;&#x5C31;&#x8BA9;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x65B0;&#x5BF9;&#x8C61;&#x5457;&#x3002;</span>
<span class="token comment">// &#x5BF9; Rational &#x7684; operator* &#x800C;&#x8A00;&#x610F;&#x5473;&#x4EE5;&#x4E0B;&#x5199;&#x6CD5;&#xFF08;&#x6216;&#x5176;&#x672C;&#x8D28;&#x4E0A;&#x7B49;&#x4EF7;&#x7684;&#x4EE3;&#x7801;&#xFF09;&#xFF1A;</span>
<span class="token keyword">inline</span> <span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                                 <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Rational</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span>n <span class="token operator">*</span> rhs<span class="token punctuation">.</span>n<span class="token punctuation">,</span> lhs<span class="token punctuation">.</span>d <span class="token operator">*</span> rhs<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-22%E5%B0%86%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E4%B8%BA-private">&#x6761;&#x6B3E; 22&#xFF1A;&#x5C06;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x4E3A; private</h3>

<ul>
<li>&#x5207;&#x8BB0;&#x5C06;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x4E3A; private&#x3002;&#x8FD9;&#x53EF;&#x8D4B;&#x4E88;&#x5BA2;&#x6237;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x7684;&#x4E00;&#x81F4;&#x6027;&#x3001;&#x53EF;&#x7EC6;&#x5FAE;&#x5212;&#x5206;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x3001;&#x5141;&#x8BFA;&#x7EA6;&#x675F;&#x6761;&#x4EF6;&#x83B7;&#x5F97;&#x4FDD;&#x8BC1;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B; class &#x4F5C;&#x8005;&#x4EE5;&#x5145;&#x5206;&#x7684;&#x5B9E;&#x73B0;&#x5F39;&#x6027;&#x3002;</li>
<li>protected &#x5E76;&#x4E0D;&#x6BD4; public &#x66F4;&#x5177;&#x5C01;&#x88C5;&#x6027;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">AccessLevels</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">int</span> <span class="token function">getReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> readOnly<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setReadWrite</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> readWrite <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">getReadWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> readWrite<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">setWriteOnly</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span> writeOnly <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> noAccess<span class="token punctuation">;</span>       <span class="token comment">// &#x5BF9;&#x6B64; int &#x65E0;&#x4EFB;&#x4F55;&#x8BBF;&#x95EE;&#x52A8;&#x4F5C;</span>
    <span class="token keyword">int</span> readOnly<span class="token punctuation">;</span>       <span class="token comment">// &#x5BF9;&#x6B64; int &#x505A;&#x53EA;&#x8BFB;&#x8BBF;&#x95EE;&#xFF08;read-only access&#xFF09;</span>
    <span class="token keyword">int</span> readWrite<span class="token punctuation">;</span>      <span class="token comment">// &#x5BF9;&#x6B64; int &#x505A;&#x8BFB;&#x5199;&#x8BBF;&#x95EE;&#xFF08;read-write access&#xFF09;</span>
    <span class="token keyword">int</span> writeOnly<span class="token punctuation">;</span>      <span class="token comment">// &#x5BF9;&#x6B64; int &#x505A;&#x60DF;&#x5199;&#x8BBF;&#x95EE;&#xFF08;write-only access&#xFF09;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// &#x5982;&#x6B64;&#x7EC6;&#x5FAE;&#x5730;&#x5212;&#x5206;&#x8BBF;&#x95EE;&#x63A7;&#x5236;&#x9887;&#x6709;&#x5FC5;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x8BB8;&#x591A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5E94;&#x8BE5;&#x88AB;&#x9690;&#x85CF;&#x8D77;&#x6765;&#x3002;</span>
<span class="token comment">// &#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x90FD;&#x9700;&#x8981;&#x4E00;&#x4E2A; getter &#x51FD;&#x6570;&#x548C; setter &#x51FD;&#x6570;&#x6BD5;&#x7ADF;&#x7F55;&#x89C1;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">SpeedDataCollection</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">addValue</span><span class="token punctuation">(</span><span class="token keyword">int</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x6DFB;&#x52A0;&#x4E00;&#x7B14;&#x65B0;&#x6570;&#x636E;</span>
    <span class="token keyword">double</span> <span class="token function">averageSoFar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x8FD4;&#x56DE;&#x5E73;&#x5747;&#x901F;&#x5EA6;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// &#x7B2C;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#xFF08;&#x968F;&#x65F6;&#x4FDD;&#x5B58;&#x5E73;&#x5747;&#x503C;&#xFF09;&#x4F1A;&#x4F7F;&#x5F97;&#x6BCF;&#x4E00;&#x4E2A; SpeedDataCollection &#x5BF9;&#x8C61;&#x53D8;&#x5927;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x4F60;&#x5FC5;&#x987B;&#x4E3A;&#x7528;&#x6765;&#x5B58;&#x653E;&#x76EE;&#x524D;&#x5E73;&#x5747;&#x503C;&#x3001;&#x7D2F;&#x79EF;&#x603B;&#x91CF;&#x3001;&#x6570;&#x636E;&#x70B9;&#x6570;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5206;&#x914D;&#x7A7A;&#x95F4;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C; averageSoFar &#x5374;&#x53EF;&#x56E0;&#x6B64;&#x800C;&#x5341;&#x5206;&#x9AD8;&#x6548;&#xFF1B;&#x5B83;&#x53EF;&#x4EE5;&#x53EA;&#x662F;&#x4E00;&#x4E2A;&#x8FD4;&#x56DE;&#x76EE;&#x524D;&#x5E73;&#x5747;&#x503C;&#x7684; inline &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x76F8;&#x53CD;&#x5730;&#xFF0C;&#x201C;&#x88AB;&#x8BE2;&#x95EE;&#x624D;&#x8BA1;&#x7B97;&#x5E73;&#x5747;&#x503C;&#x201D;&#x4F1A;&#x4F7F;&#x5F97; averageSoFar &#x6267;&#x884C;&#x8F83;&#x6162;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6BCF;&#x4E00;&#x4E2A; SpeedDataCollection &#x5BF9;&#x8C61;&#x6BD4;&#x8F83;&#x5C0F;&#x3002;</span>

<span class="token comment">// &#x91CD;&#x70B9;&#x662F;&#xFF0C;&#x7531;&#x4E8E;&#x901A;&#x8FC7;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6765;&#x8BBF;&#x95EE;&#x5E73;&#x5747;&#x503C;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5C01;&#x88C5;&#x4E86;&#x5B83;&#xFF09;&#xFF0C;&#x4F60;&#x5F97;&#x4EE5;&#x66FF;&#x6362;</span>
<span class="token comment">// &#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF08;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x4F60;&#x53EF;&#x80FD;&#x60F3;&#x5230;&#x7684;&#x4E1C;&#x897F;&#xFF09;&#xFF0C;&#x5BA2;&#x6237;&#x6700;&#x591A;&#x53EA;&#x9700;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;</span>
<span class="token comment">// &#xFF08;&#x5982;&#x679C;&#x9075;&#x5FAA;&#x6761;&#x6B3E; 31 &#x6240;&#x63CF;&#x8FF0;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x4F60;&#x751A;&#x81F3;&#x53EF;&#x4EE5;&#x6D88;&#x9664;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x7684;&#x4E0D;&#x4FBF;&#x6027;&#x3002;&#xFF09;</span>





<span class="token comment">// &#x4E00;&#x65E6;&#x4F60;&#x5C06;&#x4E00;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x58F0;&#x660E;&#x4E3A; public &#x6216; protected &#x800C;&#x5BA2;&#x6237;&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x5F88;&#x96BE;&#x6539;&#x53D8;&#x90A3;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6240;&#x6D89;&#x53CA;&#x7684;&#x4E00;&#x5207;&#x3002;&#x592A;&#x591A;&#x4EE3;&#x7801;&#x9700;&#x8981;&#x91CD;&#x5199;&#x3001;&#x91CD;&#x65B0;&#x6D4B;&#x8BD5;&#x3001;</span>
<span class="token comment">// &#x91CD;&#x65B0;&#x7F16;&#x5199;&#x6587;&#x6863;&#x3001;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;&#x4ECE;&#x5C01;&#x88C5;&#x7684;&#x89D2;&#x5EA6;&#x89C2;&#x4E4B;&#xFF0C;&#x5176;&#x5B9E;&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x8BBF;&#x95EE;&#x6743;&#x9650;&#xFF1A;</span>
<span class="token comment">// private&#xFF08;&#x63D0;&#x4F9B;&#x5C01;&#x88C5;&#xFF09;&#x548C;&#x5176;&#x4ED6;&#xFF08;&#x4E0D;&#x63D0;&#x4F9B;&#x5C01;&#x88C5;&#xFF09;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-23%E5%AE%81%E4%BB%A5-non-member-non-friend-%E6%9B%BF%E6%8D%A2-member-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 23&#xFF1A;&#x5B81;&#x4EE5; non-member&#x3001;non-friend &#x66FF;&#x6362; member &#x51FD;&#x6570;</h3>

<ul>
<li>&#x5B81;&#x53EF;&#x62FF; non-member non-friend &#x51FD;&#x6570;&#x66FF;&#x6362; member &#x51FD;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x53EF;&#x4EE5;&#x589E;&#x52A0;&#x5C01;&#x88C5;&#x6027;&#x3001;&#x5305;&#x88F9;&#x5F39;&#x6027;&#xFF08;packaging flexibility&#xFF09;&#x548C;&#x673A;&#x80FD;&#x6269;&#x5145;&#x6027;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">WebBrowser</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">clearHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">removeCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8BB8;&#x591A;&#x7528;&#x6237;&#x4F1A;&#x60F3;&#x4E00;&#x6574;&#x4E2A;&#x6267;&#x884C;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x52A8;&#x4F5C;&#xFF0C;&#x56E0;&#x6B64; WebBrowser &#x4E5F;&#x63D0;&#x4F9B;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">WebBrowser</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">clearEverything</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x8C03;&#x7528; clearCache&#xFF0C;clearHistory&#xFF0C;</span>
                                    <span class="token comment">// &#x548C; removeCookies</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5F53;&#x7136;&#xFF0C;&#x8FD9;&#x4E00;&#x673A;&#x80FD;&#x4E5F;&#x53EF;&#x7531;&#x4E00;&#x4E2A; non-member &#x51FD;&#x6570;&#x8C03;&#x7528;&#x9002;&#x5F53;&#x7684; member &#x51FD;&#x6570;&#x800C;&#x63D0;&#x4F9B;&#x51FA;&#x6765;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">clearBrowser</span><span class="token punctuation">(</span>WebBrowser<span class="token operator">&amp;</span> wb<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    wb<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wb<span class="token punctuation">.</span><span class="token function">clearHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wb<span class="token punctuation">.</span><span class="token function">removeCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5B88;&#x5219;&#x8981;&#x6C42;&#xFF0C;&#x6570;&#x636E;&#x4EE5;&#x53CA;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x7684;&#x90A3;&#x4E9B;&#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x88AB;&#x6346;&#x7ED1;&#x5728;&#x4E00;&#x5757;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x610F;&#x5473;&#x5B83;&#x5EFA;&#x8BAE; member &#x51FD;&#x6570;&#x662F;&#x8F83;&#x597D;&#x7684;&#x9009;&#x62E9;&#x3002;&#x4E0D;&#x5E78;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x5EFA;&#x8BAE;&#x4E0D;&#x6B63;&#x786E;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F;&#x57FA;&#x4E8E;&#x5BF9;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x771F;&#x5B9E;&#x610F;&#x4E49;&#x7684;&#x4E00;&#x4E2A;&#x8BEF;&#x89E3;&#x3002;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x5B88;&#x5219;&#x8981;&#x6C42;&#x6570;&#x636E;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x88AB;&#x5C01;&#x88C5;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x800C;&#x4E0E;&#x76F4;&#x89C2;&#x76F8;&#x53CD;&#x5730;&#xFF0C;member &#x51FD;&#x6570; clearEverything &#x5E26;&#x6765;&#x7684;&#x5C01;&#x88C5;&#x6027;&#x6BD4;</span>
<span class="token comment">// non-member &#x51FD;&#x6570; clearBrowser &#x4F4E;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x63D0;&#x4F9B; non-member &#x51FD;&#x6570;</span>
<span class="token comment">// &#x53EF;&#x5141;&#x8BB8;&#x5BF9; WebBrowser &#x76F8;&#x5173;&#x673A;&#x80FD;&#x6709;&#x8F83;&#x5927;&#x7684;&#x5305;&#x88F9;&#x5F39;&#x6027;&#xFF08;packaging flexibility&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x6700;&#x7EC8;&#x5BFC;&#x81F4;&#x8F83;&#x4F4E;&#x7684;&#x7F16;&#x8BD1;&#x76F8;&#x4F9D;&#x5EA6;&#xFF0C;&#x589E;&#x52A0; WebBrowser &#x7684;&#x53EF;&#x5EF6;&#x4F38;&#x6027;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x5728;&#x8BB8;&#x591A;&#x65B9;&#x9762; non-member &#x505A;&#x6CD5;&#x6BD4; member &#x505A;&#x6CD5;&#x597D;&#x3002;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4E86;&#x89E3;&#x5176;&#x539F;&#x56E0;&#x3002;</span>





<span class="token comment">// &#x4F8B;&#x5982;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4EE4; clearBrowser &#x6210;&#x4E3A;&#x67D0;&#x5DE5;&#x5177;&#x7C7B;&#xFF08;utility class&#xFF09;&#x7684;&#x4E00;&#x4E2A;</span>
<span class="token comment">// static member &#x51FD;&#x6570;&#x3002;&#x53EA;&#x8981;&#x5B83;&#x4E0D;&#x662F; WebBrowser &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF08;&#x6216;&#x6210;&#x4E3A;&#x5176; friend&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x4E0D;&#x4F1A;&#x5F71;&#x54CD; WebBrowser &#x7684; private &#x6210;&#x5458;&#x5C01;&#x88C5;&#x6027;&#x3002;</span>

<span class="token comment">// &#x5728; C++&#xFF0C;&#x6BD4;&#x8F83;&#x81EA;&#x7136;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8BA9; clearBrowser &#x6210;&#x4E3A;&#x4E00;&#x4E2A; non-member &#x51FD;&#x6570;&#x5E76;&#x4E14;&#x4F4D;&#x4E8E;</span>
<span class="token comment">// WebBrowser &#x6240;&#x5728;&#x7684;&#x540C;&#x4E00;&#x4E2A; namespace&#xFF08;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF09;&#x5185;&#xFF1A;</span>
<span class="token keyword">namespace</span> WebBrowserStuff <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">WebBrowser</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">clearBrowser</span><span class="token punctuation">(</span>WebBrowser<span class="token operator">&amp;</span> wb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x7136;&#x800C;&#x8FD9;&#x4E0D;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x770B;&#x8D77;&#x6765;&#x81EA;&#x7136;&#x800C;&#x5DF2;&#x3002;&#x8981;&#x77E5;&#x9053;&#xFF0C;namespace &#x548C; classes &#x4E0D;&#x540C;&#xFF0C;</span>
<span class="token comment">// &#x524D;&#x8005;&#x53EF;&#x8DE8;&#x8D8A;&#x591A;&#x4E2A;&#x6E90;&#x7801;&#x6587;&#x4EF6;&#x800C;&#x540E;&#x8005;&#x4E0D;&#x80FD;&#x3002;&#x8FD9;&#x5F88;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x50CF; clearBrowser</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x662F;&#x4E2A;&#x201C;&#x63D0;&#x4F9B;&#x4FBF;&#x5229;&#x7684;&#x51FD;&#x6570;&#x201D;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x65E2;&#x4E0D;&#x662F; members &#x4E5F;&#x4E0D;&#x662F; friends&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x6CA1;&#x6709;&#x5BF9; WebBrowser &#x7684;&#x7279;&#x6B8A;&#x8BBF;&#x95EE;&#x6743;&#x5229;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x80FD;&#x63D0;&#x4F9B;</span>
<span class="token comment">// &#x201C;WebBrowser &#x5BA2;&#x6237;&#x65E0;&#x6CD5;&#x4EE5;&#x5176;&#x4ED6;&#x65B9;&#x5F0F;&#x53D6;&#x5F97;&#x201D;&#x7684;&#x673A;&#x80FD;&#x3002;</span>
<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5982;&#x679C; clearBrowser &#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5BA2;&#x6237;&#x7AEF;&#x5C31;&#x53EA;&#x597D;&#x81EA;&#x884C;&#x8C03;&#x7528;</span>
<span class="token comment">// clearCache&#xFF0C;clearHistory &#x548C; removeCookies&#x3002;</span>





<span class="token comment">// &#x5206;&#x79BB;&#x5B83;&#x4EEC;&#x7684;&#x6700;&#x76F4;&#x63A5;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#x5C06;&#x4E66;&#x7B7E;&#x76F8;&#x5173;&#x4FBF;&#x5229;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E8E;&#x4E00;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#xFF0C;</span>
<span class="token comment">// &#x5C06; cookie &#x76F8;&#x5173;&#x4FBF;&#x5229;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E8E;&#x53E6;&#x4E00;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x518D;&#x5C06;&#x6253;&#x5370;&#x76F8;&#x5173;&#x4FBF;&#x5229;</span>
<span class="token comment">// &#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E8E;&#x7B2C;&#x4E09;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x4F9D;&#x6B21;&#x7C7B;&#x63A8;&#xFF1A;</span>

<span class="token comment">// &#x5934;&#x6587;&#x4EF6;&#x201C;webbrowser.h&#x201D;&#x2014;&#x2014;&#x8FD9;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#x9488;&#x5BF9; class WebBrowser &#x81EA;&#x8EAB;</span>
<span class="token comment">// &#x53CA; WebBrowser &#x6838;&#x5FC3;&#x673A;&#x80FD;&#x3002;</span>
<span class="token keyword">namespace</span> WebBrowserStuff <span class="token punctuation">{</span>
<span class="token keyword">class</span> <span class="token class-name">WebBrowser</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                     <span class="token comment">// &#x6838;&#x5FC3;&#x673A;&#x80FD;&#xFF0C;&#x4F8B;&#x5982;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x5BA2;&#x6237;&#x90FD;&#x9700;&#x8981;&#x7684;</span>
                            <span class="token comment">// non-member &#x51FD;&#x6570;&#x3002;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5934;&#x6587;&#x4EF6;&#x201C;webbrowserbookmarks.h&#x201D;</span>
<span class="token keyword">namespace</span> WebBrowserStuff <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                     <span class="token comment">// &#x4E0E;&#x4E66;&#x7B7E;&#x76F8;&#x5173;&#x7684;&#x4FBF;&#x5229;&#x51FD;&#x6570;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5934;&#x6587;&#x4EF6;&#x201C;webbrowsercookies.h&#x201D;</span>
<span class="token keyword">namespace</span> WebBrowserStuff <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                     <span class="token comment">// &#x4E0E; cookie &#x76F8;&#x5173;&#x7684;&#x4FBF;&#x5229;&#x51FD;&#x6570;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>





<span class="token comment">// &#x5C06;&#x6240;&#x6709;&#x4FBF;&#x5229;&#x51FD;&#x6570;&#x653E;&#x5728;&#x591A;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#x5185;&#x4F46;&#x96B6;&#x5C5E;&#x540C;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;</span>
<span class="token comment">// &#x610F;&#x5473;&#x5BA2;&#x6237;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x6269;&#x5C55;&#x8FD9;&#x4E00;&#x7EC4;&#x4FBF;&#x5229;&#x51FD;&#x6570;&#x3002;&#x4ED6;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x6DFB;&#x52A0;</span>
<span class="token comment">// &#x66F4;&#x591A; non-member non-friend &#x51FD;&#x6570;&#x5230;&#x6B64;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-24%E8%8B%A5%E6%89%80%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%86%E9%9C%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E8%AF%B7%E4%B8%BA%E6%AD%A4%E9%87%87%E7%94%A8-non-member-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 24&#xFF1A;&#x82E5;&#x6240;&#x6709;&#x53C2;&#x6570;&#x7686;&#x9700;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x8BF7;&#x4E3A;&#x6B64;&#x91C7;&#x7528; non-member &#x51FD;&#x6570;</h3>

<ul>
<li>&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x4E3A;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x6240;&#x6709;&#x53C2;&#x6570;&#xFF08;&#x5305;&#x62EC;&#x88AB; this &#x6307;&#x9488;&#x6240;&#x6307;&#x7684;&#x90A3;&#x4E2A;&#x9690;&#x55BB;&#x53C2;&#x6570;&#xFF09;&#x8FDB;&#x884C;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x662F;&#x4E2A; non-member&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Rational</span><span class="token punctuation">(</span><span class="token keyword">int</span> numerator <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#x523B;&#x610F;&#x4E0D;&#x4E3A; explicit&#xFF1B;</span>
             <span class="token keyword">int</span> denominator <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5141;&#x8BB8; int-to-Rational &#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x3002;</span>
    <span class="token keyword">int</span> <span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>              <span class="token comment">// &#x5206;&#x5B50;&#xFF08;numerator&#xFF09;&#x548C;&#x5206;&#x6BCD;&#xFF08;denominator&#xFF09;</span>
    <span class="token keyword">int</span> <span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>            <span class="token comment">// &#x7684;&#x8BBF;&#x95EE;&#x51FD;&#x6570;&#xFF08;accessors&#xFF09;&#x2014;&#x2014; &#x89C1;&#x6761;&#x6B3E; 22&#x3002;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x4F7F;&#x4F60;&#x80FD;&#x591F;&#x5C06;&#x4E24;&#x4E2A;&#x6709;&#x7406;&#x6570;&#x4EE5;&#x6700;&#x8F7B;&#x677E;&#x81EA;&#x5728;&#x7684;&#x65B9;&#x5F0F;&#x76F8;&#x4E58;&#xFF1A;</span>
Rational <span class="token function">oneEighth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Rational <span class="token function">oneHalf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Rational result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> oneEighth<span class="token punctuation">;</span>      <span class="token comment">// &#x5F88;&#x597D;</span>
result <span class="token operator">=</span> result <span class="token operator">*</span> oneEighth                 <span class="token comment">// &#x5F88;&#x597D;</span>

<span class="token comment">// &#x7136;&#x800C;&#x5F53;&#x4F60;&#x5C1D;&#x8BD5;&#x6DF7;&#x5408;&#x5F0F;&#x7B97;&#x672F;&#xFF0C;&#x4F60;&#x53D1;&#x73B0;&#x53EA;&#x6709;&#x4E00;&#x534A;&#x884C;&#x5F97;&#x901A;&#xFF1A;</span>
result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>           <span class="token comment">// &#x5F88;&#x597D;</span>
result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> oneHalf<span class="token punctuation">;</span>           <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>

<span class="token comment">// &#x5F53;&#x4F60;&#x4EE5;&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x5F62;&#x5F0F;&#x91CD;&#x5199;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x5F0F;&#x5B50;&#xFF0C;&#x95EE;&#x9898;&#x6240;&#x5728;&#x4FBF;&#x4E00;&#x76EE;&#x4E86;&#x7136;&#x4E86;&#xFF1A;</span>
result <span class="token operator">=</span> oneHalf<span class="token punctuation">.</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x5F88;&#x597D;</span>
result <span class="token operator">=</span> <span class="token number">2.</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span>oneHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>

<span class="token comment">// &#x662F;&#x7684;&#xFF0C;oneHalf &#x662F;&#x4E00;&#x4E2A;&#x5185;&#x542B; operator* &#x51FD;&#x6570;&#x7684; class &#x7684;&#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x3002;&#x7136;&#x800C;&#x6574;&#x6570; 2 &#x5E76;&#x6CA1;&#x6709;&#x76F8;&#x5E94;&#x7684; class&#xFF0C;&#x4E5F;&#x5C31;</span>
<span class="token comment">// &#x6CA1;&#x6709; operator* &#x6210;&#x5458;&#x51FD;&#x6570;&#x3002;&#x7F16;&#x8BD1;&#x5668;&#x4E5F;&#x4F1A;&#x5C1D;&#x8BD5;&#x5BFB;&#x627E;&#x53EF;&#x88AB;&#x4EE5;&#x4E0B;&#x8FD9;&#x822C;&#x8C03;</span>
<span class="token comment">// &#x7528;&#x7684; non-member operator*&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x6216;&#x5728; global &#x4F5C;&#x7528;&#x57DF;&#x5185;&#xFF09;&#xFF1A;</span>
result <span class="token operator">=</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> oneHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>
<span class="token comment">// &#x4F46;&#x672C;&#x4F8B;&#x5E76;&#x4E0D;&#x5B58;&#x5728;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x63A5;&#x53D7; int &#x548C; Rational &#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#x7684; non-member</span>
<span class="token comment">// operator*&#xFF0C;&#x56E0;&#x6B64;&#x67E5;&#x627E;&#x5931;&#x8D25;&#x3002;</span>





<span class="token comment">// &#x518D;&#x6B21;&#x770B;&#x770B;&#x5148;&#x524D;&#x6210;&#x529F;&#x7684;&#x90A3;&#x4E2A;&#x8C03;&#x7528;&#x3002;&#x6CE8;&#x610F;&#x5176;&#x7B2C;&#x4E8C;&#x53C2;&#x6570;&#x662F;&#x6574;&#x6570; 2&#xFF0C;&#x4F46;</span>
<span class="token comment">// Rational::operator* &#x9700;&#x8981;&#x7684;&#x5B9E;&#x53C2;&#x5374;&#x662F;&#x4E2A; Rational &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token keyword">const</span> Rational <span class="token function">temp</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6839;&#x636E; 2 &#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x6682;&#x65F6;&#x6027;&#x7684; Rational &#x5BF9;&#x8C61;&#x3002;</span>
result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> temp<span class="token punctuation">;</span>    <span class="token comment">// &#x7B49;&#x540C;&#x4E8E; oneHalf.operator*(temp)</span>

<span class="token comment">// &#x5F53;&#x7136;&#xFF0C;&#x53EA;&#x56E0;&#x4E3A;&#x6D89;&#x53CA; non-explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x624D;&#x4F1A;&#x8FD9;&#x4E48;&#x505A;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; Rational &#x6784;&#x9020;&#x51FD;&#x6570;&#x662F; explicit&#xFF0C;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF1A;</span>
result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>       <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#xFF08;&#x5728; explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;</span>
                            <span class="token comment">// &#x65E0;&#x6CD5;&#x5C06; 2 &#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A; Rational&#x3002;</span>
result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> oneHalf<span class="token punctuation">;</span>       <span class="token comment">// &#x4E00;&#x6837;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x4E00;&#x6837;&#x7684;&#x95EE;&#x9898;&#x3002;</span>





result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>       <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF08;&#x5728; non-explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;</span>
result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> oneHalf<span class="token punctuation">;</span>       <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#xFF08;&#x751A;&#x81F3;&#x5728; non-explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF09;</span>
<span class="token comment">// &#x7ED3;&#x8BBA;&#x662F;&#xFF0C;&#x53EA;&#x6709;&#x5F53;&#x53C2;&#x6570;&#x88AB;&#x5217;&#x4E8E;&#x53C2;&#x6570;&#x5217;&#xFF08;parameter list&#xFF09;&#x5185;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x624D;&#x662F;&#x9690;&#x5F0F;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x7684;&#x5408;&#x683C;&#x53C2;&#x4E0E;&#x8005;&#x3002;</span>





<span class="token comment">// &#x8BA9; operator* &#x6210;&#x4E3A;&#x4E00;&#x4E2A; non-member &#x51FD;&#x6570;&#xFF0C;&#x4FBF;&#x5141;&#x8BB8;&#x7F16;&#x8BD1;&#x5668;&#x5728;</span>
<span class="token comment">// &#x6BCF;&#x4E00;&#x4E2A;&#x5B9E;&#x53C2;&#x8EAB;&#x4E0A;&#x6267;&#x884C;&#x9690;&#x5F0F;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x4E0D;&#x5305;&#x62EC; operator*</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>      <span class="token comment">// &#x73B0;&#x5728;&#x6210;&#x4E86;&#x4E00;&#x4E2A;</span>
                          <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>      <span class="token comment">// non-member &#x51FD;&#x6570;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Rational</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    lhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Rational <span class="token function">oneFourth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Rational result<span class="token punctuation">;</span>
result <span class="token operator">=</span> oneFourth <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;</span>
result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> oneFourth<span class="token punctuation">;</span>     <span class="token comment">// &#x4E07;&#x5C81;&#xFF0C;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x4E86;&#xFF01;</span>

<span class="token comment">// &#x8FD9;&#x5F53;&#x7136;&#x662F;&#x4E2A;&#x5FEB;&#x4E50;&#x7684;&#x7ED3;&#x5C40;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#x5FC5;&#x987B;&#x64CD;&#x5FC3;&#xFF1A;operator* &#x662F;&#x5426;&#x5E94;</span>
<span class="token comment">// &#x8BE5;&#x6210;&#x4E3A; Rational class &#x7684;&#x4E00;&#x4E2A; friend &#x51FD;&#x6570;&#x5462;&#xFF1F;</span>
<span class="token comment">// &#x5C31;&#x672C;&#x4F8B;&#x800C;&#x8A00;&#x7B54;&#x6848;&#x662F;&#x5426;&#x5B9A;&#x7684;&#xFF0C;&#x56E0;&#x4E3A; operator* &#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x85C9;&#x7531; Rational</span>
<span class="token comment">// &#x7684; public &#x63A5;&#x53E3;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#xFF0C;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5DF2;&#x8868;&#x660E;&#x6B64;&#x79CD;&#x505A;&#x6CD5;&#x3002;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-25%E8%80%83%E8%99%91%E5%86%99%E5%87%BA%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8A%9B%E5%BC%82%E5%B8%B8%E7%9A%84-swap-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 25&#xFF1A;&#x8003;&#x8651;&#x5199;&#x51FA;&#x4E00;&#x4E2A;&#x4E0D;&#x629B;&#x5F02;&#x5E38;&#x7684; swap &#x51FD;&#x6570;</h3>

<ul>
<li>&#x5F53; std::swap &#x5BF9;&#x4F60;&#x7684;&#x7C7B;&#x578B;&#x6548;&#x7387;&#x4E0D;&#x9AD8;&#x65F6;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; swap &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x786E;&#x5B9A;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0D;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F60;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; member swap&#xFF0C;&#x4E5F;&#x8BE5;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; non-member swap &#x7528;&#x6765;&#x8C03;&#x7528;&#x5176;&#x524D;&#x8005;&#x3002;&#x5BF9;&#x4E8E; classes&#xFF08;&#x800C;&#x975E; templates&#xFF09;&#xFF0C;&#x4E5F;&#x8BF7;&#x7279;&#x5316; std::swap&#x3002;</li>
<li>&#x8C03;&#x7528; swap &#x65F6;&#x5E94;&#x9488;&#x5BF9; std::swap &#x4F7F;&#x7528; using &#x58F0;&#x660E;&#x5F0F;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528; swap &#x5E76;&#x4E14;&#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x201C;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x8D44;&#x683C;&#x4FEE;&#x9970;&#x201D;&#x3002;</li>
<li>&#x4E3A;&#x201C;&#x7528;&#x6237;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x201D;&#x8FDB;&#x884C; std templates &#x5168;&#x7279;&#x5316;&#x662F;&#x597D;&#x7684;&#xFF0C;&#x4F46;&#x5343;&#x4E07;&#x4E0D;&#x8981;&#x5C1D;&#x8BD5;&#x5728; std &#x5185;&#x52A0;&#x5165;&#x67D0;&#x4E9B;&#x5BF9; std &#x800C;&#x8A00;&#x5168;&#x65B0;&#x7684;&#x4E1C;&#x897F;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>        <span class="token comment">// std::swap &#x7684;&#x5178;&#x578B;&#x5B9E;&#x73B0;&#xFF1B;</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> T<span class="token operator">&amp;</span> b<span class="token punctuation">)</span>       <span class="token comment">// &#x7F6E;&#x6362; a &#x548C; b &#x7684;&#x503C;&#x3002;</span>
    <span class="token punctuation">{</span>
        T <span class="token function">temp</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        a <span class="token operator">=</span> b<span class="token punctuation">;</span>
        b <span class="token operator">=</span> temp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// &#x5176;&#x4E2D;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x5C31;&#x662F;&#x201C;&#x4EE5;&#x6307;&#x9488;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x5185;&#x542B;&#x771F;&#x6B63;&#x6570;&#x636E;&#x201D;&#x90A3;&#x79CD;&#x7C7B;&#x578B;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x8BBE;&#x8BA1;&#x7684;&#x5E38;&#x89C1;&#x8868;&#x73B0;&#x5F62;&#x5F0F;&#x662F;&#x6240;&#x8C13;&#x201C;pimpl &#x624B;&#x6CD5;&#x201D;</span>
<span class="token comment">// &#xFF08;pimpl &#x662F; &#x201C;pointer to implementation&#x201D;&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 31&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4EE5;&#x8FD9;&#x79CD;&#x624B;&#x6CD5;&#x8BBE;&#x8BA1; Widget class&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x4F1A;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">WidgetImpl</span> <span class="token punctuation">{</span>              <span class="token comment">// &#x9488;&#x5BF9; Widget &#x6570;&#x636E;&#x800C;&#x8BBE;&#x8BA1;&#x7684; class&#xFF1B;</span>
<span class="token keyword">public</span><span class="token operator">:</span>                         <span class="token comment">// &#x7EC6;&#x8282;&#x4E0D;&#x91CD;&#x8981;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">;</span>                <span class="token comment">// &#x53EF;&#x80FD;&#x6709;&#x8BB8;&#x591A;&#x6570;&#x636E;&#xFF0C;</span>
    std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> v<span class="token punctuation">;</span>      <span class="token comment">// &#x610F;&#x5473;&#x590D;&#x5236;&#x65F6;&#x95F4;&#x5F88;&#x957F;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>                                  <span class="token comment">// &#x8FD9;&#x4E2A; class &#x4F7F;&#x7528; pimpl &#x624B;&#x6CD5;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Widget</span><span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Widget<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>       <span class="token comment">// &#x590D;&#x5236; Widget &#x65F6;&#xFF0C;&#x4EE4;&#x5B83;&#x8D4B;&#x503C;&#x5176;</span>
    <span class="token punctuation">{</span>                                           <span class="token comment">// WidgetImpl &#x5BF9;&#x8C61;&#x3002;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x5173;&#x4E8E; operator= &#x7684;&#x4E00;&#x822C;&#x6027;&#x5B9E;&#x73B0;</span>
        <span class="token operator">*</span>pImpl <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>pImpl<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// &#x7EC6;&#x8282;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 10&#xFF0C;11 &#x548C; 12.</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    WidgetImpl<span class="token operator">*</span> pImpl<span class="token punctuation">;</span>                          <span class="token comment">// &#x6307;&#x9488;&#xFF0C;&#x6240;&#x6307;&#x5BF9;&#x8C61;&#x5185;&#x542B;</span>
                                                <span class="token comment">// Widget &#x6570;&#x636E;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E00;&#x65E6;&#x8981;&#x7F6E;&#x6362;&#x4E24;&#x4E2A; Widget &#x5BF9;&#x8C61;&#x503C;&#xFF0C;&#x6211;&#x4EEC;&#x552F;&#x4E00;&#x9700;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x7F6E;&#x6362;&#x5176;</span>
<span class="token comment">// pImpl &#x6307;&#x9488;&#xFF0C;&#x4F46;&#x7F3A;&#x7701;&#x7684; swap &#x7B97;&#x6CD5;&#x4E0D;&#x77E5;&#x9053;&#x8FD9;&#x4E00;&#x70B9;&#x3002;&#x5B83;&#x4E0D;&#x53EA;&#x590D;&#x5236;&#x4E09;</span>
<span class="token comment">// &#x4E2A; Widgets&#xFF0C;&#x8FD8;&#x590D;&#x5236;&#x4E09;&#x4E2A; WidgetImpl &#x5BF9;&#x8C61;&#x3002;&#x975E;&#x5E38;&#x7F3A;&#x4E4F;&#x6548;&#x7387;&#xFF01;</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x544A;&#x8BC9; std::swap&#xFF1A;&#x5F53; Widgets &#x88AB;&#x7F6E;&#x6362;&#x65F6;&#x771F;&#x6B63;&#x8BE5;&#x505A;&#x7684;&#x662F;</span>
<span class="token comment">// &#x7F6E;&#x6362;&#x5176;&#x5185;&#x90E8;&#x7684; pImpl &#x6307;&#x9488;&#x3002;&#x786E;&#x5207;&#x5B9E;&#x8DF5;&#x8FD9;&#x4E2A;&#x601D;&#x8DEF;&#x7684;&#x4E00;&#x4E2A;&#x505A;&#x6CD5;&#x662F;&#xFF1A;&#x5C06; std::swap</span>
<span class="token comment">// &#x9488;&#x5BF9; Widget &#x7279;&#x5316;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x57FA;&#x672C;&#x6784;&#x60F3;&#xFF0C;&#x4F46;&#x76EE;&#x524D;&#x8FD9;&#x4E2A;&#x5F62;&#x5F0F;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF1A;</span>
<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>                          <span class="token comment">// &#x8FD9;&#x662F; std::swap &#x9488;&#x5BF9;</span>
    <span class="token keyword">void</span> swap<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> <span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> a<span class="token punctuation">,</span>       <span class="token comment">// &#x201C;T &#x662F; Widget&#x201D;&#x7684;&#x7279;&#x5316;&#x7248;&#x672C;&#x3002;</span>
                       Widget<span class="token operator">&amp;</span> b<span class="token punctuation">)</span>       <span class="token comment">// &#x76EE;&#x524D;&#x8FD8;&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>
    <span class="token punctuation">{</span>
        <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>pImpl<span class="token punctuation">,</span> b<span class="token punctuation">.</span>pImpl<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x7F6E;&#x6362; Widgets &#x65F6;&#x53EA;&#x8981;&#x7F6E;&#x6362;&#x5B83;&#x4EEC;&#x7684;</span>
                                        <span class="token comment">// pImpl &#x6307;&#x9488;&#x5C31;&#x597D;&#x3002;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E00;&#x5F00;&#x59CB;&#x7684;&#x201C;template&lt;&gt;&#x201D;&#x8868;&#x793A;&#x5B83;&#x662F; std::swap &#x7684;&#x4E00;&#x4E2A;&#x5168;&#x7279;&#x5316;</span>
<span class="token comment">// &#xFF08;total template specialization&#xFF09;&#x7248;&#x672C;&#xFF0C;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x4E4B;&#x540E;&#x7684;</span>
<span class="token comment">// &#x201C;&lt;Widget&gt;&#x201D;&#x8868;&#x793A;&#x8FD9;&#x4E00;&#x7279;&#x5316;&#x7248;&#x672C;&#x7CFB;&#x9488;&#x5BF9;&#x201C;T &#x662F; Widget&#x201D;&#x800C;&#x8BBE;&#x8BA1;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;&#x56E0;&#x4E3A;&#x5B83;&#x4F01;&#x56FE;&#x8BBF;&#x95EE; a &#x548C; b &#x5185;&#x7684; pImpl &#x6307;&#x9488;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x5374;&#x662F; private&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E2A;&#x7279;&#x5316;&#x7248;&#x672C;&#x58F0;&#x660E;&#x4E3A; friend&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x548C;&#x4EE5;&#x5F80;&#x7684;&#x89C4;&#x77E9;&#x4E0D;&#x592A;&#x4E00;&#x6837;&#xFF1A;&#x6211;&#x4EEC;&#x4EE4; Widget &#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; swap &#x7684;</span>
<span class="token comment">// public &#x6210;&#x5458;&#x51FD;&#x6570;&#x505A;&#x771F;&#x6B63;&#x7684;&#x7F6E;&#x6362;&#x5DE5;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x5C06; std::swap &#x7279;&#x5316;&#xFF0C;</span>
<span class="token comment">// &#x4EE4;&#x5B83;&#x8C03;&#x7528;&#x8BE5;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>                          <span class="token comment">// &#x4E0E;&#x524D;&#x540C;&#xFF0C;&#x552F;&#x4E00;&#x5DEE;&#x522B;&#x662F;&#x589E;&#x52A0; swap &#x51FD;&#x6570;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">using</span> std<span class="token operator">::</span>swap<span class="token punctuation">;</span>                <span class="token comment">// &#x8FD9;&#x4E2A;&#x58F0;&#x660E;&#x4E4B;&#x6240;&#x4EE5;&#x5FC5;&#x8981;&#xFF0C;&#x7A0D;&#x540E;&#x89E3;&#x91CA;&#x3002;</span>
        <span class="token function">swap</span><span class="token punctuation">(</span>pImpl<span class="token punctuation">,</span> other<span class="token punctuation">.</span>pImpl<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x82E5;&#x8981;&#x7F6E;&#x6362; Widgets &#x5C31;&#x7F6E;&#x6362;&#x5176; pImpl &#x6307;&#x9488;&#x3002;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>                          <span class="token comment">// &#x4FEE;&#x8BA2;&#x540E;&#x7684; std::swap &#x7279;&#x5316;&#x7248;&#x672C;</span>
    <span class="token keyword">void</span> swap<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> a<span class="token punctuation">,</span>
                      Widget<span class="token operator">&amp;</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        a<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x82E5;&#x8981;&#x7F6E;&#x6362; Widgets&#xFF0C;&#x8C03;&#x7528;&#x5176;</span>
    <span class="token punctuation">}</span>                                   <span class="token comment">// swap &#x6210;&#x5458;&#x51FD;&#x6570;&#x3002;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4E0D;&#x53EA;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x8FD8;&#x4E0E; STL &#x5BB9;&#x5668;&#x6709;&#x4E00;&#x81F4;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709; STL</span>
<span class="token comment">// &#x5BB9;&#x5668;&#x4E5F;&#x90FD;&#x63D0;&#x4F9B;&#x6709; public swap &#x6210;&#x5458;&#x51FD;&#x6570;&#x548C; std::swap &#x7279;&#x5316;&#x7248;&#x672C;&#xFF08;&#x7528;&#x4EE5;&#x8C03;&#x7528;&#x524D;&#x8005;&#xFF09;&#x3002;</span>





<span class="token comment">// &#x7136;&#x800C;&#x5047;&#x8BBE; Widget &#x548C; WidgetImpl &#x90FD;&#x662F; class templates &#x800C;&#x975E; classes&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x8BB8;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BD5;&#x8BD5;&#x5C06; WidgetImpl &#x5185;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x52A0;&#x4EE5;&#x53C2;&#x6570;&#x5316;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">WidgetImpl</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5728; Widget &#x5185;&#xFF08;&#x4EE5;&#x53CA; WidgetImpl &#x5185;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#xFF09;&#x653E;&#x4E2A; swap</span>
<span class="token comment">// &#x6210;&#x5458;&#x51FD;&#x6570;&#x5C31;&#x50CF;&#x4EE5;&#x5F80;&#x4E00;&#x6837;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x6211;&#x4EEC;&#x5374;&#x5728;&#x7279;&#x5316; std::swap &#x65F6;&#x9047;&#x4E0A;&#x4E71;&#x6D41;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x60F3;&#x5199;&#x6210;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
    <span class="token keyword">void</span> swap<span class="token operator">&lt;</span>Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span>      <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x4E0D;&#x5408;&#x6CD5;&#xFF01;</span>
                         Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> a<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x770B;&#x8D77;&#x6765;&#x5408;&#x60C5;&#x5408;&#x7406;&#xFF0C;&#x5374;&#x4E0D;&#x5408;&#x6CD5;&#x3002;&#x662F;&#x8FD9;&#x6837;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x4F01;&#x56FE;&#x504F;&#x7279;&#x5316;&#xFF08;partially specialize&#xFF09;</span>
<span class="token comment">// &#x4E00;&#x4E2A; function template&#xFF08;std::swap&#xFF09;&#xFF0C;&#x4F46; C++ &#x53EA;&#x5141;&#x8BB8;&#x5BF9; class templates</span>
<span class="token comment">// &#x504F;&#x7279;&#x5316;&#xFF0C;&#x5728; function templates &#x8EAB;&#x4E0A;&#x504F;&#x7279;&#x5316;&#x662F;&#x884C;&#x4E0D;&#x901A;&#x7684;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E0D;&#x8BE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF08;&#x867D;&#x7136;&#x6709;&#x4E9B;&#x7F16;&#x8BD1;&#x5668;&#x9519;&#x8BEF;&#x5730;&#x63A5;&#x53D7;&#x4E86;&#x5B83;&#xFF09;&#x3002;</span>





<span class="token comment">// &#x5F53;&#x4F60;&#x6253;&#x7B97;&#x504F;&#x7279;&#x5316;&#x4E00;&#x4E2A; function template &#x65F6;&#xFF0C;&#x60EF;&#x5E38;&#x505A;&#x6CD5;&#x662F;&#x7B80;&#x5355;</span>
<span class="token comment">// &#x5730;&#x4E3A;&#x5B83;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x91CD;&#x8F7D;&#x7248;&#x672C;&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>        <span class="token comment">// std::swap &#x7684;&#x4E00;&#x4E2A;&#x91CD;&#x8F7D;&#x7248;&#x672C;</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span>     <span class="token comment">// &#xFF08;&#x6CE8;&#x610F;&#x201C;swap&#x201D;&#x4E4B;&#x540E;&#x6CA1;&#x6709;&#x201C;&lt;...&gt;&#x201D;&#xFF09;</span>
              Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span>     <span class="token comment">// &#x7A0D;&#x540E;&#x6211;&#x4F1A;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;&#x8FD9;&#x4E5F;&#x4E0D;&#x5408;&#x6CD5;&#x3002;</span>
    <span class="token punctuation">{</span> a<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x5BA2;&#x6237;&#x53EF;&#x4EE5;&#x5168;&#x7279;&#x5316; std &#x5185;&#x7684; templates&#xFF0C;&#x4F46;&#x4E0D;&#x53EF;&#x4EE5;&#x6DFB;&#x52A0;&#x65B0;&#x7684; templates</span>
<span class="token comment">// &#xFF08;&#x6216; classes &#x6216; functions &#x6216;&#x5176;&#x4ED6;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#xFF09;&#x5230; std &#x91CC;&#x5934;&#x3002;</span>





<span class="token comment">// &#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x58F0;&#x660E;&#x4E00;&#x4E2A; non-member swap &#x8BA9;&#x5B83;&#x8C03;&#x7528; member swap&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x4E0D;&#x518D;&#x5C06;&#x90A3;&#x4E2A; non-member swap &#x58F0;&#x660E;&#x4E3A; std::swap &#x7684;&#x7279;&#x5316;&#x7248;&#x672C;</span>
<span class="token comment">// &#x6216;&#x91CD;&#x8F7D;&#x7248;&#x672C;&#x3002;</span>
<span class="token keyword">namespace</span> WidgetStuff <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6A21;&#x677F;&#x5316;&#x7684; WidgetImpl &#x7B49;&#x7B49;&#xFF0C;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>            <span class="token comment">// &#x540C;&#x524D;&#xFF0C;&#x5185;&#x542B; swap &#x6210;&#x5458;&#x51FD;&#x6570;</span>
    <span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>            <span class="token comment">// non-member swap &#x51FD;&#x6570;</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> a<span class="token punctuation">,</span>         <span class="token comment">// &#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x5C5E;&#x4E8E; std &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;</span>
              Widget<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        a<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj1<span class="token punctuation">,</span> T<span class="token operator">&amp;</span> obj2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x4F60;&#x5E0C;&#x671B;&#x7684;&#x5E94;&#x8BE5;&#x662F;&#x8C03;&#x7528; T &#x4E13;&#x5C5E;&#x7248;&#x672C;&#xFF0C;&#x5E76;&#x5728;&#x8BE5;&#x7248;&#x672C;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8C03;&#x7528; std</span>
<span class="token comment">// &#x5185;&#x7684;&#x4E00;&#x822C;&#x5316;&#x7248;&#x672C;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4F60;&#x5E0C;&#x671B;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj1<span class="token punctuation">,</span> T<span class="token operator">&amp;</span> obj2<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> std<span class="token operator">::</span>swap<span class="token punctuation">;</span>        <span class="token comment">// &#x4EE4; std::swap &#x5728;&#x6B64;&#x51FD;&#x6570;&#x5185;&#x53EF;&#x7528;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4E3A; T &#x578B;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x6700;&#x4F73; swap &#x7248;&#x672C;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x4E00;&#x65E6;&#x7F16;&#x8BD1;&#x5668;&#x770B;&#x5230;&#x5BF9; swap &#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5B83;&#x4EEC;&#x4FBF;&#x67E5;&#x627E;&#x9002;&#x5F53;&#x7684; swap &#x5E76;&#x8C03;&#x7528;&#x4E4B;&#x3002;</span>
<span class="token comment">// C++ &#x7684;&#x540D;&#x79F0;&#x67E5;&#x627E;&#x6CD5;&#x5219;&#xFF08;name lookup rules&#xFF09;&#x786E;&#x4FDD;&#x5C06;&#x627E;&#x5230; global</span>
<span class="token comment">// &#x4F5C;&#x7528;&#x57DF;&#x6216; T &#x6240;&#x5728;&#x4E4B;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x5185;&#x7684;&#x4EFB;&#x4F55; T &#x4E13;&#x5C5E;&#x7684; swap&#x3002;&#x5982;&#x679C; T &#x662F;</span>
<span class="token comment">// Widget &#x5E76;&#x4F4D;&#x4E8E;&#x547D;&#x540D;&#x7A7A;&#x95F4; WidgetStuff &#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x4F7F;&#x7528;&#x201C;&#x5B9E;&#x53C2;&#x53D6;</span>
<span class="token comment">// &#x51B3;&#x4E4B;&#x67E5;&#x627E;&#x89C4;&#x5219;&#x201D;&#xFF08;argument-dependent lookup&#xFF09;&#x627E;&#x51FA; WidgetStuff &#x5185;</span>
<span class="token comment">// &#x7684; swap&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709; T &#x4E13;&#x5C5E;&#x4E4B; swap &#x5B58;&#x5728;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5C31;&#x4F7F;&#x7528; std &#x5185;&#x7684; swap&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x5F97;&#x611F;&#x8C22; using &#x58F0;&#x660E;&#x5F0F;&#x8BA9; std::swap &#x5728;&#x51FD;&#x6570;&#x5185;&#x66DD;&#x5149;&#x3002;&#x7136;&#x800C;&#x5373;&#x4FBF;&#x5982;&#x6B64;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x559C;&#x6B22; std::swap &#x7684; T &#x4E13;&#x5C5E;&#x7279;&#x5316;&#x7248;&#xFF0C;&#x800C;&#x975E;&#x4E00;&#x822C;&#x5316;&#x7684;</span>
<span class="token comment">// &#x90A3;&#x4E2A; template&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x9488;&#x5BF9; T &#x5C06; std::swap &#x7279;&#x5316;&#xFF0C;&#x7279;&#x5316;&#x7248;</span>
<span class="token comment">// &#x4F1A;&#x88AB;&#x7F16;&#x8BD1;&#x5668;&#x6311;&#x4E2D;&#x3002;</span>

std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &#x8FD9;&#x662F;&#x9519;&#x8BEF;&#x7684; swap &#x8C03;&#x7528;&#x65B9;&#x5F0F;</span>
<span class="token comment">// &#x8FD9;&#x4FBF;&#x5F3A;&#x8FEB;&#x7F16;&#x8BD1;&#x5668;&#x53EA;&#x8BA4; std &#x5185;&#x7684; swap&#xFF08;&#x5305;&#x62EC;&#x5176;&#x4EFB;&#x4F55; template &#x7279;</span>
<span class="token comment">// &#x5316;&#xFF09;&#xFF0C;&#x56E0;&#x800C;&#x4E0D;&#x518D;&#x53EF;&#x80FD;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x4E8E;&#x5B83;&#x5904;&#x7684;&#x8F83;&#x9002;&#x5F53; T &#x4E13;&#x5C5E;&#x7248;&#x672C;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="5-%E5%AE%9E%E7%8E%B0">5&#x3001;&#x5B9E;&#x73B0;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-26%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%BB%B6%E5%90%8E%E5%8F%98%E9%87%8F%E5%AE%9A%E4%B9%89%E5%BC%8F%E7%9A%84%E5%87%BA%E7%8E%B0%E6%97%B6%E9%97%B4">&#x6761;&#x6B3E; 26&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x5EF6;&#x540E;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5F0F;&#x7684;&#x51FA;&#x73B0;&#x65F6;&#x95F4;</h3>

<ul>
<li>&#x5C3D;&#x53EF;&#x80FD;&#x5EF6;&#x540E;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5F0F;&#x7684;&#x51FA;&#x73B0;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x53EF;&#x589E;&#x52A0;&#x7A0B;&#x5E8F;&#x7684;&#x6E05;&#x6670;&#x5EA6;&#x5E76;&#x6539;&#x5584;&#x7A0B;&#x5E8F;&#x6548;&#x7387;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x53EA;&#x8981;&#x4F60;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x53D8;&#x91CF;&#x800C;&#x5176;&#x7C7B;&#x578B;&#x6709;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6216;&#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x5F53;&#x7A0B;&#x5E8F;&#x7684;&#x63A7;&#x5236;&#x6D41;&#xFF08;control flow&#xFF09;&#x5230;&#x8FBE;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x5B9A;&#x4E49;&#x5F0F;&#x65F6;&#xFF0C;&#x4F60;&#x4FBF;&#x5F97;&#x627F;&#x53D7;&#x6784;&#x9020;&#x6210;&#x672C;&#xFF1B;</span>
<span class="token comment">// &#x5F53;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x79BB;&#x5F00;&#x5176;&#x4F5C;&#x7528;&#x57DF;&#x65F6;&#xFF0C;&#x4F60;&#x4FBF;&#x5F97;&#x627F;&#x53D7;&#x6790;&#x6784;&#x6210;&#x672C;&#x3002;</span>
<span class="token comment">// &#x5373;&#x4F7F;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x6700;&#x7EC8;&#x5E76;&#x672A;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x4ECD;&#x9700;&#x8017;&#x8D39;&#x8FD9;&#x4E9B;&#x6210;&#x672C;&#xFF0C;&#x6240;&#x4EE5;&#x4F60;&#x5E94;&#x8BE5;&#x5C3D;&#x53EF;&#x80FD;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x60C5;&#x5F62;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8FC7;&#x65E9;&#x5B9A;&#x4E49;&#x53D8;&#x91CF;&#x201C;encrypted&#x201D;</span>
std<span class="token operator">::</span>string <span class="token function">encryptPassword</span><span class="token punctuation">(</span>cons std<span class="token operator">::</span>string<span class="token operator">&amp;</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
    string encrypted<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> MinimumPasswordLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">logic_error</span><span class="token punctuation">(</span><span class="token string">&quot;Password is too short&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x5FC5;&#x8981;&#x52A8;&#x4F5C;&#xFF0C;&#x4FFE;&#x80FD;&#x5C06;&#x4E00;&#x4E2A;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x5BC6;&#x7801;</span>
                    <span class="token comment">// &#x7F6E;&#x5165;&#x53D8;&#x91CF; encrypted &#x5185;</span>
    <span class="token keyword">return</span> encrypted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5BF9;&#x8C61; encrypted &#x5728;&#x6B64;&#x51FD;&#x6570;&#x4E2D;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x672A;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x6709;&#x4E2A;&#x5F02;&#x5E38;&#x88AB;&#x4E22;&#x51FA;&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x5C31;&#x771F;&#x7684;&#x6CA1;&#x88AB;&#x4F7F;&#x7528;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5982;&#x679C;&#x51FD;&#x6570; encryptedPassword &#x4E22;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x4ECD;&#x5F97;&#x4ED8;&#x51FA; encrypted &#x7684;&#x6784;&#x9020;&#x6210;&#x672C;&#x548C;&#x6790;&#x6784;&#x6210;&#x672C;&#x3002;&#x6240;&#x4EE5;&#x6700;&#x597D;&#x5EF6;&#x540E; encrypted &#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#xFF0C;</span>
<span class="token comment">// &#x76F4;&#x5230;&#x786E;&#x5B9E;&#x9700;&#x8981;&#x5B83;&#xFF1A;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5EF6;&#x540E;&#x201C;encrypted&#x201D;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x76F4;&#x5230;&#x771F;&#x6B63;&#x9700;&#x8981;&#x5B83;</span>
std<span class="token operator">::</span>string <span class="token function">encryptPassword</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> MinimumPasswordLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">logic_error</span><span class="token punctuation">(</span><span class="token string">&quot;Password is too short&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    string encrypted<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 <span class="token comment">// &#x5FC5;&#x8981;&#x52A8;&#x4F5C;&#xFF0C;&#x4FFE;&#x80FD;&#x5C06;&#x4E00;&#x4E2A;&#x52A0;&#x5BC6;&#x540E;&#x7684;&#x5BC6;&#x7801;</span>
                        <span class="token comment">// &#x7F6E;&#x5165;&#x53D8;&#x91CF; encrypted &#x5185;</span>
    <span class="token keyword">return</span> encrypted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x4F46;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4ECD;&#x7136;&#x4E0D;&#x591F;&#x79FE;&#x7EA4;&#x548C;&#x5EA6;&#xFF0C;&#x56E0;&#x4E3A; encrypted &#x867D;&#x7136;&#x5B9A;&#x4E49;&#x5374;&#x65E0;&#x4EFB;&#x4F55;&#x5B9E;&#x53C2;&#x4F5C;&#x4E3A;&#x521D;&#x503C;&#x3002;</span>
<span class="token keyword">void</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x5728;&#x5176;&#x4E2D;&#x7684;&#x9002;&#x5F53;&#x5730;&#x70B9;&#x5BF9; s &#x52A0;&#x5BC6;</span>

<span class="token comment">// &#x4E8E;&#x662F; encryptPassword &#x53EF;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF0C;&#x867D;&#x7136;&#x8FD8;&#x4E0D;&#x7B97;&#x662F;&#x6700;&#x597D;&#x7684;&#x505A;&#x6CD5;&#xFF1A;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5EF6;&#x540E;&#x201C;encrypted&#x201D;&#x7684;&#x5B9A;&#x4E49;&#xFF0C;&#x76F4;&#x5230;&#x9700;&#x8981;&#x5B83;&#x4E3A;&#x6B62;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x6B64;&#x51FD;&#x6570;&#x4ECD;&#x7136;&#x6709;&#x7740;&#x4E0D;&#x8BE5;&#x6709;&#x7684;&#x6548;&#x7387;&#x4F4E;&#x843D;&#x3002;</span>
std<span class="token operator">::</span>string <span class="token function">encryptPassword</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x68C0;&#x67E5; length&#xFF0C;&#x5982;&#x524D;&#x3002;</span>
    std<span class="token operator">::</span>string encrypted<span class="token punctuation">;</span>      <span class="token comment">// default-construct encrypted</span>
    encrypted <span class="token operator">=</span> password<span class="token punctuation">;</span>       <span class="token comment">// &#x8D4B;&#x503C;&#x7ED9; encrypted</span>
    <span class="token function">encrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> encrypted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x66F4;&#x53D7;&#x6B22;&#x8FCE;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x4EE5; password &#x4F5C;&#x4E3A; encrypted &#x7684;&#x521D;&#x503C;&#xFF0C;</span>
<span class="token comment">// &#x8DF3;&#x8FC7;&#x6BEB;&#x65E0;&#x610F;&#x4E49;&#x7684; default &#x6784;&#x9020;&#x8FC7;&#x7A0B;&#xFF1A;</span>

<span class="token comment">// &#x7EC8;&#x4E8E;&#xFF0C;&#x8FD9;&#x662F;&#x5B9A;&#x4E49;&#x5E76;&#x521D;&#x59CB;&#x5316; encrypted &#x7684;&#x6700;&#x4F73;&#x505A;&#x6CD5;</span>
std<span class="token operator">::</span>string <span class="token function">encryptPassword</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> password<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x68C0;&#x67E5;&#x957F;&#x5EA6;</span>
    std<span class="token operator">::</span>string <span class="token function">encrypted</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x901A;&#x8FC7; copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
                                        <span class="token comment">// &#x5B9A;&#x4E49;&#x5E76;&#x521D;&#x59CB;&#x5316;&#x3002;</span>
    <span class="token function">encrypt</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> encrypted<span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x65B9;&#x6CD5; A&#xFF1A;&#x5B9A;&#x4E49;&#x4E8E;&#x5FAA;&#x73AF;&#x5916;</span>
Widget w<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    w <span class="token operator">=</span> &#x53D6;&#x51B3;&#x4E8E; i &#x7684;&#x67D0;&#x4E2A;&#x503C;&#xFF1B;
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x65B9;&#x6CD5; B&#xFF1A;&#x5B9A;&#x4E49;&#x4E8E;&#x5FAA;&#x73AF;&#x5185;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Widget <span class="token function">w</span><span class="token punctuation">(</span>&#x53D6;&#x51B3;&#x4E8E; i &#x7684;&#x67D0;&#x4E2A;&#x503C;<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x91CC;&#x6211;&#x628A;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x578B;&#x4ECE; string &#x6539;&#x4E3A; Widget&#xFF0C;</span>
<span class="token comment">// &#x4EE5;&#x514D;&#x9020;&#x6210;&#x8BFB;&#x8005;&#x5BF9;&#x4E8E;&#x201C;&#x5BF9;&#x8C61;&#x6267;&#x884C;&#x6784;&#x9020;&#x3001;&#x6790;&#x6784;&#x3001;&#x6216;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;&#x6240;&#x9700;&#x7684;&#x6210;&#x672C;&#x201D; &#x6709;&#x4EFB;&#x4F55;&#x7279;&#x6B8A;&#x504F;&#x89C1;&#x3002;</span>
<span class="token comment">// &#x5728; Widget &#x51FD;&#x6570;&#x5185;&#x90E8;&#xFF0C;&#x4EE5;&#x4E0A;&#x4E24;&#x79CD;&#x5199;&#x6CD5;&#x7684;&#x6210;&#x672C;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token comment">// &#x505A;&#x6CD5; A&#xFF1A;1 &#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570; + 1 &#x4E2A;&#x6790;&#x6784;&#x51FD;&#x6570; + n &#x4E2A;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;</span>
<span class="token comment">// &#x505A;&#x6CD5; B&#xFF1A;n &#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570; + n &#x4E2A;&#x6790;&#x6784;&#x51FD;&#x6570;</span>

<span class="token comment">// &#x5982;&#x679C; classes &#x7684;&#x4E00;&#x4E2A;&#x8D4B;&#x503C;&#x6210;&#x672C;&#x4F4E;&#x4E8E;&#x4E00;&#x7EC4;&#x6784;&#x9020; + &#x6790;&#x6784;&#x6210;&#x672C;&#xFF0C;&#x505A;&#x6CD5; A &#x5927;&#x4F53;&#x800C;&#x8A00;&#x6BD4;&#x8F83;&#x9AD8;&#x6548;&#x3002;</span>
<span class="token comment">// &#x5C24;&#x5176;&#x5F53; n &#x503C;&#x5F88;&#x5927;&#x7684;&#x65F6;&#x5019;&#x3002;&#x5426;&#x5219;&#x505A;&#x6CD5; B &#x6216;&#x8BB8;&#x6BD4;&#x8F83;&#x597D;&#x3002;&#x6B64;&#x5916;&#x505A;&#x6CD5; A &#x9020;&#x6210;&#x540D;&#x79F0; w &#x7684;&#x4F5C;&#x7528;&#x57DF;</span>
<span class="token comment">// &#xFF08;&#x8986;&#x76D6;&#x6574;&#x4E2A;&#x5FAA;&#x73AF;&#xFF09;&#x6BD4;&#x505A;&#x6CD5; B &#x66F4;&#x5927;&#xFF0C;&#x6709;&#x65F6;&#x90A3;&#x5BF9;&#x7A0B;&#x5E8F;&#x7684;&#x53EF;&#x7406;&#x89E3;&#x6027;&#x548C;&#x6613;&#x7EF4;&#x62A4;&#x6027;&#x9020;&#x6210;&#x51B2;&#x7A81;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x9664;&#x975E;&#xFF08;1&#xFF09;&#x4F60;&#x77E5;&#x9053;&#x8D4B;&#x503C;&#x6210;&#x672C;&#x6BD4;&#x201C;&#x6784;&#x9020; + &#x6790;&#x6784;&#x201D;&#x6210;&#x672C;&#x4F4E;&#xFF0C;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x4F60;&#x6B63;&#x5728;&#x5904;&#x7406;&#x4EE3;&#x7801;&#x4E2D;&#x6548;&#x7387;&#x9AD8;&#x5EA6;&#x654F;&#x611F;&#xFF08;performance-sensitive&#xFF09;&#x7684;&#x90E8;&#x5206;&#xFF0C;</span>
<span class="token comment">// &#x5426;&#x5219;&#x4F60;&#x5E94;&#x8BE5;&#x4F7F;&#x7528;&#x505A;&#x6CD5; B&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-27%E5%B0%BD%E9%87%8F%E5%B0%91%E5%81%9A%E8%BD%AC%E5%9E%8B%E5%8A%A8%E4%BD%9C">&#x6761;&#x6B3E; 27&#xFF1A;&#x5C3D;&#x91CF;&#x5C11;&#x505A;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;</h3>

<ul>
<li>&#x5982;&#x679C;&#x53EF;&#x4EE5;&#xFF0C;&#x5C3D;&#x91CF;&#x907F;&#x514D;&#x8F6C;&#x578B;&#xFF0C;&#x7279;&#x522B;&#x662F;&#x5728;&#x6CE8;&#x91CD;&#x6548;&#x7387;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x907F;&#x514D; dynamic_casts&#x3002;&#x5982;&#x679C;&#x6709;&#x4E2A;&#x8BBE;&#x8BA1;&#x9700;&#x8981;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#xFF0C;&#x8BD5;&#x7740;&#x53D1;&#x5C55;&#x65E0;&#x9700;&#x8F6C;&#x578B;&#x7684;&#x66FF;&#x4EE3;&#x8BBE;&#x8BA1;&#x3002;</li>
<li>&#x5982;&#x679C;&#x8F6C;&#x578B;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x8BD5;&#x7740;&#x5C06;&#x5B83;&#x9690;&#x85CF;&#x4E8E;&#x67D0;&#x4E2A;&#x51FD;&#x6570;&#x80CC;&#x540E;&#x3002;&#x5BA2;&#x6237;&#x968F;&#x540E;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x5C06;&#x8F6C;&#x578B;&#x653E;&#x8FDB;&#x4ED6;&#x4EEC;&#x81EA;&#x5DF1;&#x7684;&#x4EE3;&#x7801;&#x5185;&#x3002;</li>
<li>&#x5B81;&#x53EF;&#x4F7F;&#x7528; C++-style&#xFF08;&#x65B0;&#x5F0F;&#xFF09;&#x8F6C;&#x578B;&#xFF0C;&#x4E0D;&#x8981;&#x4F7F;&#x7528;&#x65E7;&#x5F0F;&#x8F6C;&#x578B;&#x3002;&#x524D;&#x8005;&#x5F88;&#x5BB9;&#x6613;&#x8FA8;&#x8BC6;&#x51FA;&#x6765;&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x6BD4;&#x8F83;&#x6709;&#x7740;&#x5206;&#x95E8;&#x522B;&#x7C7B;&#x7684;&#x804C;&#x638C;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// C &#x98CE;&#x683C;&#x7684;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1B;</span>
<span class="token punctuation">(</span>T<span class="token punctuation">)</span>expression       <span class="token comment">// &#x5C06; expression &#x8F6C;&#x578B;&#x4E3A; T</span>

<span class="token comment">// &#x51FD;&#x6570;&#x98CE;&#x683C;&#x7684;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token function">T</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>       <span class="token comment">// &#x5C06; expression &#x8F6C;&#x578B;&#x4E3A; T</span>

<span class="token comment">// &#x4E24;&#x79CD;&#x5F62;&#x5F0F;&#x5E76;&#x65E0;&#x5DEE;&#x522B;&#xFF0C;&#x7EAF;&#x7CB9;&#x53EA;&#x662F;&#x5C0F;&#x62EC;&#x53F7;&#x7684;&#x6446;&#x653E;&#x4F4D;&#x7F6E;&#x4E0D;&#x540C;&#x800C;&#x5DF2;&#x3002;</span>
<span class="token comment">// &#x6211;&#x79F0;&#x6B64;&#x4E8C;&#x79CD;&#x5F62;&#x5F0F;&#x4E3A;&#x201C;&#x65E7;&#x5F0F;&#x8F6C;&#x578B;&#x201D;&#xFF08;old-style casts&#xFF09;&#x3002;</span>

<span class="token comment">// C++ &#x8FD8;&#x63D0;&#x4F9B;&#x56DB;&#x79CD;&#x65B0;&#x5F0F;&#x8F6C;&#x578B;&#xFF08;&#x5E38;&#x5E38;&#x88AB;&#x79F0;&#x4E3A; new-style &#x6216; C++-style casts&#xFF09;&#xFF1A;</span>
<span class="token keyword">const_cast</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span> expression <span class="token punctuation">)</span>
<span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span> expression <span class="token punctuation">)</span>
<span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span> expression <span class="token punctuation">)</span>
<span class="token keyword">static_cast</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span> expression <span class="token punctuation">)</span>

<span class="token comment">// &#x5404;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x76EE;&#x7684;&#xFF1A;</span>

<span class="token comment">// const_cast &#x901A;&#x5E38;&#x88AB;&#x7528;&#x6765;&#x5C06;&#x5BF9;&#x8C61;&#x7684;&#x5E38;&#x91CF;&#x6027;&#x8F6C;&#x9664;&#xFF08;cast away the constness&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5B83;&#x4E5F;&#x662F;&#x552F;&#x4E00;&#x6709;&#x6B64;&#x80FD;&#x529B;&#x7684; C++-style &#x8F6C;&#x578B;&#x64CD;&#x4F5C;&#x7B26;&#x3002;</span>

<span class="token comment">// dynamic_cast &#x4E3B;&#x8981;&#x7528;&#x6765;&#x6267;&#x884C;&#x201C;&#x5B89;&#x5168;&#x5411;&#x4E0B;&#x8F6C;&#x578B;&#x201D;&#xFF08;safe downcasting&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x7528;&#x6765;</span>
<span class="token comment">// &#x51B3;&#x5B9A;&#x67D0;&#x5BF9;&#x8C61;&#x662F;&#x5426;&#x5F52;&#x5C5E;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x7684;&#x67D0;&#x4E2A;&#x7C7B;&#x578B;&#x3002;&#x5B83;&#x662F;&#x552F;&#x4E00;&#x65E0;&#x6CD5;&#x7531;&#x65E7;&#x5F0F;&#x8BED;&#x6CD5;&#x6267;&#x884C;&#x7684;&#x52A8;&#x4F5C;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x662F;&#x552F;&#x4E00;&#x53EF;&#x80FD;&#x8017;&#x8D39;&#x91CD;&#x5927;&#x8FD0;&#x884C;&#x6210;&#x672C;&#x7684;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#xFF08;&#x7A0D;&#x540E;&#x7EC6;&#x8C08;&#xFF09;&#x3002;</span>

<span class="token comment">// reinterpret_cast &#x610F;&#x56FE;&#x6267;&#x884C;&#x4F4E;&#x7EA7;&#x8F6C;&#x578B;&#xFF0C;&#x5B9E;&#x9645;&#x52A8;&#x4F5C;&#xFF08;&#x53CA;&#x7ED3;&#x679C;&#xFF09;&#x53EF;&#x80FD;&#x53D6;&#x51B3;&#x4E8E;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E5F;&#x5C31;&#x8868;&#x793A;&#x5B83;&#x4E0D;&#x53EF;&#x79FB;&#x690D;&#x3002;&#x4F8B;&#x5982;&#x5C06;&#x4E00;&#x4E2A; pointer to int &#x8F6C;&#x578B;&#x4E3A;&#x4E00;&#x4E2A; int&#x3002;&#x8FD9;&#x4E00;&#x7C7B;&#x8F6C;&#x578B;</span>
<span class="token comment">// &#x5728;&#x4F4E;&#x7EA7;&#x4EE3;&#x7801;&#x4EE5;&#x5916;&#x5F88;&#x5C11;&#x89C1;&#x3002;&#x672C;&#x4E66;&#x53EA;&#x4F7F;&#x7528;&#x4E00;&#x6B21;&#xFF0C;&#x90A3;&#x662F;&#x5728;&#x8BA8;&#x8BBA;&#x5982;&#x4F55;&#x9488;&#x5BF9;&#x539F;&#x59CB;&#x5185;&#x5B58;&#xFF08;raw memory&#xFF09;</span>
<span class="token comment">// &#x5199;&#x51FA;&#x4E00;&#x4E2A;&#x8C03;&#x8BD5;&#x7528;&#x7684;&#x5206;&#x914D;&#x5668;&#xFF08;debugging allocator&#xFF09;&#x65F6;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 50&#x3002;</span>

<span class="token comment">// static_cast &#x7528;&#x6765;&#x5F3A;&#x8FEB;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#xFF08;implicit conversions&#xFF09;&#xFF0C;&#x4F8B;&#x5982;&#x5C06; non-const</span>
<span class="token comment">// &#x5BF9;&#x8C61;&#x8F6C;&#x4E3A; const &#x5BF9;&#x8C61;&#xFF08;&#x5C31;&#x50CF;&#x6761;&#x6B3E; 3 &#x6240;&#x4E3A;&#xFF09;&#xFF0C;&#x6216;&#x5C06; int &#x8F6C;&#x4E3A; double &#x7B49;&#x7B49;&#x3002;&#x5B83;&#x4E5F;&#x53EF;&#x4EE5;</span>
<span class="token comment">// &#x7528;&#x6765;&#x6267;&#x884C;&#x4E0A;&#x8FF0;&#x591A;&#x79CD;&#x8F6C;&#x6362;&#x7684;&#x53CD;&#x5411;&#x8F6C;&#x6362;&#xFF0C;&#x4F8B;&#x5982;&#x5C06; void* &#x6307;&#x9488;&#x8F6C;&#x4E3A; typed &#x6307;&#x9488;&#xFF0C;</span>
<span class="token comment">// &#x5C06; pointer-to-base &#x8F6C;&#x4E3A; pointer-to-derived&#x3002;</span>
<span class="token comment">// &#x4F46;&#x5B83;&#x65E0;&#x6CD5;&#x5C06; const &#x8F6C;&#x4E3A; non-const &#x2014;&#x2014; &#x8FD9;&#x4E2A;&#x53EA;&#x6709; const_cast &#x624D;&#x529E;&#x5F97;&#x5230;&#x3002;</span>





<span class="token comment">// &#x65E7;&#x5F0F;&#x8F6C;&#x578B;&#x4ECD;&#x7136;&#x5408;&#x6CD5;&#xFF0C;&#x4F46;&#x65B0;&#x5F0F;&#x8F6C;&#x578B;&#x8F83;&#x53D7;&#x6B22;&#x8FCE;&#x3002;&#x539F;&#x56E0;&#x662F;&#xFF1A;&#x7B2C;&#x4E00;&#xFF0C;&#x5B83;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x88AB;&#x8FA8;&#x8BC6;&#x51FA;&#x6765;</span>
<span class="token comment">// &#xFF08;&#x4E0D;&#x8BBA;&#x662F;&#x4EBA;&#x5DE5;&#x8FA8;&#x8BC6;&#x6216;&#x4F7F;&#x7528;&#x5DE5;&#x5177;&#x5982; grep&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x5F97;&#x4EE5;&#x7B80;&#x5316;&#x201C;&#x627E;&#x51FA;&#x7C7B;&#x578B;&#x7CFB;&#x7EDF;&#x5728;&#x54EA;&#x4E2A;&#x5730;&#x70B9;&#x88AB;&#x7834;&#x574F;&#x201D;</span>
<span class="token comment">// &#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x7B2C;&#x4E8C;&#xFF0C;&#x5404;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#x7684;&#x76EE;&#x6807;&#x6108;&#x7A84;&#x5316;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x6108;&#x53EF;&#x80FD;&#x8BCA;&#x65AD;&#x51FA;&#x9519;&#x8BEF;&#x7684;&#x8FD0;&#x7528;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;</span>
<span class="token comment">// &#x679C;&#x4F60;&#x6253;&#x7B97;&#x5C06;&#x5E38;&#x91CF;&#x6027;&#xFF08;constness&#xFF09;&#x53BB;&#x6389;&#xFF0C;&#x9664;&#x975E;&#x4F7F;&#x7528;&#x65B0;&#x5F0F;&#x8F6C;&#x578B;&#x4E2D;&#x7684; const_cast&#xFF0C;&#x5426;&#x5219;&#x65E0;&#x6CD5;</span>
<span class="token comment">// &#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Widget</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">doSomeWork</span><span class="token punctuation">(</span><span class="token keyword">const</span> Widget<span class="token operator">&amp;</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">doSomeWork</span><span class="token punctuation">(</span><span class="token function">Widget</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x4EE5;&#x4E00;&#x4E2A; int &#x52A0;&#x4E0A;&#x201C;&#x51FD;&#x6570;&#x98CE;&#x683C;&#x201D;&#x7684;</span>
                                        <span class="token comment">// &#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Widget&#x3002;</span>
<span class="token function">doSomeWork</span><span class="token punctuation">(</span><span class="token keyword">static</span> _cast<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x4EE5;&#x4E00;&#x4E2A; int &#x52A0;&#x4E0A;&#x201C;C++ &#x98CE;&#x683C;&#x201D;&#x7684;</span>
                                        <span class="token comment">// &#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Widget&#x3002;</span>





<span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> y<span class="token punctuation">;</span>      <span class="token comment">// x &#x9664;&#x4EE5; y&#xFF0C;&#x4F7F;&#x7528;&#x6D6E;&#x70B9;&#x6570;&#x9664;&#x6CD5;</span>

<span class="token comment">// &#x5C06; int x &#x8F6C;&#x578B;&#x4E3A; double &#x51E0;&#x4E4E;&#x80AF;&#x5B9A;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E9B;&#x4EE3;&#x7801;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x5927;&#x90E8;&#x5206;&#x8BA1;&#x7B97;&#x5668;&#x4F53;&#x7CFB;&#x7ED3;&#x6784;&#x4E2D;&#xFF0C;</span>
<span class="token comment">// int &#x7684;&#x5E95;&#x5C42;&#x8868;&#x8FF0;&#x4E0D;&#x540C;&#x4E8E; double &#x7684;&#x5E95;&#x5C42;&#x8868;&#x8FF0;&#x3002;&#x8FD9;&#x6216;&#x8BB8;&#x4E0D;&#x4F1A;&#x8BA9;&#x4F60;&#x60CA;&#x8BB6;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x8BA9;&#x4F60;&#x7A0D;&#x5FAE;&#x7741;&#x5927;&#x773C;&#x775B;&#x4E86;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Derived d<span class="token punctuation">;</span>
Base<span class="token operator">*</span> pb <span class="token operator">=</span> <span class="token operator">&amp;</span>d<span class="token punctuation">;</span>                              <span class="token comment">// &#x9690;&#x55BB;&#x5730;&#x5C06; Derived* &#x8F6C;&#x6362;&#x4E3A; Base*</span>





<span class="token comment">// &#x53E6;&#x4E00;&#x4EF6;&#x5173;&#x4E8E;&#x8F6C;&#x578B;&#x7684;&#x6709;&#x8DA3;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x5199;&#x51FA;&#x67D0;&#x4E9B;&#x4F3C;&#x662F;&#x800C;&#x975E;&#x7684;&#x4EE3;&#x7801;</span>
<span class="token comment">// &#xFF08;&#x5728;&#x5176;&#x4ED6;&#x8BED;&#x8A00;&#x4E2D;&#x4E5F;&#x8BB8;&#x771F;&#x662F;&#x5BF9;&#x7684;&#xFF09;&#x3002;&#x4F8B;&#x5982;&#x8BB8;&#x591A;&#x5E94;&#x7528;&#x6846;&#x67B6;&#xFF08;application frameworks&#xFF09;</span>
<span class="token comment">// &#x90FD;&#x8981;&#x6C42; derived classes &#x5185;&#x7684; virtual &#x51FD;&#x6570;&#x4EE3;&#x7801;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x52A8;&#x4F5C;</span>
<span class="token comment">// &#x5C31;&#x5148;&#x8C03;&#x7528; base class &#x7684;&#x5BF9;&#x5E94;&#x51FD;&#x6570;&#x3002;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E2A; Window base class</span>
<span class="token comment">// &#x548C;&#x4E00;&#x4E2A; SpecialWindow derived class&#xFF0C;&#x4E24;&#x8005;&#x90FD;&#x5B9A;&#x4E49;&#x4E86; virtual &#x51FD;&#x6570;</span>
<span class="token comment">// onResize&#x3002;&#x8FDB;&#x4E00;&#x6B65;&#x5047;&#x8BBE; SpecialWindow &#x7684; onResize &#x51FD;&#x6570;&#x88AB;&#x8981;&#x6C42;&#x9996;&#x5148;&#x8C03;&#x7528; Window</span>
<span class="token comment">// &#x7684; onResize&#x3002;&#x4E0B;&#x9762;&#x662F;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x4E4B;&#x4E00;&#xFF0C;&#x5B83;&#x770B;&#x8D77;&#x6765;&#x5BF9;&#xFF0C;&#x4F46;&#x5B9E;&#x9645;&#x4E0A;&#x9519;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span>                                  <span class="token comment">// base class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>             <span class="token comment">// base onResize &#x5B9E;&#x73B0;&#x4EE3;&#x7801;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SpecialWindow</span> <span class="token operator">:</span> <span class="token keyword">public</span> Window <span class="token punctuation">{</span>           <span class="token comment">// derived class</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token comment">// derived onResize &#x5B9E;&#x73B0;&#x4EE3;&#x7801;</span>
        <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Window<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#x5C06; *this &#x8F6C;&#x578B;&#x4E3A; Window&#xFF0C;</span>
                                                <span class="token comment">// &#x7136;&#x540E;&#x8C03;&#x7528;&#x5176; onResize&#xFF1B;</span>
                                                <span class="token comment">// &#x8FD9;&#x53EF;&#x4E0D;&#x884C;&#xFF01;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// &#x8FD9;&#x91CC;&#x8FDB;&#x884C; SpecialWindow &#x4E13;&#x5C5E;&#x884C;&#x4E3A;&#x3002;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x5E76;&#x975E;&#x5728;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;&#x8C03;&#x7528; Window::onResize &#x4E4B;&#x540E;&#x53C8;&#x5728;&#x8BE5;&#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;</span>
<span class="token comment">// &#x6267;&#x884C; SpecialWindow &#x4E13;&#x5C5E;&#x52A8;&#x4F5C;&#x3002;&#x4E0D;&#xFF0C;&#x5B83;&#x662F;&#x5728;&#x201C;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x4E4B; base class &#x6210;&#x5206;&#x201D;&#x7684;&#x526F;&#x672C;&#x4E0A;</span>
<span class="token comment">// &#x8C03;&#x7528; Window::onResize&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;&#x6267;&#x884C; SpecialWindow &#x4E13;&#x5C5E;&#x52A8;&#x4F5C;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; Window::onResize &#x4FEE;&#x6539;&#x4E86;&#x5BF9;&#x8C61;&#x5185;&#x5BB9;&#xFF08;&#x4E0D;&#x80FD;&#x8BF4;&#x6CA1;&#x6709;&#x53EF;&#x80FD;&#x6027;&#xFF0C;&#x56E0;&#x4E3A;</span>
<span class="token comment">// onResize &#x662F;&#x4E2A; non-const &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x5176;&#x5B9E;&#x6CA1;&#x88AB;&#x6539;&#x52A8;&#xFF0C;&#x6539;&#x52A8;&#x7684;&#x662F;&#x526F;&#x672C;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C; SpecialWindow::onResize &#x5185;&#x5982;&#x679C;&#x4E5F;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x771F;&#x7684;&#x4F1A;&#x88AB;&#x6539;&#x52A8;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4F7F;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x8FDB;&#x5165;&#x4E00;&#x79CD;&#x201C;&#x4F24;&#x6B8B;&#x201D;&#x8F6C;&#x72B6;&#x6001;&#xFF1A;&#x5176; base class &#x6210;&#x5206;&#x7684;&#x66F4;&#x6539;&#x6CA1;&#x6709;&#x843D;&#x5B9E;&#xFF0C;</span>
<span class="token comment">// &#x800C; derived class &#x6210;&#x5206;&#x7684;&#x66F4;&#x6539;&#x5012;&#x662F;&#x843D;&#x5B9E;&#x4E86;&#x3002;</span>

<span class="token comment">// &#x89E3;&#x51B3;&#x4E4B;&#x9053;&#x662F;&#x62FF;&#x6389;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#xFF0C;&#x4F60;&#x53EA;&#x662F;&#x60F3;&#x8C03;&#x7528; base class &#x7248;&#x672C;&#x7684; onResize &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x4EE4;&#x5B83;&#x4F5C;&#x7528;&#x4E8E;&#x5F53;&#x524D;&#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;&#xFF0C;&#x6240;&#x4EE5;&#x8BF7;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">SpecialWindow</span> <span class="token operator">:</span> <span class="token keyword">public</span> Window <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Window<span class="token operator">::</span><span class="token function">onResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x8C03;&#x7528; Window::onResize &#x4F5C;&#x7528;&#x4E8E; *this &#x8EAB;&#x4E0A;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x4E4B;&#x6240;&#x4EE5;&#x9700;&#x8981; dynamic_cast&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x56E0;&#x4E3A;&#x4F60;&#x60F3;&#x5728;&#x4E00;&#x4E2A;&#x4F60;&#x8BA4;&#x5B9A;&#x4E3A; derived class &#x5BF9;&#x8C61;&#x8EAB;&#x4E0A;&#x6267;&#x884C;</span>
<span class="token comment">// derived class &#x64CD;&#x4F5C;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x4F60;&#x7684;&#x624B;&#x4E0A;&#x5374;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x201C;&#x6307;&#x5411; base&#x201D;&#x7684; pointer &#x6216; reference&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x53EA;&#x80FD;&#x9760;&#x5B83;&#x4EEC;&#x6765;&#x5904;&#x7406;&#x5BF9;&#x8C61;&#x3002;&#x6709;&#x4E24;&#x4E2A;&#x4E00;&#x822C;&#x6027;&#x505A;&#x6CD5;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</span>

<span class="token comment">// &#x7B2C;&#x4E00;&#xFF0C;&#x4F7F;&#x7528;&#x5BB9;&#x5668;&#x5E76;&#x5728;&#x5176;&#x4E2D;&#x5B58;&#x50A8;&#x76F4;&#x63A5;&#x6307;&#x5411; derived class &#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;</span>
<span class="token comment">// &#xFF08;&#x901A;&#x5E38;&#x662F;&#x667A;&#x80FD;&#x6307;&#x9488;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 13&#xFF09;&#xFF0C;&#x5982;&#x6B64;&#x4FBF;&#x6D88;&#x9664;&#x4E86;&#x201C;&#x901A;&#x8FC7; base class &#x63A5;&#x53E3;&#x5904;&#x7406;&#x5BF9;&#x8C61;&#x201D;&#x7684;&#x9700;&#x8981;&#x3002;</span>
<span class="token comment">// &#x5047;&#x8BBE;&#x5148;&#x524D;&#x7684; Window / SpecialWindow &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x53EA;&#x6709; SpecialWindows &#x624D;&#x652F;&#x6301;&#x95EA;&#x70C1;&#x6548;&#x679C;&#xFF0C;</span>
<span class="token comment">// &#x8BD5;&#x7740;&#x4E0D;&#x8981;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">SpecialWindow</span> <span class="token operator">:</span> <span class="token keyword">public</span> Window <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span>                                         <span class="token comment">// &#x5173;&#x4E8E; tr1::shared_ptr</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Window<span class="token operator">&gt;&gt;</span> VPW<span class="token punctuation">;</span>  <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 13&#x3002;</span>
VPW winPtrs<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>VPW<span class="token operator">::</span>iterator iter <span class="token operator">=</span> winPtrs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4E0D;&#x5E0C;&#x671B;&#x4F7F;&#x7528;</span>
     iter <span class="token operator">!=</span> winPtrs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// dynamic_cast</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>SpecialWindow<span class="token operator">*</span> psw <span class="token operator">=</span> <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>SpecialWindow<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>iter<span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        psw<span class="token operator">-&gt;</span><span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5E94;&#x8BE5;&#x6539;&#x800C;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</span>
<span class="token keyword">typedef</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>SpecialWindow<span class="token operator">&gt;&gt;</span> VPSW<span class="token punctuation">;</span>
VPSW winPtrs<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>VPSW<span class="token operator">::</span>iterator iter <span class="token operator">=</span> winPtrs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8FD9;&#x6837;&#x5199;&#x6BD4;&#x8F83;&#x597D;</span>
     iter <span class="token operator">!=</span> winPtrs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">// &#x4E0D;&#x4F7F;&#x7528; dynamic_cast</span>
     <span class="token operator">++</span>iter<span class="token punctuation">)</span>
     <span class="token punctuation">(</span><span class="token operator">*</span>iter<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5F53;&#x7136;&#x5566;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4F7F;&#x4F60;&#x65E0;&#x6CD5;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5185;&#x5B58;&#x50A8;&#x6307;&#x9488;&#x201C;&#x6307;&#x5411;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x4E4B;&#x5404;&#x79CD; Window &#x6D3E;&#x751F;&#x7C7B;&#x201D;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x771F;&#x8981;&#x5904;&#x7406;&#x591A;&#x79CD;&#x7A97;&#x53E3;&#x7C7B;&#x578B;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x5FC5;&#x987B;&#x5177;&#x5907;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x6027;&#xFF08;type-safe&#xFF09;&#x3002;</span>

<span class="token comment">// &#x53E6;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#x53EF;&#x8BA9;&#x4F60;&#x901A;&#x8FC7; base class &#x63A5;&#x53E3;&#x5904;&#x7406;&#x201C;&#x6240;&#x6709;&#x53EF;&#x80FD;&#x4E4B;&#x5404;&#x79CD; window &#x6D3E;&#x751F;&#x7C7B;&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x5C31;&#x662F;&#x5728; base class &#x5185;&#x63D0;&#x4F9B; virtual &#x51FD;&#x6570;&#x505A;&#x4F60;&#x60F3;&#x5BF9;&#x5404;&#x4E2A; Window &#x6D3E;&#x751F;&#x7C7B;&#x505A;&#x7684;&#x4E8B;&#x3002;</span>
<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x867D;&#x7136;&#x53EA;&#x6709; SpecialWindows &#x53EF;&#x4EE5;&#x95EA;&#x70C1;&#xFF0C;&#x4F46;&#x6216;&#x8BB8;&#x5C06;&#x95EA;&#x70C1;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E8E; base class &#x5185;</span>
<span class="token comment">// &#x5E76;&#x63D0;&#x4F9B;&#x4E00;&#x4EFD;&#x201C;&#x4EC0;&#x4E48;&#x4E5F;&#x6CA1;&#x505A;&#x201D;&#x7684;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x7801;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>       <span class="token comment">// &#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x201C;&#x4EC0;&#x4E48;&#x4E5F;&#x6CA1;&#x505A;&#x201D;&#xFF1B;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6761;&#x6B3E; 34 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                  <span class="token comment">// &#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x53EF;&#x80FD;&#x662F;&#x4E2A;&#x998A;&#x4E3B;&#x610F;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">SpecialWindow</span> <span class="token operator">:</span> <span class="token keyword">public</span> Window <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>    <span class="token comment">// &#x5728;&#x6B64; class &#x5185;&#xFF0C;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// blink &#x505A;&#x67D0;&#x4E9B;&#x4E8B;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Window<span class="token operator">&gt;&gt;</span> VPW<span class="token punctuation">;</span>
VPW winPtrs<span class="token punctuation">;</span>                        <span class="token comment">// &#x5BB9;&#x5668;&#xFF0C;&#x5185;&#x542B;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x6240;&#x6709;&#x53EF;&#x80FD;&#x7684; Window &#x7C7B;&#x578B;&#x3002;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>VPW<span class="token operator">::</span>iterator iter <span class="token operator">=</span> winPtrs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     iter <span class="token operator">!=</span> winPtrs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token operator">++</span>iter<span class="token punctuation">)</span>                        <span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>iter<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">blink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// dynamic_cast&#x3002;</span>

<span class="token comment">// &#x4E0D;&#x8BBA;&#x54EA;&#x4E00;&#x79CD;&#x5199;&#x6CD5;&#x2014;&#x2014;&#x201C;&#x4F7F;&#x7528;&#x7C7B;&#x578B;&#x5B89;&#x5168;&#x5BB9;&#x5668;&#x201D;&#x6216;&#x201C;&#x5C06; virtual &#x51FD;&#x6570;&#x5F80;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E0A;&#x65B9;&#x79FB;&#x52A8;&#x201D;&#x2014;&#x2014;</span>
<span class="token comment">// &#x90FD;&#x5E76;&#x975E;&#x653E;&#x4E4B;&#x56DB;&#x6D77;&#x7686;&#x51C6;&#xFF0C;&#x4F46;&#x5728;&#x8BB8;&#x591A;&#x60C5;&#x51B5;&#x4E0B;&#x5B83;&#x4EEC;&#x90FD;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x884C;&#x7684; dynamic_cast &#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x3002;</span>





<span class="token comment">// &#x7EDD;&#x5BF9;&#x5FC5;&#x987B;&#x907F;&#x514D;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#x6240;&#x8C13;&#x7684;&#x201C;&#x8FDE;&#x4E32;&#xFF08;cascading&#xFF09;dynamic_casts&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x662F;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x4E1C;&#x897F;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Window</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// derived classes &#x5B9A;&#x4E49;&#x5728;&#x8FD9;&#x91CC;</span>
<span class="token keyword">typedef</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Window<span class="token operator">&gt;&gt;</span> VPW<span class="token punctuation">;</span>
VPW winPtrs<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>VPW<span class="token operator">::</span>iterator iter <span class="token operator">=</span> winPtrs<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     iter <span class="token operator">!=</span> winPtrs<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>iter<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>SpecialWindow<span class="token operator">*</span> psw1 <span class="token operator">=</span> 
       <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>SpecialWindow1<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>iter<span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>SpecialWindow<span class="token operator">*</span> psw2 <span class="token operator">=</span> 
       <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>SpecialWindow2<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>iter<span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>SpecialWindow<span class="token operator">*</span> psw3 <span class="token operator">=</span> 
       <span class="token keyword">dynamic_cast</span><span class="token operator">&lt;</span>SpecialWindow3<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>iter<span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-28%E9%81%BF%E5%85%8D%E8%BF%94%E5%9B%9E-handles-%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E5%86%85%E9%83%A8%E6%88%90%E5%88%86">&#x6761;&#x6B3E; 28&#xFF1A;&#x907F;&#x514D;&#x8FD4;&#x56DE; handles &#x6307;&#x5411;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x6210;&#x5206;</h3>

<ul>
<li>&#x907F;&#x514D;&#x8FD4;&#x56DE; handles&#xFF08;&#x5305;&#x62EC; references&#x3001;&#x6307;&#x9488;&#x3001;&#x8FED;&#x4EE3;&#x5668;&#xFF09;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x3002;&#x9075;&#x5B88;&#x8FD9;&#x4E2A;&#x6761;&#x6B3E;&#xFF0C;&#x5E2E;&#x52A9; const &#x6210;&#x5458;&#x51FD;&#x6570;&#x7684;&#x884C;&#x4E3A;&#x50CF;&#x4E2A; const&#xFF0C;&#x5E76;&#x5C06;&#x53D1;&#x751F;&#x201C;&#x865A;&#x540A;&#x53F7;&#x7801;&#x724C;&#x201D;&#xFF08;dangling handles&#xFF09;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x964D;&#x81F3;&#x6700;&#x4F4E;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x5047;&#x8BBE;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x77E9;&#x5F62;&#x3002;&#x6BCF;&#x4E2A;&#x77E9;&#x5F62;&#x7531;&#x5176;&#x5DE6;&#x4E0A;&#x89D2;&#x548C;&#x53F3;&#x4E0B;&#x89D2;&#x8868;&#x793A;&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x4E86;&#x8BA9;&#x4E00;&#x4E2A; Rectangle &#x5BF9;&#x8C61;&#x5C3D;&#x53EF;&#x80FD;&#x5C0F;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x51B3;&#x5B9A;&#x4E0D;&#x628A;&#x5B9A;&#x4E49;&#x77E9;&#x5F62;&#x7684;&#x8FD9;&#x4E9B;&#x70B9;&#x5B58;&#x653E;&#x5728;</span>
<span class="token comment">// Rectangle &#x5BF9;&#x8C61;&#x5185;&#xFF0C;&#x800C;&#x662F;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x8F85;&#x52A9;&#x7684; struct &#x5185;&#x518D;&#x8BA9; Rectangle &#x53BB;&#x6307;&#x5B83;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>           <span class="token comment">// &#x8FD9;&#x4E2A; class &#x7528;&#x6765;&#x8868;&#x8FF0;&#x201C;&#x70B9;&#x201D;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">setX</span><span class="token punctuation">(</span><span class="token keyword">int</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setY</span><span class="token punctuation">(</span><span class="token keyword">int</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> RectDatea <span class="token punctuation">{</span>          <span class="token comment">// &#x8FD9;&#x4E9B;&#x201C;&#x70B9;&#x201D;&#x6570;&#x636E;&#x7528;&#x6765;&#x8868;&#x73B0;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;</span>
    Point ulhc<span class="token punctuation">;</span>             <span class="token comment">// ulhc=&quot;upper left-hand corner&quot;&#xFF08;&#x5DE6;&#x4E0A;&#x89D2;&#xFF09;</span>
    Point lrhc<span class="token punctuation">;</span>             <span class="token comment">// lrhc=&quot;lower right-hand corner&quot;&#xFF08;&#x53F3;&#x4E0B;&#x89D2;&#xFF09;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>RectData<span class="token operator">&gt;</span> pData<span class="token punctuation">;</span>       <span class="token comment">// &#x5173;&#x4E8E; tr1::shared_ptr&#xFF0C;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                              <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 13</span>

<span class="token comment">// Rectangle &#x7684;&#x5BA2;&#x6237;&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x8BA1;&#x7B97; Rectangle &#x7684;&#x8303;&#x56F4;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x8FD9;&#x4E2A; class &#x63D0;&#x4F9B; upperLeft &#x51FD;&#x6570;&#x548C; lowerRight &#x51FD;&#x6570;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    Point<span class="token operator">&amp;</span> <span class="token function">upperLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>ulhc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    Point<span class="token operator">&amp;</span> <span class="token function">lowerRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>lrhc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x53EF;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x4F46;&#x5374;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;</span>
<span class="token comment">// &#x4E00;&#x65B9;&#x9762; upperLeft &#x548C; lowerRight &#x88AB;&#x58F0;&#x660E;&#x4E3A; const &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x7684;</span>
<span class="token comment">// &#x76EE;&#x7684;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x63D0;&#x4F9B;&#x5BA2;&#x6237;&#x4E00;&#x4E2A;&#x5F97;&#x77E5; Rectangle &#x76F8;&#x5173;&#x5750;&#x6807;&#x70B9;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x8BA9;&#x5BA2;&#x6237;</span>
<span class="token comment">// &#x4FEE;&#x6539; Rectangle&#xFF08;&#x89C1;&#x6761;&#x6B3E; 3&#xFF09;&#x3002;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x5374;&#x90FD;&#x8FD4;&#x56DE; references</span>
<span class="token comment">// &#x6307;&#x5411; private &#x5185;&#x90E8;&#x6570;&#x636E;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x4E8E;&#x662F;&#x53EF;&#x901A;&#x8FC7;&#x8FD9;&#x4E9B; references &#x66F4;&#x6539;&#x5185;&#x90E8;&#x6570;&#x636E;&#xFF01;&#x4F8B;&#x5982;&#xFF1A;</span>
Point <span class="token function">coord1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Point <span class="token function">coord2</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Rectangle <span class="token function">rec</span><span class="token punctuation">(</span>coord1<span class="token punctuation">,</span> coord2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// rec &#x662F;&#x4E2A; const &#x77E9;&#x5F62;&#xFF0C;</span>
                                            <span class="token comment">// &#x4ECE; (0, 0) &#x5230; (100, 100)</span>
rec<span class="token punctuation">.</span><span class="token function">upperLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setX</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x73B0;&#x5728; rec &#x5374;&#x53D8;&#x6210;</span>
                                            <span class="token comment">// &#x4ECE; (50, 0) &#x5E26; (100, 100)</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;upperLeft &#x7684;&#x8C03;&#x7528;&#x8005;&#x80FD;&#x591F;&#x4F7F;&#x7528;&#x88AB;&#x8FD4;&#x56DE;&#x7684; reference</span>
<span class="token comment">// &#xFF08;&#x6307;&#x5411; rec &#x5185;&#x90E8;&#x7684; Point &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;&#x6765;&#x66F4;&#x6539;&#x6210;&#x5458;&#x3002;&#x4F46; rec &#x5176;&#x5B9E;&#x5E94;&#x8BE5;&#x662F;&#x4E0D;&#x53EF;&#x53D8;&#x7684;&#xFF08;const&#xFF09;&#xFF01;</span>





<span class="token comment">// &#x7B2C;&#x4E00;&#xFF0C;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x7684;&#x5C01;&#x88C5;&#x6027;&#x6700;&#x591A;&#x53EA;&#x7B49;&#x4E8E;&#x201C;&#x8FD4;&#x56DE;&#x5176; reference&#x201D;&#x7684;&#x51FD;&#x6570;&#x7684;&#x8BBF;&#x95EE;&#x7EA7;&#x522B;&#x3002;</span>
<span class="token comment">// &#x672C;&#x4F8B;&#x4E4B;&#x4E2D;&#x867D;&#x7136; ulhc &#x548C; lrhc &#x90FD;&#x88AB;&#x58F0;&#x660E;&#x4E3A; private&#xFF0C;&#x5B83;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5374;&#x662F; public&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A; public &#x51FD;&#x6570; upperLeft &#x548C; lowerRight &#x4F20;&#x51FA;&#x4E86;&#x5B83;&#x4EEC;&#x7684; references&#x3002;</span>
<span class="token comment">// &#x7B2C;&#x4E8C;&#xFF0C;&#x5982;&#x679C; const &#x6210;&#x5458;&#x51FD;&#x6570;&#x4F20;&#x51FA;&#x4E00;&#x4E2A; reference&#xFF0C;&#x540E;&#x8005;&#x6240;&#x6307;&#x6570;&#x636E;&#x4E0E;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x6709;&#x5173;&#x8054;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x5B83;&#x53C8;&#x88AB;&#x5B58;&#x50A8;&#x4E8E;&#x5BF9;&#x8C61;&#x4E4B;&#x5916;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;&#x8005;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x90A3;&#x7B14;&#x6570;&#x636E;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x6B63;&#x662F; bitwise constness &#x7684;&#x4E00;&#x4E2A;&#x9644;&#x5E26;&#x7ED3;&#x679C;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 3&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C;&#x5B83;&#x4EEC;&#x8FD4;&#x56DE;&#x7684;&#x662F;&#x6307;&#x9488;&#x6216;&#x8FED;&#x4EE3;&#x5668;&#xFF0C;&#x76F8;&#x540C;&#x7684;&#x60C5;&#x51B5;&#x8FD8;&#x662F;&#x53D1;&#x751F;&#xFF0C;&#x539F;&#x56E0;&#x4E5F;&#x76F8;&#x540C;&#x3002;</span>
<span class="token comment">// References&#x3001;&#x6307;&#x9488;&#x548C;&#x8FED;&#x4EE3;&#x5668;&#x7EDF;&#x7EDF;&#x90FD;&#x662F;&#x6240;&#x8C13;&#x7684; handles&#xFF08;&#x53F7;&#x7801;&#x724C;&#xFF0C;&#x7528;&#x6765;&#x53D6;&#x5F97;&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x201C;&#x4EE3;&#x8868;&#x5BF9;&#x8C61;&#x5185;&#x90E8;&#x6570;&#x636E;&#x201D;&#x7684; handle&#xFF0C;&#x968F;&#x4E4B;&#x800C;&#x6765;&#x7684;&#x4FBF;&#x662F;&#x201C;&#x964D;&#x4F4E;&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#x6027;&#x201D;&#x7684;&#x98CE;&#x9669;&#x3002;</span>
<span class="token comment">// &#x540C;&#x65F6;&#xFF0C;&#x5B83;&#x4E5F;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x201C;&#x867D;&#x7136;&#x8C03;&#x7528; const &#x6210;&#x5458;&#x51FD;&#x6570;&#x5374;&#x9020;&#x6210;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x88AB;&#x66F4;&#x6539;&#x201D;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> <span class="token function">upperLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>ulhc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> <span class="token function">lowerRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> pData<span class="token operator">-&gt;</span>lrhc<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6709;&#x4E86;&#x8FD9;&#x6837;&#x7684;&#x6539;&#x53D8;&#xFF0C;&#x5BA2;&#x6237;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x77E9;&#x5F62;&#x7684; Points&#xFF0C;&#x4F46;&#x4E0D;&#x80FD;&#x6D82;&#x5199;&#x5B83;&#x4EEC;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x53EA;&#x8BA9;&#x6E21;&#x8BFB;&#x53D6;&#x6743;&#xFF0C;&#x6D82;&#x5199;&#x6743;&#x4ECD;&#x7136;&#x662F;&#x88AB;&#x7981;&#x6B62;&#x7684;&#x3002;</span>





<span class="token comment">// &#x5B83;&#x53EF;&#x80FD;&#x5BFC;&#x81F4; dangling handles&#xFF08;&#x7A7A;&#x60AC;&#x7684;&#x53F7;&#x7801;&#x724C;&#xFF09;&#xFF1A;&#x8FD9;&#x79CD; handles &#x6240;&#x6307;&#x4E1C;&#x897F;&#xFF08;&#x7684;&#x6240;&#x5C5E;&#x5BF9;&#x8C61;&#xFF09;</span>
<span class="token comment">// &#x4E0D;&#x590D;&#x5B58;&#x5728;&#x3002;&#x8FD9;&#x79CD;&#x201C;&#x4E0D;&#x590D;&#x5B58;&#x5728;&#x7684;&#x5BF9;&#x8C61;&#x201D;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x6765;&#x6E90;&#x5C31;&#x662F;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x503C;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">GUIObject</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Rectangle                             <span class="token comment">// &#x4EE5; by value &#x65B9;&#x5F0F;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x77E9;&#x5F62;</span>
    <span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token keyword">const</span> GUIObject<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x6761;&#x6B3E; 3 &#x8C08;&#x8FC7;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x662F; const</span>

GUIObject<span class="token operator">*</span> pgo<span class="token punctuation">;</span>                 <span class="token comment">// &#x8BA9; pgo &#x6307;&#x5411;&#x67D0;&#x4E2A; GUIObject</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> Point<span class="token operator">*</span> pUpperLeft <span class="token operator">=</span>       <span class="token comment">// &#x53D6;&#x5F97;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x5916;&#x6846;&#x5DE6;&#x4E0A;&#x70B9;</span>
    <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token operator">*</span>pgo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">upperLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5BF9; boundingBox &#x7684;&#x8C03;&#x7528;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x3001;&#x6682;&#x65F6;&#x7684; Rectangle &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x6CA1;&#x6709;&#x540D;&#x79F0;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x6743;&#x4E14;&#x79F0;&#x5B83;&#x4E3A; temp&#x3002;&#x968F;&#x540E; upperLeft &#x4F5C;&#x7528;&#x4E8E; temp &#x8EAB;&#x4E0A;&#xFF0C;</span>
<span class="token comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; reference &#x6307;&#x5411; temp &#x7684;&#x4E00;&#x4E2A;&#x5185;&#x90E8;&#x6210;&#x5206;&#xFF0C;&#x66F4;&#x5177;&#x4F53;&#x5730;&#x8BF4;&#x662F;</span>
<span class="token comment">// &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x7528;&#x4EE5;&#x6807;&#x793A; temp &#x7684; Points&#x3002;&#x4E8E;&#x662F; pUpperLeft &#x6307;&#x5411;&#x90A3;&#x4E2A;</span>
<span class="token comment">// Point &#x5BF9;&#x8C61;&#x3002;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x4E00;&#x5207;&#x8FD8;&#x597D;&#xFF0C;&#x4F46;&#x6545;&#x4E8B;&#x5C1A;&#x672A;&#x7ED3;&#x675F;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x90A3;&#x4E2A;&#x8BED;</span>
<span class="token comment">// &#x53E5;&#x4E4B;&#x540E;&#xFF0C;boundingBox &#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684; temp&#xFF0C;&#x5C06;&#x88AB;</span>
<span class="token comment">// &#x9500;&#x6BC1;&#xFF0C;&#x800C;&#x90A3;&#x95F4;&#x63A5;&#x5BFC;&#x81F4; temp &#x5185;&#x7684; Points &#x6790;&#x6784;&#x3002;&#x6700;&#x7EC8;&#x5BFC;&#x81F4; pUpperLeft</span>
<span class="token comment">// &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x4E0D;&#x518D;&#x5B58;&#x5728;&#x7684;&#x5BF9;&#x8C61;&#xFF1B;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E00;&#x65E6;&#x4EA7;&#x51FA; pUpperLeft &#x7684;&#x90A3;&#x4E2A;</span>
<span class="token comment">// &#x8BED;&#x53E5;&#x7ED3;&#x675F;&#xFF0C;pUpperLeft &#x4E5F;&#x5C31;&#x53D8;&#x6210;&#x60AC;&#x7A7A;&#x3001;&#x865A;&#x540A;&#xFF08;dangling&#xFF09;&#xFF01;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-29%E4%B8%BA%E5%BC%82%E5%B8%B8%E5%AE%89%E5%85%A8%E8%80%8C%E5%8A%AA%E5%8A%9B%E6%98%AF%E5%80%BC%E5%BE%97%E7%9A%84">&#x6761;&#x6B3E; 29&#xFF1A;&#x4E3A;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x201D;&#x800C;&#x52AA;&#x529B;&#x662F;&#x503C;&#x5F97;&#x7684;</h3>

<ul>
<li>&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x51FD;&#x6570;&#xFF08;Exception-safe functions&#xFF09;&#x5373;&#x4F7F;&#x53D1;&#x751F;&#x5F02;&#x5E38;&#x4E5F;&#x4E0D;&#x4F1A;&#x6CC4;&#x6F0F;&#x8D44;&#x6E90;&#x6216;&#x5141;&#x8BB8;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x8D25;&#x574F;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x533A;&#x5206;&#x4E3A;&#x4E09;&#x79CD;&#x53EF;&#x80FD;&#x7684;&#x4FDD;&#x8BC1;&#xFF1A;&#x57FA;&#x672C;&#x578B;&#x3001;&#x5F3A;&#x70C8;&#x578B;&#x3001;&#x4E0D;&#x629B;&#x5F02;&#x5E38;&#x578B;&#x3002;</li>
<li>&#x201C;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x201D;&#x5F80;&#x5F80;&#x80FD;&#x591F;&#x4EE5; copy-and-swap &#x5B9E;&#x73B0;&#x51FA;&#x6765;&#xFF0C;&#x4F46;&#x201C;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x201D;&#x5E76;&#x975E;&#x5BF9;&#x6240;&#x6709;&#x51FD;&#x6570;&#x90FD;&#x53EF;&#x5B9E;&#x73B0;&#x6216;&#x5177;&#x5907;&#x73B0;&#x5B9E;&#x610F;&#x4E49;&#x3002;</li>
<li>&#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x7684;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x4FDD;&#x8BC1;&#x201D;&#x901A;&#x5E38;&#x6700;&#x9AD8;&#x53EA;&#x7B49;&#x4E8E;&#x5176;&#x6240;&#x8C03;&#x7528;&#x4E4B;&#x5404;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x4FDD;&#x8BC1;&#x201D;&#x4E2D;&#x7684;&#x6700;&#x5F31;&#x8005;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">PrettyMenu</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">changeBackground</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&amp;</span> imgSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6539;&#x53D8;&#x80CC;&#x666F;&#x56FE;&#x50CF;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Mutex mutex<span class="token punctuation">;</span>                    <span class="token comment">// &#x4E92;&#x65A5;&#x5668;</span>
    <span class="token type-opencl-host-c++ keyword">Image</span><span class="token operator">*</span> bgImage<span class="token punctuation">;</span>                 <span class="token comment">// &#x76EE;&#x524D;&#x7684;&#x80CC;&#x666F;&#x56FE;&#x50CF;</span>
    <span class="token keyword">int</span> imageChanges<span class="token punctuation">;</span>               <span class="token comment">// &#x80CC;&#x666F;&#x56FE;&#x50CF;&#x88AB;&#x6539;&#x53D8;&#x7684;&#x6B21;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> PrettyMenu<span class="token operator">::</span><span class="token function">changeBackground</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&amp;</span> imgSrc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x53D6;&#x5F97;&#x4E92;&#x65A5;&#x5668;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 14&#xFF09;</span>
    <span class="token keyword">delete</span> bgImage<span class="token punctuation">;</span>                 <span class="token comment">// &#x6446;&#x8131;&#x65E7;&#x7684;&#x80CC;&#x666F;&#x56FE;&#x50CF;</span>
    <span class="token operator">++</span>imageChanges<span class="token punctuation">;</span>                 <span class="token comment">// &#x4FEE;&#x6539;&#x56FE;&#x50CF;&#x53D8;&#x66F4;&#x6B21;&#x6570;</span>
    bgImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token type-opencl-host-c++ keyword">Image</span><span class="token punctuation">(</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x5B89;&#x88C5;&#x65B0;&#x7684;&#x80CC;&#x666F;&#x56FE;&#x50CF;</span>
    <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x91CA;&#x653E;&#x4E92;&#x65A5;&#x5668;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4ECE;&#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x6027;&#x201D;&#x7684;&#x89C2;&#x70B9;&#x6765;&#x770B;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5F88;&#x7CDF;&#x3002;</span>
<span class="token comment">// &#x201C;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x201D;&#x6709;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x6CA1;&#x6709;&#x6EE1;&#x8DB3;&#x5176;&#x4E2D;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x3002;</span>





<span class="token comment">// &#x5F53;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#x65F6;&#xFF0C;&#x5E26;&#x6709;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x6027;&#x7684;&#x51FD;&#x6570;&#x4F1A;&#xFF1A;</span>

<span class="token comment">// &#xFF08;1&#xFF09;&#xFF1A;&#x4E0D;&#x6CC4;&#x6F0F;&#x4EFB;&#x4F55;&#x8D44;&#x6E90;&#x3002;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x6CA1;&#x6709;&#x505A;&#x5230;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x65E6;&#x201C;new Image(imgSrc)&#x201D;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x5BF9; unlock &#x7684;&#x8C03;&#x7528;&#x5C31;&#x7EDD;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#xFF0C;&#x4E8E;&#x662F;&#x4E92;&#x65A5;&#x5668;&#x5C31;&#x6C38;&#x8FDC;&#x88AB;&#x628A;&#x6301;&#x4F4F;&#x4E86;&#x3002;</span>

<span class="token comment">// &#xFF08;2&#xFF09;&#xFF1A;&#x4E0D;&#x5141;&#x8BB8;&#x6570;&#x636E;&#x8D25;&#x574F;&#x3002;&#x5982;&#x679C;&#x201C;new Image(imgSrc)&#x201D;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// bgImage &#x5C31;&#x662F;&#x6307;&#x5411;&#x4E00;&#x4E2A;&#x5DF2;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;imageChanges &#x4E5F;&#x5DF2;&#x88AB;&#x7D2F;&#x52A0;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x56FE;&#x50CF;&#x88AB;&#x6210;&#x529F;&#x5B89;&#x88C5;&#x8D77;&#x6765;&#x3002;&#xFF08;&#x4F46;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x89D2;&#x5EA6;&#x8BF4;&#xFF0C;&#x65E7;&#x56FE;&#x50CF;&#x5DF2;&#x88AB;&#x6D88;&#x9664;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x4E89;&#x8FA9;&#x8BF4;&#x56FE;&#x50CF;&#x8FD8;&#x662F;&#x201C;&#x6539;&#x53D8;&#x4E86;&#x201D;&#xFF09;&#x3002;</span>





<span class="token comment">// &#x89E3;&#x51B3;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x5F88;&#x5BB9;&#x6613;&#xFF0C;&#x56E0;&#x4E3A;&#x6761;&#x6B3E; 13 &#x8BA8;&#x8BBA;&#x8FC7;&#x5982;&#x4F55;&#x4EE5;&#x5BF9;&#x8C61;&#x7BA1;&#x7406;&#x8D44;&#x6E90;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x6761;&#x6B3E; 14 &#x4E5F;&#x5BFC;&#x5165;&#x4E86; Lock class &#x4F5C;&#x4E3A;&#x4E00;&#x79CD;&#x201C;&#x786E;&#x4FDD;&#x4E92;&#x65A5;&#x5668;&#x88AB;&#x53CA;&#x65F6;&#x91CA;&#x653E;&#x201D;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;</span>
<span class="token keyword">void</span> PrettyMenu<span class="token operator">::</span><span class="token function">changeBackground</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&amp;</span> imgSrc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Lock <span class="token function">m1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6765;&#x81EA;&#x6761;&#x6B3E; 14&#xFF1A;&#x83B7;&#x5F97;&#x4E92;&#x65A5;&#x5668;&#x5E76;&#x786E;&#x4FDD;&#x5B83;&#x7A0D;&#x540E;&#x88AB;&#x91CA;&#x653E;</span>
    <span class="token keyword">delete</span> bgImage<span class="token punctuation">;</span>
    <span class="token operator">++</span>imageChanges<span class="token punctuation">;</span>
    bgImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token type-opencl-host-c++ keyword">Image</span><span class="token punctuation">(</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x628A;&#x8D44;&#x6E90;&#x6CC4;&#x6F0F;&#x629B;&#x8BF8;&#x8111;&#x540E;&#xFF0C;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4E13;&#x6CE8;&#x89E3;&#x51B3;&#x6570;&#x636E;&#x7684;&#x8D25;&#x574F;&#x4E86;&#x3002;</span>

<span class="token comment">// &#x5F02;&#x5E38;&#x5B89;&#x5168;&#x51FD;&#x6570;&#xFF08;Exception-safe functions&#xFF09;&#x63D0;&#x4F9B;&#x4E00;&#x4E0B;&#x4E09;&#x4E2A;&#x4FDD;&#x8BC1;&#x4E4B;&#x4E00;&#xFF1A;</span>

<span class="token comment">// &#xFF08;1&#xFF09;&#x57FA;&#x672C;&#x627F;&#x8BFA;&#xFF1A;&#x5982;&#x679C;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#xFF0C;&#x7A0B;&#x5E8F;&#x5185;&#x7684;&#x4EFB;&#x4F55;&#x4E8B;&#x7269;&#x4ECD;&#x7136;&#x4FDD;&#x6301;&#x5728;&#x6709;&#x6548;&#x72B6;&#x6001;&#x4E0B;&#x3002;</span>
<span class="token comment">// &#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5BF9;&#x8C61;&#x6216;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4F1A;&#x56E0;&#x6B64;&#x800C;&#x8D25;&#x574F;&#xFF0C;&#x6240;&#x6709;&#x5BF9;&#x8C61;&#x90FD;&#x5904;&#x4E8E;&#x4E00;&#x79CD;&#x5185;&#x90E8;&#x524D;&#x540E;&#x4E00;&#x81F4;&#x7684;&#x72B6;&#x6001;</span>
<span class="token comment">// &#xFF08;&#x4F8B;&#x5982;&#x6240;&#x6709;&#x7684; class &#x7EA6;&#x675F;&#x6761;&#x4EF6;&#x90FD;&#x7EE7;&#x7EED;&#x83B7;&#x5F97;&#x6EE1;&#x8DB3;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C;&#x7A0B;&#x5E8F;&#x7684;&#x73B0;&#x5B9E;&#x72B6;&#x6001;&#xFF08;exact state&#xFF09;&#x6050;&#x6015;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x3002;</span>
<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x64B0;&#x5199; changeBackground &#x4F7F;&#x5F97;&#x4E00;&#x65E6;&#x6709;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#x65F6;&#xFF0C;</span>
<span class="token comment">// PrettyMenu &#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x62E5;&#x6709;&#x539F;&#x80CC;&#x666F;&#x56FE;&#x50CF;&#xFF0C;&#x6216;&#x662F;&#x4EE4;&#x5B83;&#x62E5;&#x6709;&#x67D0;&#x4E2A;&#x7F3A;&#x7701;&#x80CC;&#x666F;&#x56FE;&#x50CF;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5BA2;&#x6237;&#x65E0;&#x6CD5;&#x9884;&#x671F;&#x54EA;&#x4E00;&#x79CD;&#x60C5;&#x51B5;&#x3002;&#x5982;&#x679C;&#x60F3;&#x77E5;&#x9053;&#xFF0C;&#x4ED6;&#x4EEC;&#x6050;&#x6015;&#x5FC5;&#x987B;&#x8C03;&#x7528;&#x67D0;&#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;</span>
<span class="token comment">// &#x4EE5;&#x5F97;&#x77E5;&#x5F53;&#x65F6;&#x7684;&#x80CC;&#x666F;&#x56FE;&#x50CF;&#x662F;&#x4EC0;&#x4E48;&#x3002;</span>

<span class="token comment">// &#xFF08;2&#xFF09;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#xFF1A;&#x5982;&#x679C;&#x5F02;&#x5E38;&#x88AB;&#x629B;&#x51FA;&#xFF0C;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x4E0D;&#x6539;&#x53D8;&#x3002;</span>
<span class="token comment">// &#x8C03;&#x7528;&#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x9700;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x8BA4;&#x77E5;&#xFF1A;&#x5982;&#x679C;&#x51FD;&#x6570;&#x6210;&#x529F;&#xFF0C;&#x5C31;&#x662F;&#x5B8C;&#x5168;&#x6210;&#x529F;&#xFF0C;</span>
<span class="token comment">// &#x5982;&#x679C;&#x51FD;&#x6570;&#x5931;&#x8D25;&#xFF0C;&#x7A0B;&#x5E8F;&#x4F1A;&#x56DE;&#x590D;&#x5230;&#x201C;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x4E4B;&#x524D;&#x201D;&#x7684;&#x72B6;&#x6001;&#x3002;</span>
<span class="token comment">// &#x548C;&#x8FD9;&#x79CD;&#x63D0;&#x4F9B;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x7684;&#x51FD;&#x6570;&#x516C;&#x4E8B;&#xFF0C;&#x6BD4;&#x521A;&#x624D;&#x8BF4;&#x7684;&#x90A3;&#x79CD;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x57FA;&#x672C;&#x627F;&#x8BFA;&#x7684;&#x51FD;&#x6570;&#x5171;&#x4E8B;&#xFF0C;&#x5BB9;&#x6613;&#x591A;&#x4E86;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x5728;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x63D0;&#x4F9B;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x7684;&#x51FD;&#x6570;&#x540E;&#xFF0C;&#x7A0B;&#x5E8F;&#x72B6;&#x6001;&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x53EF;&#x80FD;&#xFF1A;</span>
<span class="token comment">// &#x5982;&#x9884;&#x671F;&#x822C;&#x5730;&#x5230;&#x8FBE;&#x51FD;&#x6570;&#x6210;&#x529F;&#x6267;&#x884C;&#x540E;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6216;&#x56DE;&#x5230;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x524D;&#x7684;&#x72B6;&#x6001;&#x3002;</span>
<span class="token comment">// &#x4E0E;&#x6B64;&#x6210;&#x5BF9;&#x6BD4;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x53EA;&#x63D0;&#x4F9B;&#x57FA;&#x672C;&#x627F;&#x8BFA;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x771F;&#x7684;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x5904;&#x4E8E;&#x4EFB;&#x4F55;&#x72B6;&#x6001;&#x2014;&#x2014;&#x53EA;&#x8981;&#x90A3;&#x662F;&#x4E2A;&#x5408;&#x6CD5;&#x72B6;&#x6001;&#x3002;</span>

<span class="token comment">// &#xFF08;3&#xFF09;&#x4E0D;&#x629B;&#x63B7;&#xFF08;nothrow&#xFF09;&#x4FDD;&#x8BC1;&#xFF1A;&#x627F;&#x8BFA;&#x7EDD;&#x4E0D;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x603B;&#x662F;&#x80FD;&#x591F;</span>
<span class="token comment">// &#x5B8C;&#x6210;&#x5B83;&#x4EEC;&#x539F;&#x5148;&#x627F;&#x8BFA;&#x7684;&#x529F;&#x80FD;&#x3002;&#x4F5C;&#x7528;&#x4E8E;&#x5185;&#x7F6E;&#x7C7B;&#x578B;&#xFF08;&#x4F8B;&#x5982; ints&#xFF0C;&#x6307;&#x9488;&#x7B49;&#x7B49;&#xFF09;</span>
<span class="token comment">// &#x8EAB;&#x4E0A;&#x7684;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x90FD;&#x63D0;&#x4F9B; nothrow &#x4FDD;&#x8BC1;&#x3002;&#x8FD9;&#x662F;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x7801;&#x4E2D;&#x4E00;&#x4E2A;&#x5FC5;&#x4E0D;&#x53EF;&#x5C11;&#x7684;&#x5173;&#x952E;&#x57FA;&#x7840;&#x6750;&#x6599;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x6211;&#x4EEC;&#x5047;&#x8BBE;&#xFF0C;&#x51FD;&#x6570;&#x5E26;&#x7740;&#x201C;&#x7A7A;&#x767D;&#x7684;&#x5F02;&#x5E38;&#x660E;&#x7EC6;&#x201D;&#xFF08;empty exception specification&#xFF09;&#x8005;</span>
<span class="token comment">// &#x5FC5;&#x4E3A; nothrow &#x51FD;&#x6570;&#xFF0C;&#x4F3C;&#x4E4E;&#x5408;&#x60C5;&#x5408;&#x7406;&#xFF0C;&#x5176;&#x5B9E;&#x4E0D;&#x5C3D;&#x7136;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">int</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x6CE8;&#x610F;&#x201C;&#x7A7A;&#x767D;&#x7684;&#x5F02;&#x5E38;&#x660E;&#x7EC6;&#x201D;</span>
                                <span class="token comment">// &#xFF08;empty exception spec</span>
<span class="token comment">// &#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4; doSomething &#x7EDD;&#x4E0D;&#x4F1A;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x800C;&#x662F;&#x8BF4;&#x5982;&#x679C; doSomething &#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x5C06;&#x662F;&#x4E25;&#x91CD;&#x9519;&#x8BEF;&#xFF0C;&#x4F1A;&#x6709;&#x4F60;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>





<span class="token comment">// &#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x6392;&#x5217; changeBackground &#x5185;&#x7684;&#x8BED;&#x53E5;&#x6B21;&#x5E8F;&#xFF0C;&#x4F7F;&#x5F97;&#x5728;&#x66F4;&#x6362;&#x56FE;&#x50CF;</span>
<span class="token comment">// &#x5728;&#x4E4B;&#x540E;&#x624D;&#x7D2F;&#x52A0; imageChanges&#x3002;&#x4E00;&#x822C;&#x800C;&#x8A00;&#x8FD9;&#x662F;&#x4E2A;&#x597D;&#x7B56;&#x7565;&#xFF1A;&#x4E0D;&#x8981;&#x4E3A;&#x4E86;&#x8868;</span>
<span class="token comment">// &#x793A;&#x67D0;&#x4EF6;&#x4E8B;&#x60C5;&#x53D1;&#x751F;&#x800C;&#x6539;&#x53D8;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#xFF0C;&#x9664;&#x975E;&#x90A3;&#x4EF6;&#x4E8B;&#x60C5;&#x771F;&#x7684;&#x53D1;&#x751F;&#x4E86;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">PrettyMenu</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token type-opencl-host-c++ keyword">Image</span><span class="token operator">&gt;</span> bgImage<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> PrettyMenu<span class="token operator">::</span><span class="token function">changeBackground</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&amp;</span> imgSrc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Lock <span class="token function">m1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bgImage<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token type-opencl-host-c++ keyword">Image</span><span class="token punctuation">(</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x4EE5;&#x201C;new Image&#x201D;&#x7684;&#x6267;&#x884C;&#x7ED3;&#x679C;</span>
                                            <span class="token comment">// &#x8BBE;&#x5B9A; bgImage &#x5185;&#x90E8;&#x6307;&#x9488;</span>
    <span class="token operator">++</span>imageChanges<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x4E24;&#x4E2A;&#x6539;&#x53D8;&#x51E0;&#x4E4E;&#x8DB3;&#x591F;&#x8BA9; changeBackground &#x63D0;&#x4F9B;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x7684;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x4FDD;&#x8BC1;&#x3002;</span>
<span class="token comment">// &#x7F8E;&#x4E2D;&#x4E0D;&#x8DB3;&#x7684;&#x662F;&#x53C2;&#x6570; imgSrc&#x3002;&#x5982;&#x679C; Image &#x6784;&#x9020;&#x51FD;&#x6570;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x8F93;&#x5165;&#x6D41;</span>
<span class="token comment">// &#xFF08;input stream&#xFF09;&#x7684;&#x8BFB;&#x53D6;&#x8BB0;&#x53F7;&#xFF08;read marker&#xFF09;&#x5DF2;&#x88AB;&#x79FB;&#x8D70;&#xFF0C;&#x800C;&#x8FD9;&#x6837;&#x7684;&#x642C;&#x79FB;&#x5BF9;</span>
<span class="token comment">// &#x7A0B;&#x5E8F;&#x5176;&#x4F59;&#x90E8;&#x5206;&#x662F;&#x4E00;&#x79CD;&#x53EF;&#x89C1;&#x72B6;&#x6001;&#x7684;&#x6539;&#x53D8;&#x3002;&#x6240;&#x4EE5; changeBackground &#x5728;&#x89E3;&#x51B3;&#x8FD9;</span>
<span class="token comment">// &#x4E2A;&#x95EE;&#x9898;&#x4E4B;&#x524D;&#x53EA;&#x63D0;&#x4F9B;&#x57FA;&#x672C;&#x7684;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x4FDD;&#x8BC1;&#x3002;</span>





<span class="token comment">// &#x6709;&#x4E2A;&#x4E00;&#x822C;&#x5316;&#x7684;&#x8BBE;&#x8BA1;&#x7B56;&#x7565;&#x5F88;&#x5178;&#x578B;&#x5730;&#x4F1A;&#x5BFC;&#x81F4;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#xFF0C;&#x5F88;&#x503C;&#x5F97;&#x719F;&#x6089;&#x5B83;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x7B56;&#x7565;&#x88AB;&#x79F0;&#x4E3A; copy and swap&#x3002;&#x539F;&#x5219;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x4E3A;&#x4F60;&#x6253;&#x7B97;&#x4FEE;&#x6539;&#x7684;</span>
<span class="token comment">// &#x5BF9;&#x8C61;&#xFF08;&#x539F;&#x4EF6;&#xFF09;&#x505A;&#x51FA;&#x4E00;&#x4EFD;&#x526F;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x90A3;&#x526F;&#x672C;&#x4E0A;&#x505A;&#x4E00;&#x5207;&#x5FC5;&#x8981;&#x4FEE;&#x6539;&#x3002;</span>
<span class="token comment">// &#x82E5;&#x6709;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#x52A8;&#x4F5C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;&#x539F;&#x5BF9;&#x8C61;&#x4ECD;&#x4FDD;&#x6301;&#x4E3A;&#x6539;&#x53D8;&#x72B6;&#x6001;&#x3002;&#x5F85;&#x6240;&#x6709;&#x6539;</span>
<span class="token comment">// &#x53D8;&#x90FD;&#x6210;&#x529F;&#x540E;&#xFF0C;&#x518D;&#x5C06;&#x4FEE;&#x6539;&#x8FC7;&#x7684;&#x90A3;&#x4E2A;&#x526F;&#x672C;&#x548C;&#x539F;&#x5BF9;&#x8C61;&#x5728;&#x4E00;&#x4E2A;&#x4E0D;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x7684;</span>
<span class="token comment">// &#x64CD;&#x4F5C;&#x4E2D;&#x7F6E;&#x6362;&#xFF08;swap&#xFF09;&#x3002;</span>

<span class="token comment">// &#x5B9E;&#x73B0;&#x4E0A;&#x901A;&#x5E38;&#x662F;&#x5C06;&#x6240;&#x6709;&#x201C;&#x96B6;&#x5C5E;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x636E;&#x201D;&#x4ECE;&#x539F;&#x5BF9;&#x8C61;&#x653E;&#x8FDB;&#x53E6;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5185;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x8D4B;&#x4E88;&#x539F;&#x5BF9;&#x8C61;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x90A3;&#x4E2A;&#x6240;&#x8C13;&#x7684;&#x5B9E;&#x73B0;&#x5BF9;&#x8C61;&#xFF08;implementation object&#xFF0C;&#x5373;&#x526F;&#x672C;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x624B;&#x6CD5;&#x5E38;&#x88AB;&#x79F0;&#x4E3A; pimpl idiom&#xFF0C;&#x6761;&#x6B3E; 31 &#x8BE6;&#x7EC6;&#x63CF;&#x8FF0;&#x4E86;&#x5B83;&#x3002;</span>
<span class="token comment">// &#x5BF9; PrettyMenu &#x800C;&#x8A00;&#xFF0C;&#x5178;&#x578B;&#x624B;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">struct</span> PMImpl <span class="token punctuation">{</span>                                 <span class="token comment">// PMImpl = &quot;PrettyMenu Impl&quot;;</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token type-opencl-host-c++ keyword">Image</span><span class="token operator">&gt;</span> bgImage<span class="token punctuation">;</span>        <span class="token comment">// &#x7A0D;&#x540E;&#x8BF4;&#x660E;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x662F;&#x4E2A; struct</span>
    <span class="token keyword">int</span> imageChanges<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PrettyMenu</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Mutex mutex<span class="token punctuation">;</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>PMImpl<span class="token operator">&gt;</span> pImpl<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> PrettyMenu<span class="token operator">::</span><span class="token function">changeBackground</span><span class="token punctuation">(</span>std<span class="token operator">::</span>istream<span class="token operator">&amp;</span> imgSrc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> std<span class="token operator">::</span>swap<span class="token punctuation">;</span>                            <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 25</span>
    Lock <span class="token function">m1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// &#x83B7;&#x5F97; mutex &#x7684;&#x526F;&#x672C;&#x6570;&#x636E;</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>PMImpl<span class="token operator">&gt;</span>
        <span class="token function">pNew</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">PMImpl</span><span class="token punctuation">(</span><span class="token operator">*</span>pImpl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pNew<span class="token operator">-&gt;</span>bgImage<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token type-opencl-host-c++ keyword">Image</span><span class="token punctuation">(</span>imgSrc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x4FEE;&#x6539;&#x526F;&#x672C;</span>
    <span class="token operator">++</span>pNew<span class="token operator">-&gt;</span>imageChanges<span class="token punctuation">;</span>
    <span class="token function">swap</span><span class="token punctuation">(</span>pImpl<span class="token punctuation">,</span> pNew<span class="token punctuation">)</span><span class="token punctuation">;</span>                          <span class="token comment">// &#x7F6E;&#x6362;&#xFF08;swap&#xFF09;&#x6570;&#x636E;&#xFF0C;&#x91CA;&#x653E; mutex</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6B64;&#x4F8B;&#x4E4B;&#x4E2D;&#x6211;&#x9009;&#x62E9;&#x8BA9; PMImpl &#x6210;&#x4E3A;&#x4E00;&#x4E2A; struct &#x800C;&#x4E0D;&#x662F;&#x4E00;&#x4E2A; class&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x662F;&#x56E0;&#x4E3A; PrettyMenu &#x7684;&#x6570;&#x636E;&#x5C01;&#x88C5;&#x6027;&#x5DF2;&#x7ECF;&#x7531;&#x4E8E;&#x201C;pImpl &#x662F; private&#x201D;</span>
<span class="token comment">// &#x800C;&#x83B7;&#x5F97;&#x4E86;&#x4FDD;&#x8BC1;&#x3002;&#x5982;&#x679C;&#x4EE4; PMImpl &#x4E3A;&#x4E00;&#x4E2A; class&#xFF0C;&#x867D;&#x7136;&#x4E00;&#x6837;&#x597D;&#xFF0C;&#x6709;&#x65F6;&#x5019;</span>
<span class="token comment">// &#x5374;&#x4E0D;&#x592A;&#x65B9;&#x4FBF;&#xFF08;&#x4F46;&#x4E5F;&#x4FDD;&#x6301;&#x4E86;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7EAF;&#x5EA6;&#xFF09;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8981;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5C06; PMImpl</span>
<span class="token comment">// &#x5D4C;&#x5957;&#x4E8E; PrettyMenu &#x5185;&#xFF0C;&#x4F46;&#x6253;&#x5305;&#x95EE;&#x9898;&#xFF08;packaging&#xFF0C;&#x4F8B;&#x5982;&#x201C;&#x72EC;&#x7ACB;&#x64B0;&#x5199;</span>
<span class="token comment">// &#x5F02;&#x5E38;&#x5B89;&#x5168;&#x7801;&#x201D;&#xFF09;&#x662F;&#x6211;&#x4EEC;&#x8FD9;&#x91CC;&#x6240;&#x6302;&#x8651;&#x7684;&#x4E8B;&#x3002;</span>





<span class="token comment">// &#x201C;copy-and-swap&#x201D;&#x7B56;&#x7565;&#x662F;&#x5BF9;&#x5BF9;&#x8C61;&#x72B6;&#x6001;&#x505A;&#x51FA;&#x201C;&#x5168;&#x6709;&#x6216;&#x5168;&#x65E0;&#x201D;&#x6539;&#x53D8;&#x7684;&#x4E00;&#x4E2A;&#x5F88;&#x597D;&#x529E;&#x6CD5;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x4E00;&#x822C;&#x800C;&#x8A00;&#x5B83;&#x5E76;&#x4E0D;&#x4FDD;&#x8BC1;&#x6574;&#x4E2A;&#x51FD;&#x6570;&#x6709;&#x5F3A;&#x70C8;&#x7684;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x6027;&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x4E86;&#x4E86;&#x89E3;&#x539F;&#x56E0;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x8003;&#x8651; changeBackgroud &#x7684;&#x4E00;&#x4E2A;&#x62BD;&#x8C61;&#x6982;&#x5FF5;&#xFF1A;someFunc&#x3002;</span>
<span class="token comment">// &#x5B83;&#x4F7F;&#x7528; copy-and-swap &#x7B56;&#x7565;&#xFF0C;&#x4F46;&#x51FD;&#x6570;&#x5185;&#x8FD8;&#x5305;&#x62EC;&#x5BF9;&#x53E6;&#x5916;&#x4E24;&#x4E2A;&#x51FD;&#x6570; f1 &#x548C; f2 &#x7684;&#x8C03;&#x7528;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x5BF9; local &#x72B6;&#x6001;&#x505A;&#x4E00;&#x4EFD;&#x526F;&#x672C;</span>
    <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x5C06;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x72B6;&#x6001;&#x7F6E;&#x6362;&#x8FC7;&#x6765;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x5F88;&#x663E;&#x7136;&#xFF0C;&#x5982;&#x679C; f1 &#x6216; f2 &#x7684;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x6027;&#x6BD4;&#x201C;&#x5F3A;&#x70C8;&#x4FDD;&#x8BC1;&#x201D;&#x4F4E;&#xFF0C;&#x5C31;&#x5F88;&#x96BE;&#x8BA9; someFunc</span>
<span class="token comment">// &#x6210;&#x4E3A;&#x201C;&#x5F3A;&#x70C8;&#x5F02;&#x5E38;&#x5B89;&#x5168;&#x201D;&#x3002;</span>




<span class="token comment">// copy-and-swap &#x7684;&#x5173;&#x952E;&#x5728;&#x4E8E;&#x201C;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;&#x6570;&#x636E;&#x7684;&#x526F;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x4E00;&#x4E2A;&#x4E0D;</span>
<span class="token comment">// &#x629B;&#x5F02;&#x5E38;&#x7684;&#x51FD;&#x6570;&#x4E2D;&#x5C06;&#x4FEE;&#x6539;&#x540E;&#x7684;&#x6570;&#x636E;&#x548C;&#x539F;&#x4EF6;&#x7F6E;&#x6362;&#x201D;&#xFF0C;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x5373;</span>
<span class="token comment">// &#x5C06;&#x88AB;&#x6539;&#x52A8;&#x7684;&#x5BF9;&#x8C61;&#x505A;&#x51FA;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#xFF0C;&#x90A3;&#x5F97;&#x8017;&#x7528;&#x4F60;&#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#xFF08;&#x6216;&#x65E0;&#x610F;&#x613F;&#xFF09;</span>
<span class="token comment">// &#x4F9B;&#x5E94;&#x7684;&#x65F6;&#x95F4;&#x548C;&#x7A7A;&#x95F4;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-30%E9%80%8F%E5%BD%BB%E4%BA%86%E8%A7%A3-inlining-%E7%9A%84%E9%87%8C%E9%87%8C%E5%A4%96%E5%A4%96">&#x6761;&#x6B3E; 30&#xFF1A;&#x900F;&#x5F7B;&#x4E86;&#x89E3; inlining &#x7684;&#x91CC;&#x91CC;&#x5916;&#x5916;</h3>

<ul>
<li>&#x5C06;&#x5927;&#x591A;&#x6570; inlining &#x9650;&#x5236;&#x5728;&#x5C0F;&#x578B;&#x3001;&#x88AB;&#x9891;&#x7E41;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x8EAB;&#x4E0A;&#x3002;&#x8FD9;&#x53EF;&#x4F7F;&#x65E5;&#x540E;&#x7684;&#x8C03;&#x8BD5;&#x8FC7;&#x7A0B;&#x548C;&#x4E8C;&#x8FDB;&#x5236;&#x5347;&#x7EA7;&#xFF08;binary upgradability&#xFF09;&#x66F4;&#x5BB9;&#x6613;&#xFF0C;&#x4E5F;&#x53EF;&#x4F7F;&#x6F5C;&#x5728;&#x7684;&#x4EE3;&#x7801;&#x81A8;&#x80C0;&#x95EE;&#x9898;&#x6700;&#x5C0F;&#x5316;&#xFF0C;&#x4F7F;&#x7A0B;&#x5E8F;&#x7684;&#x901F;&#x5EA6;&#x63D0;&#x5347;&#x673A;&#x4F1A;&#x6700;&#x5927;&#x5316;&#x3002;</li>
<li>&#x4E0D;&#x8981;&#x53EA;&#x56E0;&#x4E3A; function templates &#x51FA;&#x73B0;&#x5728;&#x5934;&#x6587;&#x4EF6;&#xFF0C;&#x5C31;&#x5C06;&#x5B83;&#x4EEC;&#x58F0;&#x660E;&#x4E3A; inline&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x8BB0;&#x4F4F;&#xFF0C;inline &#x53EA;&#x662F;&#x5BF9;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x4E00;&#x4E2A;&#x7533;&#x8BF7;&#xFF0C;&#x4E0D;&#x662F;&#x5F3A;&#x5236;&#x547D;&#x4EE4;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x9879;&#x7533;&#x8BF7;&#x53EF;&#x4EE5;&#x9690;&#x55BB;&#x63D0;&#x51FA;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x660E;&#x786E;&#x63D0;&#x51FA;&#x3002;</span>
<span class="token comment">// &#x9690;&#x55BB;&#x65B9;&#x5F0F;&#x662F;&#x5C06;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E8E; class &#x5B9A;&#x4E49;&#x5F0F;&#x5185;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">int</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> theAge<span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x4E00;&#x4E2A;&#x9690;&#x55BB;&#x5730; inline &#x7533;&#x8BF7;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// age &#x88AB;&#x5B9A;&#x4E49;&#x4E8E; class &#x5B9A;&#x4E49;&#x5F0F;&#x5185;&#x3002;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> theAge<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x901A;&#x5E38;&#x662F;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x6761;&#x6B3E; 46 &#x8BF4; friend &#x51FD;&#x6570;&#x4E5F;&#x53EF;&#x88AB;&#x5B9A;&#x4E49;&#x4E8E; class &#x5185;&#xFF0C;</span>
<span class="token comment">// &#x5982;&#x679C;&#x771F;&#x662F;&#x90A3;&#x6837;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x662F;&#x88AB;&#x9690;&#x55BB;&#x58F0;&#x660E;&#x4E3A; inline&#x3002;</span>





<span class="token comment">// &#x660E;&#x786E;&#x58F0;&#x660E; inline &#x51FD;&#x6570;&#x7684;&#x505A;&#x6CD5;&#x5219;&#x662F;&#x5728;&#x5176;&#x5B9A;&#x4E49;&#x5F0F;&#x524D;&#x52A0;&#x4E0A;&#x5173;&#x952E;&#x5B57; inline&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x6807;&#x51C6;&#x7684; max template&#xFF08;&#x6765;&#x81EA; &lt;algorithm&gt;&#xFF09;&#x5F80;&#x5F80;&#x8FD9;&#x6837;&#x5B9E;&#x73B0;&#x51FA;&#x6765;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>                                <span class="token comment">// &#x660E;&#x786E;&#x7533;&#x8BF7; inline&#xFF1A;</span>
<span class="token keyword">inline</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span> b<span class="token punctuation">)</span>    <span class="token comment">// std::max &#x4E4B;&#x524D;&#x6709;</span>
<span class="token punctuation">{</span> <span class="token keyword">return</span> a <span class="token operator">&lt;</span> b <span class="token operator">?</span> b <span class="token operator">:</span> a<span class="token punctuation">;</span> <span class="token punctuation">}</span>                           <span class="token comment">// &#x5173;&#x952E;&#x5B57; &quot;inline&quot;</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x53D1;&#x73B0; inline &#x51FD;&#x6570;&#x548C; templates &#x4E24;&#x8005;&#x901A;&#x5E38;&#x90FD;&#x88AB;&#x5B9A;&#x4E49;&#x4E8E;&#x5934;&#x6587;&#x4EF6;&#x5185;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4F7F;&#x5F97;&#x67D0;&#x4E9B;&#x7A0B;&#x5E8F;&#x5458;&#x4EE5;&#x4E3A; function templates &#x4E00;&#x5B9A;&#x5FC5;&#x987B;&#x662F; inline&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x7ED3;&#x8BBA;&#x4E0D;&#x4F46;&#x65E0;&#x6548;&#x800C;&#x4E14;&#x53EF;&#x80FD;&#x6709;&#x5BB3;&#xFF0C;&#x503C;&#x5F97;&#x6DF1;&#x5165;&#x770B;&#x4E00;&#x770B;&#x3002;</span>





<span class="token comment">// Template &#x7684;&#x5177;&#x73B0;&#x5316;&#x4E0E; inlining &#x65E0;&#x5173;&#x3002;&#x5982;&#x679C;&#x4F60;&#x6B63;&#x5728;&#x5199;&#x4E00;&#x4E2A; template</span>
<span class="token comment">// &#x800C;&#x4F60;&#x8BA4;&#x4E3A;&#x6240;&#x6709;&#x6839;&#x636E;&#x6B64; template &#x5177;&#x73B0;&#x51FA;&#x6765;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x5E94;&#x8BE5; inlined&#xFF0C;&#x8BF7;&#x5C06;</span>
<span class="token comment">// &#x6B64; template &#x58F0;&#x660E;&#x4E3A; inline&#xFF1B;&#x8FD9;&#x5C31;&#x662F;&#x4E0A;&#x8FF0; std::max &#x4EE3;&#x7801;&#x7684;&#x4F5C;&#x4E3A;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x5982;&#x679C;&#x4F60;&#x5199;&#x7684; templates &#x6CA1;&#x6709;&#x7406;&#x7531;&#x8981;&#x6C42;&#x5B83;&#x6240;&#x5177;&#x73B0;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x662F;</span>
<span class="token comment">// inlined&#xFF0C;&#x5C31;&#x5E94;&#x8BE5;&#x907F;&#x514D;&#x5C06;&#x8FD9;&#x4E2A; template &#x58F0;&#x660E;&#x4E3A; inline&#xFF08;&#x4E0D;&#x8BBA;&#x663E;&#x5F0F;&#x6216;&#x9690;&#x5F0F;&#xFF09;&#x3002;</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x5047;&#x8BBE;&#x7F16;&#x8BD1;&#x5668;&#x6709;&#x610F;&#x613F; inline &#x201C;&#x5BF9; f &#x7684;&#x8C03;&#x7528;&#x201D;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>pf<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> f<span class="token punctuation">;</span>           <span class="token comment">// pf &#x6307;&#x5411; f</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x5C06;&#x88AB; inlined&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x8C03;&#x7528;&#x3002;</span>
<span class="token function">pf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x6216;&#x8BB8;&#x4E0D;&#x88AB; inlined&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x901A;&#x8FC7;&#x51FD;&#x6570;&#x6307;&#x9488;&#x8FBE;&#x6210;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string bm1<span class="token punctuation">,</span> bm2<span class="token punctuation">;</span>           <span class="token comment">// base &#x6210;&#x5458; 1 &#x548C; 2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                    <span class="token comment">// Derived &#x6784;&#x9020;&#x51FD;&#x6570;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x54E6;&#xFF0C;&#x662F;&#x5417;&#xFF1F;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string dm1<span class="token punctuation">,</span> dm2<span class="token punctuation">,</span> dm3<span class="token punctuation">;</span>      <span class="token comment">// derived &#x6210;&#x5458; 1 - 3</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x4E3A;&#x7A0D;&#x65E9;&#x8BF4;&#x7684;&#x90A3;&#x4E2A;&#x8868;&#x9762;&#x4E0A;&#x770B;&#x8D77;&#x6765;&#x4E3A;&#x7A7A;&#x7684; Derived &#x6784;&#x9020;&#x51FD;&#x6570;&#x6240;&#x4EA7;</span>
<span class="token comment">// &#x751F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4EE5;&#x4E0B;&#x6240;&#x5217;&#xFF1A;</span>
Derived<span class="token operator">::</span><span class="token function">Derived</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token comment">// &#x201C;&#x7A7A;&#x767D; Derived &#x6784;&#x9020;&#x51FD;&#x6570;&#x201D;&#x7684;&#x89C2;&#x5FF5;&#x6027;&#x5B9E;&#x73B0;</span>
<span class="token punctuation">{</span>
    Base<span class="token operator">::</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x201C;Base &#x6210;&#x5206;&#x201D;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span> dm1<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x8BD5;&#x56FE;&#x6784;&#x9020; dm1&#x3002;</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                           <span class="token comment">// &#x5982;&#x679C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x5C31;</span>
        Base<span class="token operator">::</span><span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x9500;&#x6BC1; base class &#x6210;&#x5206;&#xFF0C;&#x5E76;</span>
        <span class="token keyword">throw</span><span class="token punctuation">;</span>                              <span class="token comment">// &#x4F20;&#x64AD;&#x8BE5;&#x5F02;&#x5E38;&#x3002;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span> dm2<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x8BD5;&#x56FE;&#x6784;&#x9020; dm1&#x3002;</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                           <span class="token comment">// &#x5982;&#x679C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x5C31;</span>
        dm1<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x9500;&#x6BC1; dm1&#xFF0C;</span>
        Base<span class="token operator">::</span><span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x9500;&#x6BC1; base class &#x6210;&#x5206;&#xFF0C;&#x5E76;</span>
        <span class="token keyword">throw</span><span class="token punctuation">;</span>                              <span class="token comment">// &#x4F20;&#x64AD;&#x8BE5;&#x5F02;&#x5E38;&#x3002;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span> dm3<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x8BD5;&#x56FE;&#x6784;&#x9020; dm1&#x3002;</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                           <span class="token comment">// &#x5982;&#x679C;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x5C31;</span>
        dm2<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x9500;&#x6BC1; dm2&#xFF0C;</span>
        dm1<span class="token punctuation">.</span>std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x9500;&#x6BC1; dm1&#xFF0C;</span>
        Base<span class="token operator">::</span><span class="token operator">~</span><span class="token function">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x9500;&#x6BC1; base class &#x6210;&#x5206;&#xFF0C;&#x5E76;</span>
        <span class="token keyword">throw</span><span class="token punctuation">;</span>                              <span class="token comment">// &#x4F20;&#x64AD;&#x8BE5;&#x5F02;&#x5E38;&#x3002;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-31%E5%B0%86%E6%96%87%E4%BB%B6%E9%97%B4%E7%9A%84%E7%BC%96%E8%AF%91%E4%BE%9D%E5%AD%98%E5%85%B3%E7%B3%BB%E9%99%8D%E8%87%B3%E6%9C%80%E4%BD%8E">&#x6761;&#x6B3E; 31&#xFF1A;&#x5C06;&#x6587;&#x4EF6;&#x95F4;&#x7684;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x5173;&#x7CFB;&#x964D;&#x81F3;&#x6700;&#x4F4E;</h3>

<ul>
<li>&#x652F;&#x6301;&#x201C;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x6027;&#x6700;&#x5C0F;&#x5316;&#x201D;&#x7684;&#x4E00;&#x822C;&#x6784;&#x60F3;&#x662F;&#xFF1A;&#x76F8;&#x4F9D;&#x4E8E;&#x58F0;&#x660E;&#x5F0F;&#xFF0C;&#x4E0D;&#x8981;&#x76F8;&#x4F9D;&#x4E8E;&#x5B9A;&#x4E49;&#x5F0F;&#x3002;&#x57FA;&#x4E8E;&#x6B64;&#x6784;&#x60F3;&#x7684;&#x4E24;&#x4E2A;&#x624B;&#x6BB5;&#x662F; Handle classes &#x548C; Interface classes&#x3002;</li>
<li>&#x7A0B;&#x5E8F;&#x5E93;&#x5934;&#x6587;&#x4EF6;&#x5E94;&#x8BE5;&#x4EE5;&#x201C;&#x5B8C;&#x5168;&#x4E14;&#x4EC5;&#x6709;&#x58F0;&#x660E;&#x5F0F;&#x201D;&#xFF08;full and declaration-only forms&#xFF09;&#x7684;&#x5F62;&#x5F0F;&#x5B58;&#x5728;&#x3002;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4E0D;&#x8BBA;&#x662F;&#x5426;&#x6D89;&#x53CA; templates &#x90FD;&#x9002;&#x7528;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
           <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">addres</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string theName<span class="token punctuation">;</span>        <span class="token comment">// &#x5B9E;&#x73B0;&#x7EC6;&#x76EE;</span>
    Date theBirthDate<span class="token punctuation">;</span>          <span class="token comment">// &#x5B9E;&#x73B0;&#x7EC6;&#x76EE;</span>
    Address theAddress<span class="token punctuation">;</span>         <span class="token comment">// &#x5B9E;&#x73B0;&#x7EC6;&#x76EE;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x91CC;&#x7684; class Person &#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x2014;&#x2014;&#x5982;&#x679C;&#x7F16;&#x8BD1;&#x5668;&#x6CA1;&#x6709;&#x53D6;&#x5F97;&#x5176;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x6240;&#x7528;&#x5230;&#x7684;</span>
<span class="token comment">// class string&#xFF0C;Date &#x548C; Address &#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#x901A;&#x5E38;&#x7531; #include</span>
<span class="token comment">// &#x6307;&#x793A;&#x7B26;&#x63D0;&#x4F9B;&#xFF0C;&#x6240;&#x4EE5; Person &#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x7684;&#x6700;&#x4E0A;&#x65B9;&#x5F88;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x8FD9;&#x6837;&#x7684;&#x4E1C;&#x897F;&#xFF1A;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;date.h&quot;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;address.h&quot;</span></span>
<span class="token comment">// &#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E48;&#x4E00;&#x6765;&#x4FBF;&#x662F;&#x5728; Person &#x5B9A;&#x4E49;&#x6587;&#x4EF6;&#x548C;&#x5176;&#x542B;&#x5165;&#x6587;&#x4EF6;&#x4E4B;&#x95F4;&#x5F62;&#x6210;&#x4E86;</span>
<span class="token comment">// &#x4E00;&#x79CD;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x5173;&#x7CFB;&#xFF08;compilation dependency&#xFF09;&#x3002;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x5934;&#x6587;&#x4EF6;&#x4E2D;</span>
<span class="token comment">// &#x6709;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x88AB;&#x6539;&#x53D8;&#xFF0C;&#x6216;&#x8FD9;&#x4E9B;&#x5934;&#x6587;&#x4EF6;&#x6240;&#x4F9D;&#x8D56;&#x7684;&#x5176;&#x4ED6;&#x5934;&#x6587;&#x4EF6;&#x6709;&#x4EFB;&#x4F55;&#x6539;&#x53D8;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x6BCF;&#x4E00;&#x4E2A;&#x542B;&#x5165; Person class &#x7684;&#x6587;&#x4EF6;&#x5C31;&#x5F97;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#xFF0C;&#x4EFB;&#x4F55;&#x4F7F;&#x7528;</span>
<span class="token comment">// Person class &#x7684;&#x6587;&#x4EF6;&#x4E5F;&#x5FC5;&#x987B;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x8FDE;&#x4E32;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x5173;&#x7CFB;</span>
<span class="token comment">// &#xFF08;cascading compilation dependencies&#xFF09;&#x4F1A;&#x5BF9;&#x8BB8;&#x591A;&#x9879;&#x76EE;&#x9020;&#x6210;&#x96BE;&#x4EE5;</span>
<span class="token comment">// &#x5F62;&#x5BB9;&#x7684;&#x707E;&#x96BE;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48; C++ &#x575A;&#x6301;&#x5C06; class &#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x76EE;&#x7F6E;&#x4E8E; class &#x5B9A;&#x4E49;&#x5F0F;&#x4E2D;&#xFF1F;</span>
<span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x8FD9;&#x6837;&#x5B9A;&#x4E49; Person&#xFF0C;&#x5C06;&#x5B9E;&#x73B0;&#x7EC6;&#x76EE;&#x5206;&#x5F00;&#x53D9;&#x8FF0;&#xFF1F;</span>
<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">string</span><span class="token punctuation">;</span>           <span class="token comment">// &#x524D;&#x7F6E;&#x58F0;&#x660E;&#xFF08;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x8BE6;&#x4E0B;&#xFF09;</span>
<span class="token punctuation">}</span>                           <span class="token comment">//</span>
<span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x524D;&#x7F6E;&#x58F0;&#x660E;</span>
<span class="token keyword">class</span> <span class="token class-name">Address</span><span class="token punctuation">;</span>              <span class="token comment">// &#x524D;&#x7F6E;&#x58F0;&#x660E;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
           <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7B2C;&#x4E00;&#xFF0C;string &#x4E0D;&#x662F;&#x4E2A; class&#xFF0C;&#x5B83;&#x662F;&#x4E2A; typedef&#xFF08;&#x5B9A;&#x4E49;&#x4E3A; basic_string&lt;char&gt;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x4E0A;&#x8FF0;&#x9488;&#x5BF9; string &#x800C;&#x505A;&#x7684;&#x524D;&#x7F6E;&#x58F0;&#x660E;&#x5E76;&#x4E0D;&#x6B63;&#x786E;&#x3002;</span>

<span class="token comment">// &#x5173;&#x4E8E;&#x201C;&#x524D;&#x7F6E;&#x58F0;&#x660E;&#x6BCF;&#x4E00;&#x4EF6;&#x4E1C;&#x897F;&#x201D;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#xFF08;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#xFF09;&#x56F0;&#x96BE;&#x7684;&#x662F;&#xFF0C;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x5FC5;&#x987B;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x77E5;&#x9053;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x8003;&#x8651;&#x8FD9;&#x4E2A;&#xFF1A;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>                  <span class="token comment">// &#x5B9A;&#x4E49;&#x4E00;&#x4E2A; int</span>
    Person <span class="token function">p</span><span class="token punctuation">(</span> params <span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x5B9A;&#x4E49;&#x4E00;&#x4E2A; Person</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x5C06;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x89C6;&#x540C;&#x8FD9;&#x6837;&#x5B50;&#xFF1A;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>              <span class="token comment">// &#x5B9A;&#x4E49;&#x4E00;&#x4E2A; int</span>
    Person<span class="token operator">*</span> p<span class="token punctuation">;</span>          <span class="token comment">// &#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411; Person &#x5BF9;&#x8C61;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x9488;&#x5BF9; Person &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</span>
<span class="token comment">// &#x628A; Person &#x5206;&#x5272;&#x4E3A;&#x4E24;&#x4E2A; classes&#xFF0C;&#x4E00;&#x4E2A;&#x53EA;&#x63D0;&#x4F9B;&#x63A5;&#x53E3;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x8D1F;&#x8D23;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x8D1F;&#x8D23;&#x5B9E;&#x73B0;&#x7684;&#x90A3;&#x4E2A;&#x6240;&#x8C13; implementation class &#x53D6;&#x540D;&#x4E3A; PersonImpl&#xFF0C;</span>
<span class="token comment">// Person &#x5C06;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span>           </span><span class="token comment">// &#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x7EC4;&#x4EF6;&#x4E0D;&#x8BE5;&#x88AB;&#x524D;&#x7F6E;&#x58F0;&#x660E;&#x3002;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span>           </span><span class="token comment">// &#x6B64;&#x4E43;&#x4E3A;&#x4E86; tr1::shared_ptr &#x800C;&#x542B;&#x5165;&#xFF1B;&#x8BE6;&#x540E;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">PersonImpl</span><span class="token punctuation">;</span>           <span class="token comment">// Person &#x5B9E;&#x73B0;&#x7C7B;&#x7684;&#x524D;&#x7F6E;&#x58F0;&#x660E;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>                 <span class="token comment">// Person &#x63A5;&#x53E3;&#x7528;&#x5230;&#x7684; classes &#x7684;&#x524D;&#x7F6E;&#x58F0;&#x660E;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Address</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
           <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>string <span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>PersonImpl<span class="token operator">&gt;</span> pImpl<span class="token punctuation">;</span>     <span class="token comment">// &#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x5B9E;&#x73B0;&#x7269;&#xFF1B;</span>
                                                <span class="token comment">// std::tr1::shared_ptr &#x89C1;&#x6761;&#x6B3E; 13.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5728;&#x8FD9;&#x91CC;&#xFF0C;main class&#xFF08;Person&#xFF09;&#x53EA;&#x5185;&#x542B;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6210;&#x5458;</span>
<span class="token comment">// &#xFF08;&#x8FD9;&#x91CC;&#x4F7F;&#x7528; tr1::shared_ptr&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 13&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6307;&#x5411;&#x5176;&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;PersonImpl&#xFF09;&#x3002;&#x8FD9;&#x822C;&#x8BBE;&#x8BA1;&#x5E38;&#x88AB;&#x79F0;&#x4E3A; pimpl idiom</span>
<span class="token comment">// &#xFF08;pimpl &#x662F; &#x201C;pointer to implementation&#x201D; &#x7684;&#x7F29;&#x5199;&#xFF09;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x4E4B;&#x4E0B;&#xFF0C;Person &#x7684;&#x5BA2;&#x6237;&#x5C31;&#x5B8C;&#x5168;&#x4E0E; Dates&#xFF0C;Addresses &#x4EE5;&#x53CA; Persons</span>
<span class="token comment">// &#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x76EE;&#x5206;&#x79BB;&#x4E86;&#x3002;&#x90A3;&#x4E9B; classes &#x7684;&#x4EFB;&#x4F55;&#x5B9E;&#x73B0;&#x4FEE;&#x6539;&#x90FD;&#x4E0D;&#x9700;&#x8981; Person &#x5BA2;&#x6237;&#x7AEF;</span>
<span class="token comment">// &#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;&#x6B64;&#x5916;&#x7531;&#x4E8E;&#x5BA2;&#x6237;&#x65E0;&#x6CD5;&#x770B;&#x5230; Person &#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x76EE;&#xFF0C;&#x4E5F;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;</span>
<span class="token comment">// &#x5199;&#x51FA;&#x4EC0;&#x4E48;&#x201C;&#x53D6;&#x51B3;&#x4E8E;&#x90A3;&#x4E9B;&#x7EC6;&#x76EE;&#x201D;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x771F;&#x6B63;&#x662F;&#x201C;&#x63A5;&#x53E3;&#x4E0E;&#x5B9E;&#x73B0;&#x5206;&#x79BB;&#x201D;&#xFF01;</span>





<span class="token comment">// &#x8BBE;&#x8BA1;&#x7B56;&#x7565;&#xFF1A;</span>

<span class="token comment">// 1&#x3001;&#x5982;&#x679C;&#x4F7F;&#x7528; object references &#x6216; object pointers &#x53EF;&#x4EE5;&#x5B8C;&#x6210;&#x4EFB;&#x52A1;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x4E0D;&#x8981;&#x4F7F;&#x7528; objects&#x3002;</span>

<span class="token comment">// 2&#x3001;&#x5982;&#x679C;&#x80FD;&#x591F;&#xFF0C;&#x5C3D;&#x91CF;&#x4EE5; class &#x58F0;&#x660E;&#x5F0F;&#x66FF;&#x6362; class &#x5B9A;&#x4E49;&#x5F0F;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">;</span>                         <span class="token comment">// class &#x58F0;&#x660E;&#x5F0F;&#x3002;</span>
Date <span class="token function">today</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x6CA1;&#x95EE;&#x9898; &#x2014;&#x2014; &#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x9700;&#x8981;</span>
<span class="token keyword">void</span> <span class="token function">clearAppointments</span><span class="token punctuation">(</span>Date d<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Date &#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#x3002;</span>

<span class="token comment">// 3&#x3001;&#x4E3A;&#x58F0;&#x660E;&#x5F0F;&#x548C;&#x5B9A;&#x4E49;&#x5F0F;&#x63D0;&#x4F9B;&#x4E0D;&#x540C;&#x7684;&#x5934;&#x6587;&#x4EF6;&#x3002;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;datefwd.h&quot;</span>                </span><span class="token comment">// &#x8FD9;&#x4E2A;&#x5934;&#x6587;&#x4EF6;&#x58F0;&#x660E;&#xFF08;&#x4F46;&#x4E3A;&#x5B9A;&#x4E49;&#xFF09;class Date&#x3002;</span>
Date <span class="token function">today</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x540C;&#x524D;&#x3002;</span>
<span class="token keyword">void</span> <span class="token function">clearAppointments</span><span class="token punctuation">(</span>Date d<span class="token punctuation">)</span><span class="token punctuation">;</span>





<span class="token comment">// &#x50CF; Person &#x8FD9;&#x6837;&#x4F7F;&#x7528; pimpl idiom &#x7684; classes&#xFF0C;&#x5F80;&#x5F80;&#x88AB;&#x79F0;&#x4E3A; Handle classes&#x3002;</span>
<span class="token comment">// &#x529E;&#x6CD5;&#x4E4B;&#x4E00;&#x662F;&#x5C06;&#x5B83;&#x4EEC;&#x7684;&#x6240;&#x6709;&#x51FD;&#x6570;&#x8F6C;&#x4EA4;&#x7ED9;&#x76F8;&#x5E94;&#x7684;&#x5B9E;&#x73B0;&#x7C7B;&#xFF08;implementation classes&#xFF09;</span>
<span class="token comment">// &#x5E76;&#x7531;&#x540E;&#x8005;&#x5B8C;&#x6210;&#x5B9E;&#x9645;&#x5DE5;&#x4F5C;&#x3002;&#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x662F; Person &#x4E24;&#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;Person.h&quot;</span>         </span><span class="token comment">// &#x6211;&#x4EEC;&#x6B63;&#x5728;&#x5B9E;&#x73B0; Person class&#xFF0C;</span>
                            <span class="token comment">// &#x6240;&#x4EE5;&#x5FC5;&#x987B; #include &#x5176; class &#x5B9A;&#x4E49;&#x5F0F;&#x3002;</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&quot;PersonImpl.h&quot;</span>     </span><span class="token comment">// &#x6211;&#x4EEC;&#x4E5F;&#x5FC5;&#x987B; #include PersonImpl &#x7684;</span>
                            <span class="token comment">// class &#x5B9A;&#x4E49;&#x5F0F;&#xFF0C;&#x5426;&#x5219;&#x65E0;&#x6CD5;&#x8C03;&#x7528;&#x5176;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF1B;</span>
                            <span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;PersonImpl &#x6709;&#x7740;&#x548C; Person</span>
                            <span class="token comment">// &#x5B8C;&#x5168;&#x76F8;&#x540C;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x4E24;&#x8005;&#x63A5;&#x53E3;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</span>
Person<span class="token operator">::</span><span class="token function">Person</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
               <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">pImpl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">PersonImpl</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> birthday<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span>

std<span class="token operator">::</span>string Person<span class="token operator">::</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> pImpl<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;Person &#x6784;&#x9020;&#x51FD;&#x6570;&#x4EE5; new&#xFF08;&#x89C1;&#x6761;&#x6B3E; 16&#xFF09;&#x8C03;&#x7528; PersonImpl &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x4EE5;&#x53CA; Person::name &#x51FD;&#x6570;&#x5185;&#x8C03;&#x7528; PersonImpl::name&#x3002;&#x8FD9;&#x662F;&#x91CD;&#x8981;&#x7684;&#xFF0C;</span>
<span class="token comment">// &#x8BA9; Person &#x53D8;&#x6210;&#x4E00;&#x4E2A; Handle class &#x5E76;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x5B83;&#x505A;&#x7684;&#x4E8B;&#xFF0C;&#x53EA;&#x4F1A;</span>
<span class="token comment">// &#x6539;&#x53D8;&#x5B83;&#x505A;&#x4E8B;&#x7684;&#x65B9;&#x6CD5;&#x3002;</span>





<span class="token comment">// &#x53E6;&#x4E00;&#x4E2A;&#x5236;&#x4F5C; Handle class &#x7684;&#x529E;&#x6CD5;&#x662F;&#xFF0C;&#x4EE4; Person &#x6210;&#x4E3A;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x7684;</span>
<span class="token comment">// abstract base class&#xFF08;&#x62BD;&#x8C61;&#x57FA;&#x7C7B;&#xFF09;&#xFF0C;&#x79F0;&#x4E3A; Interface class&#x3002;&#x8FD9;&#x79CD;</span>
<span class="token comment">// class &#x7684;&#x76EE;&#x7684;&#x662F;&#x8BE6;&#x7EC6;&#x4E00;&#x4E00;&#x63CF;&#x8FF0; derived classes &#x7684;&#x63A5;&#x53E3;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 34&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x5B83;&#x901A;&#x5E38;&#x4E0D;&#x5E26;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x53EA;&#x6709;&#x4E00;&#x4E2A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;</span>
<span class="token comment">// &#xFF08;&#x89C1;&#x6761;&#x6B3E; 7&#xFF09;&#x4EE5;&#x53CA;&#x4E00;&#x7EC4; pure virtual &#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x53D9;&#x8FF0;&#x6574;&#x4E2A;&#x63A5;&#x53E3;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A; class &#x7684;&#x5BA2;&#x6237;&#x5FC5;&#x987B;&#x4EE5; Person &#x7684; pointers &#x548C; references &#x6765;</span>
<span class="token comment">// &#x64B0;&#x5199;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4E0D;&#x53EF;&#x80FD;&#x9488;&#x5BF9;&#x201C;&#x5185;&#x542B; pure virtual &#x51FD;&#x6570;&#x201D;&#x7684; Person classes</span>
<span class="token comment">// &#x5177;&#x73B0;&#x51FA;&#x5B9E;&#x4F53;&#x3002;&#xFF08;&#x7136;&#x800C;&#x5374;&#x6709;&#x53EF;&#x80FD;&#x5BF9;&#x6D3E;&#x751F;&#x81EA; Person &#x7684; classes &#x5177;&#x73B0;&#x51FA;&#x5B9E;&#x4F53;&#xFF0C;&#x8BE6;&#x4E0B;&#x3002;&#xFF09;</span>
<span class="token comment">// &#x5C31;&#x50CF; Handle classes &#x7684;&#x5BA2;&#x6237;&#x4E00;&#x6837;&#xFF0C;&#x9664;&#x975E; Interface class &#x7684;&#x63A5;&#x53E3;</span>
<span class="token comment">// &#x88AB;&#x4FEE;&#x6539;&#x5426;&#x5219;&#x5176;&#x5BA2;&#x6237;&#x4E0D;&#x9700;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span>     <span class="token comment">// &#x8FD4;&#x56DE;&#x4E00;&#x4E2A; tr1::shared_ptr&#xFF0C;&#x6307;&#x5411;</span>
        <span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span>     <span class="token comment">// &#x4E00;&#x4E2A;&#x65B0;&#x7684; Person&#xFF0C;&#x5E76;&#x4EE5;&#x7ED9;&#x5B9A;&#x4E4B;&#x53C2;&#x6570;</span>
               <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>        <span class="token comment">// &#x521D;&#x59CB;&#x5316;&#x3002;&#x6761;&#x6B3E; 18 &#x544A;&#x8BC9;&#x4F60;</span>
               <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x7684;&#x662F; tr1::shared_ptr</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5BA2;&#x6237;&#x4F1A;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x5B83;&#x4EEC;&#xFF1A;</span>

std<span class="token operator">::</span>string name<span class="token punctuation">;</span>
Date dateOfBirth<span class="token punctuation">;</span>
Address address<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x652F;&#x6301; Person &#x63A5;&#x53E3;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> <span class="token function">pp</span><span class="token punctuation">(</span>Person<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> dateOfBirth<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> pp<span class="token operator">-&gt;</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment">// &#x901A;&#x8FC7; Person &#x7684;&#x63A5;&#x53E3;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;</span>
          <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; was born on &quot;</span>
          <span class="token operator">&lt;&lt;</span> pp<span class="token operator">-&gt;</span><span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; and now lives at &quot;</span>
          <span class="token operator">&lt;&lt;</span> pp<span class="token operator">-&gt;</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x5F53; pp &#x79BB;&#x5F00;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;</span>
                                    <span class="token comment">// &#x5BF9;&#x8C61;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x5220;&#x9664;&#xFF0C;</span>
                                    <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 13&#x3002;</span>

<span class="token comment">// &#x5047;&#x8BBE; Interface class Person &#x6709;&#x4E2A;&#x5177;&#x8C61;&#x7684; derived class RealPerson&#xFF0C;</span>
<span class="token comment">// &#x540E;&#x8005;&#x63D0;&#x4F9B;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; virtual &#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">RealPerson</span> <span class="token operator">:</span> <span class="token keyword">public</span> Person <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">RealPerson</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span> <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
               <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">theName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">theBirthDate</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">theAddress</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">RealPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>           <span class="token comment">// &#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x7801;&#x5E76;&#x4E0D;&#x663E;&#x793A;&#x4E8E;&#x6B64;&#x3002;</span>
    std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4F46;&#x5B83;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x60F3;&#x8C61;&#x3002;</span>
    std<span class="token operator">::</span>string <span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string theName<span class="token punctuation">;</span>
    Date theBirthDate<span class="token punctuation">;</span>
    Address theAddress<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6709;&#x4E86; RealPerson &#x4E4B;&#x540E;&#xFF0C;&#x5199;&#x51FA; Person::create &#x5C31;&#x771F;&#x7684;&#x4E00;&#x70B9;&#x4E5F;&#x4E0D;&#x7A00;&#x5947;&#x4E86;&#xFF1A;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span> Person<span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">,</span>
                                            <span class="token keyword">const</span> Date<span class="token operator">&amp;</span> birthday<span class="token punctuation">,</span>
                                            <span class="token keyword">const</span> Address<span class="token operator">&amp;</span> addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> std<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">RealPerson</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> birthday<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// RealPerson &#x793A;&#x8303;&#x5B9E;&#x73B0; Interface class &#x7684;&#x4E24;&#x4E2A;&#x6700;&#x5E38;&#x89C1;&#x673A;&#x5236;&#x4E4B;&#x4E00;&#xFF1A;</span>
<span class="token comment">// &#x4ECE; Interface class&#xFF08;Person&#xFF09;&#x7EE7;&#x627F;&#x63A5;&#x53E3;&#x89C4;&#x683C;&#xFF0C;&#x7136;&#x540E;&#x5B9E;&#x73B0;&#x51FA;&#x63A5;&#x53E3;&#x6240;</span>
<span class="token comment">// &#x8986;&#x76D6;&#x7684;&#x51FD;&#x6570;&#x3002;Interface class &#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x5B9E;&#x73B0;&#x6CD5;&#x6D89;&#x53CA;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x662F;&#x6761;&#x6B3E; 40 &#x63A2;&#x7D22;&#x7684;&#x4E3B;&#x9898;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="6-%E7%BB%A7%E6%89%BF%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1">6&#x3001;&#x7EE7;&#x627F;&#x4E0E;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8BBE;&#x8BA1;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-32%E7%A1%AE%E5%AE%9A%E4%BD%A0%E7%9A%84-public-%E7%BB%A7%E6%89%BF%E5%A1%91%E6%A8%A1%E5%87%BA-is-a-%E5%85%B3%E7%B3%BB">&#x6761;&#x6B3E; 32&#xFF1A;&#x786E;&#x5B9A;&#x4F60;&#x7684; public &#x7EE7;&#x627F;&#x5851;&#x6A21;&#x51FA; is-a &#x5173;&#x7CFB;</h3>

<ul>
<li>&#x201C;public &#x7EE7;&#x627F;&#x201D;&#x610F;&#x5473; is-a&#x3002;&#x9002;&#x7528;&#x4E8E; base classes &#x8EAB;&#x4E0A;&#x7684;&#x6BCF;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x4E00;&#x5B9A;&#x4E5F;&#x9002;&#x7528;&#x4E8E; derived classes &#x8EAB;&#x4E0A;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A; derived class &#x5BF9;&#x8C61;&#x4E5F;&#x90FD;&#x662F;&#x4E00;&#x4E2A; base class &#x5BF9;&#x8C61;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x4EE5; C++ &#x8FDB;&#x884C;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#xFF0C;&#x6700;&#x91CD;&#x8981;&#x7684;&#x4E00;&#x4E2A;&#x89C4;&#x5219;&#x662F;&#xFF1A;</span>
<span class="token comment">// public inheritance&#xFF08;&#x516C;&#x5F00;&#x7EE7;&#x627F;&#xFF09;&#x610F;&#x5473;&#x201C;is-a&#x201D;&#xFF08;&#x662F;&#x4E00;&#x79CD;&#xFF09;&#x7684;&#x5173;&#x7CFB;&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x4EE4; class D&#xFF08;&#x201C;Derived&#x201D;&#xFF09;&#x4EE5; public &#x5F62;&#x5F0F;&#x7EE7;&#x627F; class B&#xFF08;&#x201C;Base&#x201D;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x4FBF;&#x662F;&#x544A;&#x8BC9; C++ &#x7F16;&#x8BD1;&#x5668;&#xFF08;&#x4EE5;&#x53CA;&#x4F60;&#x7684;&#x4EE3;&#x7801;&#x8BFB;&#x8005;&#xFF09;&#x8BF4;&#xFF0C;</span>
<span class="token comment">// &#x6BCF;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; D &#x7684;&#x5BF9;&#x8C61;&#x540C;&#x65F6;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; B &#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x53CD;&#x4E4B;&#x4E0D;&#x6210;&#x7ACB;&#x3002;</span>

<span class="token comment">// &#x4F60;&#x4E3B;&#x5F20;&#x201C;B &#x5BF9;&#x8C61;&#x53EF;&#x6D3E;&#x4E0A;&#x7528;&#x573A;&#x7684;&#x4EBA;&#x4EFB;&#x4F55;&#x5730;&#x65B9;&#xFF0C;D &#x5BF9;&#x8C61;&#x4E00;&#x6837;&#x53EF;&#x4EE5;&#x6D3E;&#x4E0A;&#x7528;&#x573A;&#x201D;</span>
<span class="token comment">// &#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x6B64;&#x5373;&#x6240;&#x8C13; Liskov Substitution Principle&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A; D &#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x4E00;&#x79CD;&#xFF08;&#x662F;&#x4E00;&#x4E2A;&#xFF09;B &#x5BF9;&#x8C61;&#x3002;&#x53CD;&#x4E4B;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x4E00;&#x4E2A; D &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// B &#x5BF9;&#x8C61;&#x65E0;&#x6CD5;&#x6548;&#x52B3;&#xFF0C;&#x56E0;&#x4E3A;&#x867D;&#x7136;&#x6BCF;&#x4E2A; D &#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x4E00;&#x4E2A; B &#x5BF9;&#x8C61;&#xFF0C;&#x53CD;&#x4E4B;&#x5E76;&#x4E0D;&#x6210;&#x7ACB;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token operator">:</span> <span class="token keyword">public</span> Person <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4EBA;&#x7684;&#x6982;&#x5FF5;&#x6BD4;&#x5B66;&#x751F;&#x66F4;&#x4E00;&#x822C;&#x5316;&#xFF0C;&#x5B66;&#x751F;&#x662F;&#x4EBA;&#x7684;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x5F62;&#x5F0F;&#x3002;</span>

<span class="token comment">// &#x5728; C++ &#x9886;&#x57DF;&#x4E2D;&#xFF0C;&#x4EFB;&#x4F55;&#x51FD;&#x6570;&#x5982;&#x679C;&#x671F;&#x671B;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; Person&#xFF08;&#x6216; pointer-to-Person</span>
<span class="token comment">// &#x6216; reference-to-Person&#xFF09;&#x7684;&#x5B9E;&#x53C2;&#xFF0C;&#x90FD;&#x4E5F;&#x613F;&#x610F;&#x63A5;&#x53D7;&#x4E00;&#x4E2A; Student &#x5BF9;&#x8C61;</span>
<span class="token comment">// &#xFF08;&#x6216; pointer-to-Student &#x6216; reference-to-Student&#xFF09;&#xFF1A;</span>

<span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token keyword">const</span> Person<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x4F1A;&#x5403;</span>
<span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token keyword">const</span> Student<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x53EA;&#x6709;&#x5B66;&#x751F;&#x624D;&#x5230;&#x6821;&#x5B66;&#x4E60;</span>
Person p<span class="token punctuation">;</span>                               <span class="token comment">// p &#x662F;&#x4EBA;</span>
Student s<span class="token punctuation">;</span>                              <span class="token comment">// s &#x662F;&#x5B66;&#x751F;</span>
<span class="token function">eat</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>                                 <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;p &#x662F;&#x4EBA;</span>
<span class="token function">eat</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                                 <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;s &#x662F;&#x5B66;&#x751F;&#xFF0C;&#x800C;&#x5B66;&#x751F;&#x4E5F;&#x662F;&#xFF08;is-a&#xFF09;&#x4EBA;</span>
<span class="token function">study</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;s &#x662F;&#x4E2A;&#x5B66;&#x751F;</span>
<span class="token function">study</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>                               <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;p &#x4E0D;&#x662F;&#x4E2A;&#x5B66;&#x751F;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBA;&#x70B9;&#x53EA;&#x5BF9; public &#x7EE7;&#x627F;&#x624D;&#x6210;&#x7ACB;&#x3002;&#x53EA;&#x6709;&#x5F53; Student &#x4EE5; public &#x5F62;&#x5F0F;&#x7EE7;&#x627F; Person&#xFF0C;</span>
<span class="token comment">// C++ &#x7684;&#x884C;&#x4E3A;&#x624D;&#x4F1A;&#x5982;&#x6211;&#x6240;&#x63CF;&#x8FF0;&#x3002;private &#x7EE7;&#x627F;&#x7684;&#x610F;&#x4E49;&#x4E0E;&#x6B64;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 39&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x81F3;&#x4E8E; protected &#x7EE7;&#x627F;&#xFF0C;&#x90A3;&#x662F;&#x4E00;&#x79CD;&#x5176;&#x610F;&#x4E49;&#x81F3;&#x4ECA;&#x4ECD;&#x7136;&#x56F0;&#x60D1;&#x6211;&#x7684;&#x4E1C;&#x897F;&#x3002;</span>





<span class="token comment">// public &#x7EE7;&#x627F;&#x548C; is-a &#x4E4B;&#x95F4;&#x7684;&#x7B49;&#x4EF7;&#x5173;&#x7CFB;&#x542C;&#x8D77;&#x6765;&#x9887;&#x4E3A;&#x7B80;&#x5355;&#xFF0C;&#x4F46;&#x6709;&#x65F6;&#x5019;&#x4F60;&#x7684;&#x76F4;&#x89C9;</span>
<span class="token comment">// &#x53EF;&#x80FD;&#x4F1A;&#x8BEF;&#x5BFC;&#x4F60;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x4F01;&#x9E45;&#xFF08;penguin&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x9E1F;&#xFF0C;&#x8FD9;&#x662F;&#x4E8B;&#x5B9E;&#x3002;&#x9E1F;&#x53EF;&#x4EE5;</span>
<span class="token comment">// &#x98DE;&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E8B;&#x5B9E;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x5929;&#x771F;&#x5730;&#x4EE5; C++ &#x63CF;&#x8FF0;&#x8FD9;&#x5C42;&#x5173;&#x7CFB;&#xFF0C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x9E1F;&#x53EF;&#x4EE5;&#x98DE;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Penguin</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bird <span class="token punctuation">{</span>       <span class="token comment">// &#x4F01;&#x9E45;&#x662F;&#x4E00;&#x79CD;&#x9E1F;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6CA1;&#x6709;&#x58F0;&#x660E; fly &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FlyingBird</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bird <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Penguin</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bird <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6CA1;&#x6709;&#x58F0;&#x660E; fly &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5373;&#x4FBF;&#x5982;&#x6B64;&#xFF0C;&#x6B64;&#x523B;&#x6211;&#x4EEC;&#x4ECD;&#x7136;&#x672A;&#x80FD;&#x5B8C;&#x5168;&#x5904;&#x7406;&#x597D;&#x8FD9;&#x4E9B;&#x9E1F;&#x4E8B;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9;&#x67D0;&#x4E9B;&#x8F6F;&#x4EF6;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;</span>
<span class="token comment">// &#x53EF;&#x80FD;&#x4E0D;&#x9700;&#x8981;&#x533A;&#x5206;&#x4F1A;&#x98DE;&#x7684;&#x9E1F;&#x548C;&#x4E0D;&#x4F1A;&#x98DE;&#x7684;&#x9E1F;&#x3002;&#x6240;&#x8C13;&#x6700;&#x4F73;&#x8BBE;&#x8BA1;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x7CFB;&#x7EDF;&#x5E0C;&#x671B;&#x505A;&#x4EC0;&#x4E48;</span>
<span class="token comment">// &#x4E8B;&#xFF0C;&#x5305;&#x62EC;&#x73B0;&#x5728;&#x4E0E;&#x672A;&#x6765;&#x3002;</span>





<span class="token comment">// &#x53E6;&#x6709;&#x4E00;&#x79CD;&#x601D;&#x60F3;&#x6D3E;&#x522B;&#x5904;&#x7406;&#x6211;&#x6240;&#x8C13;&#x201C;&#x6240;&#x6709;&#x7684;&#x9E1F;&#x90FD;&#x4F1A;&#x98DE;&#xFF0C;&#x4F01;&#x9E45;&#x662F;&#x9E1F;&#xFF0C;&#x4F46;&#x662F;&#x4F01;&#x9E45;&#x4E0D;&#x4F1A;&#x98DE;&#xFF0C;&#x5594;&#x5662;&#x201D;&#x7684;&#x95EE;&#x9898;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x662F;&#x4E3A;&#x4F01;&#x9E45;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; fly &#x51FD;&#x6570;&#xFF0C;&#x4EE4;&#x5B83;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x8FD0;&#x884C;&#x671F;&#x9519;&#x8BEF;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x5B9A;&#x4E49;&#x4E8E;&#x53E6;&#x5916;&#x67D0;&#x5904;</span>

<span class="token keyword">class</span> <span class="token class-name">Penguin</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bird <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Attempt to make a penguin fly!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5F88;&#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x8BA4;&#x77E5;&#x8FD9;&#x91CC;&#x6240;&#x8BF4;&#x7684;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x53EF;&#x80FD;&#x548C;&#x4F60;&#x6240;&#x60F3;&#x7684;&#x4E0D;&#x540C;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#x201C;&#x4F01;&#x9E45;&#x4E0D;&#x4F1A;&#x98DE;&#x201D;&#xFF0C;&#x800C;&#x662F;&#x8BF4;&#x201C;&#x4F01;&#x9E45;&#x4F1A;&#x98DE;&#xFF0C;&#x4F46;&#x5C1D;&#x8BD5;&#x90A3;&#x4E48;&#x505A;&#x4E8B;&#x4E00;&#x79CD;&#x9519;&#x8BEF;&#x201D;&#x3002;</span>
<span class="token comment">// &#x5982;&#x4F55;&#x63CF;&#x8FF0;&#x5176;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#xFF1F;&#x4ECE;&#x9519;&#x8BEF;&#x88AB;&#x4FA6;&#x6D4B;&#x51FA;&#x6765;&#x7684;&#x65F6;&#x95F4;&#x70B9;&#x89C2;&#x4E4B;&#xFF0C;&#x201C;&#x4F01;&#x9E45;&#x4E0D;&#x4F1A;&#x98DE;&#x201D;</span>
<span class="token comment">// &#x8FD9;&#x4E00;&#x9650;&#x5236;&#x53EF;&#x7531;&#x7F16;&#x8BD1;&#x5668;&#x5F3A;&#x5236;&#x5B9E;&#x65BD;&#xFF0C;&#x4F46;&#x82E5;&#x8FDD;&#x53CD;&#x201C;&#x4F01;&#x9E45;&#x5C1D;&#x8BD5;&#x98DE;&#x884C;&#xFF0C;&#x662F;&#x4E00;&#x79CD;&#x9519;&#x8BEF;&#x201D;&#x8FD9;&#x4E00;&#x6761;&#x89C4;&#x5219;&#xFF0C;</span>
<span class="token comment">// &#x53EA;&#x6709;&#x8FD0;&#x884C;&#x671F;&#x624D;&#x80FD;&#x68C0;&#x6D4B;&#x51FA;&#x6765;&#x3002;</span>





<span class="token comment">// &#x4E3A;&#x4E86;&#x8868;&#x73B0;&#x201C;&#x4F01;&#x9E45;&#x4E0D;&#x4F1A;&#x98DE;&#xFF0C;&#x5C31;&#x8FD9;&#x6837;&#x201D;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4F60;&#x4E0D;&#x53EF;&#x4EE5;&#x4E3A; Penguin &#x5B9A;&#x4E49; fly &#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Bird</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6CA1;&#x6709;&#x58F0;&#x660E; fly &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Penguin</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bird <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x6CA1;&#x6709;&#x58F0;&#x660E; fly &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x8BD5;&#x56FE;&#x8BA9;&#x4F01;&#x9E45;&#x98DE;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x5BF9;&#x4F60;&#x7684;&#x80CC;&#x4FE1;&#x52A0;&#x4EE5;&#x8C34;&#x8D23;&#xFF1A;</span>
Penguin p<span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>

<span class="token comment">// &#x6761;&#x6B3E; 18 &#x8BF4;&#x8FC7;&#xFF1A;&#x597D;&#x7684;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x65E0;&#x6548;&#x7684;&#x4EE3;&#x7801;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x56E0;&#x6B64;&#x4F60;&#x5E94;&#x8BE5;</span>
<span class="token comment">// &#x5B81;&#x53EF;&#x91C7;&#x53D6;&#x201C;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x62D2;&#x7EDD;&#x4F01;&#x9E45;&#x98DE;&#x884C;&#x201D;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x201C;&#x53EA;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x624D;&#x80FD;</span>
<span class="token comment">// &#x4FA6;&#x6D4B;&#x5B83;&#x4EEC;&#x201D;&#x7684;&#x8BBE;&#x8BA1;&#x3002;</span>





<span class="token comment">// class Square &#x5E94;&#x8BE5;&#x4EE5; public &#x5F62;&#x5F0F;&#x7EE7;&#x627F; class Rectangle &#x5417;&#xFF1F;</span>
<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token keyword">int</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">setWidth</span><span class="token punctuation">(</span><span class="token keyword">int</span> newWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>             <span class="token comment">// &#x8FD4;&#x56DE;&#x5F53;&#x524D;&#x503C;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">makeBigger</span><span class="token punctuation">(</span>Rectangle<span class="token operator">&amp;</span> r<span class="token punctuation">)</span>       <span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7528;&#x4EE5;&#x589E;&#x52A0; r &#x7684;&#x9762;&#x79EF;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> oldHeight <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    r<span class="token punctuation">.</span><span class="token function">setWidth</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// &#x4E3A; r &#x7684;&#x5BBD;&#x5EA6;&#x52A0; 10</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> oldHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x5224;&#x65AD; r &#x7684;&#x9AD8;&#x5EA6;&#x662F;&#x5426;&#x672A;&#x66FE;&#x6539;&#x53D8;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &#x663E;&#x7136;&#xFF0C;&#x4E0A;&#x8FF0;&#x7684; assert &#x7ED3;&#x679C;&#x6C38;&#x8FDC;&#x4E3A;&#x771F;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x4E3A; makeBigger &#x53EA;&#x6539;&#x53D8; r &#x7684;&#x5BBD;&#x5EA6;&#xFF1B;r &#x7684;&#x9AD8;&#x5EA6;&#x4ECE;&#x672A;&#x88AB;&#x66F4;&#x6539;&#x3002;</span>

<span class="token comment">// &#x73B0;&#x5728;&#x8003;&#x8651;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x4E2D;&#x4F7F;&#x7528; public &#x7EE7;&#x627F;&#xFF0C;&#x5141;&#x8BB8;&#x6B63;&#x65B9;&#x5F62;&#x88AB;&#x89C6;&#x4E3A;&#x4E00;&#x79CD;&#x77E9;&#x5F62;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Square</span> <span class="token operator">:</span> <span class="token keyword">public</span> Rectangle <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Square s<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">assert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> s<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x8FD9;&#x5BF9;&#x6240;&#x6709;&#x6B63;&#x65B9;&#x5F62;&#x4E00;&#x5B9A;&#x4E3A;&#x771F;&#x3002;</span>
<span class="token function">makeBigger</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                          <span class="token comment">// &#x7531;&#x4E8E;&#x7EE7;&#x627F;&#xFF0C;s &#x662F;&#x4E00;&#x79CD;&#xFF08;is-a&#xFF09;&#x77E9;&#x5F62;&#xFF0C;</span>
                                        <span class="token comment">// &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x589E;&#x52A0;&#x5176;&#x9762;&#x79EF;&#x3002;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> s<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x5BF9;&#x6240;&#x6709;&#x6B63;&#x65B9;&#x5F62;&#x5E94;&#x8BE5;&#x4ECD;&#x7136;&#x4E3A;&#x771F;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E5F;&#x5F88;&#x660E;&#x663E;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A; assert &#x7ED3;&#x679C;&#x4E5F;&#x5E94;&#x8BE5;&#x6C38;&#x8FDC;&#x4E3A;&#x771F;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x6839;&#x636E;&#x5B9A;&#x4E49;&#xFF0C;&#x6B63;&#x65B9;&#x5F62;&#x7684;&#x5BBD;&#x5EA6;&#x548C;&#x5176;&#x9AD8;&#x5EA6;&#x76F8;&#x540C;&#x3002;</span>

<span class="token comment">// &#x4F46;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x9047;&#x4E0A;&#x4E86;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x8C03;&#x89E3;&#x4E0B;&#x9762;&#x5404;&#x4E2A; assert &#x5224;&#x65AD;&#x5F0F;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x8C03;&#x7528; makeBigger &#x4E4B;&#x524D;&#xFF0C;s &#x7684;&#x9AD8;&#x5EA6;&#x548C;&#x5BBD;&#x5EA6;&#x76F8;&#x540C;&#xFF1B;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x5728; makeBigger &#x51FD;&#x6570;&#x5185;&#xFF0C;s &#x7684;&#x5BBD;&#x5EA6;&#x6539;&#x53D8;&#xFF0C;&#x4F46;&#x9AD8;&#x5EA6;&#x4E0D;&#x53D8;&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;makeBigger &#x8FD4;&#x56DE;&#x4E4B;&#x540E;&#xFF0C;s &#x7684;&#x9AD8;&#x5EA6;&#x518D;&#x5EA6;&#x548C;&#x5176;&#x5BBD;&#x5EA6;&#x76F8;&#x540C;&#x3002;</span>
<span class="token comment">// &#xFF08;&#x6CE8;&#x610F; s &#x662F;&#x4EE5; by reference &#x65B9;&#x5F0F;&#x4F20;&#x7ED9; makeBigger&#xFF0C;&#x6240;&#x4EE5;</span>
<span class="token comment">// makeBigger &#x4FEE;&#x6539;&#x7684;&#x662F; s &#x81EA;&#x8EAB;&#xFF0C;&#x4E0D;&#x662F; s &#x7684;&#x526F;&#x672C;&#x3002;&#xFF09;</span>





<span class="token comment">// is-a &#x5E76;&#x975E;&#x662F;&#x552F;&#x4E00;&#x5B58;&#x5728;&#x4E8E; classes &#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x53E6;&#x4E24;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x5173;&#x7CFB;&#x662F;</span>
<span class="token comment">// has-a&#xFF08;&#x6709;&#x4E00;&#x4E2A;&#xFF09;&#x548C; is-implemented-in-terms-of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-33%E9%81%BF%E5%85%8D%E9%81%AE%E6%8E%A9%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0">&#x6761;&#x6B3E; 33&#xFF1A;&#x907F;&#x514D;&#x906E;&#x63A9;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x540D;&#x79F0;</h3>

<ul>
<li>derived classes &#x5185;&#x7684;&#x540D;&#x79F0;&#x4F1A;&#x906E;&#x63A9; base classes &#x5185;&#x7684;&#x540D;&#x79F0;&#x3002;&#x5728; public &#x7EE7;&#x627F;&#x4E0B;&#x4ECE;&#x6765;&#x6CA1;&#x6709;&#x4EBA;&#x5E0C;&#x671B;&#x5982;&#x6B64;&#x3002;</li>
<li>&#x4E3A;&#x4E86;&#x8BA9;&#x88AB;&#x906E;&#x63A9;&#x7684;&#x540D;&#x79F0;&#x518D;&#x89C1;&#x5929;&#x65E5;&#xFF0C;&#x53EF;&#x4F7F;&#x7528; using &#x58F0;&#x660E;&#x5F0F;&#x6216;&#x8F6C;&#x4EA4;&#x51FD;&#x6570;&#xFF08;forwarding functions&#xFF09;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">int</span> x<span class="token punctuation">;</span>                      <span class="token comment">// global &#x53D8;&#x91CF;</span>
<span class="token keyword">void</span> <span class="token function">someFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">double</span> x<span class="token punctuation">;</span>               <span class="token comment">// local &#x53D8;&#x91CF;</span>
    std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> x<span class="token punctuation">;</span>          <span class="token comment">// &#x8BFB;&#x4E00;&#x4E2A;&#x65B0;&#x503C;&#x8D4B;&#x4E88; local &#x53D8;&#x91CF; x</span>
<span class="token punctuation">}</span>





<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Base &#x7684;&#x4F5C;&#x7528;&#x57DF;</span>
<span class="token comment">// x&#xFF08;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf2&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf3&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>

<span class="token comment">// Derived &#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x88AB; Base &#x4F5C;&#x7528;&#x57DF;&#x5305;&#x542B;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf4&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>





<span class="token keyword">void</span> Derived<span class="token operator">::</span><span class="token function">mf4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5F53;&#x7F16;&#x8BD1;&#x5668;&#x770B;&#x5230;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x540D;&#x79F0; mf2&#xFF0C;&#x5FC5;&#x987B;&#x4F30;&#x7B97;&#x5B83;&#x6307;&#x6D89;&#xFF08;refer to&#xFF09;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x3002;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x67E5;&#x627E;&#x5404;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x770B;&#x770B;&#x6709;&#x6CA1;&#x6709;&#x67D0;&#x4E2A;&#x540D;&#x4E3A; mf2 &#x7684;&#x58F0;&#x660E;&#x5F0F;&#x3002;</span>
<span class="token comment">// &#x9996;&#x5148;&#x67E5;&#x627E; local &#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x4E5F;&#x5C31;&#x662F; mf4 &#x8986;&#x76D6;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF09;&#xFF0C;&#x5728;&#x90A3;&#x513F;&#x6CA1;&#x627E;&#x5230;</span>
<span class="token comment">// &#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x540D;&#x4E3A; mf2&#x3002;&#x4E8E;&#x662F;&#x67E5;&#x627E;&#x5176;&#x5916;&#x56F4;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F; class Derived &#x8986;&#x76D6;&#x7684;</span>
<span class="token comment">// &#x4F5C;&#x7528;&#x57DF;&#x3002;&#x8FD8;&#x662F;&#x6CA1;&#x627E;&#x5230;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x540D;&#x4E3A; mf2&#xFF0C;&#x4E8E;&#x662F;&#x518D;&#x5F80;&#x5916;&#x56F4;&#x79FB;&#x52A8;&#xFF0C;&#x672C;&#x4F8B;&#x4E3A;</span>
<span class="token comment">// base class&#x3002;&#x5728;&#x90A3;&#x513F;&#x7F16;&#x8BD1;&#x5668;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; mf2 &#x7684;&#x4E1C;&#x897F;&#x4E86;&#xFF0C;&#x4E8E;&#x662F;&#x505C;&#x6B62;&#x67E5;&#x627E;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; Base &#x5185;&#x8FD8;&#x662F;&#x6CA1;&#x6709; mf2&#xFF0C;&#x67E5;&#x627E;&#x52A8;&#x4F5C;&#x4FBF;&#x7EE7;&#x7EED;&#x4E0B;&#x53BB;&#xFF0C;&#x9996;&#x5148;&#x627E;&#x5185;&#x542B; Base &#x7684;</span>
<span class="token comment">// &#x90A3;&#x4E2A; namespace(s) &#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF09;&#xFF0C;&#x6700;&#x540E;&#x5F80; global &#x4F5C;&#x7528;&#x57DF;&#x627E;&#x53BB;&#x3002;</span>





<span class="token comment">// &#x8FD9;&#x6B21;&#x8BA9;&#x6211;&#x4EEC;&#x91CD;&#x8F7D; mf1 &#x548C; mf3&#xFF0C;&#x5E76;&#x4E14;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x65B0;&#x7248; mf3 &#x5230; Derived &#x53BB;&#x3002;</span>
<span class="token comment">// &#x5982;&#x6761;&#x6B3E; 36 &#x6240;&#x8BF4;&#xFF0C;&#x8FD9;&#x91CC;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x60C5;&#x662F;&#xFF1A;Derived &#x91CD;&#x8F7D;&#x4E86; mf3&#xFF0C;&#x90A3;&#x662F;&#x4E00;&#x4E2A;</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; non-virtual &#x51FD;&#x6570;&#x3002;&#x8FD9;&#x4F1A;&#x4F7F;&#x6574;&#x4E2A;&#x8BBE;&#x8BA1;&#x7ACB;&#x523B;&#x663E;&#x5F97;&#x7591;&#x4E91;&#x91CD;&#x91CD;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x4E3A;&#x4E86;&#x5145;&#x5206;&#x8BA4;&#x8BC6;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x5185;&#x7684;&#x201C;&#x540D;&#x79F0;&#x53EF;&#x89C6;&#x6027;&#x201D;&#xFF0C;&#x6211;&#x4EEC;&#x6682;&#x65F6;&#x5B89;&#x4E4B;&#x82E5;&#x7D20;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Base &#x7684;&#x4F5C;&#x7528;&#x57DF;</span>
<span class="token comment">// x&#xFF08;&#x6210;&#x5458;&#x53D8;&#x96F6;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf2&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf3&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>

<span class="token comment">// Derived &#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x88AB; Base &#x4F5C;&#x7528;&#x57DF;&#x5305;&#x542B;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf3&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf4&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>

<span class="token comment">// &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x5E26;&#x6765;&#x7684;&#x884C;&#x4E3A;&#x4F1A;&#x8BA9;&#x6BCF;&#x4E00;&#x4F4D;&#x7B2C;&#x4E00;&#x6B21;&#x9762;&#x5BF9;&#x5B83;&#x7684; C++ &#x7A0B;&#x5E8F;&#x5458;&#x5927;&#x5403;&#x4E00;&#x60CA;&#x3002;</span>
<span class="token comment">// &#x4EE5;&#x4F5C;&#x7528;&#x57DF;&#x4E3A;&#x57FA;&#x7840;&#x7684;&#x201C;&#x540D;&#x79F0;&#x906E;&#x63A9;&#x89C4;&#x5219;&#x201D;&#x5E76;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#xFF0C;&#x56E0;&#x6B64; base class</span>
<span class="token comment">// &#x5185;&#x6240;&#x6709;&#x540D;&#x4E3A; mf1 &#x548C; mf3 &#x7684;&#x51FD;&#x6570;&#x90FD;&#x88AB; derived class &#x5185;&#x7684; mf1 &#x548C;</span>
<span class="token comment">// mf3 &#x51FD;&#x6570;&#x906E;&#x63A9;&#x6389;&#x4E86;&#x3002;&#x4ECE;&#x540D;&#x79F0;&#x67E5;&#x627E;&#x89C2;&#x70B9;&#x6765;&#x770B;&#xFF0C;Base::mf1 &#x548C; Base::mf3</span>
<span class="token comment">// &#x4E0D;&#x518D;&#x88AB; Derived &#x7EE7;&#x627F;&#xFF01;</span>
Derived d<span class="token punctuation">;</span>
<span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x8C03;&#x7528; Derived::mf1</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x56E0;&#x4E3A; Derived::mf1 &#x906E;&#x63A9;&#x4E86; Base::mf1</span>
d<span class="token punctuation">.</span><span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x8C03;&#x7528; Base::mf2</span>
d<span class="token punctuation">.</span><span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x8C03;&#x7528; Derived::mf3</span>
d<span class="token punctuation">.</span><span class="token function">mf3</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x56E0;&#x4E3A; Derived::mf3 &#x906E;&#x63A9;&#x4E86; Base::mf3</span>

<span class="token comment">// &#x4E0A;&#x8FF0;&#x89C4;&#x5219;&#x90FD;&#x9002;&#x7528;&#xFF0C;&#x5373;&#x4F7F; base classes &#x548C; derived classes &#x5185;&#x7684;</span>
<span class="token comment">// &#x51FD;&#x6570;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x4E5F;&#x9002;&#x7528;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x8BBA;&#x51FD;&#x6570;&#x662F; virtual &#x6216; non-virtual &#x4E00;&#x4F53;&#x9002;&#x7528;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E9B;&#x884C;&#x4E3A;&#x80CC;&#x540E;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x4F60;&#x5728;&#x7A0B;&#x5E8F;&#x5E93;&#x6216;&#x5E94;&#x7528;&#x6846;&#x67B6;&#xFF08;application framework&#xFF09;</span>
<span class="token comment">// &#x5185;&#x5EFA;&#x7ACB;&#x65B0;&#x7684; derived class &#x65F6;&#x9644;&#x5E26;&#x5730;&#x4ECE;&#x758F;&#x8FDC;&#x7684; base classes &#x7EE7;&#x627F;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x4E0D;&#x5E78;&#x7684;&#x662F;&#x4F60;&#x901A;&#x5E38;&#x4F1A;&#x60F3;&#x7EE7;&#x627F;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x5982;&#x679C;&#x4F60;&#x6B63;&#x5728;&#x4F7F;&#x7528; public &#x7EE7;&#x627F;&#x800C;&#x53C8;&#x4E0D;&#x7EE7;</span>
<span class="token comment">// &#x627F;&#x90A3;&#x4E9B;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x662F;&#x8FDD;&#x53CD; base &#x548C; derived classes &#x4E4B;&#x95F4;&#x7684; is-a &#x5173;&#x7CFB;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x6761;&#x6B3E; 32 &#x8BF4;&#x8FC7; is-a &#x662F; public &#x7EE7;&#x627F;&#x7684;&#x57FA;&#x77F3;&#x3002;&#x56E0;&#x6B64;&#x4F60;&#x51E0;&#x4E4E;&#x603B;&#x4F1A;&#x60F3;&#x8981;&#x63A8;&#x7FFB;</span>
<span class="token comment">// &#xFF08;override&#xFF09;C++ &#x5BF9;&#x201C;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x540D;&#x79F0;&#x201D;&#x7684;&#x7F3A;&#x7701;&#x906E;&#x63A9;&#x884C;&#x4E3A;&#x3002;</span>

<span class="token comment">// &#x4F60;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; using &#x58F0;&#x660E;&#x5F0F;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">using</span> Base<span class="token operator">::</span>mf1<span class="token punctuation">;</span>        <span class="token comment">// &#x8BA9; Base class &#x5185;&#x540D;&#x4E3A; mf1 &#x548C; mf3 &#x7684;&#x6240;&#x6709;&#x4E1C;&#x897F;</span>
    <span class="token keyword">using</span> Base<span class="token operator">::</span>mf3<span class="token punctuation">;</span>        <span class="token comment">// &#x5728; Derived &#x4F5C;&#x7528;&#x57DF;&#x5185;&#x90FD;&#x53EF;&#x89C1;&#xFF08;&#x5E76;&#x4E14; public&#xFF09;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mf4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Base &#x7684;&#x4F5C;&#x7528;&#x57DF;</span>
<span class="token comment">// x&#xFF08;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf2&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf3&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>

<span class="token comment">// Derived &#x7684;&#x4F5C;&#x7528;&#x57DF;&#xFF08;&#x88AB; Base &#x4F5C;&#x7528;&#x57DF;&#x5305;&#x542B;&#xFF09;</span>
<span class="token comment">// mf1&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf3&#xFF08;2 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>
<span class="token comment">// mf4&#xFF08;1 &#x4E2A;&#x51FD;&#x6570;&#xFF09;</span>

<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x7EE7;&#x627F;&#x673A;&#x5236;&#x5C06;&#x4E00;&#x5982;&#x5F80;&#x6614;&#x5730;&#x8FD0;&#x4F5C;&#xFF1A;</span>

Derived d<span class="token punctuation">;</span>
<span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x4ECD;&#x7136;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x4ECD;&#x7136;&#x8C03;&#x7528; Derived::mf1</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x73B0;&#x5728;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x8C03;&#x7528; Base::mf1</span>
d<span class="token punctuation">.</span><span class="token function">mf2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x4ECD;&#x7136;&#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x4ECD;&#x7136;&#x8C03;&#x7528; Base::mf2</span>
d<span class="token punctuation">.</span><span class="token function">mf3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x8C03;&#x7528; Derived::mf3</span>
d<span class="token punctuation">.</span><span class="token function">mf3</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x73B0;&#x5728;&#x6CA1;&#x95EE;&#x9898;&#x4E86;&#xFF0C;&#x8C03;&#x7528; Base::mf3</span>

<span class="token comment">// &#x8FD9;&#x610F;&#x5473;&#x5982;&#x679C;&#x4F60;&#x7EE7;&#x627F; base class &#x5E76;&#x52A0;&#x4E0A;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4F60;&#x53C8;&#x5E0C;&#x671B;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;</span>
<span class="token comment">// &#x6216;&#x8986;&#x5199;&#xFF08;&#x63A8;&#x7FFB;&#xFF09;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x90A3;&#x4E48;&#x4F60;&#x5FC5;&#x987B;&#x4E3A;&#x90A3;&#x4E9B;&#x539F;&#x672C;&#x4F1A;&#x88AB;&#x906E;&#x63A9;&#x7684;&#x6BCF;&#x4E2A;&#x540D;</span>
<span class="token comment">// &#x79F0;&#x5F15;&#x5165;&#x4E00;&#x4E2A; using &#x58F0;&#x660E;&#x5F0F;&#xFF0C;&#x5426;&#x5219;&#x67D0;&#x4E9B;&#x4F60;&#x5E0C;&#x671B;&#x7EE7;&#x627F;&#x7684;&#x540D;&#x79F0;&#x4F1A;&#x88AB;&#x906E;&#x63A9;&#x3002;</span>





<span class="token comment">// &#x6709;&#x65F6;&#x5019;&#x4F60;&#x5E76;&#x4E0D;&#x60F3;&#x7EE7;&#x627F; base classes &#x7684;&#x6240;&#x6709;&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x662F;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C;&#x5728; private &#x7EE7;&#x627F;&#x4E4B;&#x4E0B;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 39&#xFF09;&#x5B83;&#x5374;&#x53EF;&#x80FD;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x5047;&#x8BBE; Derived &#x4EE5; private &#x5F62;&#x5F0F;&#x7EE7;&#x627F; Base&#xFF0C;&#x800C; Derived &#x552F;&#x4E00;</span>
<span class="token comment">// &#x60F3;&#x7EE7;&#x627F;&#x7684; mf1 &#x662F;&#x90A3;&#x4E2A;&#x65E0;&#x53C2;&#x6570;&#x7248;&#x672C;&#x3002;using &#x58F0;&#x660E;&#x5F0F;&#x5728;&#x8FD9;&#x91CC;&#x6D3E;&#x4E0D;&#x4E0A;&#x7528;&#x573A;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A; using &#x58F0;&#x660E;&#x5F0F;&#x4F1A;&#x4EE4;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x67D0;&#x7ED9;&#x5B9A;&#x540D;&#x79F0;&#x4E4B;&#x6240;&#x6709;&#x540C;&#x540D;&#x51FD;&#x6570;&#x5728;</span>
<span class="token comment">// derived class &#x4E2D;&#x90FD;&#x53EF;&#x89C1;&#x3002;&#x4E0D;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x5373;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;</span>
<span class="token comment">// &#x8F6C;&#x4EA4;&#x51FD;&#x6570;&#xFF08;forwarding function&#xFF09;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x4E0E;&#x524D;&#x540C;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">private</span> Base <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">// &#x8F6C;&#x4EA4;&#x51FD;&#x6570;&#xFF08;forwarding function&#xFF09;&#xFF1B;</span>
    <span class="token punctuation">{</span> Base<span class="token operator">::</span><span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token comment">// &#x6697;&#x81EA;&#x6210;&#x4E3A; inline&#xFF08;&#x89C1;&#x6761;&#x6B3E; 30&#xFF09;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Derived d<span class="token punctuation">;</span>
<span class="token keyword">int</span> x<span class="token punctuation">;</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x5F88;&#x597D;&#xFF0C;&#x8C03;&#x7528;&#x7684;&#x662F; Derived::mf1</span>
d<span class="token punctuation">.</span><span class="token function">mf1</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;Base::mf1() &#x88AB;&#x906E;&#x63A9;&#x4E86;</span>

<span class="token comment">// inline &#x8F6C;&#x4EA4;&#x51FD;&#x6570;&#xFF08;forwarding function&#xFF09;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x7528;&#x9014;&#x662F;&#x4E3A;&#x90A3;&#x4E9B;</span>
<span class="token comment">// &#x4E0D;&#x652F;&#x6301; using &#x58F0;&#x660E;&#x5F0F;&#xFF08;&#x6CE8;&#xFF1A;&#x8FD9;&#x5E76;&#x975E;&#x6B63;&#x786E;&#x884C;&#x4E3A;&#xFF09;&#x7684;&#x8001;&#x65E7;&#x7F16;&#x8BD1;&#x5668;&#x53E6;&#x8F9F;&#x4E00;</span>
<span class="token comment">// &#x6761;&#x65B0;&#x8DEF;&#xFF0C;&#x5C06;&#x7EE7;&#x627F;&#x800C;&#x5F97;&#x7684;&#x540D;&#x79F0;&#x6C47;&#x5165; derived class &#x4F5C;&#x7528;&#x57DF;&#x5185;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-34%E5%8C%BA%E5%88%86%E6%8E%A5%E5%8F%A3%E7%BB%A7%E6%89%BF%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 34&#xFF1A;&#x533A;&#x5206;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x548C;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;</h3>

<ul>
<li>&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x548C;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;&#x4E0D;&#x540C;&#x3002;&#x5728; public &#x7EE7;&#x627F;&#x4E4B;&#x4E0B;&#xFF0C;derived classes &#x603B;&#x662F;&#x7EE7;&#x627F; base class &#x7684;&#x63A5;&#x53E3;&#x3002;</li>
<li>pure virtual &#x51FD;&#x6570;&#x53EA;&#x5177;&#x4F53;&#x6307;&#x5B9A;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x3002;</li>
<li>&#x7B80;&#x6734;&#x7684;&#xFF08;&#x975E;&#x7EAF;&#xFF09;impure virtual &#x51FD;&#x6570;&#x5177;&#x4F53;&#x5236;&#x5B9A;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x53CA;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;&#x3002;</li>
<li>non-virtual &#x51FD;&#x6570;&#x5177;&#x4F53;&#x6307;&#x5B9A;&#x63A5;&#x53E3;&#x7EE7;&#x627F;&#x4EE5;&#x53CA;&#x5F3A;&#x5236;&#x6027;&#x5B9E;&#x73B0;&#x7EE7;&#x627F;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">objectID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Ellipse</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Shape &#x662F;&#x4E2A;&#x62BD;&#x8C61; class&#xFF1B;&#x5B83;&#x7684; pure virtual &#x51FD;&#x6570; draw &#x4F7F;&#x5B83;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;</span>
<span class="token comment">// &#x62BD;&#x8C61; class&#x3002;&#x6240;&#x4EE5;&#x5BA2;&#x6237;&#x4E0D;&#x80FD;&#x591F;&#x521B;&#x5EFA; Shape class &#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x53EA;&#x80FD;&#x521B;&#x5EFA;&#x5176;</span>
<span class="token comment">// derived classes &#x7684;&#x5B9E;&#x4F53;&#x3002;&#x5C3D;&#x7BA1;&#x5982;&#x6B64;&#xFF0C;Shape &#x8FD8;&#x662F;&#x5F3A;&#x70C8;&#x5F71;&#x54CD;&#x4E86;&#x6240;&#x6709;&#x4EE5; public &#x5F62;&#x5F0F;</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x5B83;&#x7684; derived classes&#xFF0C;&#x56E0;&#x4E3A;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x6210;&#x5458;&#x51FD;&#x6570;&#x7684;&#x63A5;&#x53E3;&#x603B;&#x662F;&#x4F1A;&#x88AB;&#x7EE7;&#x627F;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// pure virtual &#x51FD;&#x6570;&#x6709;&#x4E24;&#x4E2A;&#x6700;&#x7A81;&#x51FA;&#x7684;&#x7279;&#x6027;&#xFF1A;&#x5B83;&#x4EEC;&#x5FC5;&#x987B;&#x88AB;&#x4EFB;&#x4F55;&#x201C;&#x7EE7;&#x627F;&#x4E86;&#x5B83;&#x4EEC;&#x201D;&#x7684;</span>
<span class="token comment">// &#x5177;&#x8C61; class &#x91CD;&#x65B0;&#x58F0;&#x660E;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4EEC;&#x5728;&#x62BD;&#x8C61; class &#x4E2D;&#x901A;&#x5E38;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x3002;&#x628A;&#x8FD9;&#x4E24;&#x4E2A;</span>
<span class="token comment">// &#x6027;&#x8D28;&#x6446;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x660E;&#x767D;&#xFF1A;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x58F0;&#x660E;&#x4E00;&#x4E2A; pure virtual &#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x8BA9; derived classes &#x53EA;&#x7EE7;&#x627F;&#x51FD;&#x6570;&#x63A5;&#x53E3;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x5BF9; Shape::draw &#x51FD;&#x6570;&#x662F;&#x518D;&#x5408;&#x7406;&#x4E0D;&#x8FC7;&#x7684;&#x4E8B;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709; Shape &#x5BF9;&#x8C61;&#x90FD;</span>
<span class="token comment">// &#x5E94;&#x8BE5;&#x662F;&#x53EF;&#x7ED8;&#x51FA;&#x7684;&#xFF0C;&#x8FD9;&#x662F;&#x5408;&#x7406;&#x7684;&#x8981;&#x6C42;&#x3002;&#x4F46; Shape class &#x65E0;&#x6CD5;&#x4E3A;&#x6B64;&#x51FD;&#x6570;&#x63D0;&#x4F9B;</span>
<span class="token comment">// &#x5408;&#x7406;&#x7684;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#xFF0C;&#x6BD5;&#x7ADF;&#x692D;&#x5706;&#x5F62;&#x7ED8;&#x6CD5;&#x8FE5;&#x5F02;&#x4E8E;&#x7ED8;&#x6CD5;&#x3002;Shape::draw &#x7684;&#x58F0;&#x660E;&#x5F0F;&#x4E43;</span>
<span class="token comment">// &#x662F;&#x5BF9;&#x5177;&#x8C61; derived classes &#x8BBE;&#x8BA1;&#x8005;&#x8BF4;&#xFF0C;&#x201C;&#x4F60;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; draw &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6211;&#x4E0D;&#x5E72;&#x6D89;&#x4F60;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x5B83;&#x3002;&#x201D;</span>

<span class="token comment">// &#x4EE4;&#x4EBA;&#x610F;&#x5916;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7ADF;&#x7136;&#x53EF;&#x4EE5;&#x4E3A; pure virtual &#x51FD;&#x6570;&#x63D0;&#x4F9B;&#x5B9A;&#x4E49;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;</span>
<span class="token comment">// &#x4F60;&#x53EF;&#x4EE5;&#x4E3A; Shape::draw &#x4F9B;&#x5E94;&#x4E00;&#x4EFD;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF0C;C++ &#x5E76;&#x4E0D;&#x4F1A;&#x53D1;&#x51FA;&#x6028;&#x8A00;&#xFF0C;&#x4F46;&#x8C03;</span>
<span class="token comment">// &#x7528;&#x5B83;&#x7684;&#x552F;&#x4E00;&#x9014;&#x5F84;&#x662F;&#x201C;&#x8C03;&#x7528;&#x65F6;&#x660E;&#x786E;&#x6307;&#x51FA;&#x5176; class &#x540D;&#x79F0;&#x201D;&#xFF1A;</span>
Shape<span class="token operator">*</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> Shape<span class="token punctuation">;</span>              <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;Shape &#x662F;&#x62BD;&#x8C61;&#x7684;</span>
Shape<span class="token operator">*</span> ps1 <span class="token operator">=</span> <span class="token keyword">new</span> Rectangle<span class="token punctuation">;</span>         <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;</span>
ps1<span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x8C03;&#x7528; Rectangle::draw</span>
Shape<span class="token operator">*</span> ps2 <span class="token operator">=</span> <span class="token keyword">new</span> Ellipse<span class="token punctuation">;</span>           <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;</span>
ps2<span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x8C03;&#x7528; Ellipse::draw</span>
ps1<span class="token operator">-&gt;</span>Shape<span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x8C03;&#x7528; Shape::draw</span>
ps2<span class="token operator">-&gt;</span>shape<span class="token operator">::</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x8C03;&#x7528; Shape::draw</span>

<span class="token comment">// &#x7B80;&#x6734;&#x7684; impure virtual &#x51FD;&#x6570;&#x80CC;&#x540E;&#x7684;&#x6545;&#x4E8B;&#x548C; pure virtual &#x51FD;&#x6570;&#x80CC;&#x540E;&#x7684;&#x6545;&#x4E8B;</span>
<span class="token comment">// &#x548C; pure virtual &#x51FD;&#x6570;&#x6709;&#x70B9;&#x4E0D;&#x540C;&#x3002;&#x4E00;&#x5982;&#x5F80;&#x5E38;&#xFF0C;derived classes &#x7EE7;&#x627F;&#x5176;&#x51FD;&#x6570;</span>
<span class="token comment">// &#x63A5;&#x53E3;&#xFF0C;&#x4F46; impure virtual &#x51FD;&#x6570;&#x4F1A;&#x63D0;&#x4F9B;&#x4E00;&#x4EFD;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF0C;derived classes</span>
<span class="token comment">// &#x53EF;&#x80FD;&#x8986;&#x5199;&#xFF08;override&#xFF09;&#x5B83;&#x3002;&#x7A0D;&#x52A0;&#x601D;&#x7D22;&#xFF0C;&#x4F60;&#x5C31;&#x4F1A;&#x660E;&#x767D;&#xFF1A;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x58F0;&#x660E;&#x7B80;&#x6734;&#x7684;&#xFF08;&#x975E;&#x7EAF;&#xFF09;impure virtual &#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x662F;&#x8BA9; derived classes</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x63A5;&#x53E3;&#x548C;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Shape::error &#x7684;&#x58F0;&#x660E;&#x5F0F;&#x544A;&#x8BC9; derived classes &#x7684;&#x8BBE;&#x8BA1;&#x8005;&#xFF0C;&#x201C;&#x4F60;&#x5FC5;&#x987B;&#x652F;&#x6301;</span>
<span class="token comment">// &#x4E00;&#x4E2A; error &#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x4E0D;&#x60F3;&#x81EA;&#x5DF1;&#x5199;&#x4E00;&#x4E2A;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; Shape class &#x63D0;&#x4F9B;&#x7684;&#x7F3A;&#x7701;&#x7248;&#x672C;&#x201D;&#x3002;</span>

<span class="token comment">// &#x4F46;&#x662F;&#x5141;&#x8BB8; impure virtual &#x51FD;&#x6570;&#x540C;&#x65F6;&#x6307;&#x5B9A;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x548C;&#x51FD;&#x6570;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#xFF0C;&#x5374;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x5371;&#x9669;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">Airport</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>          <span class="token comment">// &#x7528;&#x4EE5;&#x8868;&#x73B0;&#x673A;&#x573A;</span>
<span class="token keyword">class</span> <span class="token class-name">Airplane</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> Airplane<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    &#x7F3A;&#x7701;&#x4EE3;&#x7801;&#xFF0C;&#x5C06;&#x98DE;&#x673A;&#x98DE;&#x81F3;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x7684;&#x5730;
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ModelA</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">ModelB</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x8868;&#x793A;&#x6240;&#x6709;&#x98DE;&#x673A;&#x90FD;&#x4E00;&#x5B9A;&#x80FD;&#x98DE;&#xFF0C;&#x5E76;&#x9610;&#x660E;&#x201C;&#x4E0D;&#x540C;&#x578B;&#x98DE;&#x673A;&#x539F;&#x5219;&#x4E0A;&#x9700;&#x8981;&#x4E0D;&#x540C;&#x7684; fly &#x5B9E;&#x73B0;&#x201D;&#xFF0C;</span>
<span class="token comment">// Airplane::fly &#x88AB;&#x58F0;&#x660E;&#x4E3A; virtual&#x3002;&#x7136;&#x800C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5728; ModelA &#x548C; ModelB &#x4E2D;&#x64B0;&#x5199;</span>
<span class="token comment">// &#x76F8;&#x540C;&#x4EE3;&#x7801;&#xFF0C;&#x7F3A;&#x7701;&#x98DE;&#x884C;&#x884C;&#x4E3A;&#x7531; Airplane::fly &#x63D0;&#x4F9B;&#xFF0C;&#x5B83;&#x540C;&#x65F6;&#x88AB; ModelA &#x548C; ModelB &#x7EE7;&#x627F;&#x3002;</span>

<span class="token comment">// XYZ &#x516C;&#x53F8;&#x7684;&#x7A0B;&#x5E8F;&#x5458;&#x5728;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x9488;&#x5BF9; C &#x578B;&#x98DE;&#x673A;&#x6DFB;&#x52A0;&#x4E86;&#x4E00;&#x4E2A; class&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x7531;&#x4E8E;&#x4ED6;&#x4EEC;&#x6025;&#x7740;&#x8BA9;&#x65B0;&#x98DE;&#x673A;&#x4E0A;&#x7EBF;&#x670D;&#x52A1;&#xFF0C;&#x7ADF;&#x5FD8;&#x4E86;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5176; fly &#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">ModelC</span><span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x672A;&#x58F0;&#x660E; fly &#x51FD;&#x6570;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Airport PDX <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>                <span class="token comment">// PDX &#x662F;&#x6211;&#x5BB6;&#x9644;&#x8FD1;&#x7684;&#x673A;&#x573A;</span>
Airplane<span class="token operator">*</span> pa <span class="token operator">=</span> <span class="token keyword">new</span> ModelC<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
pa<span class="token operator">-&gt;</span><span class="token function">fly</span><span class="token punctuation">(</span>PDX<span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment">// &#x8C03;&#x7528; Airplane::fly</span>

<span class="token comment">// &#x8FD9;&#x5C06;&#x917F;&#x6210;&#x5927;&#x707E;&#x96BE;&#xFF1B;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x8BD5;&#x56FE;&#x4EE5; ModalA &#x6216; ModalB &#x7684;&#x98DE;&#x884C;&#x65B9;&#x5F0F;&#x6765;&#x98DE; ModelC&#x3002;</span>

<span class="token comment">// &#x95EE;&#x9898;&#x4E0D;&#x5728; Airplane::fly &#x6709;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#xFF0C;&#x800C;&#x5728;&#x4E8E; ModelC &#x5728;&#x672A;&#x660E;&#x767D;&#x8BF4;&#x51FA;&#x201C;&#x6211;&#x8981;&#x201D;&#x7684;&#x60C5;&#x51B5;</span>
<span class="token comment">// &#x4E0B;&#x5C31;&#x7EE7;&#x627F;&#x4E86;&#x8BE5;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#x3002;&#x5E78;&#x8FD0;&#x7684;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8F7B;&#x6613;&#x505A;&#x5230;&#x201C;&#x63D0;&#x4F9B;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x7ED9; derived classes&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x9664;&#x975E;&#x5B83;&#x4EEC;&#x660E;&#x767D;&#x8981;&#x6C42;&#x5426;&#x5219;&#x514D;&#x8C08;&#x201D;&#x3002;&#x6B64;&#x95F4;&#x4F0E;&#x4FE9;&#x5728;&#x4E8E;&#x5207;&#x65AD;&#x201C;virtual &#x51FD;&#x6570;&#x63A5;&#x53E3;&#x201D; &#x548C;&#x5176;&#x201C;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x201D;</span>
<span class="token comment">// &#x4E4B;&#x95F4;&#x7684;&#x8FDE;&#x63A5;&#x3002;&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Airplane</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">defaultFly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> Airplane<span class="token operator">::</span><span class="token function">defaultFly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    &#x7F3A;&#x7701;&#x884C;&#x4E3A;&#xFF0C;&#x5C06;&#x98DE;&#x673A;&#x98DE;&#x81F3;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x7684;&#x5730;&#x3002;
<span class="token punctuation">}</span>

<span class="token comment">// &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;Airplane::fly &#x5DF2;&#x88AB;&#x6539;&#x4E3A;&#x4E00;&#x4E2A; pure virtual &#x51FD;&#x6570;&#xFF0C;&#x53EA;&#x63D0;&#x4F9B;&#x98DE;&#x884C;&#x63A5;&#x53E3;&#x3002;</span>
<span class="token comment">// &#x5176;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#x4E5F;&#x51FA;&#x73B0;&#x5728; Airplane class &#x4E2D;&#xFF0C;&#x4F46;&#x6B64;&#x6B21;&#x7CFB;&#x4EE5;&#x72EC;&#x7ACB;&#x51FD;&#x6570; defaultFly &#x7684;</span>
<span class="token comment">// &#x59FF;&#x6001;&#x51FA;&#x73B0;&#x3002;&#x82E5;&#x60F3;&#x4F7F;&#x7528;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#xFF08;&#x4F8B;&#x5982; ModelA &#x548C; ModelB&#xFF09;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x5176; fly &#x51FD;&#x6570;&#x4E2D;</span>
<span class="token comment">// &#x5BF9; defaultFly &#x505A;&#x4E00;&#x4E2A; inline &#x8C03;&#x7528;&#xFF08;&#x4F46;&#x8BF7;&#x6CE8;&#x610F;&#x6761;&#x6B3E; 30 &#x6240;&#x8A00;&#xFF0C;inline &#x51FD;&#x6570;</span>
<span class="token comment">// &#x548C; virtual &#x51FD;&#x6570;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x5173;&#x7CFB;&#xFF09;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">ModalA</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token function">defaultFly</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ModalB</span><span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token function">defaultFly</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x73B0;&#x5728; ModelC class &#x4E0D;&#x53EF;&#x80FD;&#x610F;&#x5916;&#x7EE7;&#x627F;&#x4E0D;&#x6B63;&#x786E;&#x7684; fly &#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x4E86;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A; Airplane &#x4E2D;&#x7684; pure virtual &#x51FD;&#x6570;&#x8FEB;&#x4F7F; ModelC &#x5FC5;&#x987B;&#x63D0;&#x4F9B;</span>
<span class="token comment">// &#x81EA;&#x5DF1;&#x7684; fly &#x7248;&#x672C;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">ModelC</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> ModelC<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    &#x5C06; C &#x578B;&#x98DE;&#x673A;&#x98DE;&#x81F3;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x7684;&#x5730;
<span class="token punctuation">}</span>





<span class="token comment">// &#x6709;&#x4E9B;&#x4EBA;&#x53CD;&#x5BF9;&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#x5206;&#x522B;&#x63D0;&#x4F9B;&#x63A5;&#x53E3;&#x548C;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#xFF0C;&#x50CF;&#x4E0A;&#x8FF0;&#x7684; fly &#x548C; defaultFly &#x90A3;&#x6837;&#x3002;</span>
<span class="token comment">// &#x4ED6;&#x4EEC;&#x5173;&#x5FC3;&#x56E0;&#x8FC7;&#x5EA6;&#x96F7;&#x540C;&#x7684;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x800C;&#x5F15;&#x8D77;&#x7684; class &#x547D;&#x540D;&#x7A7A;&#x95F4;&#x6C61;&#x67D3;&#x95EE;&#x9898;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x662F;&#x4ED6;&#x4EEC;&#x4E5F;&#x540C;&#x610F;&#xFF0C;&#x63A5;&#x53E3;&#x548C;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#x5E94;&#x8BE5;&#x5206;&#x5F00;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x201C;pure virtual &#x51FD;&#x6570;&#x5FC5;&#x987B;&#x5728; derived classes &#x4E2D;&#x91CD;&#x65B0;&#x58F0;&#x660E;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5B83;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5B9E;&#x73B0;&#x201D;&#x8FD9;&#x4E00;&#x4E8B;&#x5B9E;&#x3002;</span>
<span class="token comment">// &#x4E0B;&#x9762;&#x4FBF;&#x662F; Airplane &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x5982;&#x4F55;&#x7ED9; pure virtual &#x51FD;&#x6570;&#x4E00;&#x4EFD;&#x5B9A;&#x4E49;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Airplane</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> Airplane<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>  <span class="token comment">// pure virtual &#x51FD;&#x6570;&#x5B9E;&#x73B0;</span>
<span class="token punctuation">{</span>
    &#x7F3A;&#x7701;&#x884C;&#x4E3A;&#xFF0C;&#x5C06;&#x98DE;&#x673A;&#x98DE;&#x81F3;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x7684;&#x5730;
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">ModelA</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> Airplane<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ModelB</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> vodi <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> Airplane<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span>destination<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ModelC</span> <span class="token operator">:</span> <span class="token keyword">public</span> Airplane <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> ModelC<span class="token operator">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token keyword">const</span> Airport<span class="token operator">&amp;</span> destination<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    &#x5C06; C &#x578B;&#x98DE;&#x673A;&#x98DE;&#x81F3;&#x6307;&#x5B9A;&#x7684;&#x76EE;&#x7684;&#x5730;
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x51E0;&#x4E4E;&#x548C;&#x524D;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x4E00;&#x6A21;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7; pure virtual &#x51FD;&#x6570; Airplane::fly &#x66FF;&#x6362;&#x4E86;</span>
<span class="token comment">// &#x72EC;&#x7ACB;&#x51FD;&#x6570; Airplane::defaultFly&#x3002;&#x672C;&#x8D28;&#x4E0A;&#xFF0C;&#x73B0;&#x5728;&#x7684; fly &#x88AB;&#x5206;&#x5272;&#x4E3A;&#x4E24;&#x4E2A;&#x57FA;&#x672C;&#x8981;&#x7D20;&#xFF1A;</span>
<span class="token comment">// &#x5176;&#x58F0;&#x660E;&#x90E8;&#x5206;&#x8868;&#x73B0;&#x7684;&#x662F;&#x63A5;&#x53E3;&#xFF08;&#x90A3;&#x662F; derived classes &#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7684;&#xFF09;&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x90E8;&#x5206;&#x5219;</span>
<span class="token comment">// &#x8868;&#x73B0;&#x51FA;&#x7F3A;&#x7701;&#x884C;&#x4E3A;&#xFF08;&#x90A3;&#x662F; derived classes &#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#xFF0C;&#x4F46;&#x53EA;&#x6709;&#x5728;&#x5B83;&#x4EEC;&#x660E;&#x786E;&#x63D0;&#x51FA;&#x7533;&#x8BF7;</span>
<span class="token comment">// &#x65F6;&#x624D;&#x662F;&#xFF09;&#x3002;&#x5982;&#x679C;&#x5408;&#x5E76; fly &#x548C; defaultFly&#xFF0C;&#x5C31;&#x4E27;&#x5931;&#x4E86;&#x201C;&#x8BA9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x4EAB;&#x6709;&#x4E0D;&#x540C;&#x4FDD;&#x62A4;&#x7EA7;&#x522B;&#x201D;</span>
<span class="token comment">// &#x7684;&#x673A;&#x4F1A;&#xFF1A;&#x4E60;&#x60EF;&#x4E0A;&#x88AB;&#x8BBE;&#x4E3A; protected &#x7684;&#x51FD;&#x6570;&#xFF08;defaultFly&#xFF09;&#x5982;&#x4ECA;&#x6210;&#x4E86; public</span>
<span class="token comment">// &#xFF08;&#x56E0;&#x4E3A;&#x5B83;&#x5728; fly &#x4E4B;&#x4E2D;&#xFF09;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> <span class="token function">objectID</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5982;&#x679C;&#x6210;&#x5458;&#x51FD;&#x6570;&#x662F;&#x4E2A; non-virtual &#x51FD;&#x6570;&#xFF0C;&#x610F;&#x5473;&#x662F;&#x5B83;&#x5E76;&#x4E0D;&#x6253;&#x7B97;&#x5728;</span>
<span class="token comment">// derived classes &#x4E2D;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x4E00;&#x4E2A; non-virtual &#x6210;&#x5458;&#x51FD;&#x6570;</span>
<span class="token comment">// &#x6240;&#x8868;&#x73B0;&#x7684;&#x4E0D;&#x53D8;&#x6027;&#xFF08;invariant&#xFF09;&#x51CC;&#x9A7E;&#x5176;&#x7279;&#x5F02;&#x6027;&#xFF08;specialization&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x5B83;&#x8868;&#x793A;&#x4E0D;&#x8BBA; derived class &#x53D8;&#x5F97;&#x591A;&#x4E48;&#x7279;&#x5F02;&#x5316;&#xFF0C;&#x5B83;&#x7684;&#x884C;&#x4E3A;&#x90FD;&#x4E0D;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x3002;</span>
<span class="token comment">// &#x5C31;&#x5176;&#x81EA;&#x8EAB;&#x800C;&#x8A00;&#xFF1A;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x58F0;&#x660E; non-virtual &#x51FD;&#x6570;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x4EE4; derived classes &#x7EE7;&#x627F;&#x51FD;&#x6570;&#x7684;&#x63A5;&#x53E3;</span>
<span class="token comment">// &#x53CA;&#x4E00;&#x4EFD;&#x5F3A;&#x5236;&#x6027;&#x5B9E;&#x73B0;&#x3002;</span>

<span class="token comment">// &#x4F60;&#x53EF;&#x4EE5;&#x628A; Shape::objectID &#x7684;&#x58F0;&#x660E;&#x60F3;&#x505A;&#x4E8B;&#xFF1A;&#x201C;&#x6BCF;&#x4E2A; Shape &#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x4EA7;&#x751F;</span>
<span class="token comment">// &#x5BF9;&#x8C61;&#x8BC6;&#x522B;&#x7801;&#x7684;&#x51FD;&#x6570;&#xFF1B;&#x6B64;&#x8BC6;&#x522B;&#x7801;&#x603B;&#x662F;&#x91C7;&#x7528;&#x76F8;&#x540C;&#x8BA1;&#x7B97;&#x65B9;&#x6CD5;&#xFF0C;&#x8BE5;&#x65B9;&#x6CD5;&#x7531; Shape::objectID</span>
<span class="token comment">// &#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#x51B3;&#x5B9A;&#xFF0C;&#x4EFB;&#x4F55; derived class &#x90FD;&#x4E0D;&#x5E94;&#x8BE5;&#x5C1D;&#x8BD5;&#x6539;&#x53D8;&#x5176;&#x884C;&#x4E3A;&#x201D;&#x3002;</span>
<span class="token comment">// &#x7531;&#x4E8E; non-virtual &#x51FD;&#x6570;&#x4EE3;&#x8868;&#x7684;&#x610F;&#x4E49;&#x662F;&#x4E0D;&#x53D8;&#x6027;&#xFF08;invariant&#xFF09;&#x51CC;&#x9A7E;&#x7279;&#x5F02;&#x6027;&#xFF08;specialization&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5B83;&#x7EDD;&#x4E0D;&#x8BE5;&#x5728; derived class &#x4E2D;&#x88AB;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x3002;</span>





<span class="token comment">// pure virtual &#x51FD;&#x6570;&#x3001;simple&#xFF08;impure&#xFF09;virtual &#x51FD;&#x6570;&#x3001;non-virtual &#x51FD;&#x6570;</span>
<span class="token comment">// &#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x4F7F;&#x4F60;&#x5F97;&#x4EE5;&#x7CBE;&#x786E;&#x6307;&#x5B9A;&#x4F60;&#x60F3;&#x8981; derived classes &#x7EE7;&#x627F;&#x7684;&#x4E1C;&#x897F;&#xFF1A;</span>
<span class="token comment">// &#x53EA;&#x7EE7;&#x627F;&#x63A5;&#x53E3;&#xFF0C;&#x6216;&#x662F;&#x7EE7;&#x627F;&#x63A5;&#x53E3;&#x548C;&#x4E00;&#x4EFD;&#x7F3A;&#x7701;&#x5B9E;&#x73B0;&#xFF0C;&#x6216;&#x662F;&#x7EE7;&#x627F;&#x63A5;&#x53E3;&#x548C;&#x4E00;&#x4EFD;&#x5F3A;&#x5236;&#x5B9E;&#x73B0;&#x3002;</span>
<span class="token comment">// &#x7531;&#x4E8E;&#x8FD9;&#x4E9B;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x58F0;&#x660E;&#x610F;&#x5473;&#x6839;&#x672C;&#x610F;&#x4E49;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x5F53;&#x4F60;&#x58F0;&#x660E;&#x4F60;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x65F6;&#xFF0C;</span>
<span class="token comment">// &#x5FC5;&#x987B;&#x8C28;&#x614E;&#x9009;&#x62E9;&#x3002;&#x5982;&#x679C;&#x4F60;&#x786E;&#x5B9E;&#x5C65;&#x884C;&#xFF0C;&#x5E94;&#x8BE5;&#x80FD;&#x591F;&#x907F;&#x514D;&#x7ECF;&#x9A8C;&#x4E0D;&#x8DB3;&#x7684; class &#x8BBE;&#x8BA1;&#x8005;&#x6700;&#x5E38;&#x72AF;</span>
<span class="token comment">// &#x7684;&#x4E24;&#x4E2A;&#x9519;&#x8BEF;&#x3002;</span>

<span class="token comment">// &#x7B2C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x662F;&#x5C06;&#x6240;&#x6709;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E3A; non-virtual&#x3002;&#x8FD9;&#x4F7F;&#x5F97; derived classes &#x6CA1;&#x6709;</span>
<span class="token comment">// &#x4F59;&#x88D5;&#x7A7A;&#x95F4;&#x8FDB;&#x884C;&#x7279;&#x5316;&#x5DE5;&#x4F5C;&#x3002;non-virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x5C24;&#x5176;&#x4F1A;&#x5E26;&#x6765;&#x95EE;&#x9898;&#x3002;</span>
<span class="token comment">// &#x5F53;&#x7136;&#x5566;&#xFF0C;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x5E76;&#x4E0D;&#x60F3;&#x6210;&#x4E3A; base class &#x7684; class &#x662F;&#x7EDD;&#x5BF9;&#x5408;&#x7406;&#x7684;&#xFF0C;&#x65E2;&#x7136;&#x8FD9;&#x6837;&#xFF0C;</span>
<span class="token comment">// &#x5C06;&#x5176;&#x6240;&#x6709;&#x6210;&#x5458;&#x51FD;&#x6570;&#x90FD;&#x58F0;&#x660E;&#x4E3A; non-virtual &#x4E5F;&#x5F88;&#x9002;&#x5F53;&#x3002;</span>

<span class="token comment">// &#x53E6;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x9519;&#x8BEF;&#x662F;&#x5C06;&#x6240;&#x6709;&#x6210;&#x5458;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E3A; virtual&#x3002;&#x6709;&#x65F6;&#x5019;&#x8FD9;&#x6837;&#x505A;&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x6761;&#x6B3E; 31 &#x7684; Interface classes&#x3002;&#x7136;&#x800C;&#x8FD9;&#x4E5F;&#x53EF;&#x80FD;&#x662F; class &#x8BBE;&#x8BA1;&#x8005;&#x7F3A;&#x4E4F;&#x575A;&#x5B9A;&#x7ACB;&#x573A;&#x7684;&#x524D;&#x5146;&#x3002;</span>
<span class="token comment">// &#x67D0;&#x4E9B;&#x51FD;&#x6570;&#x5C31;&#x662F;&#x4E0D;&#x8BE5;&#x5728; derived class&#x4E2D;&#x88AB;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#xFF0C;</span>
<span class="token comment">// &#x679C;&#x771F;&#x5982;&#x6B64;&#x4F60;&#x5E94;&#x8BE5;&#x5C06;&#x90A3;&#x4E9B;&#x51FD;&#x6570;&#x58F0;&#x660E;&#x4E3A; non-virtual&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-35%E8%80%83%E8%99%91-virtual-%E5%87%BD%E6%95%B0%E4%BB%A5%E5%A4%96%E7%9A%84%E5%85%B6%E4%BB%96%E9%80%89%E6%8B%A9">&#x6761;&#x6B3E; 35&#xFF1A;&#x8003;&#x8651; virtual &#x51FD;&#x6570;&#x4EE5;&#x5916;&#x7684;&#x5176;&#x4ED6;&#x9009;&#x62E9;</h3>

<ul>
<li>virtual &#x51FD;&#x6570;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x5305;&#x62EC; NVI &#x624B;&#x6CD5;&#x53CA; Strategy &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x591A;&#x79CD;&#x5F62;&#x5F0F;&#x3002;NVI &#x624B;&#x6CD5;&#x81EA;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x6B8A;&#x5F62;&#x5F0F;&#x7684; Template Method &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002;</li>
<li>&#x5C06;&#x673A;&#x80FD;&#x4ECE;&#x6210;&#x5458;&#x51FD;&#x6570;&#x79FB;&#x5230; class &#x5916;&#x90E8;&#x51FD;&#x6570;&#xFF0C;&#x5E26;&#x6765;&#x7684;&#x4E00;&#x4E2A;&#x7F3A;&#x70B9;&#x662F;&#xFF0C;&#x975E;&#x6210;&#x5458;&#x51FD;&#x6570;&#x65E0;&#x6CD5;&#x8BBF;&#x95EE; class &#x7684; non-public &#x6210;&#x5458;&#x3002;</li>
<li>tr1::function &#x5BF9;&#x8C61;&#x7684;&#x884C;&#x4E3A;&#x5C31;&#x50CF;&#x4E00;&#x822C;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x53EF;&#x63A5;&#x7EB3;&#x201C;&#x4E0E;&#x7ED9;&#x5B9A;&#x4E4B;&#x76EE;&#x6807;&#x7B7E;&#x540D;&#x5F0F;&#xFF08;target signature&#xFF09;&#x517C;&#x5BB9;&#x201D;&#x7684;&#x6240;&#x6709;&#x53EF;&#x8C03;&#x7528;&#x7269;&#xFF08;callable entities&#xFF09;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">GameCharacter</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">healthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x8FD4;&#x56DE;&#x4EBA;&#x7269;&#x7684;&#x5065;&#x5EB7;&#x6307;&#x6570;&#xFF1B;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// derived classes &#x53EF;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5B83;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// healthValue &#x5E76;&#x672A;&#x88AB;&#x58F0;&#x660E;&#x4E3A; pure virtual&#xFF0C;&#x8FD9;&#x6697;&#x793A;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x6709;&#x4E2A;&#x8BA1;&#x7B97;</span>
<span class="token comment">// &#x5065;&#x5EB7;&#x6307;&#x6570;&#x7684;&#x7F3A;&#x7701;&#x7B97;&#x6CD5;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 34&#xFF09;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x7684;&#x786E;&#x662F;&#x518D;&#x660E;&#x767D;&#x4E0D;&#x8FC7;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x4F46;&#x662F;&#x4ECE;&#x67D0;&#x4E2A;&#x89D2;&#x5EA6;&#x8BF4;&#x5374;&#x53CD;&#x800C;&#x6210;&#x4E86;&#x5B83;&#x7684;&#x5F31;&#x70B9;&#x3002;&#x7531;&#x4E8E;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x5982;&#x6B64;&#x660E;&#x663E;&#xFF0C;&#x4F60;&#x53EF;&#x80FD;&#x56E0;&#x6B64;&#x6CA1;&#x6709;&#x8BA4;&#x771F;&#x8003;&#x8651;&#x5176;&#x4ED6;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x3002;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;</span>
<span class="token comment">// &#x4F60;&#x8DF3;&#x8131;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8BBE;&#x8BA1;&#x8DEF;&#x4E0A;&#x7684;&#x5E38;&#x8F68;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x8003;&#x8651;&#x5176;&#x4ED6;&#x4E00;&#x4E9B;&#x89E3;&#x6CD5;&#xFF1A;</span>





<span class="token comment">// &#x85C9;&#x7531; Non-virtual Interface &#x624B;&#x6CD5;&#x5B9E;&#x73B0; Template Method &#x6A21;&#x5F0F;</span>

<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> <span class="token function">healthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>             <span class="token comment">// derived classes &#x4E0D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5B83;&#xFF0C;</span>
    <span class="token punctuation">{</span>                                   <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 36&#x3002;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x60C5;&#x5DE5;&#x4F5C;&#xFF0C;&#x8BE6;&#x4E0B;&#x3002;</span>
        <span class="token keyword">int</span> retVal <span class="token operator">=</span> <span class="token function">doHealthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x505A;&#x771F;&#x6B63;&#x7684;&#x5DE5;&#x4F5C;&#x3002;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x540E;&#x5DE5;&#x4F5C;&#xFF0C;&#x8BE6;&#x4E0B;&#x3002;</span>
        <span class="token keyword">return</span> retVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">doHealthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>   <span class="token comment">// derived classes &#x53EF;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5B83;&#x3002;</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                             <span class="token comment">// &#x7F3A;&#x7701;&#x7B97;&#x6CD5;&#xFF0C;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x3002;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5728;&#x8FD9;&#x6BB5;&#xFF08;&#x4EE5;&#x53CA;&#x672C;&#x6761;&#x6B3E;&#x5176;&#x4F59;&#x7684;&#xFF09;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x6211;&#x76F4;&#x63A5;&#x5728; class &#x5B9A;&#x4E49;&#x5F0F;&#x5185;&#x5448;&#x73B0;&#x6210;&#x5458;&#x51FD;&#x6570;&#x672C;&#x4F53;&#x3002;</span>
<span class="token comment">// &#x4E00;&#x5982;&#x6761;&#x6B3E; 30 &#x6240;&#x8A00;&#xFF0C;&#x90A3;&#x4E5F;&#x5C31;&#x8BA9;&#x5B83;&#x4EEC;&#x5168;&#x90FD;&#x6697;&#x81EA;&#x6210;&#x4E86; inline&#x3002;&#x4F46;&#x5176;&#x5B9E;&#x6211;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5448;&#x73B0;</span>
<span class="token comment">// &#x4EE3;&#x7801;&#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x4F60;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x9605;&#x8BFB;&#x3002;&#x6211;&#x6240;&#x63CF;&#x8FF0;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E; inlining &#x5176;&#x5B9E;&#x5E76;&#x6CA1;&#x6709;&#x5173;&#x8054;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x8BF7;&#x4E0D;&#x8981;&#x8BA4;&#x4E3A;&#x6210;&#x5458;&#x51FD;&#x6570;&#x5728;&#x8FD9;&#x91CC;&#x88AB;&#x5B9A;&#x4E49;&#x4E8E; classes &#x5185;&#x6709;&#x7279;&#x6B8A;&#x7528;&#x610F;&#x3002;&#x4E0D;&#xFF0C;&#x5B83;&#x6CA1;&#x6709;&#x3002;</span>





<span class="token comment">// &#x8FD9;&#x4E00;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x201C;&#x4EE4;&#x5BA2;&#x6237;&#x901A;&#x8FC7; public non-virtual &#x6210;&#x5458;&#x51FD;&#x6570;&#x95F4;&#x63A5;&#x8C03;&#x7528;</span>
<span class="token comment">// private virtual &#x51FD;&#x6570;&#x201D;&#xFF0C;&#x79F0;&#x4E3A; non-virtual interface &#xFF08;NVI&#xFF09;&#x624B;&#x6CD5;&#x3002;</span>
<span class="token comment">// &#x5B83;&#x662F;&#x6240;&#x8C13; Template Method &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF08;&#x4E0E; C++ templates &#x5E76;&#x65E0;&#x5173;&#x8054;&#xFF09;&#x7684;&#x4E00;&#x4E2A;</span>
<span class="token comment">// &#x72EC;&#x7279;&#x8868;&#x73B0;&#x5F62;&#x5F0F;&#x3002;&#x6211;&#x628A;&#x8FD9;&#x4E2A; non-virtual &#x51FD;&#x6570;&#xFF08;healthValue&#xFF09;&#x79F0;&#x4E3A; virtual</span>
<span class="token comment">// &#x51FD;&#x6570;&#x7684;&#x5916;&#x8986;&#x5668;&#xFF08;wrapper&#xFF09;&#x3002;</span>

<span class="token comment">// NVI &#x624B;&#x6CD5;&#x7684;&#x4E00;&#x4E2A;&#x4F18;&#x70B9;&#x9690;&#x8EAB;&#x5728;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x6CE8;&#x91CA;&#x201C;&#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x524D;&#x5DE5;&#x4F5C;&#x201D;&#x548C;&#x201C;&#x505A;&#x4E00;&#x4E9B;&#x4E8B;&#x540E;&#x5DE5;&#x4F5C;&#x201D;&#x4E4B;&#x4E2D;&#x3002;</span>
<span class="token comment">// &#x90A3;&#x4E9B;&#x6CE8;&#x91CA;&#x7528;&#x6765;&#x544A;&#x8BC9;&#x4F60;&#x5F53;&#x65F6;&#x7684;&#x4EE3;&#x7801;&#x4FDD;&#x8BC1;&#x5728;&#x201C;virtual &#x51FD;&#x6570;&#x8FDB;&#x884C;&#x771F;&#x6B63;&#x7684;&#x5DE5;&#x4F5C;&#x4E4B;&#x524D;&#x548C;&#x4E4B;&#x540E;&#x201D;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x610F;&#x5473;&#x5916;&#x8986;&#x5668;&#xFF08;wrapper&#xFF09;&#x786E;&#x4FDD;&#x5F97;&#x4EE5;&#x5728;&#x4E00;&#x4E2A; virtual &#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#x8BBE;&#x5B9A;&#x597D;&#x9002;&#x5F53;&#x573A;&#x666F;&#xFF0C;</span>
<span class="token comment">// &#x5E76;&#x5728;&#x8C03;&#x7528;&#x7ED3;&#x675F;&#x4E4B;&#x540E;&#x6E05;&#x7406;&#x573A;&#x666F;&#x3002;&#x201C;&#x4E8B;&#x524D;&#x5DE5;&#x4F5C;&#x201D;&#x53EF;&#x4EE5;&#x5305;&#x62EC;&#x9501;&#x5B9A;&#x4E92;&#x65A5;&#x5668;&#xFF08;locking a mutex&#xFF09;&#x3001;</span>
<span class="token comment">// &#x5236;&#x9020;&#x8FD0;&#x8F6C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x9879;&#xFF08;log entry&#xFF09;&#x3001;&#x9A8C;&#x8BC1; class &#x7EA6;&#x675F;&#x6761;&#x4EF6;&#x3001;&#x9A8C;&#x8BC1;&#x51FD;&#x6570;&#x5148;&#x51B3;&#x6761;&#x4EF6;&#x7B49;&#x7B49;&#x3002;</span>
<span class="token comment">// &#x201C;&#x4E8B;&#x540E;&#x5DE5;&#x4F5C;&#x201D;&#x53EF;&#x4EE5;&#x5305;&#x62EC;&#x4E92;&#x65A5;&#x5668;&#x89E3;&#x9664;&#x9501;&#x5B9A;&#xFF08;unlocking a mutex&#xFF09;&#x3001;&#x9A8C;&#x8BC1;&#x51FD;&#x6570;&#x7684;&#x4E8B;&#x540E;&#x6761;&#x4EF6;&#x3001;</span>
<span class="token comment">// &#x518D;&#x6B21;&#x9A8C;&#x8BC1; class &#x7EA6;&#x675F;&#x6761;&#x4EF6;&#x7B49;&#x7B49;&#x3002;&#x5982;&#x679C;&#x4F60;&#x8BA9;&#x5BA2;&#x6237;&#x76F4;&#x63A5;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;&#xFF0C;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;</span>
<span class="token comment">// &#x597D;&#x529E;&#x6CD5;&#x53EF;&#x4EE5;&#x505A;&#x8FD9;&#x4E9B;&#x4E8B;&#x3002;</span>

<span class="token comment">// &#x6709;&#x4EF6;&#x4E8B;&#x5B9E;&#x6216;&#x8BB8;&#x59A8;&#x788D;&#x4F60;&#x8DC3;&#x8DC3;&#x6B32;&#x8BD5;&#x7684;&#x5FC3;&#xFF1A;NVI &#x624B;&#x6CD5;&#x6D89;&#x53CA;&#x5728; derived classes &#x5185;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;</span>
<span class="token comment">// private virtual &#x51FD;&#x6570;&#x3002;&#x554A;&#xFF0C;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x82E5;&#x5E72;&#x4E2A; derived classes &#x5E76;&#x4E0D;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#xFF01;</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x5E76;&#x4E0D;&#x5B58;&#x5728;&#x77DB;&#x76FE;&#x3002;&#x201C;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; virtual &#x51FD;&#x6570;&#x201D;&#x8868;&#x793A;&#x67D0;&#x4E9B;&#x4E8B;&#x201C;&#x5982;&#x4F55;&#x201D;&#x88AB;&#x5B8C;&#x6210;&#xFF0C;</span>
<span class="token comment">//  &#x201C;&#x8C03;&#x7528; virtual &#x51FD;&#x6570;&#x201D;&#x5219;&#x8868;&#x793A;&#x5B83;&#x201C;&#x4F55;&#x65F6;&#x201D;&#x88AB;&#x5B8C;&#x6210;&#x3002;&#x8FD9;&#x4E9B;&#x4E8B;&#x60C5;&#x90FD;&#x662F;&#x5404;&#x81EA;&#x72EC;&#x7ACB;&#x4E92;&#x4E0D;&#x76F8;&#x5E72;&#x7684;&#x3002;</span>
<span class="token comment">// NVI &#x624B;&#x6CD5;&#x5141;&#x8BB8; derived classes &#x91CD;&#x65B0;&#x5B9A;&#x4E49; virtual &#x51FD;&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x8D4B;&#x4E88;&#x5B83;&#x4EEC;&#x201C;&#x5982;&#x4F55;&#x5B9E;&#x73B0;&#x673A;&#x80FD;&#x201D;</span>
<span class="token comment">// &#x7684;&#x63A7;&#x5236;&#x80FD;&#x529B;&#xFF0C;&#x4F46; base class &#x4FDD;&#x7559;&#x8BC9;&#x8BF4;&#x201C;&#x51FD;&#x6570;&#x4F55;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#x201D;&#x7684;&#x6743;&#x5229;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#x8FD9;&#x4E9B;&#x542C;&#x8D77;&#x6765;&#x4F3C;&#x4E4E;&#x8BE1;&#x5F02;&#xFF0C;</span>
<span class="token comment">// &#x4F46; C++ &#x7684;&#x8FD9;&#x79CD;&#x201C;derived classes &#x53EF;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; private virtual &#x51FD;&#x6570;&#x201D;</span>
<span class="token comment">// &#x7684;&#x89C4;&#x5219;&#x5B8C;&#x5168;&#x5408;&#x60C5;&#x5408;&#x7406;&#x3002;</span>

<span class="token comment">// &#x5728; NVI &#x624B;&#x6CD5;&#x4E0B;&#x5176;&#x5B9E;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x8BA9; virtual &#x51FD;&#x6570;&#x4E00;&#x5B9A;&#x5F97;&#x662F; private&#x3002;&#x67D0;&#x4E9B; class &#x7EE7;&#x627F;</span>
<span class="token comment">// &#x4F53;&#x7CFB;&#x8981;&#x6C42; derived class &#x5728; virtual &#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x5185;&#x5FC5;&#x987B;&#x8C03;&#x7528;&#x5176; base class &#x7684;&#x5BF9;&#x5E94;&#x5144;&#x5F1F;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x4E3A;&#x4E86;&#x8BA9;&#x8FD9;&#x6837;&#x7684;&#x8C03;&#x7528;&#x5408;&#x6CD5;&#xFF0C;virtual &#x51FD;&#x6570;&#x5FC5;&#x987B;&#x662F; protected&#xFF0C;&#x4E0D;&#x80FD;&#x662F; private&#x3002;</span>
<span class="token comment">// &#x6709;&#x65F6;&#x5019; virtual &#x51FD;&#x6570;&#x751A;&#x81F3;&#x4E00;&#x5B9A;&#x5F97;&#x662F; public&#xFF08;&#x4F8B;&#x5982;&#x5177;&#x5907;&#x591A;&#x6001;&#x6027;&#x8D28;&#x7684; base classes &#x7684;</span>
<span class="token comment">// &#x6790;&#x6784;&#x51FD;&#x6570;&#x2014;&#x2014;&#x89C1;&#x6761;&#x6B3E; 7&#xFF09;&#xFF0C;&#x8FD9;&#x4E48;&#x4E00;&#x6765;&#x5C31;&#x4E0D;&#x80FD;&#x5B9E;&#x65BD; NVI &#x624B;&#x6CD5;&#x4E86;&#x3002;</span>





<span class="token comment">// &#x85C9;&#x7531; Function Pointers &#x5B9E;&#x73B0; Strategy &#x6A21;&#x5F0F;</span>

<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span><span class="token punctuation">;</span>            <span class="token comment">// &#x524D;&#x7F6E;&#x58F0;&#x660E;&#xFF08;forward declaration&#xFF09;</span>
<span class="token comment">// &#x4EE5;&#x4E0B;&#x51FD;&#x6570;&#x662F;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x7684;&#x7F3A;&#x7701;&#x7B97;&#x6CD5;&#x3002;</span>
<span class="token keyword">int</span> <span class="token function">defaultHealthCalc</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span> gc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">typedef</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>HealthCalcFunc<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">explicit</span> <span class="token function">GameCharacter</span><span class="token punctuation">(</span>HealthCalcFunc hcf <span class="token operator">=</span> defaultHealthCalc<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">healthFunc</span><span class="token punctuation">(</span>hcf<span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">healthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">healthFunc</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    HealthCalcFunc healthFunc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x505A;&#x6CD5;&#x662F;&#x5E38;&#x89C1;&#x7684; Strategy &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x7B80;&#x5355;&#x5E94;&#x7528;&#x3002;&#x62FF;&#x5B83;&#x548C;&#x201C;&#x690D;&#x57FA;&#x4E8E; GameCharacter &#x7EE7;&#x627F;</span>
<span class="token comment">// &#x4F53;&#x7CFB;&#x5185;&#x4E4B; virtual &#x51FD;&#x6570;&#x201D;&#x7684;&#x505A;&#x6CD5;&#x6BD4;&#x8F83;&#xFF0C;&#x5B83;&#x63D0;&#x4F9B;&#x4E86;&#x67D0;&#x4E9B;&#x6709;&#x8DA3;&#x5F39;&#x6027;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x540C;&#x4E00;&#x4EBA;&#x7269;&#x7C7B;&#x578B;&#x4E4B;&#x4E0D;&#x540C;&#x5B9E;&#x4F53;&#x53EF;&#x4EE5;&#x6709;&#x4E0D;&#x540C;&#x7684;&#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">EvilBadGuy</span> <span class="token operator">:</span> <span class="token keyword">public</span> GameCharacter <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">EvilBadGuy</span><span class="token punctuation">(</span>HealthCalcFunc hcf <span class="token operator">=</span> defaultHealthCalc<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">GameCharacter</span><span class="token punctuation">(</span>hcf<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">loseHealthQuickly</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x5065;&#x5EB7;&#x6307;&#x6570;&#x8BA1;&#x7B97;&#x51FD;&#x6570; 1</span>
<span class="token keyword">int</span> <span class="token function">loseHealthSlowly</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x5065;&#x5EB7;&#x6307;&#x6570;&#x8BA1;&#x7B97;&#x51FD;&#x6570; 2</span>

EvilBadGuy <span class="token function">ebg1</span><span class="token punctuation">(</span>loseHealthQuickly<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x4EBA;&#x7269;&#x642D;&#x914D;</span>
EvilBadGuy <span class="token function">ebg2</span><span class="token punctuation">(</span>loseHealthSlowly<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &#x4E0D;&#x540C;&#x7684;&#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x65B9;&#x5F0F;</span>

<span class="token comment">// &#xFF08;2&#xFF09;&#x67D0;&#x5DF2;&#x77E5;&#x4EBA;&#x7269;&#x4E4B;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x53EF;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x53D8;&#x66F4;&#x3002;&#x4F8B;&#x5982; GameCharacter &#x53EF;&#x63D0;&#x4F9B;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570; setHealthCalculator&#xFF0C;&#x7528;&#x6765;&#x66FF;&#x6362;&#x5F53;&#x524D;&#x7684;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x201C;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x4E0D;&#x518D;&#x662F; GameCharacter &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x5185;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x201D;&#x8FD9;&#x4E00;&#x4E8B;&#x5B9E;&#x610F;&#x5473;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E9B;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x5E76;&#x672A;&#x7279;&#x522B;&#x8BBF;&#x95EE;&#x201C;&#x5373;&#x5C06;&#x88AB;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x201D;&#x7684;&#x90A3;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x90E8;&#x6210;&#x5206;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982; defaultHealthCalc &#x5E76;&#x672A;&#x8BBF;&#x95EE; EvilBadGuy &#x7684; non-public &#x6210;&#x5206;&#x3002;</span>

<span class="token comment">// &#x4E00;&#x822C;&#x800C;&#x8A00;&#xFF0C;&#x552F;&#x4E00;&#x80FD;&#x591F;&#x89E3;&#x51B3;&#x201C;&#x9700;&#x8981;&#x4EE5; non-member &#x51FD;&#x6570;&#x8BBF;&#x95EE; class &#x7684; non-public &#x6210;&#x5206;&#x201D;&#x7684;</span>
<span class="token comment">// &#x529E;&#x6CD5;&#x5C31;&#x662F;&#xFF1A;&#x5F31;&#x5316; class &#x7684;&#x5C01;&#x88C5;&#x3002;&#x4F8B;&#x5982; class &#x53EF;&#x58F0;&#x660E;&#x90A3;&#x4E2A; non-member &#x51FD;&#x6570;&#x4E3A; friends&#xFF0C;</span>
<span class="token comment">// &#x6216;&#x662F;&#x4E3A;&#x5176;&#x5B9E;&#x73B0;&#x7684;&#x67D0;&#x4E00;&#x90E8;&#x5206;&#x63D0;&#x4F9B; public &#x8BBF;&#x95EE;&#x51FD;&#x6570;&#xFF08;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x5219;&#x5B81;&#x53EF;&#x9690;&#x85CF;&#x8D77;&#x6765;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x8FD0;&#x7528;&#x51FD;&#x6570;&#x6307;&#x9488;&#x66FF;&#x6362; virtual &#x51FD;&#x6570;&#xFF0C;&#x5176;&#x4F18;&#x70B9;&#xFF08;&#x50CF;&#x662F;&#x201C;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x53EF;&#x5404;&#x81EA;&#x62E5;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x5065;</span>
<span class="token comment">// &#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x201D;&#x548C;&#x201C;&#x53EF;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x6539;&#x53D8;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x201D;&#xFF09;&#x662F;&#x5426;&#x8DB3;&#x4EE5;&#x5F25;&#x8865;&#x7F3A;&#x70B9;&#xFF08;&#x4F8B;&#x5982;&#x53EF;&#x80FD;&#x5FC5;&#x987B;&#x964D;</span>
<span class="token comment">// &#x4F4E; GameCharacter &#x5C01;&#x88C5;&#x6027;&#xFF09;&#xFF0C;&#x662F;&#x4F60;&#x5FC5;&#x987B;&#x6839;&#x636E;&#x6BCF;&#x4E2A;&#x8BBE;&#x8BA1;&#x60C5;&#x51B5;&#x7684;&#x4E0D;&#x540C;&#x800C;&#x6289;&#x62E9;&#x7684;&#x3002;</span>





<span class="token comment">// &#x85C9;&#x7531; tr1::function &#x5B8C;&#x6210; Strategy &#x6A21;&#x5F0F;</span>

<span class="token comment">// &#x4E00;&#x65E6;&#x4E60;&#x60EF;&#x4E86; templates &#x4EE5;&#x53CA;&#x5B83;&#x4EEC;&#x5BF9;&#x9690;&#x5F0F;&#x63A5;&#x53E3;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 41&#xFF09;&#x7684;&#x4F7F;&#x7528;&#xFF0C;&#x57FA;&#x4E8E;&#x51FD;&#x6570;&#x6307;&#x9488;&#x7684;&#x505A;&#x6CD5;</span>
<span class="token comment">// &#x770B;&#x8D77;&#x6765;&#x4FBF;&#x8FC7;&#x5206;&#x82DB;&#x523B;&#x800C;&#x6B7B;&#x677F;&#x4E86;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6C42;&#x201C;&#x5065;&#x5EB7;&#x6307;&#x6570;&#x4E4B;&#x8BA1;&#x7B97;&#x201D;&#x5FC5;&#x987B;&#x662F;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x4E0D;&#x80FD;&#x662F;&#x67D0;&#x79CD;&#x201C;&#x50CF;&#x51FD;&#x6570;&#x7684;&#x4E1C;&#x897F;&#x201D;&#xFF08;&#x4F8B;&#x5982;&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#xFF09;&#x5462;&#xFF1F;&#x5982;&#x679C;&#x4E00;&#x5B9A;&#x5F97;&#x662F;&#x51FD;&#x6570;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x80FD;&#x662F;</span>
<span class="token comment">// &#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;&#x5462;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x4E00;&#x5B9A;&#x5F97;&#x8FD4;&#x56DE; int &#x800C;&#x4E0D;&#x662F;&#x4EFB;&#x4F55;&#x53EF;&#x88AB;&#x8F6C;&#x6362;&#x4E3A; int &#x7684;&#x7C7B;&#x578B;&#x5462;&#xFF1F;</span>

<span class="token comment">// &#x5982;&#x679C;&#x6211;&#x4EEC;&#x4E0D;&#x518D;&#x4F7F;&#x7528;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF08;&#x5982;&#x524D;&#x4F8B;&#x7684; healthFunc&#xFF09;&#xFF0C;&#x800C;&#x662F;&#x6539;&#x7528;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; tr1::function</span>
<span class="token comment">// &#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E9B;&#x7EA6;&#x675F;&#x5C31;&#x5168;&#x90FD;&#x6325;&#x53D1;&#x4E0D;&#x89C1;&#x4E86;&#x3002;&#x5C31;&#x50CF;&#x6761;&#x6B3E; 54 &#x6240;&#x8BF4;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x53EF;&#x6301;&#x6709;</span>
<span class="token comment">// &#xFF08;&#x4FDD;&#x5B58;&#xFF09;&#x4EFB;&#x4F55;&#x53EF;&#x8C03;&#x7528;&#xFF08;callable entity&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3001;&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x3001;&#x6216;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x53EA;&#x8981;&#x5176;&#x7B7E;&#x540D;&#x65B9;&#x5F0F;&#x517C;&#x5BB9;&#x4E8E;&#x9700;&#x6C42;&#x7AEF;&#x3002;&#x4EE5;&#x4E0B;&#x5C06;&#x521A;&#x624D;&#x7684;&#x8BBE;&#x8BA1;&#x6539;&#x4E3A;&#x4F7F;&#x7528; tr1::function&#xFF1A;</span>

<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span><span class="token punctuation">;</span>                                <span class="token comment">// &#x5982;&#x524D;</span>
<span class="token keyword">int</span> <span class="token function">defaultHealthCalc</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span> gc<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x5982;&#x524D;</span>
<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// HealthCalcFunc &#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x4F55;&#x201C;&#x53EF;&#x8C03;&#x7528;&#x7269;&#x201D;&#xFF08;callable entity&#xFF09;&#xFF0C;&#x53EF;&#x88AB;&#x8C03;&#x7528;&#x5E76;&#x63A5;&#x53D7;</span>
    <span class="token comment">// &#x4EFB;&#x4F55;&#x517C;&#x5BB9;&#x4E8E; GameCharacter &#x4E4B;&#x7269;&#xFF0C;&#x8FD4;&#x56DE;&#x4EFB;&#x4F55;&#x517C;&#x5BB9;&#x4E8E; int &#x7684;&#x4E1C;&#x897F;&#x3002;&#x8BE6;&#x4E0B;&#x3002;</span>
    <span class="token keyword">typedef</span> std<span class="token operator">::</span>tr1<span class="token operator">::</span>function<span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> HealthCalcFunc<span class="token punctuation">;</span>
    <span class="token keyword">explicit</span> <span class="token function">GameCharacter</span><span class="token punctuation">(</span>HealthCalcFunc hcf <span class="token operator">=</span> defaultHealthCalc<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">healthFunc</span><span class="token punctuation">(</span>hcf<span class="token punctuation">)</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">healthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">healthFunc</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    HealthCalcFunc healthFunc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x6539;&#x53D8;&#x5982;&#x6B64;&#x7EC6;&#x5C0F;&#xFF0C;&#x6211;&#x603B;&#x8BF4;&#x5B83;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5916;&#x663E;&#x5F71;&#x54CD;&#xFF0C;&#x9664;&#x975E;&#x5BA2;&#x6237;&#x5728;&#x201C;&#x6307;&#x5B9A;&#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x201D;</span>
<span class="token comment">// &#x8FD9;&#x4EF6;&#x4E8B;&#x4E0A;&#x9700;&#x8981;&#x66F4;&#x60CA;&#x4EBA;&#x7684;&#x5F39;&#x6027;&#xFF1A;</span>
<span class="token keyword">short</span> <span class="token function">calcHealth</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#xFF1A;</span>
                                            <span class="token comment">// &#x6CE8;&#x610F;&#x5176;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4E3A; non-int</span>
<span class="token keyword">struct</span> HealthCalculator <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GameLevel</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">float</span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>   <span class="token comment">// &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x4EE5;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#xFF1A;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// &#x6CE8;&#x610F;&#x5176; non-int &#x8FD4;&#x56DE;&#x7C7B;&#x578B;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EvilBadGuy</span> <span class="token operator">:</span> <span class="token keyword">public</span> GameCharacter <span class="token punctuation">{</span>       <span class="token comment">// &#x540C;&#x524D;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EyeCandyCharacter</span> <span class="token operator">:</span> <span class="token keyword">public</span> GameCharacter <span class="token punctuation">{</span>    <span class="token comment">// &#x53E6;&#x4E00;&#x4E2A;&#x4EBA;&#x7269;&#x7C7B;&#x578B;&#xFF1A;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                             <span class="token comment">// &#x5047;&#x8BBE;&#x5176;&#x6784;&#x9020;&#x51FD;&#x6570;&#x4E0E;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                                  <span class="token comment">// EvilBadGuy &#x540C;</span>

EvilBadGuy <span class="token function">ebg1</span><span class="token punctuation">(</span>calcHealth<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// &#x4EBA;&#x7269; 1&#xFF0C;&#x4F7F;&#x7528;&#x67D0;&#x4E2A;</span>
                                                <span class="token comment">// &#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;</span>

EyeCandyCharacter <span class="token function">ecc1</span><span class="token punctuation">(</span><span class="token function">HealthCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x4EBA;&#x7269; 2&#xFF0C;&#x4F7F;&#x7528;&#x67D0;&#x4E2A;</span>
                                                <span class="token comment">// &#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;</span>
GameLevel currentLevel<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
EvilBadGuy <span class="token function">ebg2</span><span class="token punctuation">(</span>                                <span class="token comment">// &#x4EBA;&#x7269; 3 &#x4F7F;&#x7528;&#x67D0;&#x4E2A;</span>
    std<span class="token operator">::</span>tr1<span class="token operator">::</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>GameLevel<span class="token operator">::</span>health<span class="token punctuation">,</span>          <span class="token comment">// &#x6210;&#x5458;&#x51FD;&#x6570;&#x8BA1;&#x7B97;&#x5065;&#x5EB7;&#x6307;&#x6570;</span>
                   currentLevel<span class="token punctuation">,</span>
                   _1<span class="token punctuation">)</span>                          <span class="token comment">// &#x8BE6;&#x89C1;&#x4EE5;&#x4E0B;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// tr1::bind &#x7684;&#x4F5C;&#x4E3A;&#xFF1A;&#x5B83;&#x6307;&#x51FA; ebg2 &#x7684;&#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x603B;&#x662F;&#x4EE5;</span>
<span class="token comment">// currentLevel &#x4F5C;&#x4E3A; GameLevel &#x5BF9;&#x8C61;&#x3002;</span>




<span class="token comment">// &#x53E4;&#x5178;&#x7684; Strategy &#x6A21;&#x5F0F;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x5BF9;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF08;design patterns&#xFF09;&#x6BD4;&#x5BF9; C++ &#x7684;&#x9177;&#x52B2;&#x66F4;&#x6709;&#x5174;&#x8DA3;&#xFF0C;&#x6211;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;</span>
<span class="token comment">// &#x4F20;&#x7EDF;&#xFF08;&#x5178;&#x578B;&#xFF09;&#x7684; Strategy &#x505A;&#x6CD5;&#x4F1A;&#x5C06;&#x5065;&#x5EB7;&#x8BA1;&#x7B97;&#x51FD;&#x6570;&#x505A;&#x6210;&#x4E00;&#x4E2A;&#x5206;&#x79BB;&#x7684;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x7684;</span>
<span class="token comment">// virtual &#x6210;&#x5458;&#x51FD;&#x6570;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span><span class="token punctuation">;</span>        <span class="token comment">// &#x524D;&#x7F6E;&#x58F0;&#x660E;&#xFF08;forward declaration&#xFF09;</span>
<span class="token keyword">class</span> <span class="token class-name">HealthCalcFunc</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">virtual</span> <span class="token keyword">int</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token keyword">const</span> GameCharacter<span class="token operator">&amp;</span> gc<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

HealthCalcFunc defaultHealthCalc<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">GameCharacter</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">GameCharacter</span><span class="token punctuation">(</span>HealthCalcFunc<span class="token operator">*</span> phcf <span class="token operator">=</span> <span class="token operator">&amp;</span>defaultHealthCalc<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">pHealthCalc</span><span class="token punctuation">(</span>phcf<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">int</span> <span class="token function">healthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> pHealthCalc<span class="token operator">-&gt;</span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    HealthCalcFunc<span class="token operator">*</span> pHealthCalc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x89E3;&#x6CD5;&#x7684;&#x5438;&#x5F15;&#x529B;&#x5728;&#x4E8E;&#xFF0C;&#x719F;&#x6089;&#x6807;&#x51C6; Strategy &#x6A21;&#x5F0F;&#x7684;&#x4EBA;&#x5F88;&#x5BB9;&#x6613;&#x8FA8;&#x8BA4;&#x5B83;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x4E14;&#x5B83;&#x8FD8;&#x63D0;&#x4F9B;&#x201C;&#x5C06;&#x4E00;&#x4E2A;&#x65E2;&#x6709;&#x7684;&#x5065;&#x5EB7;&#x7B97;&#x6CD5;&#x7EB3;&#x5165;&#x4F7F;&#x7528;&#x201D;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x2014;&#x2014;&#x53EA;&#x8981;&#x4E3A; HealthCalcFunc</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A; derived class &#x5373;&#x53EF;&#x3002;</span>





<span class="token comment">// &#x672C;&#x6761;&#x6B3E;&#x7684;&#x6839;&#x672C;&#x5FE0;&#x544A;&#x662F;&#xFF0C;&#x5F53;&#x4F60;&#x4E3A;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x800C;&#x5BFB;&#x627E;&#x67D0;&#x4E2A;&#x8BBE;&#x8BA1;&#x65B9;&#x6CD5;&#x65F6;&#xFF0C;</span>
<span class="token comment">// &#x4E0D;&#x59A8;&#x8003;&#x8651; virtual &#x51FD;&#x6570;&#x7684;&#x66FF;&#x4EE3;&#x65B9;&#x6848;&#x3002;</span>

<span class="token comment">// &#xFF08;1&#xFF09;&#x4F7F;&#x7528; non-virtual interface&#xFF08;NVI&#xFF09;&#x624B;&#x6CD5;&#xFF0C;&#x90A3;&#x662F; Template Method &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</span>
<span class="token comment">// &#x7684;&#x4E00;&#x79CD;&#x7279;&#x6B8A;&#x5F62;&#x5F0F;&#x3002;&#x5B83;&#x4EE5; public non-virtual &#x6210;&#x5458;&#x51FD;&#x6570;&#x5305;&#x88F9;&#x8F83;&#x4F4E;&#x8BBF;&#x95EE;&#x6027;&#xFF08;private &#x6216;</span>
<span class="token comment">// protected&#xFF09;&#x7684; virtual &#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#xFF08;2&#xFF09;&#x5C06; virtual &#x51FD;&#x6570;&#x66FF;&#x6362;&#x4E3A; &#x201C;&#x51FD;&#x6570;&#x6307;&#x9488;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x201D;&#xFF0C;&#x8FD9;&#x662F; Strategy &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</span>
<span class="token comment">// &#x7684;&#x4E00;&#x79CD;&#x5206;&#x89E3;&#x8868;&#x73B0;&#x5F62;&#x5F0F;&#x3002;</span>

<span class="token comment">// &#xFF08;3&#xFF09;&#x4EE5; tr1::function &#x6210;&#x5458;&#x53D8;&#x91CF;&#x66FF;&#x6362; virtual &#x51FD;&#x6570;&#xFF0C;&#x56E0;&#x4E3A;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x53EF;&#x8C03;&#x7528;&#x7269;</span>
<span class="token comment">// &#xFF08;callable entity&#xFF09;&#x642D;&#x914D;&#x4E00;&#x4E2A;&#x517C;&#x5BB9;&#x4E8E;&#x9700;&#x6C42;&#x7684;&#x7B7E;&#x540D;&#x5F0F;&#x3002;&#x8FD9;&#x4E5F;&#x662F; Strategy &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x67D0;&#x79CD;&#x5F62;&#x5F0F;&#x3002;</span>

<span class="token comment">// &#xFF08;4&#xFF09;&#x5C06;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x5185;&#x7684; virtual &#x51FD;&#x6570;&#x66FF;&#x6362;&#x4E3A;&#x53E6;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x5185;&#x7684; virtual &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F; Strategy &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x7684;&#x4F20;&#x7EDF;&#x5B9E;&#x73B0;&#x624B;&#x6CD5;&#x3002;</span>

<span class="token comment">// &#x4EE5;&#x4E0A;&#x5E76;&#x672A;&#x5F7B;&#x5E95;&#x800C;&#x8BE6;&#x5C3D;&#x5730;&#x5217;&#x51FA; virtual &#x51FD;&#x6570;&#x7684;&#x6240;&#x6709;&#x66FF;&#x6362;&#x65B9;&#x6848;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5E94;&#x8BE5;&#x8DB3;&#x591F;&#x8BA9;&#x4F60;&#x77E5;&#x9053;&#x7684;&#x786E;&#x6709;&#x4E0D;&#x5C11;&#x66FF;&#x6362;&#x65B9;&#x6848;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-36%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84-non-virtual-%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 36&#xFF1A;&#x7EDD;&#x4E0D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; non-virtual &#x51FD;&#x6570;</h3>

<ul>
<li>&#x7EDD;&#x5BF9;&#x4E0D;&#x8981;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; non-virtual &#x51FD;&#x6570;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token keyword">public</span> B <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

D x<span class="token punctuation">;</span>                    <span class="token comment">// x &#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; D &#x7684;&#x5BF9;&#x8C61;</span>

B<span class="token operator">*</span> pB <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>             <span class="token comment">// &#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411; x</span>
pB<span class="token operator">-&gt;</span><span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x7ECF;&#x7531;&#x8BE5;&#x6307;&#x9488;&#x8C03;&#x7528; mf</span>

D<span class="token operator">*</span> pD <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>             <span class="token comment">// &#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411; x</span>
pD<span class="token operator">-&gt;</span><span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x7ECF;&#x7531;&#x8BE5;&#x6307;&#x9488;&#x8C03;&#x7528; mf</span>

<span class="token comment">// &#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x76F8;&#x5F53;&#x60CA;&#x8BB6;&#x3002;&#x6BD5;&#x7ADF;&#x4E24;&#x8005;&#x90FD;&#x901A;&#x8FC7;&#x5BF9;&#x8C61; x &#x8C03;&#x7528;&#x6210;&#x5458;&#x51FD;&#x6570; mf&#x3002;&#x7531;&#x4E8E;&#x4E24;&#x8005;&#x6240;&#x8C03;&#x7528;</span>
<span class="token comment">// &#x7684;&#x51FD;&#x6570;&#x90FD;&#x76F8;&#x540C;&#xFF0C;&#x51ED;&#x501F;&#x7684;&#x5BF9;&#x8C61;&#x4E5F;&#x76F8;&#x540C;&#xFF0C;&#x6240;&#x4EE5;&#x884C;&#x4E3A;&#x4E5F;&#x5E94;&#x8BE5;&#x76F8;&#x540C;&#xFF0C;&#x662F;&#x5417;&#xFF1F;</span>
<span class="token comment">// &#x662F;&#x7684;&#xFF0C;&#x7406;&#x5E94;&#x5982;&#x6B64;&#xFF0C;&#x4F46;&#x4E8B;&#x5B9E;&#x53EF;&#x80FD;&#x4E0D;&#x662F;&#x5982;&#x6B64;&#x3002;&#x66F4;&#x786E;&#x5207;&#x5730;&#x8BF4;&#xFF0C;&#x5982;&#x679C; mf &#x662F;&#x4E2A; non-virtual</span>
<span class="token comment">// &#x51FD;&#x6570;&#x800C; D &#x5B9A;&#x4E49;&#x6709;&#x81EA;&#x5DF1;&#x7684; mf &#x7248;&#x672C;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x662F;&#x5982;&#x6B64;&#xFF1A;</span>

<span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token operator">:</span> <span class="token keyword">public</span> B <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &#x906E;&#x63A9;&#xFF08;hides&#xFF09;&#x4E86; B::mf&#xFF1B;&#x89C1;&#x6761;&#x6B3E; 33</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
pB<span class="token operator">-&gt;</span><span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x8C03;&#x7528; B::mf</span>
pD<span class="token operator">-&gt;</span><span class="token function">mf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x8C03;&#x7528; D::mf</span>

<span class="token comment">// &#x9020;&#x6210;&#x8FD9;&#x4E00;&#x4E24;&#x9762;&#x884C;&#x4E3A;&#x7684;&#x539F;&#x56E0;&#x662F;&#xFF0C;non-virtual &#x51FD;&#x6570;&#x5982; B::mf &#x548C; D::mf &#x90FD;&#x662F;&#x9759;&#x6001;&#x7ED1;&#x5B9A;</span>
<span class="token comment">// &#xFF08;statically bound&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 37&#xFF09;&#x3002;&#x8FD9;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x7531;&#x4E8E; pB &#x88AB;&#x58F0;&#x660E;&#x4E3A;&#x4E00;&#x4E2A; pointers-to-B&#xFF0C;</span>
<span class="token comment">// &#x901A;&#x8FC7; pB &#x8C03;&#x7528;&#x7684; non-virtual &#x51FD;&#x6570;&#x6C38;&#x8FDC;&#x662F; B &#x6240;&#x5B9A;&#x4E49;&#x7684;&#x7248;&#x672C;&#xFF0C;&#x5373;&#x4F7F; pB &#x6307;&#x5411;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A;</span>
<span class="token comment">// &#x201C;B &#x6D3E;&#x751F;&#x4E4B; class&#x201D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E00;&#x5982;&#x672C;&#x4F8B;&#x3002;</span>





<span class="token comment">// &#x4F46;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;virtual &#x51FD;&#x6570;&#x5374;&#x662F;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#xFF08;dynamically bound&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 37&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x4E0D;&#x53D7;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x4E4B;&#x82E6;&#x3002;&#x5982;&#x679C; mf &#x662F;&#x4E2A; virtual &#x51FD;&#x6570;&#xFF0C;&#x4E0D;&#x8BBA;&#x662F;&#x901A;&#x8FC7; pB &#x6216; pD</span>
<span class="token comment">// &#x8C03;&#x7528; mf&#xFF0C;&#x90FD;&#x4F1A;&#x5BFC;&#x81F4;&#x8C03;&#x7528; D::mf&#xFF0C;&#x56E0;&#x4E3A; pB &#x548C; pD &#x771F;&#x6B63;&#x6307;&#x7684;&#x90FD;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; D &#x7684;&#x5BF9;&#x8C61;&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x6B63;&#x5728;&#x7F16;&#x5199; class D &#x5E76;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x81EA; class B &#x7684; non-virtual &#x51FD;&#x6570; mf&#xFF0C;</span>
<span class="token comment">// D &#x5BF9;&#x8C61;&#x5F88;&#x53EF;&#x80FD;&#x5C55;&#x73B0;&#x51FA;&#x7CBE;&#x795E;&#x5206;&#x88C2;&#x7684;&#x4E0D;&#x4E00;&#x81F4;&#x884C;&#x5F84;&#x3002;&#x66F4;&#x660E;&#x786E;&#x5730;&#x8BF4;&#xFF0C;&#x5F53; mf &#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A; D &#x5BF9;&#x8C61;</span>
<span class="token comment">// &#x90FD;&#x53EF;&#x80FD;&#x8868;&#x73B0;&#x51FA; B &#x6216; D &#x7684;&#x884C;&#x4E3A;&#xFF1B;&#x51B3;&#x5B9A;&#x56E0;&#x7D20;&#x4E0D;&#x5728;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#xFF0C;&#x800C;&#x5728;&#x4E8E;&#x201C;&#x6307;&#x5411;&#x8BE5;&#x5BF9;&#x8C61;&#x4E4B;&#x6307;&#x9488;&#x201D;</span>
<span class="token comment">// &#x5F53;&#x521D;&#x7684;&#x58F0;&#x660E;&#x7C7B;&#x578B;&#x3002;References &#x4E5F;&#x4F1A;&#x5C55;&#x73B0;&#x51FA;&#x548C;&#x6307;&#x9488;&#x4E00;&#x6837;&#x96BE;&#x4EE5;&#x7406;&#x89E3;&#x7684;&#x884C;&#x5F84;&#x3002;</span>





<span class="token comment">// &#x6761;&#x6B3E; 32 &#x5DF2;&#x7ECF;&#x8BF4;&#x8FC7;&#xFF0C;&#x6240;&#x8C13; public &#x7EE7;&#x627F;&#x610F;&#x5473; is-a&#xFF08;&#x662F;&#x4E00;&#x79CD;&#xFF09;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x6761;&#x6B3E; 34 &#x5219;&#x63CF;&#x8FF0;</span>
<span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x5728; class &#x5185;&#x58F0;&#x660E;&#x4E00;&#x4E2A; non-virtual &#x51FD;&#x6570;&#x4F1A;&#x4E3A;&#x8BE5; class &#x5EFA;&#x7ACB;&#x8D77;&#x4E00;&#x4E2A;&#x4E0D;&#x53D8;&#x6027;</span>
<span class="token comment">// &#xFF08;invariant&#xFF09;&#xFF0C;&#x51CC;&#x9A7E;&#x5176;&#x7279;&#x5F02;&#x6027;&#xFF08;specialization&#xFF09;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x89C2;&#x70B9;&#x65BD;&#x884C;&#x4E8E;&#x4E24;&#x4E2A;</span>
<span class="token comment">// classes B &#x548C; D &#x4EE5;&#x53CA; non-virtual &#x6210;&#x5458;&#x51FD;&#x6570; B::mf &#x8EAB;&#x4E0A;&#xFF0C;&#x90A3;&#x4E48;&#xFF1A;</span>
<span class="token comment">// 1&#x3001;&#x9002;&#x7528;&#x4E8E; B &#x5BF9;&#x8C61;&#x7684;&#x6BCF;&#x4E00;&#x4EF6;&#x4E8B;&#xFF0C;&#x4E5F;&#x9002;&#x7528;&#x4E8E; D &#x5BF9;&#x8C61;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x4E2A; D &#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x4E00;&#x4E2A; B &#x5BF9;&#x8C61;&#xFF1B;</span>
<span class="token comment">// 2&#x3001;B &#x7684; derived classes &#x4E00;&#x5B9A;&#x4F1A;&#x7EE7;&#x627F; mf &#x7684;&#x63A5;&#x53E3;&#x548C;&#x5B9E;&#x73B0;&#xFF0C;&#x56E0;&#x4E3A; mf &#x662F; B &#x7684;&#x4E00;&#x4E2A;</span>
<span class="token comment">// non-virtual &#x51FD;&#x6570;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-37%E7%BB%9D%E4%B8%8D%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89%E7%BB%A7%E6%89%BF%E8%80%8C%E6%9D%A5%E7%9A%84%E7%BC%BA%E7%9C%81%E5%8F%82%E6%95%B0%E5%80%BC">&#x6761;&#x6B3E; 37&#xFF1A;&#x7EDD;&#x4E0D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;</h3>

<ul>
<li>&#x7EDD;&#x5BF9;&#x4E0D;&#x8981;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#xFF0C;&#x56E0;&#x4E3A;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x90FD;&#x662F;&#x9759;&#x6001;&#x7ED1;&#x5B9A;&#xFF0C;&#x800C; virtual &#x51FD;&#x6570;&#x2014;&#x2014;&#x4F60;&#x552F;&#x4E00;&#x5E94;&#x8BE5;&#x8986;&#x5199;&#x7684;&#x4E1C;&#x897F;&#x2014;&#x2014;&#x5374;&#x662F;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// virtual &#x51FD;&#x6570;&#x7CFB;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#xFF08;dynamically bound&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x5374;&#x662F;&#x9759;&#x6001;&#x7ED1;&#x5B9A;&#xFF08;statically bound&#xFF09;&#x3002;</span>





<span class="token comment">// &#x5BF9;&#x8C61;&#x7684;&#x6240;&#x8C13;&#x9759;&#x6001;&#x7C7B;&#x578B;&#xFF08;static type&#xFF09;&#xFF0C;&#x5C31;&#x662F;&#x5B83;&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x88AB;&#x58F0;&#x660E;&#x65F6;&#x6240;&#x91C7;&#x7528;&#x7684;&#x7C7B;&#x578B;&#x3002;</span>
<span class="token comment">// &#x8003;&#x8651;&#x4EE5;&#x4E0B;&#x7684; class &#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#xFF1A;</span>

<span class="token comment">// &#x4E00;&#x4E2A;&#x7528;&#x4EE5;&#x63CF;&#x8FF0;&#x51E0;&#x4F55;&#x5F62;&#x72B6;&#x7684; class</span>
<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">enum</span> ShapeColor <span class="token punctuation">{</span> Red<span class="token punctuation">,</span> Green<span class="token punctuation">,</span> Blue <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x6240;&#x6709;&#x5F62;&#x72B6;&#x90FD;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x7ED8;&#x51FA;&#x81EA;&#x5DF1;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color <span class="token operator">=</span> Red<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x8D4B;&#x4E88;&#x4E0D;&#x540C;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x3002;&#x8FD9;&#x771F;&#x7CDF;&#x7CD5;&#xFF01;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color <span class="token operator">=</span> Green<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Circle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token comment">// &#x8BD1;&#x6CE8;&#xFF1A;&#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x4EE5;&#x4E0A;&#x8FD9;&#x4E48;&#x5199;&#x5219;&#x5F53;&#x5BA2;&#x6237;&#x4EE5;&#x5BF9;&#x8C61;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x6307;&#x5B9A;&#x53C2;&#x6570;&#x503C;&#x3002;</span>
    <span class="token comment">//       &#x56E0;&#x4E3A;&#x9759;&#x6001;&#x7ED1;&#x5B9A;&#x4E0B;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5E76;&#x4E0D;&#x4ECE;&#x5176; base &#x7EE7;&#x627F;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x3002;</span>
    <span class="token comment">//       &#x4F46;&#x82E5;&#x4EE5;&#x6307;&#x9488;&#xFF08;&#x6216; reference&#xFF09;&#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x4EE5;&#x4E0D;&#x6307;&#x5B9A;&#x53C2;&#x6570;&#x503C;&#x3002;</span>
    <span class="token comment">//       &#x56E0;&#x4E3A;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#x4E0B;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x4ECE;&#x5176; base &#x7EE7;&#x627F;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x73B0;&#x5728;&#x8003;&#x8651;&#x8FD9;&#x4E9B;&#x6307;&#x9488;&#xFF1A;</span>
Shape<span class="token operator">*</span> ps<span class="token punctuation">;</span>                      <span class="token comment">// &#x9759;&#x6001;&#x7C7B;&#x578B;&#x4E3A; Shape*</span>
Shape<span class="token operator">*</span> pc <span class="token operator">=</span> <span class="token keyword">new</span> Circle<span class="token punctuation">;</span>         <span class="token comment">// &#x9759;&#x6001;&#x7C7B;&#x578B;&#x4E3A; Shape*</span>
Shape<span class="token operator">*</span> pr <span class="token operator">=</span> <span class="token keyword">new</span> Rectangle<span class="token punctuation">;</span>      <span class="token comment">// &#x9759;&#x6001;&#x7C7B;&#x578B;&#x4E3A; Shape*</span>

<span class="token comment">// &#x672C;&#x4F8B;&#x4E2D; ps&#xFF0C;pc &#x548C; pr &#x90FD;&#x88AB;&#x58F0;&#x660E;&#x4E3A; pointer-to-Shape &#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x90FD;&#x4EE5;&#x5B83;&#x4E3A;&#x9759;&#x6001;&#x7C7B;&#x578B;&#x3002;</span>
<span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x8BBA;&#x5B83;&#x4EEC;&#x771F;&#x6B63;&#x6307;&#x4EC0;&#x4E48;&#xFF0C;&#x5B83;&#x4EEC;&#x7684;&#x9759;&#x6001;&#x7C7B;&#x578B;&#x90FD;&#x662F; Shape*&#x3002;</span>

<span class="token comment">// &#x5BF9;&#x8C61;&#x7684;&#x6240;&#x8C13;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#xFF08;dynamic type&#xFF09;&#x5219;&#x662F;&#x6307;&#x201C;&#x76EE;&#x524D;&#x6240;&#x6307;&#x5BF9;&#x8C61;&#x7684;&#x7C7B;&#x578B;&#x201D;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;</span>
<span class="token comment">// &#x52A8;&#x6001;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x8868;&#x73B0;&#x51FA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5C06;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x884C;&#x4E3A;&#x3002;&#x4EE5;&#x4E0A;&#x4F8B;&#x800C;&#x8A00;&#xFF0C;pc &#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x662F; Circle*&#xFF0C;</span>
<span class="token comment">// pr &#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x662F; Rectangle*&#x3002;ps &#x6CA1;&#x6709;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5C1A;&#x672A;&#x6307;&#x5411;&#x4EFB;&#x4F55;&#x5BF9;&#x8C61;&#x3002;</span>

<span class="token comment">// &#x52A8;&#x6001;&#x7C7B;&#x578B;&#x4E00;&#x5982;&#x5176;&#x540D;&#x79F0;&#x6240;&#x793A;&#xFF0C;&#x53EF;&#x5728;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x6539;&#x53D8;&#xFF08;&#x901A;&#x5E38;&#x662F;&#x7ECF;&#x7531;&#x8D4B;&#x503C;&#x52A8;&#x4F5C;&#xFF09;&#xFF1A;</span>
ps <span class="token operator">=</span> pc<span class="token punctuation">;</span>                <span class="token comment">// ps &#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x5982;&#x4ECA;&#x662F; Circle*</span>
ps <span class="token operator">=</span> pr<span class="token punctuation">;</span>                <span class="token comment">// ps &#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x5982;&#x4ECA;&#x662F; Rectangle*</span>

<span class="token comment">// Virtual &#x51FD;&#x6570;&#x7CFB;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#x800C;&#x6765;&#xFF0C;&#x610F;&#x601D;&#x662F;&#x8C03;&#x7528;&#x4E00;&#x4E2A; virtual &#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x7A76;&#x7ADF;&#x8C03;&#x7528;&#x54EA;&#x4E00;&#x4EFD;</span>
<span class="token comment">// &#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF0C;&#x53D6;&#x51B3;&#x4E8E;&#x53D1;&#x51FA;&#x8C03;&#x7528;&#x7684;&#x90A3;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#xFF1A;</span>
pc<span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span>Shape<span class="token operator">::</span>Red<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x8C03;&#x7528; Circle::draw(Shape::Red)</span>
pr<span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span>Shape<span class="token operator">::</span>Red<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x8C03;&#x7528; Rectangle::draw(Shape::Red)</span>

<span class="token comment">//virtual &#x51FD;&#x6570;&#x65F6;&#x52A8;&#x6001;&#x7ED1;&#x5B9A;&#xFF0C;&#x800C;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x5374;&#x662F;&#x9759;&#x6001;&#x7ED1;&#x5B9A;&#x3002;&#x610F;&#x601D;&#x662F;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;&#x5728;</span>
<span class="token comment">// &#x201C;&#x8C03;&#x7528;&#x4E00;&#x4E2A;&#x5B9A;&#x4E49;&#x4E8E; derived class &#x5185;&#x7684; virtual &#x51FD;&#x6570;&#x201D;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x5374;&#x4F7F;&#x7528;</span>
<span class="token comment">// base class &#x4E3A;&#x5B83;&#x6240;&#x6307;&#x5B9A;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#xFF1A;</span>
pr<span class="token operator">-&gt;</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x8C03;&#x7528; Rectangle::draw(Shape::Red)&#xFF01;</span>

<span class="token comment">// &#x6B64;&#x4F8B;&#x4E4B;&#x4E2D;&#xFF0C;pr &#x7684;&#x52A8;&#x6001;&#x7C7B;&#x578B;&#x662F; Rectangle*&#xFF0C;&#x6240;&#x4EE5;&#x8C03;&#x7528;&#x7684;&#x662F; Rectangle &#x7684; virtual &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x4E00;&#x5982;&#x4F60;&#x6240;&#x9884;&#x671F;&#x3002;Rectangle::draw &#x51FD;&#x6570;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x5E94;&#x8BE5;&#x662F; GREEN&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x7531;&#x4E8E; pr &#x7684;&#x9759;&#x6001;&#x7C7B;&#x578B;&#x662F; Shape*&#xFF0C;&#x6240;&#x4EE5;&#x6B64;&#x4E00;&#x8C03;&#x7528;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x6765;&#x81EA; Shape class</span>
<span class="token comment">// &#x800C;&#x975E; Rectangle class&#xFF01;&#x7ED3;&#x5C40;&#x662F;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6709;&#x7740;&#x5947;&#x602A;&#x5E76;&#x4E14;&#x51E0;&#x4E4E;&#x7EDD;&#x5BF9;&#x6CA1;&#x4EBA;&#x9884;&#x6599;&#x5F97;&#x5230;</span>
<span class="token comment">// &#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x7531; Shape class &#x548C; Rectangle class &#x7684; draw &#x58F0;&#x660E;&#x5F0F;&#x5404;&#x51FA;&#x4E00;&#x534A;&#x529B;&#x3002;</span>

<span class="token comment">// &#x4EE5;&#x4E0A;&#x4E8B;&#x5B9E;&#x4E0D;&#x53EA;&#x5C40;&#x9650;&#x4E8E;&#x201C;ps&#xFF0C;pc &#x548C; pr &#x90FD;&#x662F;&#x6307;&#x9488;&#x201D;&#x7684;&#x60C5;&#x51B5;&#xFF1B;&#x5373;&#x4F7F;&#x628A;&#x6307;&#x9488;&#x6362;&#x6210; references</span>
<span class="token comment">// &#x95EE;&#x9898;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#x3002;&#x91CD;&#x70B9;&#x5728;&#x4E8E; draw &#x662F;&#x4E2A; virtual &#x51FD;&#x6570;&#xFF0C;&#x800C;&#x5B83;&#x6709;&#x4E2A;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x5728; derived class</span>
<span class="token comment">// &#x4E2D;&#x88AB;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x4E86;&#x3002;</span>





<span class="token comment">// &#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x5F88;&#x597D;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x4F60;&#x8BD5;&#x7740;&#x9075;&#x5B88;&#x8FD9;&#x6761;&#x89C4;&#x5219;&#xFF0C;&#x5E76;&#x4E14;&#x540C;&#x65F6;&#x63D0;&#x4F9B;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x7ED9; base</span>
<span class="token comment">// &#x548C; derived classes &#x7684;&#x7528;&#x6237;&#xFF0C;&#x53C8;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#x5462;&#xFF1F;</span>
<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">enum</span> ShapeColor <span class="token punctuation">{</span> Red<span class="token punctuation">,</span> Green<span class="token punctuation">,</span> Blue <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color <span class="token operator">=</span> Red<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color <span class="token operator">=</span> Red<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5594;&#x5662;&#xFF0C;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x3002;&#x66F4;&#x7CDF;&#x7684;&#x662F;&#xFF0C;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x53C8;&#x5E26;&#x7740;&#x76F8;&#x4F9D;&#x6027;&#xFF08;with dependencies&#xFF09;&#xFF1A;</span>
<span class="token comment">// &#x5982;&#x679C; Shape &#x5185;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x6539;&#x53D8;&#x4E86;&#xFF0C;&#x6240;&#x6709;&#x201C;&#x91CD;&#x590D;&#x7ED9;&#x5B9A;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x201D;&#x7684;&#x90A3;&#x4E9B; derived</span>
<span class="token comment">// classes &#x4E5F;&#x5FC5;&#x987B;&#x6539;&#x53D8;&#xFF0C;&#x5426;&#x5219;&#x5B83;&#x4EEC;&#x6700;&#x7EC8;&#x4F1A;&#x5BFC;&#x81F4;&#x201C;&#x91CD;&#x590D;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x201D;&#x3002;</span>
<span class="token comment">// &#x600E;&#x4E48;&#x529E;&#xFF1F;</span>

<span class="token comment">// &#x806A;&#x660E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x8003;&#x8651;&#x66FF;&#x4EE3;&#x8BBE;&#x8BA1;&#x3002;&#x6761;&#x6B3E; 35 &#x5217;&#x4E86;&#x4E0D;&#x5C11; virtual &#x51FD;&#x6570;&#x7684;&#x66FF;&#x4EE3;&#x8BBE;&#x8BA1;&#xFF0C;</span>
<span class="token comment">// &#x5176;&#x4E2D;&#x4E4B;&#x4E00;&#x662F; NVI&#xFF08;non-virtual interface&#xFF09;&#x624B;&#x6CD5;&#xFF1A;&#x4EE4; base class &#x5185;&#x7684;</span>
<span class="token comment">// &#x4E00;&#x4E2A; public non-virtual &#x51FD;&#x6570;&#x8C03;&#x7528; private virtual &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x540E;&#x8005;&#x53EF;&#x88AB; derived classes &#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BA9; non-virtual &#x51FD;&#x6570;&#x6307;&#x5B9A;</span>
<span class="token comment">// &#x7F3A;&#x7701;&#x53C2;&#x6570;&#xFF0C;&#x800C; private virtual &#x51FD;&#x6570;&#x8D1F;&#x8D23;&#x771F;&#x6B63;&#x7684;&#x5DE5;&#x4F5C;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">enum</span> ShapeColor <span class="token punctuation">{</span> Red<span class="token punctuation">,</span> Green<span class="token punctuation">,</span> Blue <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span>ShapeColor color <span class="token operator">=</span> Red<span class="token punctuation">)</span> <span class="token keyword">const</span>             <span class="token comment">// &#x5982;&#x4ECA;&#x5B83;&#x662F; non-virtual</span>
    <span class="token punctuation">{</span>
        <span class="token function">doDraw</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token comment">// &#x8C03;&#x7528;&#x4E00;&#x4E2A; virtual</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">doDraw</span><span class="token punctuation">(</span>ShapeColor color<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// &#x771F;&#x6B63;&#x7684;&#x5DE5;&#x4F5C;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                                                      <span class="token comment">// &#x5728;&#x6B64;&#x5904;&#x5B8C;&#x6210;</span>

<span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Shape <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">doDraw</span><span class="token punctuation">(</span>ShapeColor color<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x987B;&#x6307;&#x5B9A;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                                 <span class="token comment">// &#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7531;&#x4E8E; non-virtual &#x51FD;&#x6570;&#x5E94;&#x8BE5;&#x7EDD;&#x5BF9;&#x4E0D;&#x88AB; derived classes &#x8986;&#x5199;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 36&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x5F88;&#x6E05;&#x695A;&#x5730;&#x4F7F;&#x5F97; draw &#x51FD;&#x6570;&#x7684; color &#x7F3A;&#x7701;&#x53C2;&#x6570;&#x503C;&#x603B;&#x662F;&#x4E3A; Red&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-38%E9%80%9A%E8%BF%87%E5%A4%8D%E5%90%88%E5%A1%91%E6%A8%A1%E5%87%BA-has-a-%E6%88%96%E6%A0%B9%E6%8D%AE%E6%9F%90%E7%89%A9%E5%AE%9E%E7%8E%B0%E5%87%BA">&#x6761;&#x6B3E; 38&#xFF1A;&#x901A;&#x8FC7;&#x590D;&#x5408;&#x5851;&#x6A21;&#x51FA; has-a &#x6216;&#x201C;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#x201D;</h3>

<ul>
<li>&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x7684;&#x610F;&#x4E49;&#x548C; public &#x7EE7;&#x627F;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x3002;</li>
<li>&#x5728;&#x5E94;&#x7528;&#x57DF;&#xFF08;application domain&#xFF09;&#xFF0C;&#x590D;&#x5408;&#x610F;&#x5473; has-a&#xFF08;&#x6709;&#x4E00;&#x4E2A;&#xFF09;&#x3002;&#x5728;&#x5B9E;&#x73B0;&#x57DF;&#xFF08;implementation domain&#xFF09;&#xFF0C;&#x590D;&#x5408;&#x610F;&#x5473; is-implemented-in-terms-of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x662F;&#x7C7B;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x4E00;&#x79CD;&#x5173;&#x7CFB;&#xFF0C;&#x5F53;&#x67D0;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x5185;&#x542B;&#x5B83;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x4FBF;&#x662F;&#x8FD9;&#x79CD;&#x5173;&#x7CFB;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">PhoneNumber</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>string name<span class="token punctuation">;</span>               <span class="token comment">// &#x5408;&#x6210;&#x6210;&#x5206;&#x7269;&#xFF08;composed object&#xFF09;</span>
    Address address<span class="token punctuation">;</span>                <span class="token comment">// &#x540C;&#x4E0A;</span>
    PhoneNumber voiceNumber<span class="token punctuation">;</span>        <span class="token comment">// &#x540C;&#x4E0A;</span>
    PhoneNumber faxNumber<span class="token punctuation">;</span>          <span class="token comment">// &#x540C;&#x4E0A;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5728;&#x7A0B;&#x5E8F;&#x5458;&#x4E4B;&#x95F4;&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x6709;&#x8BB8;&#x591A;&#x540C;&#x4E49;&#x8BCD;&#xFF0C;&#x5305;&#x62EC; layering&#xFF08;&#x5206;&#x5C42;&#xFF09;&#xFF0C;</span>
<span class="token comment">// containment&#xFF08;&#x5185;&#x542B;&#xFF09;&#xFF0C;aggregation&#xFF08;&#x805A;&#x5408;&#xFF09;&#x548C; embedding&#xFF08;&#x5185;&#x5D4C;&#xFF09;&#x3002;</span>

<span class="token comment">// &#x6761;&#x6B3E; 32 &#x66FE;&#x8BF4;&#xFF0C;&#x201C;public &#x7EE7;&#x627F;&#x201D;&#x5E26;&#x6709; is-a&#xFF08;&#x662F;&#x4E00;&#x79CD;&#xFF09;&#x7684;&#x610F;&#x4E49;&#x3002;&#x590D;&#x5408;&#x4E5F;&#x6709;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x610F;&#x4E49;&#x3002;</span>
<span class="token comment">// &#x5B9E;&#x9645;&#x4E0A;&#x5B83;&#x6709;&#x4E24;&#x4E2A;&#x610F;&#x4E49;&#x3002;&#x590D;&#x5408;&#x610F;&#x5473; has-a&#xFF08;&#x6709;&#x4E00;&#x4E2A;&#xFF09;</span>
<span class="token comment">// &#x6216; is-implemented-in-terms-of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x90A3;&#x662F;&#x56E0;&#x4E3A;&#x4F60;&#x6B63;&#x6253;&#x7B97;&#x5728;&#x4F60;&#x7684;&#x8F6F;&#x4EF6;&#x4E2D;&#x5904;&#x7406;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x9886;&#x57DF;&#xFF08;domains&#xFF09;&#x3002;</span>
<span class="token comment">// &#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x5176;&#x5B9E;&#x76F8;&#x5F53;&#x4E8E;&#x4F60;&#x6240;&#x5851;&#x9020;&#x7684;&#x4E16;&#x754C;&#x4E2D;&#x7684;&#x67D0;&#x4E9B;&#x4E8B;&#x7269;&#xFF0C;&#x4F8B;&#x5982;&#x4EBA;&#x3001;&#x6C7D;&#x8F66;&#x3001;&#x4E00;&#x5F20;&#x5F20;&#x89C6;&#x9891;&#x753B;&#x9762;&#x7B49;&#x7B49;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x5C5E;&#x4E8E;&#x5E94;&#x7528;&#x57DF;&#xFF08;application domain&#xFF09;&#x90E8;&#x5206;&#x3002;</span>
<span class="token comment">// &#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x5219;&#x7EAF;&#x7CB9;&#x662F;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x4E0A;&#x7684;&#x4EBA;&#x5DE5;&#x5236;&#x54C1;&#xFF0C;&#x50CF;&#x662F;&#x7F13;&#x51B2;&#x533A;&#xFF08;buffers&#xFF09;&#x3001;&#x4E92;&#x65A5;&#x5668;&#xFF08;mutexes&#xFF09;&#x3001;</span>
<span class="token comment">// &#x67E5;&#x627E;&#x6811;&#xFF08;search trees&#xFF09;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x76F8;&#x5F53;&#x4E8E;&#x4F60;&#x7684;&#x8F6F;&#x4EF6;&#x7684;&#x5B9E;&#x73B0;&#x57DF;&#xFF08;implementation domain&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5F53;&#x590D;&#x5408;&#x53D1;&#x751F;&#x4E8E;&#x5E94;&#x7528;&#x57DF;&#x5185;&#x7684;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#xFF0C;&#x8868;&#x73B0;&#x51FA; has-a &#x7684;&#x5173;&#x7CFB;&#xFF1A;</span>
<span class="token comment">// &#x5F53;&#x5B83;&#x53D1;&#x751F;&#x4E8E;&#x5B9E;&#x73B0;&#x57DF;&#x5185;&#x5219;&#x662F;&#x8868;&#x73B0; is-implemented-in-terms-of &#x7684;&#x5173;&#x7CFB;&#x3002;</span>

<span class="token comment">// &#x4E0A;&#x8FF0;&#x7684; Person class &#x793A;&#x8303; has-a &#x5173;&#x7CFB;&#x3002;</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>            <span class="token comment">// &#x5C06; list &#x5E94;&#x7528;&#x4E8E; Set&#x3002;&#x9519;&#x8BEF;&#x505A;&#x6CD5;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Set</span> <span class="token operator">:</span> <span class="token keyword">public</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E00;&#x5982;&#x6761;&#x6B3E; 32 &#x6240;&#x8BF4;&#xFF0C;&#x5982;&#x679C; D &#x662F;&#x4E00;&#x79CD;&#x5BF9;&#x8C61;&#xFF0C;&#x5BF9; B &#x4E3A;&#x771F;&#x7684;&#x6BCF;&#x4E00;&#x4EF6;&#x4E8B;&#x60C5;&#x5BF9; D &#x4E5F;&#x90FD;&#x5E94;&#x8BE5;&#x4E3A;&#x771F;&#x3002;</span>
<span class="token comment">// &#x4F46; list &#x53EF;&#x4EE5;&#x5185;&#x542B;&#x91CD;&#x590D;&#x5143;&#x7D20;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x503C; 3051 &#x88AB;&#x5B89;&#x63D2;&#x5230; list&lt;int&gt; &#x4E24;&#x6B21;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E2A; list &#x5C06;&#x5185;&#x542B;&#x4E24;&#x7B14; 3051&#x3002;Set &#x4E0D;&#x53EF;&#x4EE5;&#x5185;&#x542B;&#x91CD;&#x590D;&#x5143;&#x7D20;&#xFF0C;</span>
<span class="token comment">// &#x5982;&#x679C;&#x6570;&#x503C; 3051 &#x88AB;&#x5B89;&#x63D2;&#x5230; Set&lt;int&gt; &#x4E24;&#x6B21;&#xFF0C;&#x8FD9;&#x4E2A; Set &#x53EA;&#x5185;&#x542B;&#x4E00;&#x7B14; 3051&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x201C;Set &#x662F;&#x4E00;&#x79CD; list&#x201D;&#x5E76;&#x4E0D;&#x4E3A;&#x771F;&#xFF0C;&#x56E0;&#x4E3A;&#x5BF9; list &#x5BF9;&#x8C61;&#x4E3A;&#x771F;&#x7684;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#x5BF9; Set &#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x4E3A;&#x771F;&#x3002;</span>





<span class="token comment">// &#x7531;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A; classes &#x4E4B;&#x95F4;&#x5E76;&#x975E; is-a &#x7684;&#x5173;&#x7CFB;&#xFF0C;&#x6240;&#x4EE5; public &#x7EE7;&#x627F;&#x4E0D;&#x9002;&#x5408;&#x7528;&#x6765;&#x5851;&#x6A21;&#x5B83;&#x4EEC;&#x3002;</span>
<span class="token comment">// &#x6B63;&#x786E;&#x7684;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x4F60;&#x5E94;&#x5F53;&#x4E86;&#x89E3;&#xFF0C;Set &#x5BF9;&#x8C61;&#x53EF;&#x6839;&#x636E;&#x4E00;&#x4E2A; list &#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#x51FA;&#x6765;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>                       <span class="token comment">// &#x5C06; list &#x5E94;&#x7528;&#x4E8E; Set&#x3002;&#x6B63;&#x786E;&#x505A;&#x6CD5;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Set</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">member</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span>size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> rep<span class="token punctuation">;</span>                   <span class="token comment">// &#x7528;&#x6765;&#x8868;&#x8FF0; Set &#x7684;&#x6570;&#x636E;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Set &#x6210;&#x5458;&#x51FD;&#x6570;&#x5927;&#x91CF;&#x501A;&#x8D56; list &#x53CA;&#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x63D0;&#x4F9B;&#x7684;&#x6280;&#x80FD;&#x6765;&#x5B8C;&#x6210;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5176;&#x5B9E;&#x73B0;&#x5F88;&#x76F4;&#x89C2;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x8981;&#x4F60;&#x719F;&#x6089;&#x4EE5; STL &#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">bool</span> Set<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">member</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> std<span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rep<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">!=</span> rep<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> Set<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">member</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> rep<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> Set<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> item<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">typename</span> std<span class="token operator">::</span>list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>iterator it <span class="token operator">=</span>            <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 42 &#x5BF9;</span>
        std<span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span>rep<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rep<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x201C;typename&#x201D;&#x7684;&#x8BA8;&#x8BBA;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> rep<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> rep<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
std<span class="token operator">::</span>size_t Set<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> rep<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x5982;&#x6B64;&#x7B80;&#x5355;&#xFF0C;&#x56E0;&#x6B64;&#x90FD;&#x9002;&#x5408;&#x6210;&#x4E3A; inlining &#x5019;&#x9009;&#x4EBA;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x8BF7;&#x8BB0;&#x4F4F;&#xFF0C;&#x5728;&#x505A;&#x51FA;&#x4EFB;&#x4F55;&#x4E0E; inlining &#x6709;&#x5173;&#x7684;&#x51B3;&#x5B9A;&#x4E4B;&#x524D;&#xFF0C;&#x5E94;&#x8BE5;&#x5148;&#x770B;&#x770B;&#x6761;&#x6B3E; 30&#x3002;</span>

<span class="token comment">// Set &#x63A5;&#x53E3;&#x4E5F;&#x4E0D;&#x8BE5;&#x9020;&#x6210;&#x201C;&#x5BF9; Set &#x800C;&#x8A00;&#x65E0;&#x53EF;&#x7F6E;&#x8FA9;&#x7684;&#x6743;&#x5229;&#x201D;&#x9EEF;&#x7136;&#x5931;&#x8272;&#xFF0C;&#x90A3;&#x4E2A;&#x6743;&#x5229;&#x662F;&#x6307;</span>
<span class="token comment">// &#x5B83;&#x548C; list &#x95F4;&#x7684;&#x5173;&#x7CFB;&#x3002;&#x8FD9;&#x5173;&#x7CFB;&#x5E76;&#x975E; is-a&#xFF08;&#x867D;&#x7136;&#x6700;&#x521D;&#x4F3C;&#x4E4E;&#x662F;&#xFF09;&#xFF0C;&#x800C;&#x662F;</span>
<span class="token comment">// is-implemented-in-terms-of&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-39%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8-private-%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 39&#xFF1A;&#x660E;&#x667A;&#x800C;&#x5BA1;&#x614E;&#x5730;&#x4F7F;&#x7528; private &#x7EE7;&#x627F;</h3>

<ul>
<li>Private &#x7EE7;&#x627F;&#x610F;&#x5473; is-implemented-in-terms of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;&#x5B83;&#x901A;&#x5E38;&#x6BD4;&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x7684;&#x7EA7;&#x522B;&#x4F4E;&#x3002;&#x4F46;&#x662F;&#x5F53; derived class &#x9700;&#x8981;&#x8BBF;&#x95EE; protected base class &#x7684;&#x6210;&#x5458;&#xFF0C;&#x6216;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684; virtual &#x51FD;&#x6570;&#x65F6;&#xFF0C;&#x8FD9;&#x4E48;&#x8BBE;&#x8BA1;&#x662F;&#x5408;&#x7406;&#x7684;&#x3002;</li>
<li>&#x548C;&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x4E0D;&#x540C;&#xFF0C;private &#x7EE7;&#x627F;&#x53EF;&#x4EE5;&#x9020;&#x6210; empty base &#x6700;&#x4F18;&#x5316;&#x3002;&#x8FD9;&#x5BF9;&#x81F4;&#x529B;&#x4E8E;&#x201C;&#x5BF9;&#x8C61;&#x5C3A;&#x5BF8;&#x6700;&#x5C0F;&#x5316;&#x201D;&#x7684;&#x7A0B;&#x5E8F;&#x5E93;&#x5F00;&#x53D1;&#x8005;&#x800C;&#x8A00;&#xFF0C;&#x53EF;&#x80FD;&#x5F88;&#x91CD;&#x8981;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x73B0;&#x5728;&#x6211;&#x518D;&#x91CD;&#x590D;&#x8BE5;&#x4F8B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x5E76;&#x4EE5; private &#x7EE7;&#x627F;&#x66FF;&#x6362; public &#x7EE7;&#x627F;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token operator">:</span> <span class="token keyword">private</span> Person <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>         <span class="token comment">// &#x8FD9;&#x6B21;&#x6539;&#x7528; private &#x7EE7;&#x627F;</span>
<span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token keyword">const</span> Person<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x4F1A;&#x5403;</span>
<span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token keyword">const</span> Student<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x53EA;&#x6709;&#x5B66;&#x751F;&#x624D;&#x5728;&#x5B66;&#x6821;&#x5B66;&#x4E60;</span>

Person p<span class="token punctuation">;</span>               <span class="token comment">// p &#x662F;&#x4EBA;</span>
Student s<span class="token punctuation">;</span>              <span class="token comment">// s &#x662F;&#x5B66;&#x751F;</span>

<span class="token function">eat</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;p &#x662F;&#x4EBA;&#xFF0C;&#x4F1A;&#x5403;&#x3002;</span>
<span class="token function">eat</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x6CA1;&#x9519;&#xFF01;&#x5413;&#xFF0C;&#x96BE;&#x9053;&#x5B66;&#x751F;&#x4E0D;&#x662F;&#x4EBA;&#xFF1F;&#xFF01;</span>

<span class="token comment">// &#x663E;&#x7136; private &#x7EE7;&#x627F;&#x5E76;&#x4E0D;&#x610F;&#x5473; is-a &#x5173;&#x7CFB;&#x3002;&#x90A3;&#x4E48;&#x5B83;&#x610F;&#x5473;&#x4EC0;&#x4E48;&#xFF1F;</span>

<span class="token comment">// &#x5230;&#x5E95; private &#x7EE7;&#x627F;&#x7684;&#x884C;&#x4E3A;&#x5982;&#x4F55;&#x5462;&#xFF1F;&#x5514;&#xFF0C;&#x7EDF;&#x5FA1; private &#x7EE7;&#x627F;&#x7684;&#x9996;&#x8981;&#x89C4;&#x5219;&#x4F60;&#x521A;&#x624D;&#x5DF2;&#x7ECF;&#x89C1;&#x8FC7;&#x4E86;&#xFF1A;</span>
<span class="token comment">// &#x5982;&#x679C; classes &#x4E4B;&#x95F4;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x662F; private&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x5C06;&#x4E00;&#x4E2A; derived class &#x5BF9;&#x8C61;</span>
<span class="token comment">// &#xFF08;&#x4F8B;&#x5982; Student&#xFF09;&#x8F6C;&#x6362;&#x4E3A;&#x4E00;&#x4E2A; base class &#x5BF9;&#x8C61;&#xFF08;&#x4F8B;&#x5982; Person&#xFF09;&#x3002;&#x8FD9;&#x548C; public</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x7684;&#x60C5;&#x51B5;&#x4E0D;&#x540C;&#x3002;&#x8FD9;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x901A;&#x8FC7; s &#x8C03;&#x7528; eat &#x4F1A;&#x5931;&#x8D25;&#x7684;&#x539F;&#x56E0;&#x3002;&#x7B2C;&#x4E8C;&#x6761;&#x89C4;&#x5219;&#x662F;&#xFF0C;</span>
<span class="token comment">// &#x7531; private base class &#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x6240;&#x6709;&#x6210;&#x5458;&#xFF0C;&#x5728; derived class &#x4E2D;&#x90FD;&#x4F1A;</span>
<span class="token comment">// &#x53D8;&#x6210; private &#x5C5E;&#x6027;&#xFF0C;&#x7EB5;&#x4F7F;&#x5B83;&#x4EEC;&#x5728; base class &#x4E2D;&#x539F;&#x672C;&#x662F; protected &#x6216; public &#x5C5E;&#x6027;&#x3002;</span>

<span class="token comment">// Private &#x7EE7;&#x627F;&#x610F;&#x5473; implemented-in-terms-of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x8BA9; class D &#x4EE5; private &#x5F62;&#x5F0F;&#x7EE7;&#x627F; class B&#xFF0C;&#x4F60;&#x7684;&#x7528;&#x610F;&#x662F;&#x4E3A;&#x4E86;&#x91C7;&#x7528; class B </span>
<span class="token comment">// &#x5185;&#x5DF2;&#x7ECF;&#x5907;&#x59A5;&#x7684;&#x67D0;&#x4E9B;&#x7279;&#x6027;&#xFF0C;&#x4E0D;&#x662F;&#x56E0;&#x4E3A; B &#x5BF9;&#x8C61;&#x548C; D &#x5BF9;&#x8C61;&#x5B58;&#x5728;&#x6709;&#x4EFB;&#x4F55;&#x89C2;&#x5FF5;&#x4E0A;&#x7684;&#x5173;&#x7CFB;&#x3002;</span>
<span class="token comment">// private &#x7EE7;&#x627F;&#x7EAF;&#x7CB9;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x5B9E;&#x73B0;&#x6280;&#x672F;&#xFF08;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x7EE7;&#x627F;&#x81EA;&#x4E00;&#x4E2A; private base class</span>
<span class="token comment">// &#x7684;&#x6BCF;&#x6837;&#x4E1C;&#x897F;&#x5728;&#x4F60;&#x7684; class &#x5185;&#x90FD;&#x662F; private&#xFF1A;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x90FD;&#x53EA;&#x662F;&#x5B9E;&#x73B0;&#x679D;&#x8282;&#x800C;&#x5DF2;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x501F;&#x7528;&#x6761;&#x6B3E; 34 &#x63D0;&#x51FA;&#x7684;&#x672F;&#x8BED;&#xFF0C;private &#x7EE7;&#x627F;&#x610F;&#x5473;&#x53EA;&#x6709;&#x5B9E;&#x73B0;&#x90E8;&#x5206;&#x88AB;&#x7EE7;&#x627F;&#xFF0C;&#x63A5;&#x53E3;&#x90E8;&#x5206;&#x5E94;&#x7565;&#x53BB;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; D &#x4EE5; private &#x5F62;&#x5F0F;&#x7EE7;&#x627F; B&#xFF0C;&#x610F;&#x601D;&#x662F; D &#x5BF9;&#x8C61;&#x6839;&#x636E; B &#x5BF9;&#x8C61;&#x5B9E;&#x73B0;&#x800C;&#x5F97;&#xFF0C;&#x518D;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x610F;&#x6DB5;&#x4E86;&#x3002;</span>
<span class="token comment">// Private &#x7EE7;&#x627F;&#x5728;&#x8F6F;&#x4EF6;&#x201C;&#x8BBE;&#x8BA1;&#x201D;&#x5C42;&#x9762;&#x4E0A;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#xFF0C;&#x5176;&#x610F;&#x4E49;&#x53EA;&#x53CA;&#x4E8E;&#x8F6F;&#x4EF6;&#x5B9E;&#x73B0;&#x5C42;&#x9762;&#x3002;</span>

<span class="token comment">// Private &#x7EE7;&#x627F;&#x610F;&#x5473; is-implemented-in-terms-of&#xFF08;&#x6839;&#x636E;&#x67D0;&#x7269;&#x5B9E;&#x73B0;&#x51FA;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x6761;&#x6B3E; 38 &#x624D;&#x521A;&#x6307;&#x51FA;&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x7684;&#x610F;&#x4E49;&#x4E5F;&#x662F;&#x8FD9;&#x6837;&#x3002;&#x4F60;&#x5982;&#x4F55;&#x5728;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x53D6;&#x820D;&#xFF1F;</span>
<span class="token comment">// &#x7B54;&#x6848;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x590D;&#x5408;&#xFF0C;&#x5FC5;&#x8981;&#x65F6;&#x624D;&#x4F7F;&#x7528; private &#x7EE7;&#x627F;&#x3002;</span>
<span class="token comment">// &#x4F55;&#x65F6;&#x624D;&#x662F;&#x5FC5;&#x8981;&#xFF1F;&#x4E3B;&#x8981;&#x5F53; protected &#x6210;&#x5458;&#x548C; / &#x6216; virtual &#x51FD;&#x6570;&#x7275;&#x626F;&#x8FDB;&#x6765;&#x7684;&#x65F6;&#x5019;&#x3002;</span>
<span class="token comment">// &#x5176;&#x5B9E;&#x8FD8;&#x8981;&#x4E00;&#x79CD;&#x6FC0;&#x8FDB;&#x60C5;&#x51B5;&#xFF0C;&#x90A3;&#x662F;&#x5F53;&#x7A7A;&#x95F4;&#x65B9;&#x9762;&#x7684;&#x5229;&#x5BB3;&#x5173;&#x7CFB;&#x8DB3;&#x4EE5;&#x8E22;&#x7FFB; private &#x7EE7;&#x627F;&#x7684;&#x652F;&#x67F1;&#x65F6;&#x3002;</span>





<span class="token keyword">class</span> <span class="token class-name">Timer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token keyword">int</span> tickFrequency<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>            <span class="token comment">// &#x5B9A;&#x65F6;&#x5668;&#x6BCF;&#x6EF4;&#x7B54;&#x4E00;&#x6B21;&#xFF0C;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x6B64;&#x51FD;&#x6570;&#x5C31;&#x88AB;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x8BA9; Widget &#x91CD;&#x65B0;&#x5B9A;&#x4E49; Timer &#x5185;&#x7684; virtual &#x51FD;&#x6570;&#xFF0C;widget &#x5FC5;&#x987B;&#x7EE7;&#x627F;&#x81EA; Timer&#x3002;</span>
<span class="token comment">// &#x4F46; public &#x7EE7;&#x627F;&#x5728;&#x6B64;&#x4F8B;&#x5E76;&#x4E0D;&#x9002;&#x5F53;&#xFF0C;&#x56E0;&#x4E3A; Widget &#x5E76;&#x4E0D;&#x662F;&#x4E2A; Timer&#x3002;&#x662F;&#x5440;&#xFF0C;</span>
<span class="token comment">// Widget &#x5BA2;&#x6237;&#x603B;&#x4E0D;&#x8BE5;&#x80FD;&#x591F;&#x5BF9;&#x7740;&#x4E00;&#x4E2A; Widget &#x8C03;&#x7528; onTick &#x5427;&#xFF0C;&#x56E0;&#x4E3A;&#x89C2;&#x5FF5;&#x4E0A;&#x90A3;&#x5E76;&#x4E0D;&#x662F;</span>
<span class="token comment">// Widget &#x63A5;&#x53E3;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;&#x5982;&#x679C;&#x5141;&#x8BB8;&#x90A3;&#x6837;&#x7684;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#xFF0C;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x5BA2;&#x6237;&#x4E0D;&#x6B63;&#x786E;&#x5730;&#x4F7F;&#x7528; Widget &#x63A5;&#x53E3;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x8FDD;&#x53CD;&#x6761;&#x6B3E; 18 &#x7684;&#x5FE0;&#x544A;&#xFF1A;&#x201C;&#x8BA9;&#x63A5;&#x53E3;&#x5BB9;&#x6613;&#x88AB;&#x6B63;&#x786E;&#x4F7F;&#x7528;&#xFF0C;&#x4E0D;&#x6613;&#x88AB;&#x8BEF;&#x7528;&#x201D;&#x3002;</span>
<span class="token comment">// &#x5728;&#x8FD9;&#x7C7B;&#xFF0C;public &#x7EE7;&#x627F;&#x4E0D;&#x662F;&#x4E2A;&#x597D;&#x7B56;&#x7565;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4EE5; private &#x5F62;&#x5F0F;&#x7EE7;&#x627F; Timer&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token operator">:</span> <span class="token keyword">private</span> Timer <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// &#x67E5;&#x770B; Widget &#x7684;&#x6570;&#x636E;...&#x7B49;&#x7B49;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x85C9;&#x7531; private &#x7EE7;&#x627F;&#xFF0C;Timer &#x7684; public onTick &#x51FD;&#x6570;&#x5728; Widget &#x5185;&#x53D8;&#x6210; private&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x6211;&#x4EEC;&#x91CD;&#x65B0;&#x58F0;&#x660E;&#xFF08;&#x5B9A;&#x4E49;&#xFF09;&#x65F6;&#x4ECD;&#x7136;&#x628A;&#x5B83;&#x7559;&#x5728;&#x90A3;&#x513F;&#x3002;&#x518D;&#x8BF4;&#x4E00;&#x6B21;&#xFF0C;&#x628A; onTick &#x653E;&#x8FDB;</span>
<span class="token comment">// public &#x63A5;&#x53E3;&#x5185;&#x4F1A;&#x8BEF;&#x5BFC;&#x5BA2;&#x6237;&#x7AEF;&#x4EE5;&#x4E3A;&#x4ED6;&#x4EEC;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x5B83;&#xFF0C;&#x90A3;&#x5C31;&#x8FDD;&#x53CD;&#x4E86;&#x6761;&#x6B3E; 18&#x3002;</span>





<span class="token comment">// &#x8FD9;&#x662F;&#x4E2A;&#x597D;&#x8BBE;&#x8BA1;&#xFF0C;&#x4F46;&#x4E0D;&#x503C;&#x51E0;&#x6587;&#x94B1;&#xFF0C;&#x56E0;&#x4E3A; private &#x7EE7;&#x627F;&#x5E76;&#x975E;&#x7EDD;&#x5BF9;&#x5FC5;&#x8981;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x51B3;&#x5B9A;</span>
<span class="token comment">// &#x4EE5;&#x590D;&#x5408;&#xFF08;composition&#xFF09;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#xFF0C;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x53EA;&#x8981;&#x5728; Widget &#x5185;&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x5D4C;&#x5957;</span>
<span class="token comment">// &#x5F0F; private class&#xFF0C;&#x540E;&#x8005;&#x4EE5; public &#x5F62;&#x5F0F;&#x7EE7;&#x627F; Timer &#x5E76;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; onTick&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x653E;&#x4E00;&#x4E2A;&#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x4E8E; Widget &#x5185;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">class</span> <span class="token class-name">WidgetTimer</span> <span class="token operator">:</span> <span class="token keyword">public</span> Timer <span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    WidgetTimer timer<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x9996;&#x5148;&#xFF0C;&#x4F60;&#x6216;&#x8BB8;&#x4F1A;&#x60F3;&#x8BBE;&#x8BA1; Widget &#x4F7F;&#x5B83;&#x5F97;&#x4EE5;&#x62E5;&#x6709; derived classes&#xFF0C;&#x4F46;&#x540C;&#x65F6;&#x4F60;&#x53EF;&#x80FD;&#x4F1A;</span>
<span class="token comment">// &#x60F3;&#x963B;&#x6B62; derived classes &#x91CD;&#x65B0;&#x5B9A;&#x4E49; onTick&#x3002;&#x5982;&#x679C; Widget &#x7EE7;&#x627F;&#x81EA; Timer&#xFF0C;</span>
<span class="token comment">// &#x4E0A;&#x9762;&#x7684;&#x60F3;&#x6CD5;&#x5C31;&#x4E0D;&#x53EF;&#x80FD;&#x5B9E;&#x73B0;&#xFF0C;&#x5373;&#x4F7F;&#x662F; private &#x7EE7;&#x627F;&#x4E5F;&#x4E0D;&#x53EF;&#x80FD;&#x3002;&#xFF08;&#x8FD8;&#x8BB0;&#x5F97;&#x5417;&#xFF0C;&#x6761;&#x6B3E; 35 &#x66FE;</span>
<span class="token comment">// &#x8BF4; derived classes &#x53EF;&#x4EE5;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; virtual &#x51FD;&#x6570;&#xFF0C;&#x5373;&#x4F7F;&#x5B83;&#x4EEC;&#x4E0D;&#x5F97;&#x8C03;&#x7528;&#x5B83;&#x3002;&#xFF09;</span>
<span class="token comment">// &#x4F46;&#x5982;&#x679C; WidgetTimer &#x662F; Widget &#x5185;&#x90E8;&#x7684;&#x4E00;&#x4E2A; private &#x6210;&#x5458;&#x5E76;&#x7EE7;&#x627F; Timer&#xFF0C;Widget &#x7684;</span>
<span class="token comment">// derived classes &#x5C06;&#x65E0;&#x6CD5;&#x53D6;&#x7528; WidgetTimer&#xFF0C;&#x56E0;&#x6B64;&#x65E0;&#x6CD5;&#x7EE7;&#x627F;&#x5B83;&#x6216;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5B83;&#x7684; virtual &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x66FE;&#x7ECF;&#x4EE5; Java &#x6216; C# &#x7F16;&#x7A0B;&#x5E76;&#x6000;&#x5FF5;&#x201C;&#x963B;&#x6B62; derived classes &#x91CD;&#x65B0;&#x5B9A;&#x4E49; virtual</span>
<span class="token comment">// &#x51FD;&#x6570;&#x201D;&#x7684;&#x80FD;&#x529B;&#xFF08;&#x4E5F;&#x5C31;&#x662F; Java &#x7684; final &#x548C; C# &#x7684; sealed&#xFF09;&#x3002;</span>

<span class="token comment">// &#x7B2C;&#x4E8C;&#xFF0C;&#x4F60;&#x6216;&#x8BB8;&#x4F1A;&#x60F3;&#x8981;&#x5C06; Widget &#x7684;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x6027;&#x964D;&#x81F3;&#x6700;&#x4F4E;&#x3002;&#x5982;&#x679C; Widget &#x7EE7;&#x627F; Timer&#xFF0C;</span>
<span class="token comment">// &#x5F53; Widget &#x88AB;&#x7F16;&#x8BD1;&#x65F6; Timer &#x7684;&#x5B9A;&#x4E49;&#x5FC5;&#x987B;&#x53EF;&#x89C1;&#xFF0C;&#x6240;&#x4EE5;&#x5B9A;&#x4E49; Widget &#x7684;&#x90A3;&#x4E2A;&#x6587;&#x4EF6;&#x6050;&#x6015;&#x5FC5;&#x987B;</span>
<span class="token comment">// #include Timer.h&#x3002;&#x4F46;&#x5982;&#x679C; WidgetTimer &#x79FB;&#x51FA; Widget &#x4E4B;&#x5916;&#x800C; Widget &#x5185;&#x542B;&#x6307;&#x9488;</span>
<span class="token comment">// &#x6307;&#x5411;&#x4E00;&#x4E2A; WidgetTimer&#xFF0C;Widget &#x53EF;&#x4EE5;&#x53EA;&#x5E26;&#x7740;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684; WidgetTimer &#x58F0;&#x660E;&#x5F0F;&#xFF0C;</span>
<span class="token comment">// &#x4E0D;&#x518D;&#x9700;&#x8981; #include &#x4EFB;&#x4F55;&#x4E0E; Timer &#x6709;&#x5173;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x5BF9;&#x5927;&#x578B;&#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x5982;&#x6B64;&#x7684;&#x89E3;&#x8026;</span>
<span class="token comment">// &#xFF08;decouplings&#xFF09;&#x53EF;&#x80FD;&#x662F;&#x91CD;&#x8981;&#x7684;&#x63AA;&#x65BD;&#x3002;&#x5173;&#x4E8E;&#x7F16;&#x8BD1;&#x4F9D;&#x5B58;&#x6027;&#x7684;&#x6700;&#x5C0F;&#x5316;&#xFF0C;&#x8BE6;&#x89C1;&#x6761;&#x6B3E; 31&#x3002;</span>





<span class="token comment">// &#x6709;&#x4E00;&#x79CD;&#x6FC0;&#x8FDB;&#x60C5;&#x51B5;&#x6D89;&#x53CA;&#x7A7A;&#x95F4;&#x6700;&#x4F18;&#x5316;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x4FC3;&#x4F7F;&#x4F60;&#x9009;&#x62E9;&#x201C;private &#x7EE7;&#x627F;&#x201D;&#x800C;&#x4E0D;&#x662F;&#x201C;&#x7EE7;&#x627F;&#x52A0;&#x590D;&#x5408;&#x201D;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x6FC0;&#x8FDB;&#x60C5;&#x51B5;&#x771F;&#x662F;&#x6709;&#x591F;&#x6FC0;&#x8FDB;&#xFF0C;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x4F60;&#x6240;&#x5904;&#x7406;&#x7684; class &#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x65F6;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684; classes &#x6CA1;&#x6709; non-static &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x6CA1;&#x6709; virtual &#x51FD;&#x6570;&#xFF08;&#x56E0;&#x4E3A;&#x8FD9;&#x79CD;</span>
<span class="token comment">// &#x51FD;&#x6570;&#x7684;&#x5B58;&#x5728;&#x4F1A;&#x4E3A;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x5E26;&#x6765;&#x4E00;&#x4E2A; vptr&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 7&#xFF09;&#xFF0C;&#x4E5F;&#x6CA1;&#x6709; virtual base</span>
<span class="token comment">// classes&#xFF08;&#x56E0;&#x4E3A;&#x8FD9;&#x6837;&#x7684; base classes &#x4E5F;&#x4F1A;&#x62DB;&#x81F4;&#x4F53;&#x79EF;&#x4E0A;&#x7684;&#x989D;&#x5916;&#x5F00;&#x9500;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 40&#xFF09;&#x3002;</span>
<span class="token comment">// &#x4E8E;&#x662F;&#x8FD9;&#x79CD;&#x6240;&#x8C13;&#x7684; empty classes &#x5BF9;&#x8C61;&#x4E0D;&#x4F7F;&#x7528;&#x4EFB;&#x4F55;&#x7A7A;&#x95F4;&#xFF0C;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x96B6;&#x5C5E;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x636E;&#x9700;&#x8981;&#x5B58;&#x50A8;&#x3002;</span>
<span class="token comment">// &#x7136;&#x800C;&#x7531;&#x4E8E;&#x6280;&#x672F;&#x4E0A;&#x7684;&#x7406;&#x7531;&#xFF0C;C++ &#x88C1;&#x5B9A;&#x51E1;&#x662F;&#x72EC;&#x7ACB;&#xFF08;&#x975E;&#x9644;&#x5C5E;&#xFF09;&#x5BF9;&#x8C61;&#x7684;&#x5FC5;&#x987B;&#x6709;&#x975E;&#x96F6;&#x5927;&#x5C0F;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5982;&#x679C;&#x4F60;&#x8FD9;&#x6837;&#x505A;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Empty</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>           <span class="token comment">// &#x6CA1;&#x6709;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x4E0D;&#x9002;&#x7528;&#x4EFB;&#x4F55;&#x5185;&#x5B58;</span>

<span class="token keyword">class</span> <span class="token class-name">HoldsAnInt</span> <span class="token punctuation">{</span>          <span class="token comment">// &#x5E94;&#x8BE5;&#x53EA;&#x9700;&#x8981;&#x4E00;&#x4E2A; int &#x7A7A;&#x95F4;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    Empty e<span class="token punctuation">;</span>                <span class="token comment">// &#x5E94;&#x8BE5;&#x4E0D;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x5185;&#x5B58;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4F60;&#x4F1A;&#x53D1;&#x73B0; sizeof(HoldsAnInt) &gt; sizeof(int); &#x5594;&#x5662;&#xFF0C;&#x4E00;&#x4E2A; Empty &#x6210;&#x5458;&#x53D8;&#x91CF;&#x7ADF;&#x7136;&#x8981;&#x6C42;&#x5185;&#x5B58;&#x3002;</span>
<span class="token comment">// &#x5728;&#x5927;&#x591A;&#x6570;&#x7F16;&#x8BD1;&#x5668;&#x4E2D; sizeof(Empty) &#x83B7;&#x5F97; 1&#xFF0C;&#x56E0;&#x4E3A;&#x9762;&#x5BF9;&#x201C;&#x5927;&#x5C0F;&#x4E3A;&#x96F6;&#x4E4B;&#x72EC;&#x7ACB;&#xFF08;&#x975E;&#x9644;&#x5C5E;&#xFF09;&#x5BF9;&#x8C61;&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x901A;&#x5E38; C++ &#x5B98;&#x65B9;&#x52D2;&#x4EE4;&#x9ED8;&#x9ED8;&#x5B89;&#x63D2;&#x4E00;&#x4E2A; char &#x5230;&#x7A7A;&#x5BF9;&#x8C61;&#x5185;&#x3002;&#x7136;&#x800C;&#x9F50;&#x4F4D;&#x9700;&#x6C42;&#xFF08;alignment&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 50&#xFF09;</span>
<span class="token comment">// &#x53EF;&#x80FD;&#x9020;&#x6210;&#x7F16;&#x8BD1;&#x5668;&#x4E3A;&#x7C7B;&#x4F3C; HoldsAnInt &#x8FD9;&#x6837;&#x7684; class &#x52A0;&#x4E0A;&#x4E00;&#x4E9B;&#x886C;&#x57AB;&#xFF08;padding&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x6709;&#x53EF;&#x80FD;</span>
<span class="token comment">// HoldsAnInt &#x5BF9;&#x8C61;&#x4E0D;&#x53EA;&#x83B7;&#x5F97;&#x4E00;&#x4E2A; char &#x5927;&#x5C0F;&#xFF0C;&#x4E5F;&#x8BB8;&#x5B9E;&#x9645;&#x4E0A;&#x88AB;&#x653E;&#x5927;&#x5230;&#x8DB3;&#x591F;&#x6709;&#x5B58;&#x653E;&#x4E00;&#x4E2A; int&#x3002;</span>

<span class="token comment">// &#x4F46;&#x6216;&#x8BB8;&#x4F60;&#x6CE8;&#x610F;&#x5230;&#x4E86;&#xFF0C;&#x6211;&#x5F88;&#x5C0F;&#x5FC3;&#x5730;&#x8BF4;&#x201C;&#x72EC;&#x7ACB;&#xFF08;&#x975E;&#x9644;&#x5C5E;&#xFF09;&#x201D;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x4E00;&#x5B9A;&#x4E0D;&#x4E3A;&#x96F6;&#x3002;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x7EA6;&#x675F;&#x4E0D;&#x9002;&#x7528;&#x4E8E; derived class &#x5BF9;&#x8C61;&#x5185;&#x7684; base class &#x6210;&#x5206;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x5E76;&#x975E;&#x72EC;&#x7ACB;&#xFF08;&#x975E;&#x9644;&#x5C5E;&#xFF09;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7EE7;&#x627F; Empty&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5185;&#x542B;&#x4E00;&#x4E2A;&#x90A3;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">HoldsAnInt</span> <span class="token operator">:</span> <span class="token keyword">private</span> Empty <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x51E0;&#x4E4E;&#x53EF;&#x4EE5;&#x786E;&#x5B9A; sizeof(HoldsAnInt) == sizeof(int)&#x3002;&#x8FD9;&#x662F;&#x6240;&#x8C13;&#x7684; EBO</span>
<span class="token comment">// &#xFF08;empty base optimization&#xFF1B;&#x7A7A;&#x767D;&#x57FA;&#x7C7B;&#x6700;&#x4F18;&#x5316;&#xFF09;&#x3002;</span>

<span class="token comment">// &#x73B0;&#x5B9E;&#x4E2D;&#x7684;&#x201C;empty&#x201D; classes &#x5E76;&#x4E0D;&#x662F;&#x771F;&#x7684;&#x662F; empty&#x3002;&#x867D;&#x7136;&#x5B83;&#x4EEC;&#x4ECE;&#x672A;&#x62E5;&#x6709; non-static &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;</span>
<span class="token comment">// &#x5374;&#x5F80;&#x5F80;&#x5185;&#x542B; typedefs&#xFF0C;enums&#xFF0C;static &#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x6216; non-virtual &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// STL &#x5C31;&#x6709;&#x8BB8;&#x591A;&#x6280;&#x672F;&#x7528;&#x9014;&#x7684; empty classes&#xFF0C;&#x5176;&#x4E2D;&#x5185;&#x542B;&#x6709;&#x7528;&#x7684;&#x6210;&#x5458;&#xFF08;&#x901A;&#x5E38;&#x662F; typedefs&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5305;&#x62EC; base classes unary_function &#x548C; binary_function&#xFF0C;&#x8FD9;&#x4E9B;&#x662F;&#x201C;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x4E4B;&#x51FD;&#x6570;&#x5BF9;&#x8C61;&#x201D;</span>
<span class="token comment">// &#x901A;&#x5E38;&#x4F1A;&#x7EE7;&#x627F;&#x7684; classes&#x3002;&#x611F;&#x8C22; EBO &#x7684;&#x5E7F;&#x6CDB;&#x5B9E;&#x8DF5;&#xFF0C;&#x4F7F;&#x8FD9;&#x6837;&#x7684;&#x7EE7;&#x627F;&#x5F88;&#x5C11;&#x589E;&#x52A0;</span>
<span class="token comment">// derived classes &#x7684;&#x5927;&#x5C0F;&#x3002;</span>




<span class="token comment">// &#x5927;&#x591A;&#x6570;&#x7EE7;&#x627F;&#x76F8;&#x5F53;&#x4E8E; is-a&#xFF0C;&#x8FD9;&#x662F;&#x6307; public &#x7EE7;&#x627F;&#xFF0C;&#x4E0D;&#x662F; private &#x7EE7;&#x627F;&#x3002;</span>
<span class="token comment">// &#x590D;&#x5408;&#x548C; private &#x7EE7;&#x627F;&#x90FD;&#x610F;&#x5473; is-implemented-in-terms-of&#xFF0C;&#x4F46;&#x590D;&#x5408;&#x6BD4;&#x8F83;&#x5BB9;&#x6613;&#x7406;&#x89E3;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x65E0;&#x8BBA;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#xFF0C;&#x53EA;&#x8981;&#x53EF;&#x4EE5;&#xFF0C;&#x4F60;&#x8FD8;&#x662F;&#x5E94;&#x8BE5;&#x9009;&#x62E9;&#x590D;&#x5408;&#x3002;</span>

<span class="token comment">// &#x5F53;&#x4F60;&#x9762;&#x5BF9;&#x201C;&#x5E76;&#x4E0D;&#x5B58;&#x5728; is-a &#x5173;&#x7CFB;&#x201D;&#x7684;&#x4E24;&#x4E2A; classes&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x53E6;&#x4E00;&#x4E2A;&#x7684; protected &#x6210;&#x5458;&#xFF0C;</span>
<span class="token comment">// &#x6216;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x5176;&#x4E00;&#x6216;&#x591A;&#x4E2A; virtual &#x51FD;&#x6570;&#xFF0C;private &#x7EE7;&#x627F;&#x6781;&#x6709;&#x53EF;&#x80FD;&#x6210;&#x4E3A;&#x6B63;&#x7EDF;&#x8BBE;&#x8BA1;&#x7B56;&#x7565;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-40%E6%98%8E%E6%99%BA%E8%80%8C%E5%AE%A1%E6%85%8E%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF">&#x6761;&#x6B3E; 40&#xFF1A;&#x660E;&#x667A;&#x800C;&#x5BA1;&#x614E;&#x5730;&#x4F7F;&#x7528;&#x591A;&#x91CD;&#x7EE7;&#x627F;</h3>

<ul>
<li>&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x6BD4;&#x5355;&#x4E00;&#x7EE7;&#x627F;&#x590D;&#x6742;&#x3002;&#x5B83;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x65B0;&#x7684;&#x6B67;&#x4E49;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x5BF9; virtual &#x7EE7;&#x627F;&#x7684;&#x9700;&#x8981;&#x3002;</li>
<li>virtual &#x7EE7;&#x627F;&#x4F1A;&#x589E;&#x52A0;&#x5927;&#x5C0F;&#x3001;&#x901F;&#x5EA6;&#x3001;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x53CA;&#x8D4B;&#x503C;&#xFF09;&#x590D;&#x6742;&#x5EA6;&#x7B49;&#x7B49;&#x6210;&#x672C;&#x3002;&#x5982;&#x679C; virtual base classes &#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#xFF0C;&#x5C06;&#x662F;&#x6700;&#x5177;&#x5B9E;&#x7528;&#x4EF7;&#x503C;&#x7684;&#x60C5;&#x51B5;&#x3002;</li>
<li>&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x786E;&#x6709;&#x6B63;&#x5F53;&#x7528;&#x9014;&#x3002;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x60C5;&#x8282;&#x6D89;&#x53CA;&#x201C;public &#x7EE7;&#x627F;&#x67D0;&#x4E2A; Interface class&#x201D;&#x548C;&#x201C;private &#x7EE7;&#x627F;&#x67D0;&#x4E2A;&#x534F;&#x52A9;&#x5B9E;&#x73B0;&#x7684; class&#x201D;&#x7684;&#x4E24;&#x76F8;&#x7EC4;&#x5408;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x6700;&#x5148;&#x9700;&#x8981;&#x8BA4;&#x6E05;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#xFF0C;&#x5F53; MI &#x8FDB;&#x5165;&#x8BBE;&#x8BA1;&#x666F;&#x6846;&#xFF0C;&#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x4ECE;&#x4E00;&#x4E2A;&#x4EE5;&#x4E0A;&#x7684; base classes</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x76F8;&#x540C;&#x7684;&#x540D;&#x79F0;&#xFF08;&#x5982;&#x51FD;&#x6570;&#x3001;typedef&#x7B49;&#x7B49;&#xFF09;&#x3002;&#x90A3;&#x4F1A;&#x5BFC;&#x81F4;&#x8F83;&#x591A;&#x7684;&#x6B67;&#x4E49;&#xFF08;ambiguity&#xFF09;&#x673A;&#x4F1A;&#x3002;&#x4F8B;&#x5982;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">BorrowableItem</span> <span class="token punctuation">{</span>           <span class="token comment">// &#x56FE;&#x4E66;&#x9986;&#x5141;&#x8BB8;&#x4F60;&#x501F;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">checkOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x79BB;&#x5F00;&#x65F6;&#x8FDB;&#x884C;&#x68C0;&#x67E5;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ElectronicGadget</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">bool</span> <span class="token function">checkOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>      <span class="token comment">// &#x6267;&#x884C;&#x81EA;&#x6211;&#x68C0;&#x6D4B;&#xFF0C;&#x8FD4;&#x56DE;&#x662F;&#x5426;&#x6D4B;&#x8BD5;&#x6210;&#x529F;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MP3Player</span> <span class="token operator">:</span>               <span class="token comment">// &#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x591A;&#x91CD;&#x7EE7;&#x627F;</span>
    <span class="token keyword">public</span> BorrowableItem<span class="token punctuation">,</span>      <span class="token comment">// &#xFF08;&#x67D0;&#x4E9B;&#x56FE;&#x4E66;&#x9986;&#x613F;&#x610F;&#x501F;&#x51FA; MP3 &#x64AD;&#x653E;&#x5668;&#xFF09;</span>
    <span class="token keyword">public</span> ElectronicGadget
<span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x8FD9;&#x91CC;&#xFF0C;class &#x7684;&#x5B9A;&#x4E49;&#x4E0D;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x5173;&#x5FC3;&#x91CD;&#x70B9;</span>

MP3Player mp<span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">checkOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// &#x6B67;&#x4E49;&#xFF01;&#x8C03;&#x7528;&#x7684;&#x662F;&#x54EA;&#x4E2A; checkOut&#xFF1F;</span>

<span class="token comment">// &#x6CE8;&#x610F;&#x6B64;&#x4F8B;&#x4E4B;&#x4E2D;&#x5BF9; checkOut &#x7684;&#x8C03;&#x7528;&#x65F6;&#x6B67;&#x4E49;&#xFF08;&#x6A21;&#x68F1;&#x4E24;&#x53EF;&#xFF09;&#x7684;&#xFF0C;&#x5373;&#x4F7F;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x4E4B;&#x4E2D;</span>
<span class="token comment">// &#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x53EF;&#x53D6;&#x7528;&#xFF08;BorrowableItem &#x5185;&#x7684; checkOut &#x662F; public&#xFF0C;ElectronicGadget</span>
<span class="token comment">// &#x5185;&#x7684;&#x5374;&#x662F; private&#xFF09;&#x3002;&#x8FD9;&#x4E0E; C++ &#x7528;&#x6765;&#x89E3;&#x6790;&#xFF08;resolving&#xFF09;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x7684;&#x89C4;&#x5219;&#x76F8;&#x7B26;&#xFF1A;</span>
<span class="token comment">// &#x5728;&#x770B;&#x5230;&#x662F;&#x5426;&#x6709;&#x4E2A;&#x51FD;&#x6570;&#x53EF;&#x53D6;&#x7528;&#x4E4B;&#x524D;&#xFF0C;C++ &#x9996;&#x5148;&#x786E;&#x8BA4;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x5BF9;&#x6B64;&#x8C03;&#x7528;&#x4E4B;&#x8A00;&#x662F;&#x6700;&#x4F73;&#x5339;&#x914D;&#x3002;</span>
<span class="token comment">// &#x627E;&#x51FA;&#x6700;&#x4F73;&#x5339;&#x914D;&#x51FD;&#x6570;&#x540E;&#x624D;&#x68C0;&#x9A8C;&#x5176;&#x53EF;&#x53D6;&#x7528;&#x6027;&#x3002;&#x672C;&#x4F8B;&#x7684;&#x4E24;&#x4E2A; checkOuts &#x6709;&#x76F8;&#x540C;&#x7684;&#x5339;&#x914D;&#x7A0B;&#x5EA6;</span>
<span class="token comment">// &#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x56E0;&#x6B64;&#x624D;&#x9020;&#x6210;&#x6B67;&#x4E49;&#xFF09;&#xFF0C;&#x6CA1;&#x6709;&#x6240;&#x8C13;&#x6700;&#x4F73;&#x5339;&#x914D;&#x3002;&#x56E0;&#x6B64; ElectronicGadget::checkOut</span>
<span class="token comment">// &#x7684;&#x53EF;&#x53D6;&#x7528;&#x6027;&#x4E5F;&#x5C31;&#x662F;&#x4ECE;&#x672A;&#x88AB;&#x7F16;&#x8BD1;&#x5668;&#x5BA1;&#x67E5;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x6B67;&#x4E49;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x660E;&#x767D;&#x6307;&#x51FA;&#x4F60;&#x8981;&#x8C03;&#x7528;&#x54EA;&#x4E00;&#x4E2A; base class &#x5185;&#x7684;&#x51FD;&#x6570;&#xFF1A;</span>
mp<span class="token punctuation">.</span>BorrowableItem<span class="token operator">::</span><span class="token function">checkOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x54CE;&#x5440;&#xFF0C;&#x539F;&#x6765;&#x662F;&#x8FD9;&#x4E2A; checkOut...</span>

<span class="token comment">// &#x4F60;&#x5F53;&#x7136;&#x4E5F;&#x53EF;&#x4EE5;&#x5C1D;&#x8BD5;&#x660E;&#x786E;&#x8C03;&#x7528; ElectronicGadget::checkOut&#xFF0C;&#x4F46;&#x7136;&#x540E;&#x4F60;&#x4F1A;&#x83B7;&#x5F97;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x201C;&#x5C1D;&#x8BD5;&#x8C03;&#x7528; private &#x6210;&#x5458;&#x51FD;&#x6570;&#x201D;&#x7684;&#x9519;&#x8BEF;&#x3002;</span>





<span class="token comment">// &#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x610F;&#x601D;&#x662F;&#x7EE7;&#x627F;&#x4E00;&#x4E2A;&#x4EE5;&#x4E0A;&#x7684; base classes&#xFF0C;&#x4F46;&#x8FD9;&#x4E9B; base classes &#x5E76;&#x4E0D;</span>
<span class="token comment">// &#x5E38;&#x5728;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x53C8;&#x6709;&#x66F4;&#x9AD8;&#x7EA7;&#x7684; base classes&#xFF0C;&#x56E0;&#x4E3A;&#x90A3;&#x4F1A;&#x5BFC;&#x81F4;&#x8981;&#x547D;&#x7684;&#x201C;&#x94BB;&#x77F3;&#x578B;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x201D;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">InputFile</span> <span class="token operator">:</span> <span class="token keyword">public</span> File <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">OutputFile</span> <span class="token operator">:</span> <span class="token keyword">public</span> File <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">IOFile</span> <span class="token operator">:</span> <span class="token keyword">public</span> InputFile<span class="token punctuation">,</span> <span class="token keyword">public</span> OutputFile <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4ECE;&#x67D0;&#x4E2A;&#x89D2;&#x5EA6;&#x8BF4;&#xFF0C;IOFile &#x4ECE;&#x5176;&#x6BCF;&#x4E00;&#x4E2A; base class &#x7EE7;&#x627F;&#x4E00;&#x4EFD;&#xFF0C;&#x6240;&#x4EE5;&#x5176;&#x5BF9;&#x8C61;&#x5185;</span>
<span class="token comment">// &#x5E94;&#x8BE5;&#x6709;&#x4E24;&#x4EFD; fileName &#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;&#x4F46;&#x4ECE;&#x53E6;&#x4E00;&#x4E2A;&#x89D2;&#x5EA6;&#x8BF4;&#xFF0C;&#x7B80;&#x5355;&#x7684;&#x903B;&#x8F91;&#x544A;&#x8BC9;&#x6211;&#x4EEC;&#xFF0C;</span>
<span class="token comment">// IOFile &#x5BF9;&#x8C61;&#x53EA;&#x8BE5;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x540D;&#x79F0;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7EE7;&#x627F;&#x81EA;&#x4E24;&#x4E2A; base classes</span>
<span class="token comment">// &#x800C;&#x6765;&#x7684; fileName &#x4E0D;&#x8BE5;&#x91CD;&#x590D;&#x3002;</span>





<span class="token comment">// C++ &#x5728;&#x8FD9;&#x573A;&#x8FA9;&#x8BBA;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x503E;&#x659C;&#x7ACB;&#x573A;&#xFF1B;&#x4E24;&#x4E2A;&#x65B9;&#x6848;&#x5B83;&#x90FD;&#x652F;&#x6301;&#x2014;&#x2014;&#x867D;&#x7136;&#x5176;&#x7F3A;&#x7701;&#x505A;&#x6CD5;&#x662F;&#x6267;&#x884C;&#x590D;&#x5236;</span>
<span class="token comment">// &#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x4E0A;&#x4E00;&#x6BB5;&#x8BF4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x505A;&#x6CD5;&#xFF09;&#x3002;&#x5982;&#x679C;&#x90A3;&#x4E0D;&#x662F;&#x4F60;&#x8981;&#x7684;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x4EE4;&#x90A3;&#x4E2A;&#x5E26;&#x6709;&#x6B64;&#x6570;&#x636E;&#x7684;</span>
<span class="token comment">// class &#x4E5F;&#x5C31;&#x662F; File &#x6210;&#x4E3A;&#x4E00;&#x4E2A; virtual base class&#x3002;&#x4E3A;&#x4E86;&#x8FD9;&#x6837;&#x505A;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x5FC5;&#x987B;&#x4EE4;&#x6240;&#x6709;&#x76F4;&#x63A5;&#x7EE7;&#x627F;&#x81EA;&#x5B83;&#x7684; classes &#x91C7;&#x7528; &#x201C;virtual &#x7EE7;&#x627F;&#x201D;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">InputFile</span> <span class="token operator">:</span> <span class="token keyword">virtual</span> <span class="token keyword">public</span> File <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">OutputFile</span> <span class="token operator">:</span> <span class="token keyword">virtual</span> <span class="token keyword">public</span> File <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">IOFile</span> <span class="token operator">:</span> <span class="token keyword">public</span> InputFile<span class="token punctuation">,</span> <span class="token keyword">public</span> OutputFile <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4ECE;&#x6B63;&#x786E;&#x884C;&#x4E3A;&#x7684;&#x89C2;&#x70B9;&#x770B;&#xFF0C;public &#x7EE7;&#x627F;&#x5E94;&#x8BE5;&#x603B;&#x662F; virtual&#x3002;&#x5982;&#x679C;&#x8FD9;&#x662F;&#x552F;&#x4E00;&#x4E00;&#x4E2A;&#x89C2;&#x70B9;&#xFF0C;&#x89C4;&#x5219;&#x5F88;&#x7B80;&#x5355;&#xFF1A;</span>
<span class="token comment">// &#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x5F53;&#x4F60;&#x4F7F;&#x7528; public &#x7EE7;&#x627F;&#xFF0C;&#x8BF7;&#x6539;&#x7528; virtual public &#x7EE7;&#x627F;&#x3002;</span>
<span class="token comment">// &#x4F46;&#x662F;&#xFF0C;&#x554A;&#x5440;&#xFF0C;&#x6B63;&#x786E;&#x6027;&#x5E76;&#x4E0D;&#x662F;&#x552F;&#x4E00;&#x89C2;&#x70B9;&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x907F;&#x514D;&#x7EE7;&#x627F;&#x5F97;&#x6765;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x91CD;&#x590D;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x82E5;&#x5E72;&#x5E55;&#x540E;&#x620F;&#x6CD5;&#xFF0C;&#x800C;&#x5176;&#x540E;&#x679C;&#x662F;&#xFF1A;</span>
<span class="token comment">// &#x4F7F;&#x7528; virtual &#x7EE7;&#x627F;&#x7684;&#x90A3;&#x4E9B; classes &#x6240;&#x4EA7;&#x751F;&#x7684;&#x5BF9;&#x8C61;&#x5F80;&#x5F80;&#x6BD4;&#x4F7F;&#x7528; non-virtual &#x7EE7;&#x627F;</span>
<span class="token comment">// &#x7684;&#x5144;&#x5F1F;&#x4EEC;&#x4F53;&#x79EF;&#x5927;&#xFF0C;&#x8BBF;&#x95EE; virtual base classes &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x65F6;&#xFF0C;&#x4E5F;&#x6BD4;&#x8BBF;&#x95EE;</span>
<span class="token comment">// non-virtual base classes &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x901F;&#x5EA6;&#x6162;&#x3002;&#x79CD;&#x79CD;&#x7EC6;&#x8282;&#x56E0;&#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x540C;&#x800C;&#x5F02;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x57FA;&#x672C;&#x91CD;&#x70B9;&#x5F88;&#x6E05;&#x695A;&#xFF1A;&#x4F60;&#x5F97;&#x4E3A; virtual &#x7EE7;&#x627F;&#x4ED8;&#x51FA;&#x4EE3;&#x4EF7;&#x3002;</span>

<span class="token comment">// virtual base &#x7684;&#x521D;&#x59CB;&#x5316;&#x8D23;&#x4EFB;&#x662F;&#x7531;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#x7684;&#x6700;&#x4F4E;&#x5C42;&#xFF08;most derived&#xFF09;class &#x8D1F;&#x8D23;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x6697;&#x793A;&#xFF08;1&#xFF09;classes &#x82E5;&#x6D3E;&#x751F;&#x81EA; virtual bases &#x800C;&#x9700;&#x8981;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5FC5;&#x987B;&#x8BA4;&#x77E5;&#x5176; virtual bases</span>
<span class="token comment">// &#x2014;&#x2014; &#x4E0D;&#x8BBA;&#x90A3;&#x4E9B; bases &#x8DDD;&#x79BB;&#x591A;&#x8FDC;&#xFF0C;&#xFF08;2&#xFF09;&#x5F53;&#x4E00;&#x4E2A;&#x65B0;&#x7684; derived class &#x52A0;&#x5165;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x5FC5;&#x987B;&#x627F;&#x62C5;&#x5176; virtual bases&#xFF08;&#x4E0D;&#x8BBA;&#x76F4;&#x63A5;&#x6216;&#x95F4;&#x63A5;&#xFF09;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8D23;&#x4EFB;&#x3002;</span>





<span class="token comment">// &#x6211;&#x5BF9; virtual base classes&#xFF08;&#x4EA6;&#x76F8;&#x5F53;&#x4E8E;&#x5BF9; virtual &#x7EE7;&#x627F;&#xFF09;&#x7684;&#x5FE0;&#x544A;&#x5F88;&#x7B80;&#x5355;&#x3002;</span>
<span class="token comment">// &#x7B2C;&#x4E00;&#xFF0C;&#x975E;&#x5FC5;&#x8981;&#x4E0D;&#x9002;&#x7528; virtual bases&#x3002;&#x5E73;&#x5E38;&#x8BF7;&#x4F7F;&#x7528; non-virtual &#x7EE7;&#x627F;&#x3002;</span>
<span class="token comment">// &#x7B2C;&#x4E8C;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x5FC5;&#x987B;&#x4F7F;&#x7528; virtual base classes&#xFF0C;&#x5C3D;&#x53EF;&#x80FD;&#x907F;&#x514D;&#x5728;&#x5176;&#x4E2D;&#x653E;&#x7F6E;&#x6570;&#x636E;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E48;&#x4E00;&#x6765;&#x4F60;&#x5C31;&#x4E0D;&#x9700;&#x62C5;&#x5FC3;&#x8FD9;&#x4E9B; classes &#x8EAB;&#x4E0A;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x548C;&#x8D4B;&#x503C;&#xFF09;&#x6240;&#x5E26;&#x6765;&#x7684;&#x8BE1;&#x5F02;&#x4E8B;&#x60C5;&#x4E86;&#x3002;</span>
<span class="token comment">// Java &#x548C; .NET &#x7684; Interfaces &#x503C;&#x5F97;&#x6CE8;&#x610F;&#xFF0C;&#x5B83;&#x5728;&#x8BB8;&#x591A;&#x65B9;&#x9762;&#x517C;&#x5BB9;&#x4E8E; C++ &#x7684; virtual</span>
<span class="token comment">// base classes&#xFF0C;&#x800C;&#x4E14;&#x4E5F;&#x4E0D;&#x5141;&#x8BB8;&#x542B;&#x6709;&#x4EFB;&#x4F55;&#x6570;&#x636E;&#x3002;</span>

<span class="token comment">// &#x73B0;&#x5728;&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x7528;&#x6765;&#x5851;&#x6A21;&#x201C;&#x4EBA;&#x201D;&#x7684; C++ Interface class&#xFF08;&#x89C1;&#x6761;&#x6B3E; 31&#xFF09;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">IPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// IPerson &#x7684;&#x5BA2;&#x6237;&#x5FC5;&#x987B;&#x4EE5; IPerson &#x7684; pointers &#x548C; references &#x6765;&#x7F16;&#x5199;&#x7A0B;&#x5E8F;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x62BD;&#x8C61; classes &#x65E0;&#x6CD5;&#x88AB;&#x5B9E;&#x4F53;&#x5316;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3002;&#x4E3A;&#x4E86;&#x521B;&#x5EFA;&#x4E00;&#x4E9B;&#x53EF;&#x88AB;&#x5F53;&#x505A; IPerson &#x6765;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// IPerson &#x7684;&#x5BA2;&#x6237;&#x4F7F;&#x7528; factory functions&#xFF08;&#x5DE5;&#x5382;&#x51FD;&#x6570;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 31&#xFF09;</span>
<span class="token comment">// &#x5C06;&#x201C;&#x6D3E;&#x751F;&#x81EA; IPerson &#x7684;&#x5177;&#x8C61; classes&#x201D; &#x5B9E;&#x4F53;&#x5316;&#xFF1A;</span>

<span class="token comment">// factory function&#xFF08;&#x5DE5;&#x5382;&#x51FD;&#x6570;&#xFF09;&#xFF0C;&#x6839;&#x636E;&#x4E00;&#x4E2A;&#x72EC;&#x4E00;&#x65E0;&#x4E8C;&#x7684;&#x6570;&#x636E;&#x5E93; ID &#x521B;&#x5EFA;&#x4E00;&#x4E2A; Person &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x6761;&#x6B3E; 18 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4E0D;&#x662F;&#x539F;&#x59CB;&#x6307;&#x9488;&#x3002;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>IPerson<span class="token operator">&gt;</span> <span class="token function">makePerson</span><span class="token punctuation">(</span>DatabaseID personIdentifier<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4ECE;&#x4F7F;&#x7528;&#x8005;&#x624B;&#x4E0A;&#x53D6;&#x5F97;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93; ID</span>
DatabaseID <span class="token function">askUserForDatabaseID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

DatabaseID <span class="token function">id</span><span class="token punctuation">(</span><span class="token function">askUserForDatabaseID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>tr1<span class="token operator">::</span>shared_ptr<span class="token operator">&lt;</span>IPerson<span class="token operator">&gt;</span> <span class="token function">pp</span><span class="token punctuation">(</span><span class="token function">makePerson</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x652F;&#x6301; IPerson &#x63A5;&#x53E3;&#x3002;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// &#x85C9;&#x7531; IPerson &#x6210;&#x5458;&#x51FD;&#x6570;&#x5904;&#x7406; *pp&#x3002;</span>

<span class="token comment">// &#x4F46;&#x662F; makePerson &#x5982;&#x4F55;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x5B83;&#x5462;&#xFF1F;</span>
<span class="token comment">// &#x65E0;&#x7591;&#x5730;&#x4E00;&#x5B9A;&#x6709;&#x67D0;&#x4E9B;&#x6D3E;&#x751F;&#x81EA; IPerson &#x7684;&#x5177;&#x8C61; class&#xFF0C;&#x5728;&#x5176;&#x4E2D; makePerson &#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3002;</span>

<span class="token comment">// &#x5047;&#x8BBE;&#x8FD9;&#x4E2A; class &#x540D;&#x4E3A; CPerson&#x3002;&#x5C31;&#x50CF;&#x5177;&#x8C61; class &#x4E00;&#x6837;&#xFF0C;CPerson &#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x201C;&#x7EE7;&#x627F;&#x81EA; IPerson&#x201D;</span>
<span class="token comment">// &#x7684; pure virtual &#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4ECE;&#x65E0;&#x5230;&#x6709;&#x5199;&#x51FA;&#x8FD9;&#x4E9B;&#x4E1C;&#x897F;&#xFF0C;</span>
<span class="token comment">// &#x66F4;&#x597D;&#x7684;&#x662F;&#x5229;&#x7528;&#x65E2;&#x6709;&#x7EC4;&#x4EF6;&#xFF0C;&#x540E;&#x8005;&#x505A;&#x4E86;&#x5927;&#x90E8;&#x5206;&#x6216;&#x6240;&#x6709;&#x5FC5;&#x8981;&#x4E8B;&#x60C5;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#xFF0C;&#x5047;&#x8BBE;&#x6709;&#x4E2A;&#x65E2;&#x6709;&#x7684;&#x6570;&#x636E;&#x5E93;&#x76F8;&#x5173; class&#xFF0C;&#x540D;&#x4E3A; PersonInfo&#xFF0C;</span>
<span class="token comment">// &#x63D0;&#x4F9B; CPerson &#x6240;&#x9700;&#x8981;&#x7684;&#x5B9E;&#x8D28;&#x4E1C;&#x897F;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">PersonInfo</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">PersonInof</span><span class="token punctuation">(</span>DatabaseID pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">theName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">theBirthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>     <span class="token comment">// &#x8BE6;&#x4E0B;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> PersonInfo<span class="token operator">::</span><span class="token function">valueDelimOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x7F3A;&#x7701;&#x7684;&#x8D77;&#x59CB;&#x7B26;&#x53F7;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> PersonInfo<span class="token operator">::</span><span class="token function">valueDelimClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>                 <span class="token comment">// &#x7F3A;&#x7701;&#x7684;&#x7ED3;&#x5C3E;&#x7B26;&#x53F7;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> PersonInfo<span class="token operator">::</span><span class="token function">theName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{</span>
    <span class="token comment">// &#x4FDD;&#x7559;&#x7F13;&#x51B2;&#x533A;&#x7ED9;&#x8FD4;&#x56DE;&#x503C;&#x4F7F;&#x7528;&#xFF1B;&#x7531;&#x4E8E;&#x7F13;&#x51B2;&#x533A;&#x662F; static&#xFF0C;&#x56E0;&#x6B64;&#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x521D;&#x59CB;&#x5316;&#x4E3A;&#x201C;&#x5168;&#x90E8;&#x662F; 0&#x201D;</span>
    <span class="token keyword">static</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span>Max_Formatted_Field_Value_Length<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x5199;&#x5165;&#x8D77;&#x59CB;&#x7B26;&#x53F7;</span>
    std<span class="token operator">::</span><span class="token function">strcpy</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token function">valueDelimOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    &#x73B0;&#x5728;&#xFF0C;&#x5C06; value &#x5185;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6DFB;&#x9644;&#x5230;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684; name &#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E2D;
    &#xFF08;&#x5C0F;&#x5FC3;&#xFF0C;&#x907F;&#x514D;&#x7F13;&#x51B2;&#x533A;&#x8D85;&#x9650;&#xFF09;

    <span class="token comment">// &#x5199;&#x5165;&#x7ED3;&#x5C3E;&#x7B26;&#x53F7;</span>
    std<span class="token operator">::</span><span class="token function">strcat</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token function">valueDelimClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x672C;&#x4F8B;&#x4E4B;&#x4E2D; CPerson &#x9700;&#x8981;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; valueDelimOpen &#x548C; valueDelimClose&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5355;&#x7EAF;&#x7684;&#x590D;&#x5408;&#x65E0;&#x6CD5;&#x5E94;&#x4ED8;&#x3002;&#x6700;&#x76F4;&#x63A5;&#x7684;&#x89E3;&#x6CD5;&#x5C31;&#x662F;&#x4EE4; CPerson &#x4EE5; private &#x5F62;&#x5F0F;</span>
<span class="token comment">// &#x7EE7;&#x627F; PersonInfo&#xFF0C;&#x867D;&#x7136;&#x6761;&#x6B3E; 39 &#x4E5F;&#x8BF4;&#x8FC7;&#xFF0C;&#x53EA;&#x8981;&#x591A;&#x52A0;&#x4E00;&#x70B9;&#x5DE5;&#x4F5C;&#xFF0C;</span>
<span class="token comment">// CPerson &#x4E5F;&#x53EF;&#x4EE5;&#x7ED3;&#x5408;&#x201C;&#x590D;&#x5408; + &#x7EE7;&#x627F;&#x201D;&#x6280;&#x672F;&#x4EE5;&#x6C42;&#x6709;&#x6548;&#x91CD;&#x65B0;&#x5B9A;&#x4E49; PersonInfo &#x7684;</span>
<span class="token comment">// virtual &#x51FD;&#x6570;&#x3002;&#x6B64;&#x5904;&#x6211;&#x5C06;&#x4F7F;&#x7528; private &#x7EE7;&#x627F;&#x3002;</span>

<span class="token comment">// &#x4F46; CPerson &#x4E5F;&#x5FC5;&#x987B;&#x5B9E;&#x73B0; IPerson &#x63A5;&#x53E3;&#xFF0C;&#x90A3;&#x9700;&#x5F97;&#x4EE5; public &#x7EE7;&#x627F;&#x624D;&#x80FD;&#x5B8C;&#x6210;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x5BFC;&#x81F4;&#x591A;&#x91CD;&#x7EE7;&#x627F;&#x7684;&#x4E00;&#x4E2A;&#x901A;&#x60C5;&#x8FBE;&#x7406;&#x7684;&#x5E94;&#x7528;&#xFF1A;&#x5C06;&#x201C;public &#x7EE7;&#x627F;&#x81EA;&#x67D0;&#x63A5;&#x53E3;&#x201D;</span>
<span class="token comment">// &#x548C;&#x201C;private &#x7EE7;&#x627F;&#x81EA;&#x67D0;&#x5B9E;&#x73B0;&#x201D;&#x7ED3;&#x5408;&#x5728;&#x4E00;&#x8D77;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>                         <span class="token comment">// &#x8FD9;&#x4E2A; class &#x6307;&#x51FA;&#x9700;&#x5B9E;&#x73B0;&#x7684;&#x63A5;&#x53E3;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">IPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DatabaseID</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>               <span class="token comment">// &#x7A0D;&#x540E;&#x88AB;&#x4F7F;&#x7528;&#xFF1B;&#x7EC6;&#x8282;&#x4E0D;&#x91CD;&#x8981;&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">PersonInfo</span> <span class="token punctuation">{</span>                      <span class="token comment">// &#x8FD9;&#x4E2A; class &#x6709;&#x82E5;&#x5E72;&#x6709;&#x7528;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token keyword">public</span><span class="token operator">:</span>                                 <span class="token comment">// &#x53EF;&#x7528;&#x4EE5;&#x5B9E;&#x73B0; IPerson &#x63A5;&#x53E3;&#x3002;</span>
    <span class="token keyword">explicit</span> <span class="token function">PersonInfo</span><span class="token punctuation">(</span>DatabaseID pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">PersonInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">theName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">theBirthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CPerson</span> <span class="token operator">:</span> <span class="token keyword">public</span> IPerson<span class="token punctuation">,</span> <span class="token keyword">private</span> PersonInfo <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">CPerson</span><span class="token punctuation">(</span>DatabaseID pid<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">PersonInfo</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
    
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>        <span class="token comment">// &#x5B9E;&#x73B0;&#x5FC5;&#x8981;&#x7684; IPerson &#x6210;&#x5458;&#x51FD;&#x6570;</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> PersonInfo<span class="token operator">::</span><span class="token function">theName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">virtual</span> std<span class="token operator">::</span>string <span class="token function">birthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>   <span class="token comment">// &#x5B9E;&#x73B0;&#x5FC5;&#x8981;&#x7684; IPerson &#x6210;&#x5458;&#x51FD;&#x6570;</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> PersonInfo<span class="token operator">::</span><span class="token function">theBirthDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>                                                <span class="token comment">// &#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>   <span class="token comment">// virtual &#x201C;&#x754C;&#x9650;&#x51FD;&#x6570;&#x201D;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">valueDelimClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="7-%E6%A8%A1%E6%9D%BF%E4%B8%8E%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B">7&#x3001;&#x6A21;&#x677F;&#x4E0E;&#x6CDB;&#x578B;&#x7F16;&#x7A0B;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-41%E4%BA%86%E8%A7%A3%E9%9A%90%E5%BC%8F%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%9A%E6%80%81">&#x6761;&#x6B3E; 41&#xFF1A;&#x4E86;&#x89E3;&#x9690;&#x5F0F;&#x63A5;&#x53E3;&#x548C;&#x7F16;&#x8BD1;&#x671F;&#x591A;&#x6001;</h3>

<ul>
<li>classes &#x548C; templates &#x90FD;&#x652F;&#x6301;&#x63A5;&#x53E3;&#xFF08;interfaces&#xFF09;&#x548C;&#x591A;&#x6001;&#xFF08;polymorphism&#xFF09;&#x3002;</li>
<li>&#x5BF9; classes &#x800C;&#x8A00;&#x63A5;&#x53E3;&#x662F;&#x663E;&#x793A;&#x7684;&#xFF08;explicit&#xFF09;&#xFF0C;&#x4EE5;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x4E3A;&#x4E2D;&#x5FC3;&#x3002;&#x591A;&#x6001;&#x5219;&#x662F;&#x901A;&#x8FC7; virtual &#x51FD;&#x6570;&#x53D1;&#x751F;&#x4E8E;&#x8FD0;&#x884C;&#x671F;&#x3002;</li>
<li>&#x5BF9; template &#x53C2;&#x6570;&#x800C;&#x8A00;&#xFF0C;&#x63A5;&#x53E3;&#x662F;&#x9690;&#x5F0F;&#x7684;&#xFF08;implicit&#xFF09;&#xFF0C;&#x5960;&#x57FA;&#x4E8E;&#x6709;&#x6548;&#x8868;&#x8FBE;&#x5F0F;&#x3002;&#x591A;&#x6001;&#x5219;&#x662F;&#x901A;&#x8FC7; template &#x5177;&#x73B0;&#x5316;&#x548C;&#x51FD;&#x6570;&#x91CD;&#x8F7D;&#x89E3;&#x6790;&#xFF08;function overloading resolution&#xFF09;&#x53D1;&#x751F;&#x4E8E;&#x7F16;&#x8BD1;&#x671F;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numebrs}" class="language-cpp line-numebrs"><span class="token comment">// &#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7F16;&#x7A0B;&#x4E16;&#x754C;&#x603B;&#x662F;&#x4EE5;&#x663E;&#x793A;&#x63A5;&#x53E3;&#xFF08;explicit interfaces&#xFF09;&#x548C;</span>
<span class="token comment">// &#x8FD0;&#x884C;&#x671F;&#x591A;&#x6001;&#xFF08;runtime polymorphism&#xFF09;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 25</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">doProcessing</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> w <span class="token operator">!=</span> someNastyWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Widget <span class="token function">temp</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        temp<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        temp<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8BF4; doProcessing &#x5185;&#x7684; w&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x7531;&#x4E8E; w &#x7684;&#x7C7B;&#x578B;&#x88AB;&#x58F0;&#x660E;&#x4E3A; Widget&#xFF0C;&#x6240;&#x4EE5; w &#x5FC5;&#x987B;&#x652F;&#x6301; Widget &#x63A5;&#x53E3;&#x3002;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x6211;&#x79F0;&#x6B64;&#x4E3A;&#x4E00;&#x4E2A;&#x663E;&#x793A;&#x63A5;&#x53E3;&#xFF08;explicit interface&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5B83;&#x5728;&#x6E90;&#x7801;&#x4E2D;&#x660E;&#x786E;&#x53EF;&#x89C1;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x7531;&#x4E8E; Widget &#x7684;&#x67D0;&#x4E9B;&#x6210;&#x5458;&#x51FD;&#x6570;&#x662F; virtual&#xFF0C;w &#x5BF9;&#x90A3;&#x4E9B;&#x51FD;&#x6570;&#x7684;&#x8C03;&#x7528;</span>
<span class="token comment">// &#x5C06;&#x8868;&#x73B0;&#x51FA;&#x8FD0;&#x884C;&#x671F;&#x591A;&#x6001;&#xFF08;runtime polymorphism&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5C06;&#x4E8E;&#x8FD0;&#x884C;&#x671F;&#x6839;&#x636E; w &#x7684;</span>
<span class="token comment">// &#x52A8;&#x6001;&#x7C7B;&#x578B;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 37&#xFF09;&#x51B3;&#x5B9A;&#x7A76;&#x7ADF;&#x8C03;&#x7528;&#x54EA;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span>





<span class="token comment">// Templates &#x53CA;&#x6CDB;&#x578B;&#x7F16;&#x7A0B;&#x7684;&#x4E16;&#x754C;&#xFF0C;&#x4E0E;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x6709;&#x6839;&#x672C;&#x4E0A;&#x7684;&#x4E0D;&#x540C;&#x3002;</span>
<span class="token comment">// &#x5728;&#x4E16;&#x754C;&#x4E2D;&#x663E;&#x793A;&#x63A5;&#x53E3;&#x548C;&#x8FD0;&#x884C;&#x671F;&#x591A;&#x6001;&#x4ECD;&#x7136;&#x5B58;&#x5728;&#xFF0C;&#x4F46;&#x91CD;&#x8981;&#x6027;&#x964D;&#x4F4E;&#x3002;</span>
<span class="token comment">// &#x53CD;&#x5012;&#x662F;&#x9690;&#x5F0F;&#x63A5;&#x53E3;&#xFF08;implicit interfaces&#xFF09;&#x548C;&#x7F16;&#x8BD1;&#x5668;&#x591A;&#x6001;</span>
<span class="token comment">// &#xFF08;compile-time polymorphism&#xFF09; &#x79FB;&#x5230;&#x524D;&#x5934;&#x4E86;&#x3002;</span>
<span class="token comment">// &#x82E5;&#x60F3;&#x77E5;&#x9053;&#x90A3;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x770B;&#x770B;&#x5F53;&#x6211;&#x4EEC;&#x5C06; doProcessing &#x4ECE;&#x51FD;&#x6570;</span>
<span class="token comment">// &#x8F6C;&#x53D8;&#x6210;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF08;function template&#xFF09;&#x65F6;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">doProcessing</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> w <span class="token operator">!=</span> someNastyWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        T <span class="token function">temp</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
        temp<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        temp<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x73B0;&#x5728;&#x6211;&#x4EEC;&#x600E;&#x4E48;&#x8BF4; doProcessing &#x5185;&#x7684; w &#x5462;&#xFF1F;</span>
<span class="token comment">// &#xFF08;1&#xFF09;w &#x5FC5;&#x987B;&#x652F;&#x6301;&#x54EA;&#x4E00;&#x79CD;&#x63A5;&#x53E3;&#xFF0C;&#x7CFB;&#x7531; template &#x4E2D;&#x6267;&#x884C;&#x4E8E; w &#x8EAB;&#x4E0A;&#x7684;&#x64CD;&#x4F5C;&#x6765;&#x51B3;&#x5B9A;&#x3002;</span>
<span class="token comment">// &#x672C;&#x4F8B;&#x770B;&#x6765; w &#x7684;&#x7C7B;&#x578B; T &#x597D;&#x50CF;&#x5FC5;&#x987B;&#x652F;&#x6301; size&#xFF0C;normalize &#x548C; swap &#x6210;&#x5458;&#x51FD;&#x6570;&#x3001;</span>
<span class="token comment">// copy &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;&#x7528;&#x4EE5;&#x5EFA;&#x7ACB; temp&#xFF09;&#x3001;&#x4E0D;&#x7B49;&#x6BD4;&#x8F83;&#xFF08;inequality comparison&#xFF0C;</span>
<span class="token comment">// &#x7528;&#x6765;&#x6BD4;&#x8F83; someNasty-Widget&#xFF09;&#x3002;&#x6211;&#x4EEC;&#x5F88;&#x5FEB;&#x4F1A;&#x770B;&#x5230;&#x8FD9;&#x5E76;&#x975E;&#x5B8C;&#x5168;&#x6B63;&#x786E;&#xFF0C;&#x4F46;&#x5BF9;&#x76EE;&#x524D;&#x800C;&#x8A00;&#x8DB3;&#x591F;&#x771F;&#x5B9E;&#x3002;</span>
<span class="token comment">// &#x91CD;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E00;&#x7EC4;&#x8868;&#x8FBE;&#x5F0F;&#xFF08;&#x5BF9;&#x6B64; template &#x800C;&#x8A00;&#x5FC5;&#x987B;&#x6709;&#x6548;&#x7F16;&#x8BD1;&#xFF09;&#x4FBF;&#x662F; T &#x5FC5;&#x987B;&#x652F;&#x6301;&#x7684;&#x4E00;&#x7EC4;&#x9690;&#x5F0F;&#x63A5;&#x53E3;</span>
<span class="token comment">// &#xFF08;implicit interface&#xFF09;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x51E1;&#x6D89;&#x53CA; w &#x7684;&#x4EFB;&#x52A1;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x4F8B;&#x5982; operator&gt; &#x548C; operator !=&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210; template</span>
<span class="token comment">// &#x5177;&#x73B0;&#x5316;&#xFF08;instantiated&#xFF09;&#xFF0C;&#x4F7F;&#x8FD9;&#x4E9B;&#x8C03;&#x7528;&#x5F97;&#x4EE5;&#x6210;&#x529F;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x5177;&#x73B0;&#x884C;&#x4E3A;&#x53D1;&#x751F;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x3002;</span>
<span class="token comment">// &#x201C;&#x4EE5;&#x4E0D;&#x540C;&#x7684; template &#x53C2;&#x6570;&#x5177;&#x73B0;&#x5316; function templates&#x201D;&#x4F1A;&#x5BFC;&#x81F4;&#x8C03;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4FBF;&#x662F;&#x6240;&#x8C13;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x591A;&#x6001;&#xFF08;compile-time polymorphism&#xFF09;&#x3002;</span>





<span class="token comment">// &#x7EB5;&#x4F7F;&#x4F60;&#x4ECE;&#x672A;&#x7528;&#x8FC7; templates&#xFF0C;&#x5E94;&#x8BE5;&#x4E0D;&#x964C;&#x751F;&#x201C;&#x8FD0;&#x884C;&#x671F;&#x591A;&#x6001;&#x201D;&#x548C;&#x201C;&#x7F16;&#x8BD1;&#x5668;&#x591A;&#x6001;&#x201D;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x5B83;&#x7C7B;&#x4F3C;&#x4E8E;&#x201C;&#x54EA;&#x4E00;&#x4E2A;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x201D;&#xFF08;&#x53D1;&#x751F;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#xFF09;&#x548C;</span>
<span class="token comment">// &#x201C;&#x54EA;&#x4E00;&#x4E2A; virtual &#x51FD;&#x6570;&#x8BE5;&#x88AB;&#x7ED1;&#x5B9A;&#x201D;&#xFF08;&#x53D1;&#x751F;&#x5728;&#x8FD0;&#x884C;&#x671F;&#xFF09;&#x4E4B;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#x3002;</span>





<span class="token comment">// &#x901A;&#x5E38;&#x663E;&#x793A;&#x63A5;&#x53E3;&#x7531;&#x51FD;&#x6570;&#x7684;&#x7B7E;&#x540D;&#x5F0F;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x3001;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x3001;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#xFF09;&#x6784;&#x6210;&#x3002;&#x4F8B;&#x5982; Widget class&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Widget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> std<span class="token operator">::</span>size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>Widget<span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x9690;&#x5F0F;&#x63A5;&#x53E3;&#x5C31;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x4E86;&#x3002;&#x5B83;&#x5E76;&#x4E0D;&#x57FA;&#x4E8E;&#x51FD;&#x6570;&#x7B7E;&#x540D;&#x5F0F;&#xFF0C;&#x800C;&#x662F;&#x7531;&#x6709;&#x6548;&#x8868;&#x8FBE;&#x5F0F;&#xFF08;valid expression&#xFF09;&#x7EC4;&#x6210;&#x3002;</span>
<span class="token comment">// &#x518D;&#x6B21;&#x770B;&#x770B; doProcessing template &#x4E00;&#x5F00;&#x59CB;&#x7684;&#x6761;&#x4EF6;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">doProcessing</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> w <span class="token operator">!=</span> someNastyWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// T&#xFF08;w &#x7684;&#x7C7B;&#x578B;&#xFF09;&#x7684;&#x9690;&#x5F0F;&#x63A5;&#x53E3;&#x770B;&#x8D77;&#x6765;&#x597D;&#x50CF;&#x6709;&#x8FD9;&#x4E9B;&#x7EA6;&#x675F;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x5B83;&#x5FC5;&#x987B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; size &#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x503C;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x5B83;&#x5FC5;&#x987B;&#x652F;&#x6301;&#x4E00;&#x4E2A; operator!= &#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x6BD4;&#x8F83;&#x4E24;&#x4E2A; T &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5047;&#x8BBE; someNastyWidget &#x7684;&#x7C7B;&#x578B;&#x4E3A; T&#x3002;</span>
</pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-42%E4%BA%86%E8%A7%A3-typename-%E7%9A%84%E5%8F%8C%E9%87%8D%E6%84%8F%E4%B9%89">&#x6761;&#x6B3E; 42&#xFF1A;&#x4E86;&#x89E3; typename &#x7684;&#x53CC;&#x91CD;&#x610F;&#x4E49;</h3>

<ul>
<li>&#x58F0;&#x660E; template &#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x524D;&#x7F00;&#x5173;&#x952E;&#x5B57; class &#x548C; typename &#x53EF;&#x4E92;&#x6362;&#x3002;</li>
<li>&#x8BF7;&#x4F7F;&#x7528;&#x5173;&#x952E;&#x5B57; typename &#x6807;&#x8BC6;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF1B;&#x4F46;&#x4E0D;&#x5F97;&#x5728; base class lists&#xFF08;&#x57FA;&#x7C7B;&#x5217;&#xFF09;&#x6216; member initialization list&#xFF08;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#xFF09;&#x5185;&#x4EE5;&#x5B83;&#x4F5C;&#x4E3A; base class &#x4FEE;&#x9970;&#x7B26;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x63D0;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;&#x4EE5;&#x4E0B; template &#x58F0;&#x660E;&#x5F0F;&#x4E2D;&#xFF0C;class &#x548C; typename &#x6709;&#x4EC0;&#x4E48;&#x4E0D;&#x540C;&#xFF1F;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">Widget</span><span class="token punctuation">;</span>         <span class="token comment">// &#x4F7F;&#x7528;&#x201C;class&#x201D;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">Widget</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4F7F;&#x7528;&#x201C;typename&#x201D;</span>

<span class="token comment">// &#x7B54;&#x6848;&#xFF1A;&#x6CA1;&#x6709;&#x4E0D;&#x540C;&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x58F0;&#x660E; template &#x7C7B;&#x578B;&#x53C2;&#x6570;&#xFF0C;class &#x548C; typename &#x7684;&#x610F;&#x4E49;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</span>
<span class="token comment">// &#x4ECE; C++ &#x7684;&#x89D2;&#x5EA6;&#x6765;&#x770B;&#xFF0C;&#x58F0;&#x660E; template &#x53C2;&#x6570;&#x65F6;&#xFF0C;&#x4E0D;&#x8BBA;&#x4F7F;&#x7528;</span>
<span class="token comment">// &#x5173;&#x952E;&#x5B57; class &#x6216; typename&#xFF0C;&#x610F;&#x4E49;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</span>





<span class="token comment">// &#x7136;&#x800C; C++ &#x5E76;&#x4E0D;&#x603B;&#x662F;&#x628A; class &#x548C; typename &#x89C6;&#x4E3A;&#x7B49;&#x4EF7;&#x3002;&#x6709;&#x65F6;&#x5019;&#x4F60;&#x4E00;&#x5B9A;&#x5F97;&#x4F7F;&#x7528; typename&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x4E86;&#x4E86;&#x89E3;&#x5176;&#x65F6;&#x673A;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5148;&#x8C08;&#x8C08;&#x4F60;&#x53EF;&#x4EE5;&#x5728; template &#x5185;&#x6307;&#x6D89;&#xFF08;refer to&#xFF09;&#x7684;&#x4E24;&#x79CD;&#x540D;&#x79F0;&#x3002;</span>

<span class="token comment">// &#x4E0B;&#x9762;&#x662F;&#x5B9E;&#x8DF5;&#x611A;&#x8822;&#x60F3;&#x6CD5;&#x7684;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> C<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">print2nd</span><span class="token punctuation">(</span><span class="token keyword">const</span> C<span class="token operator">&amp;</span> container<span class="token punctuation">)</span>       <span class="token comment">// &#x6253;&#x5370;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x7B2C;&#x4E8C;&#x5143;&#x7D20;</span>
<span class="token punctuation">{</span>                                       <span class="token comment">// &#x6CE8;&#x610F;&#x8FD9;&#x4E0D;&#x662F;&#x6709;&#x6548;&#x7684; C++ &#x4EE3;&#x7801;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        C<span class="token operator">::</span>const_iterator <span class="token function">iter</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x53D6;&#x5F97;&#x7B2C;&#x4E00;&#x5143;&#x7D20;&#x7684;&#x8FED;&#x4EE3;&#x5668;</span>
        <span class="token operator">++</span>iter<span class="token punctuation">;</span>                                         <span class="token comment">// &#x5C06; iter &#x79FB;&#x5F80;&#x7B2C;&#x4E8C;&#x5143;&#x7D20;</span>
        <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token operator">*</span>iter<span class="token punctuation">;</span>                              <span class="token comment">// &#x5C06;&#x8BE5;&#x5143;&#x7D20;&#x590D;&#x5236;&#x5230;&#x67D0;&#x4E2A; int&#x3002;</span>
        std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> value<span class="token punctuation">;</span>                             <span class="token comment">// &#x6253;&#x5370;&#x90A3;&#x4E2A; int&#x3002;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// iter &#x7684;&#x7C7B;&#x578B;&#x662F; C::const_iterator&#xFF0C;&#x5B9E;&#x9645;&#x662F;&#x4EC0;&#x4E48;&#x5FC5;&#x987B;&#x53D6;&#x51B3;&#x4E8E; template &#x53C2;&#x6570; C&#x3002;</span>
<span class="token comment">// template &#x5185;&#x51FA;&#x73B0;&#x7684;&#x540D;&#x79F0;&#x5982;&#x679C;&#x76F8;&#x4F9D;&#x4E8E;&#x67D0;&#x4E2A; template &#x53C2;&#x6570;&#xFF0C;&#x79F0;&#x4E4B;&#x4E3A;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#xFF08;dependent names&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#x5728; class &#x5185;&#x5448;&#x5D4C;&#x5957;&#x72B6;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x5B83;&#x4E3A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#xFF08;nested dependent name&#xFF09;&#x3002;</span>
<span class="token comment">// C::const_iterator &#x5C31;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x5B83;&#x8FD8;&#x662F;&#x4E2A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;</span>
<span class="token comment">// &#xFF08;nested dependent name&#xFF09;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E2A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#x5E76;&#x4E14;&#x6307;&#x6D89;&#x67D0;&#x7C7B;&#x578B;&#x3002;</span>

<span class="token comment">// print2nd &#x5185;&#x7684;&#x53E6;&#x4E00;&#x4E2A; local &#x53D8;&#x91CF; value&#xFF0C;&#x5176;&#x7C7B;&#x578B;&#x662F; int&#x3002;int &#x662F;&#x4E00;&#x4E2A;&#x5E76;&#x4E0D;&#x501A;&#x8D56;&#x4EFB;&#x4F55;</span>
<span class="token comment">// template &#x53C2;&#x6570;&#x7684;&#x540D;&#x79F0;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x540D;&#x79F0;&#x662F;&#x8C13;&#x975E;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#xFF08;non-dependent names&#xFF09;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4E0D;&#x77E5;&#x9053;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x53EB;&#x505A;&#x72EC;&#x7ACB;&#x540D;&#x79F0;&#xFF08;independent names&#xFF09;&#x3002;</span>





<span class="token comment">// &#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#x6709;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x89E3;&#x6790;&#xFF08;parsing&#xFF09;&#x56F0;&#x96BE;&#x3002;</span>
<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x4EE4; print2nd &#x66F4;&#x611A;&#x8822;&#x4E9B;&#xFF0C;&#x8FD9;&#x6837;&#x8D77;&#x5934;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> C<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">print2nd</span><span class="token punctuation">(</span><span class="token keyword">const</span> C<span class="token operator">&amp;</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    C<span class="token operator">::</span>const_iterator<span class="token operator">*</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5982;&#x679C; C::const_iterator &#x4E0D;&#x662F;&#x4E2A;&#x7C7B;&#x578B;&#x5462;&#xFF1F;&#x5982;&#x679C; C &#x6709;&#x4E2A; static &#x6210;&#x5458;&#x53D8;&#x91CF;&#x800C;</span>
<span class="token comment">// &#x78B0;&#x5DE7;&#x88AB;&#x547D;&#x540D;&#x4E3A; const_iterator&#xFF0C;&#x6216;&#x5982;&#x679C; x &#x78B0;&#x5DE7;&#x662F;&#x4E2A; global &#x53D8;&#x91CF;&#x540D;&#x79F0;&#x5462;&#xFF1F;</span>
<span class="token comment">// &#x90A3;&#x6837;&#x7684;&#x8BDD;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x518D;&#x662F;&#x58F0;&#x660E;&#x4E00;&#x4E2A; local &#x53D8;&#x91CF;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x76F8;&#x4E58;&#x52A8;&#x4F5C;&#xFF1A;</span>
<span class="token comment">// C::const_iterator &#x4E58;&#x4EE5; x&#x3002;</span>





<span class="token comment">// &#x73B0;&#x5728;&#x518D;&#x6B21;&#x770B;&#x770B; print2nd &#x8D77;&#x59CB;&#x5904;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> C<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">print2nd</span><span class="token punctuation">(</span><span class="token keyword">const</span> C<span class="token operator">&amp;</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        C<span class="token operator">::</span>const_iterator <span class="token function">iter</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8FD9;&#x4E2A;&#x540D;&#x79F0;&#x88AB;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                             <span class="token comment">// &#x5047;&#x8BBE;&#x4E3A;&#x975E;&#x7C7B;&#x578B;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x73B0;&#x5728;&#x5E94;&#x8BE5;&#x5F88;&#x6E05;&#x695A;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x4E0D;&#x662F;&#x6709;&#x6548;&#x7684; C++ &#x4EE3;&#x7801;&#x4E86;&#x5427;&#x3002;</span>
<span class="token comment">// iter &#x58F0;&#x660E;&#x5F0F;&#x53EA;&#x6709;&#x5728; C:const_iterator &#x662F;&#x4E2A;&#x7C7B;&#x578B;&#x65F6;&#x624D;&#x5408;&#x7406;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x544A;&#x8BC9; C++ &#x8BF4;&#x5B83;&#x662F;&#xFF0C;&#x4E8E;&#x662F; C++ &#x5047;&#x8BBE;&#x5B83;&#x4E0D;&#x662F;&#x3002;</span>
<span class="token comment">// &#x82E5;&#x8981;&#x77EB;&#x6B63;&#x8FD9;&#x4E2A;&#x5F62;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x544A;&#x8BC9; C++ &#x8BF4; C::const_iterator &#x662F;&#x4E2A;&#x7C7B;&#x578B;&#x3002;</span>
<span class="token comment">// &#x53EA;&#x8981;&#x7D27;&#x4E34;&#x5B83;&#x4E4B;&#x524D;&#x653E;&#x7F6E;&#x5173;&#x952E;&#x5B57; typename &#x5373;&#x53EF;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> C<span class="token operator">&gt;</span>                    <span class="token comment">// &#x8FD9;&#x662F;&#x5408;&#x6CD5;&#x7684; C++ &#x4EE3;&#x7801;</span>
<span class="token keyword">void</span> <span class="token function">print2nd</span><span class="token punctuation">(</span><span class="token keyword">const</span> C<span class="token operator">&amp;</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">typename</span> C<span class="token operator">::</span>const_iterator <span class="token function">iter</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4E00;&#x822C;&#x6027;&#x89C4;&#x5219;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x5F53;&#x4F60;&#x60F3;&#x8981;&#x5728; template &#x4E2D;&#x6307;&#x6D89;&#x4E00;&#x4E2A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF0C;</span>
<span class="token comment">// &#x5C31;&#x5FC5;&#x987B;&#x5728;&#x7D27;&#x4E34;&#x5B83;&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#x653E;&#x4E0A;&#x5173;&#x952E;&#x5B57; typename&#x3002;</span>





<span class="token comment">// typename &#x53EA;&#x88AB;&#x7528;&#x6765;&#x9A8C;&#x660E;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF1B;&#x5176;&#x4ED6;&#x540D;&#x79F0;&#x4E0D;&#x8BE5;&#x6709;&#x5B83;&#x5B58;&#x5728;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A; function template&#xFF0C;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x548C;&#x4E00;&#x4E2A;&#x201C;&#x6307;&#x5411;&#x8BE5;&#x5BB9;&#x5668;&#x201D;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> C<span class="token operator">&gt;</span>                    <span class="token comment">// &#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x201C;typename&#x201D;&#xFF08;&#x6216;&#x201C;class&#x201D;&#xFF09;</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">const</span> C<span class="token operator">&amp;</span> container<span class="token punctuation">,</span>              <span class="token comment">// &#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;&#x201C;typename&#x201D;</span>
       <span class="token keyword">typename</span> C<span class="token operator">::</span>iterator iter<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4E00;&#x5B9A;&#x8981;&#x4F7F;&#x7528;&#x201C;typename&#x201D;</span>

<span class="token comment">// &#x4E0A;&#x8FF0;&#x7684; C &#x5E76;&#x4E0D;&#x662F;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF08;&#x5B83;&#x5E76;&#x975E;&#x5D4C;&#x5957;&#x4E8E;&#x4EFB;&#x4F55;&#x201C;&#x53D6;&#x51B3;&#x4E8E; template &#x53C2;&#x6570;&#x201D;&#x7684;&#x4E1C;&#x897F;&#x5185;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x58F0;&#x660E; container &#x65F6;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x4EE5; typename &#x4E3A;&#x524D;&#x5BFC;&#xFF0C;&#x4F46; C::iterator</span>
<span class="token comment">// &#x662F;&#x4E2A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x540D;&#x79F0;&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x4EE5; typename &#x4E3A;&#x524D;&#x5BFC;&#x3002;</span>





<span class="token comment">// &#x201C;typename &#x5FC5;&#x987B;&#x4F5C;&#x4E3A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x7684;&#x524D;&#x7F00;&#x8BCD;&#x201D;&#x8FD9;&#x4E00;&#x89C4;&#x5219;&#x7684;&#x4F8B;&#x5916;&#x662F;&#xFF0C;</span>
<span class="token comment">// typename &#x4E0D;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;&#x5728; base classes list &#x5185;&#x7684;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x4E4B;&#x524D;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x4E0D;&#x53EF;&#x5728; member initialization list&#xFF08;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#xFF09;&#x4E2D;&#x4F5C;&#x4E3A; base class &#x4FEE;&#x9970;&#x7B26;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>Nested <span class="token punctuation">{</span>        <span class="token comment">// base class list &#x4E2D;</span>
<span class="token keyword">public</span><span class="token operator">:</span>                                         <span class="token comment">// &#x4E0D;&#x5141;&#x8BB8;&#x201C;typename&#x201D;&#x3002;</span>
    <span class="token keyword">explicit</span> <span class="token function">Derived</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span>
        <span class="token operator">:</span> Base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">Nested</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                    <span class="token comment">// mem.init.list &#x4E2D;</span>
    <span class="token punctuation">{</span>                                           <span class="token comment">// &#x4E0D;&#x5141;&#x8BB8; &#x201C;typename&#x201D;&#x3002;</span>
        <span class="token keyword">typename</span> Base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>Nested temp<span class="token punctuation">;</span>          <span class="token comment">// &#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#xFF0C;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x65E2;&#x4E0D;&#x5728; base class list &#x4E2D;&#x4E5F;&#x4E0D;&#x5728; mem.init.list &#x4E2D;&#xFF0C;</span>
    <span class="token punctuation">}</span>                   <span class="token comment">// &#x4F5C;&#x4E3A;&#x4E00;&#x4E2A; base class &#x4FEE;&#x9970;&#x7B26;&#x9700;&#x52A0;&#x4E0A; typename&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">workWithIterator</span><span class="token punctuation">(</span>IterT iter<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">typename</span> std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">&gt;</span><span class="token operator">::</span>value_type <span class="token function">temp</span><span class="token punctuation">(</span><span class="token operator">*</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x522B;&#x8BA9; std::iterator_traits&lt;IterT&gt;::value_type &#x60CA;&#x5413;&#x4E86;&#x4F60;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x53EA;&#x4E0D;&#x8FC7;&#x662F;&#x6807;&#x51C6; traits class&#xFF08;&#x89C1;&#x6761;&#x6B3E; 47&#xFF09;&#x7684;&#x4E00;&#x79CD;&#x8FD0;&#x7528;&#xFF0C;</span>
<span class="token comment">// &#x76F8;&#x5F53;&#x4E8E;&#x8BF4;&#x201C;&#x7C7B;&#x578B;&#x4E3A; IterT &#x4E4B;&#x5BF9;&#x8C61;&#x6240;&#x6307;&#x7269;&#x7684;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x5C06; temp &#x521D;&#x59CB;&#x5316; iter &#x6240;&#x6307;&#x7269;&#x201D;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; IterT &#x662F; vector&lt;int&gt;::iterator&#xFF0C;temp &#x7684;&#x7C7B;&#x578B;&#x5C31;&#x662F; int&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C; IterT &#x662F; vector&lt;string&gt;::iterator&#xFF0C;temp &#x7684;&#x7C7B;&#x578B;&#x5C31;&#x662F; string&#x3002;</span>
<span class="token comment">// &#x7531;&#x4E8E; std::iterator_traits&lt;IterT&gt;::value_type &#x662F;&#x4E2A;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;</span>
<span class="token comment">// &#xFF08;value_type &#x88AB;&#x5D4C;&#x5957;&#x4E8E; iterator_traits&lt;IterT&gt; &#x4E4B;&#x5185;&#x800C; IterT &#x662F;&#x4E2A; template &#x53C2;&#x6570;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728;&#x5B83;&#x4E4B;&#x524D;&#x653E;&#x7F6E; typename&#x3002;</span>





<span class="token comment">// &#x666E;&#x901A;&#x7684;&#x4E60;&#x60EF;&#x662F;&#x8BBE;&#x5B9A; typedef &#x540D;&#x79F0;&#x7528;&#x4EE5;&#x4EE3;&#x8868;&#x67D0;&#x4E2A; traits &#x6210;&#x5458;&#x540D;&#x79F0;&#xFF0C;</span>
<span class="token comment">// &#x4E8E;&#x662F;&#x5E38;&#x5E38;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684; local typedef&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">workWithIterator</span><span class="token punctuation">(</span>IterT iter<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">typedef</span> <span class="token keyword">typename</span> std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">&gt;</span><span class="token operator">::</span>value_type value_type<span class="token punctuation">;</span>
    value_type <span class="token function">temp</span><span class="token punctuation">(</span><span class="token operator">*</span>iter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8BB8;&#x591A;&#x7A0B;&#x5E8F;&#x5458;&#x6700;&#x521D;&#x8BA4;&#x4E3A;&#x628A;&#x201C;typedef typename&#x201D;&#x5E76;&#x5217;&#x9887;&#x4E0D;&#x548C;&#x8C10;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5B83;&#x662F;&#x5728;&#x662F;&#x6307;&#x6D89;&#x201C;&#x5D4C;&#x5957;&#x4ECE;&#x5C5E;&#x7C7B;&#x578B;&#x540D;&#x79F0;&#x201D;&#x7684;&#x4E00;&#x4E2A;&#x5408;&#x7406;&#x9644;&#x5E26;&#x7ED3;&#x679C;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-43%E5%AD%A6%E4%B9%A0%E5%A4%84%E7%90%86%E6%A8%A1%E6%9D%BF%E5%8C%96%E5%9F%BA%E7%B1%BB%E5%86%85%E7%9A%84%E5%90%8D%E7%A7%B0">&#x6761;&#x6B3E; 43&#xFF1A;&#x5B66;&#x4E60;&#x5904;&#x7406;&#x6A21;&#x677F;&#x5316;&#x57FA;&#x7C7B;&#x5185;&#x7684;&#x540D;&#x79F0;</h3>

<ul>
<li>&#x53EF;&#x5728; derived class templates &#x5185;&#x901A;&#x8FC7;&#x201C;this-&gt;&#x201D;&#x6307;&#x6D89; base class templates &#x5185;&#x7684;&#x6210;&#x5458;&#x540D;&#x79F0;&#xFF0C;&#x6216;&#x85C9;&#x7531;&#x4E00;&#x4E2A;&#x660E;&#x767D;&#x5199;&#x51FA;&#x7684;&#x201C;base class &#x8D44;&#x683C;&#x4FEE;&#x9970;&#x7B26;&#x201D;&#x5B8C;&#x6210;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x64B0;&#x5199;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x4F20;&#x9001;&#x4FE1;&#x606F;&#x5230;&#x82E5;&#x5E72;&#x4E0D;&#x540C;&#x7684;&#x516C;&#x53F8;&#x53BB;&#x3002;</span>
<span class="token comment">// &#x4FE1;&#x606F;&#x8981;&#x4E0D;&#x8BD1;&#x6210;&#x5BC6;&#x7801;&#xFF0C;&#x8981;&#x4E0D;&#x5C31;&#x662F;&#x672A;&#x7ECF;&#x52A0;&#x5DE5;&#x7684;&#x6587;&#x5B57;&#x3002;&#x5982;&#x679C;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x6211;&#x4EEC;&#x6709;&#x8DB3;&#x591F;&#x4FE1;&#x606F;</span>
<span class="token comment">// &#x6765;&#x51B3;&#x5B9A;&#x54EA;&#x4E00;&#x4E2A;&#x4FE1;&#x606F;&#x4F20;&#x81F3;&#x54EA;&#x4E00;&#x5BB6;&#x516C;&#x53F8;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x91C7;&#x7528;&#x57FA;&#x4E8E; template &#x7684;&#x89E3;&#x6CD5;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">CompanyA</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendCleartext</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sendEncrypted</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CompantyB</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendCleartext</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">sendEncrypted</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x9488;&#x5BF9;&#x5176;&#x4ED6;&#x516C;&#x53F8;&#x8BBE;&#x8BA1;&#x7684; classes&#x3002;</span>

<span class="token keyword">class</span> <span class="token class-name">MsgInfo</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8FD9;&#x4E2A; class &#x7528;&#x6765;&#x4FDD;&#x5B58;&#x4FE1;&#x606F;&#xFF0C;&#x4EE5;&#x5907;&#x5C06;&#x6765;&#x4EA7;&#x751F;&#x4FE1;&#x606F;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">MsgSender</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                     <span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x6790;&#x6784;&#x51FD;&#x6570;&#x7B49;&#x7B49;</span>
    <span class="token keyword">void</span> <span class="token function">sendClear</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        std<span class="token operator">::</span>string msg<span class="token punctuation">;</span>
        &#x5728;&#x8FD9;&#x513F;&#xFF0C;&#x6839;&#x636E; info &#x4EA7;&#x751F;&#x4FE1;&#x606F;&#xFF1B;
        Company c<span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token function">sendCleartext</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">sendSecret</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>        <span class="token comment">// &#x7C7B;&#x4F3C; sendClear&#xFF0C;&#x552F;&#x4E00;&#x4E0D;&#x540C;&#x662F;</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>                                     <span class="token comment">// &#x8FD9;&#x91CC;&#x8C03;&#x7528; c.sendEncrypted</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x505A;&#x6CD5;&#x884C;&#x5F97;&#x901A;&#x3002;&#x4F46;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x65F6;&#x5019;&#x60F3;&#x8981;&#x5728;&#x6BCF;&#x6B21;&#x9001;&#x51FA;&#x4FE1;&#x606F;&#x65F6;&#x5FD7;&#x8BB0;&#xFF08;log&#xFF09;&#x67D0;&#x4E9B;&#x4FE1;&#x606F;&#x3002;</span>
<span class="token comment">// derived class &#x53EF;&#x8F7B;&#x6613;&#x52A0;&#x4E0A;&#x8FD9;&#x6837;&#x7684;&#x751F;&#x4EA7;&#x529B;&#xFF0C;&#x90A3;&#x4F3C;&#x4E4E;&#x662F;&#x4E2A;&#x5408;&#x60C5;&#x5408;&#x7406;&#x7684;&#x89E3;&#x6CD5;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">LoggingMsgSender</span> <span class="token operator">:</span> <span class="token keyword">public</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#x3001;&#x6790;&#x6784;&#x51FD;&#x6570;&#x7B49;&#x7B49;&#x3002;</span>
    <span class="token keyword">void</span> <span class="token function">sendClearMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x524D;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
        <span class="token function">sendClear</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x8C03;&#x7528; base class &#x51FD;&#x6570;&#xFF1B;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x540E;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6CE8;&#x610F;&#x8FD9;&#x4E2A; derived class &#x7684;&#x4FE1;&#x606F;&#x4F20;&#x9001;&#x51FD;&#x6570;&#x6709;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x540D;&#x79F0;&#xFF08;sendClearMsg&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4E0E;&#x5176; base class &#x5185;&#x7684;&#x540D;&#x79F0;&#xFF08;sendClear&#xFF09;&#x4E0D;&#x540C;&#x3002;&#x90A3;&#x662F;&#x4E2A;&#x597D;&#x8BBE;&#x8BA1;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x907F;&#x514D;&#x906E;&#x63A9;</span>
<span class="token comment">// &#x201C;&#x7EE7;&#x627F;&#x800C;&#x5F97;&#x7684;&#x540D;&#x79F0;&#x201D;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 33&#xFF09;&#xFF0C;&#x4E5F;&#x907F;&#x514D;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7EE7;&#x627F;&#x800C;&#x5F97;&#x7684; </span>
<span class="token comment">// non-virtual &#x51FD;&#x6570;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 36&#xFF09;&#x3002;&#x4F46;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;</span>
<span class="token comment">// &#x81F3;&#x5C11;&#x5BF9;&#x4E25;&#x5B88;&#x89C4;&#x5F8B;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x800C;&#x8A00;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x4F1A;&#x62B1;&#x6028; sendClear &#x4E0D;&#x5B58;&#x5728;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x7684;&#x773C;&#x955C;&#x53EF;&#x4EE5;&#x770B;&#x5230; sendClear &#x7684;&#x786E;&#x5728; base class &#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x5374;&#x770B;&#x4E0D;&#x5230;&#x5B83;&#x4EEC;&#x3002;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;</span>

<span class="token comment">// &#x95EE;&#x9898;&#x5728;&#x4E8E;&#xFF0C;&#x5F53;&#x7F16;&#x8BD1;&#x5668;&#x906D;&#x9047; class template LoggingMsgSender &#x5B9A;&#x4E49;&#x5F0F;&#x65F6;&#xFF0C;</span>
<span class="token comment">// &#x5E76;&#x4E0D;&#x77E5;&#x9053;&#x5B83;&#x7EE7;&#x627F;&#x4EC0;&#x4E48;&#x6837;&#x7684; class&#x3002;&#x5F53;&#x7136;&#x5B83;&#x7EE7;&#x627F;&#x7684;&#x662F; MsgSender&lt;Company&gt;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5176;&#x4E2D;&#x7684; Company &#x662F;&#x4E2A; template &#x53C2;&#x6570;&#xFF0C;&#x4E0D;&#x5230;&#x540E;&#x6765;&#xFF08;&#x5F53; LoggingMsgSender &#x88AB;&#x5177;&#x73B0;&#x5316;&#xFF09;</span>
<span class="token comment">// &#x65E0;&#x6CD5;&#x786E;&#x5207;&#x77E5;&#x9053;&#x5B83;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x800C;&#x5982;&#x679C;&#x4E0D;&#x77E5;&#x9053; Company &#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5C31;&#x65E0;&#x6CD5;&#x77E5;&#x9053;</span>
<span class="token comment">// class MsgSender&lt;Company&gt; &#x770B;&#x8D77;&#x6765;&#x60F3;&#x4EC0;&#x4E48;&#x2014;&#x2014;&#x66F4;&#x660E;&#x786E;&#x5730;&#x8BF4;&#x662F;&#x6CA1;&#x529E;&#x6CD5;</span>
<span class="token comment">// &#x77E5;&#x9053;&#x5B83;&#x662F;&#x5426;&#x6709;&#x4E2A; sendClear &#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x8BA9;&#x95EE;&#x9898;&#x66F4;&#x5177;&#x4F53;&#x5316;&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x6709;&#x4E2A; class CompanyZ &#x575A;&#x6301;&#x4F7F;&#x7528;&#x52A0;&#x5BC6;&#x901A;&#x8BAF;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">CompanyZ</span> <span class="token punctuation">{</span>                <span class="token comment">// &#x8FD9;&#x4E2A; class &#x4E0D;&#x63D0;&#x4F9B;</span>
<span class="token keyword">public</span><span class="token operator">:</span>                         <span class="token comment">// sendCleartext &#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendEncrypted</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E00;&#x822C;&#x6027;&#x7684; MsgSender template &#x5BF9; CompanyZ &#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x56E0;&#x4E3A;&#x90A3;&#x4E2A; template &#x63D0;&#x4F9B;</span>
<span class="token comment">// &#x4E86;&#x4E00;&#x4E2A; sendClear &#x51FD;&#x6570;&#xFF08;&#x5176;&#x4E2D;&#x9488;&#x5BF9;&#x5176;&#x7C7B;&#x578B;&#x53C2;&#x6570; Company &#x8C03;&#x7528;&#x4E86; sendCleartext &#x51FD;&#x6570;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x8FD9;&#x5BF9; CompanyZ &#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x5408;&#x7406;&#x3002;&#x6B32;&#x77EB;&#x6B63;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9488;&#x5BF9; CompanyZ &#x4EA7;&#x751F;&#x4E00;&#x4E2A; MsgSender &#x7279;&#x5316;&#x7248;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>                          <span class="token comment">// &#x4E00;&#x4E2A;&#x5168;&#x7279;&#x5316;&#x7684;</span>
<span class="token keyword">class</span> <span class="token class-name">MsgSender</span><span class="token operator">&lt;</span>CompanyZ<span class="token operator">&gt;</span> <span class="token punctuation">{</span>         <span class="token comment">// MsgSender&#xFF1A;&#x5B83;&#x548C;&#x4E00;&#x822C; template &#x76F8;&#x540C;&#xFF0C;</span>
<span class="token keyword">public</span><span class="token operator">:</span>                             <span class="token comment">// &#x5DEE;&#x522B;&#x53EA;&#x5728;&#x4E8E;&#x5B83;&#x5220;&#x6389;&#x4E86; sendClear&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendSecret</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6CE8;&#x610F; class &#x5B9A;&#x4E49;&#x5F0F;&#x6700;&#x524D;&#x6709;&#x7684; &#x201C;template&lt;&gt;&#x201D;&#x7684;&#x8BED;&#x6CD5;&#x8C61;&#x5F81;&#x8FD9;&#x65E2;&#x4E0D;&#x662F; template &#x4E5F;&#x4E0D;&#x662F;&#x6807;&#x51C6; class&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x662F;&#x4E2A;&#x7279;&#x5316;&#x7248;&#x7684; MsgSender template&#xFF0C;&#x5728; template &#x5B9E;&#x53C2;&#x662F; CompanyZ &#x65F6;&#x88AB;&#x4F7F;&#x7528;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F;&#x6240;&#x8C13;&#x7684;&#x6A21;&#x677F;&#x5168;&#x7279;&#x5316;&#xFF08;total template specialization&#xFF09;&#xFF1A;</span>
<span class="token comment">// template MsgSender &#x9488;&#x5BF9;&#x7C7B;&#x578B; CompanyZ &#x7279;&#x5316;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x5176;&#x7279;&#x5316;&#x662F;&#x5168;&#x9762;&#x6027;&#x7684;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4E00;&#x65E6;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x88AB;&#x5B9A;&#x4E49;&#x4E3A; CompanyZ&#xFF0C;&#x518D;&#x6CA1;&#x6709;&#x5176;&#x4ED6; template &#x53C2;&#x6570;&#x53EF;&#x4F9B;&#x53D8;&#x5316;&#x3002;</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">LoggingMsgSender</span> <span class="token operator">:</span> <span class="token keyword">public</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendClearMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x524D;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
        <span class="token function">sendClear</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x5982;&#x679C; Company == CompanyZ&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4E0D;&#x5B58;&#x5728;&#x3002;</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x540E;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6B63;&#x5982;&#x6CE8;&#x91CA;&#x6240;&#x8A00;&#xFF0C;&#x5F53; base class &#x88AB;&#x6307;&#x5B9A;&#x4E3A; MsgSender&lt;CompanyZ&gt; &#x65F6;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E0D;&#x5408;&#x6CD5;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x90A3;&#x4E2A; class &#x5E76;&#x672A;&#x63D0;&#x4F9B; sendClear &#x51FD;&#x6570;&#xFF01;&#x90A3;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48; C++ &#x62D2;&#x7EDD;&#x8FD9;&#x4E2A;&#x8C03;&#x7528;&#x7684;&#x539F;&#x56E0;&#xFF1A;</span>
<span class="token comment">// &#x5B83;&#x77E5;&#x9053; base class templates &#x6709;&#x53EF;&#x80FD;&#x88AB;&#x7279;&#x5316;&#xFF0C;&#x800C;&#x90A3;&#x4E2A;&#x7279;&#x5316;&#x7248;&#x672C;&#x53EF;&#x80FD;&#x4E0D;&#x63D0;&#x4F9B;&#x548C;&#x4E00;&#x822C;&#x6027;</span>
<span class="token comment">// template &#x76F8;&#x540C;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x56E0;&#x6B64;&#x5B83;&#x5F80;&#x5F80;&#x62D2;&#x7EDD;&#x5728; templatized base classes</span>
<span class="token comment">// &#xFF08;&#x6A21;&#x677F;&#x5316;&#x57FA;&#x7C7B;&#xFF0C;&#x672C;&#x4F8B;&#x7684; MsgSender&lt;Company&gt;&#xFF09;&#x5185;&#x5BFB;&#x627E;&#x7EE7;&#x627F;&#x800C;&#x6765;&#x7684;&#x540D;&#x79F0;&#xFF08;&#x672C;&#x4F8B;&#x7684; SendClear&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5C31;&#x67D0;&#x79CD;&#x610F;&#x4E49;&#x800C;&#x8A00;&#xFF0C;&#x5F53;&#x6211;&#x4EEC;&#x4ECE; Object Oriented C++ &#x8DE8;&#x8FDB; Template C++&#xFF08;&#x89C1;&#x6761;&#x6B3E; 1&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x7EE7;&#x627F;&#x5C31;&#x4E0D;&#x50CF;&#x4EE5;&#x524D;&#x90A3;&#x822C;&#x7545;&#x884C;&#x65E0;&#x963B;&#x4E86;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x91CD;&#x5934;&#x6765;&#x8FC7;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x6709;&#x67D0;&#x79CD;&#x529E;&#x6CD5;&#x4EE4; C++ &#x201C;&#x4E0D;&#x8FDB;&#x5165; templatized</span>
<span class="token comment">// base classes &#x89C2;&#x5BDF;&#x201D;&#x7684;&#x884C;&#x4E3A;&#x5931;&#x6548;&#x3002;&#x6709;&#x4E09;&#x4E2A;&#x529E;&#x6CD5;&#xFF0C;</span>
<span class="token comment">// &#x7B2C;&#x4E00;&#x662F;&#x5728; base class &#x51FD;&#x6570;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#x4E4B;&#x524D;&#x52A0;&#x4E0A;&#x201C;this-&gt;&#x201D;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">LoggingMsgSender</span> <span class="token operator">:</span> <span class="token keyword">public</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendClearMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x524D;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
        <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">sendClear</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &#x6210;&#x7ACB;&#xFF0C;&#x5047;&#x8BBE; sendClear &#x5C06;&#x88AB;&#x7EE7;&#x627F;&#x3002;</span>
        &#x5C06;&#x201C;&#x4F20;&#x9001;&#x540E;&#x201D;&#x7684;&#x4FE1;&#x606F;&#x5199;&#x81F3; log&#xFF1B;
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7B2C;&#x4E8C;&#x662F;&#x4F7F;&#x7528; using &#x58F0;&#x660E;&#x5F0F;&#x3002;&#x5982;&#x679C;&#x4F60;&#x5DF2;&#x7ECF;&#x8BFB;&#x8FC7;&#x6761;&#x6B3E; 33&#xFF0C;&#x8FD9;&#x4E2A;&#x89E3;&#x6CD5;&#x5E94;&#x8BE5;&#x4F1A;&#x4EE4;&#x4F60;&#x611F;&#x5230;&#x719F;&#x6089;&#x3002;</span>
<span class="token comment">// &#x6761;&#x6B3E; 33 &#x63CF;&#x8FF0; using &#x58F0;&#x660E;&#x5F0F;&#x5982;&#x4F55;&#x5C06;&#x201C;&#x88AB;&#x63A9;&#x76D6;&#x7684; base class &#x540D;&#x79F0;&#x201D;&#x5E26;&#x5165;&#x4E00;&#x4E2A; derived class</span>
<span class="token comment">// &#x4F5C;&#x7528;&#x57DF;&#x5185;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5199;&#x4E0B; sendClearMsg&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">LoggingMsgSender</span> <span class="token operator">:</span> <span class="token keyword">public</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">using</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span><span class="token operator">::</span>sendClear<span class="token punctuation">;</span>        <span class="token comment">// &#x544A;&#x8BC9;&#x7F16;&#x8BD1;&#x5668;&#xFF0C;&#x8BF7;&#x5B83;&#x5047;&#x8BBE;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                         <span class="token comment">// sendClear &#x4F4D;&#x4E8E; base class &#x5185;&#x3002;</span>
    <span class="token keyword">void</span> <span class="token function">sendClearMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token function">sendClear</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// OK&#xFF0C;&#x5047;&#x8BBE; sendClear &#x5C06;&#x88AB;&#x7EE7;&#x627F;&#x4E0B;&#x6765;&#x3002;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#xFF08;&#x867D;&#x7136; using &#x58F0;&#x660E;&#x5F0F;&#x5728;&#x8FD9;&#x91CC;&#x6216;&#x5728;&#x6761;&#x6B3E; 33 &#x90FD;&#x53EF;&#x6709;&#x6548;&#x8FD0;&#x4F5C;&#xFF0C;&#x4F46;&#x4E24;&#x5904;&#x89E3;&#x51B3;&#x7684;&#x95EE;&#x9898;&#x5176;&#x5B9E;&#x4E0D;&#x76F8;&#x540C;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x7684;&#x60C5;&#x51B5;&#x5E76;&#x4E0D;&#x662F; base class &#x540D;&#x79F0;&#x88AB; derived class &#x540D;&#x79F0;&#x906E;&#x63A9;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x8FDB;&#x5165; base class &#x4F5C;&#x7528;&#x57DF;&#x5185;&#x67E5;&#x627E;&#xFF0C;&#x4E8E;&#x662F;&#x6211;&#x4EEC;&#x901A;&#x8FC7; using &#x544A;&#x8BC9;&#x5B83;&#xFF0C;&#x8BF7;&#x5B83;&#x90A3;&#x4E48;&#x505A;&#x3002;&#xFF09;</span>

<span class="token comment">// &#x7B2C;&#x4E09;&#x4E2A;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x660E;&#x767D;&#x6307;&#x51FA;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x4F4D;&#x4E8E; base class &#x5185;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> Company<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">LoggingMsgSender</span> <span class="token operator">:</span> <span class="token keyword">public</span> MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">sendClearMsg</span><span class="token punctuation">(</span><span class="token keyword">const</span> MsgInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        MsgSender<span class="token operator">&lt;</span>Company<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">sendClear</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// OK&#xFF0C;&#x5047;&#x8BBE; sendClear</span>
                                                <span class="token comment">// &#x5C06;&#x88AB;&#x7EE7;&#x627F;&#x4E0B;&#x6765;&#x3002;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4F46;&#x8FD9;&#x5F80;&#x5F80;&#x662F;&#x6700;&#x4E0D;&#x8BA9;&#x4EBA;&#x6EE1;&#x610F;&#x7684;&#x4E00;&#x4E2A;&#x89E3;&#x6CD5;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x662F; virtual &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x4E0A;&#x8FF0;&#x7684;&#x660E;&#x786E;&#x8D44;&#x683C;&#x4FEE;&#x9970;&#xFF08;explicit qualification&#xFF09;&#x4F1A;&#x5173;&#x95ED;&#x201C;virtual &#x7ED1;&#x5B9A;&#x884C;&#x4E3A;&#x201D;&#x3002;</span>





<span class="token comment">// &#x4ECE;&#x540D;&#x79F0;&#x53EF;&#x89C6;&#x70B9;&#xFF08;visibility point&#xFF09;&#x7684;&#x89D2;&#x5EA6;&#x51FA;&#x53D1;&#xFF0C;&#x4E0A;&#x8FF0;&#x6BCF;&#x4E00;&#x4E2A;&#x89E3;&#x6CD5;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x90FD;&#x76F8;&#x540C;&#xFF1A;</span>
<span class="token comment">// &#x5BF9;&#x7F16;&#x8BD1;&#x5668;&#x627F;&#x8BFA;&#x201C;base class template &#x7684;&#x4EFB;&#x4F55;&#x7279;&#x5316;&#x7248;&#x672C;&#x90FD;&#x5C06;&#x652F;&#x6301;&#x5176;&#x4E00;&#x822C;&#xFF08;&#x6CDB;&#x5316;&#xFF09;</span>
<span class="token comment">// &#x7248;&#x672C;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x63A5;&#x53E3;&#x201D;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x627F;&#x8BFA;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x5728;&#x89E3;&#x6790;&#xFF08;parse&#xFF09;&#x50CF; LoggingMsgSender</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684; derived class template &#x65F6;&#x9700;&#x8981;&#x7684;&#x3002;&#x4F46;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x627F;&#x8BFA;&#x6700;&#x7EC8;&#x672A;&#x88AB;&#x5B9E;&#x8DF5;&#x51FA;&#x6765;&#xFF0C;</span>
<span class="token comment">// &#x5F80;&#x540E;&#x7684;&#x7F16;&#x8BD1;&#x6700;&#x7EC8;&#x8FD8;&#x662F;&#x4F1A;&#x8FD8;&#x7ED9;&#x4E8B;&#x5B9E;&#x4E00;&#x4E2A;&#x516C;&#x9053;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x7A0D;&#x540E;&#x7684;&#x6E90;&#x7801;&#x5185;&#x542B;&#x8FD9;&#x4E2A;&#xFF1A;</span>
LoggingMsgSender<span class="token operator">&lt;</span>CompanyZ<span class="token operator">&gt;</span> zMsgSender<span class="token punctuation">;</span>
MsgInfo msgData<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x5728; msgData &#x5185;&#x653E;&#x7F6E;&#x4FE1;&#x606F;&#x3002;</span>
zMsgSender<span class="token punctuation">.</span><span class="token function">sendClearMsg</span><span class="token punctuation">(</span>msgData<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// &#x5176;&#x4E2D;&#x5BF9; sendClearMsg &#x7684;&#x8C03;&#x7528;&#x52A8;&#x4F5C;&#x5C06;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x90A3;&#x70B9;&#x4E0A;&#xFF0C;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x77E5;&#x9053; base class &#x662F;&#x4E2A; template &#x7279;&#x5316;&#x7248;&#x672C; MsgSender&lt;CompanyZ&gt;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x4E14;&#x5B83;&#x4EEC;&#x77E5;&#x9053;&#x90A3;&#x4E2A; class &#x4E0D;&#x63D0;&#x4F9B; sendClear &#x51FD;&#x6570;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x5374;&#x662F; sendClearMsg</span>
<span class="token comment">// &#x5C1D;&#x8BD5;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;</span>





<span class="token comment">// &#x6839;&#x672C;&#x800C;&#x8A00;&#xFF0C;&#x672C;&#x6761;&#x6B3E;&#x63A2;&#x8BA8;&#x7684;&#x662F;&#xFF0C;&#x9762;&#x5411;&#x201C;&#x6307;&#x6D89; base class members&#x201D;&#x4E4B;&#x65E0;&#x6548; references&#xFF0C;</span>
<span class="token comment">// &#x7F16;&#x8BD1;&#x5668;&#x7684;&#x8BCA;&#x65AD;&#x65F6;&#x95F4;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5728;&#x65E9;&#x671F;&#xFF08;&#x5F53;&#x89E3;&#x6790; derived class template &#x7684;&#x5B9A;&#x4E49;&#x5F0F;&#x65F6;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x5728;&#x665A;&#x671F;&#xFF08;&#x5F53;&#x90A3;&#x4E9B; templates &#x88AB;&#x7279;&#x5B9A;&#x4E4B; template &#x5B9E;&#x53C2;&#x5177;&#x73B0;&#x5316;&#x65F6;&#xFF09;&#x3002;</span>
<span class="token comment">// C++ &#x7684;&#x653F;&#x7B56;&#x662F;&#x5B81;&#x613F;&#x8F83;&#x65E9;&#x8BCA;&#x65AD;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x201C;&#x5F53; base classes &#x4ECE; templates</span>
<span class="token comment">// &#x4E2D;&#x88AB;&#x5177;&#x73B0;&#x5316;&#x65F6;&#x201D;&#x5B83;&#x5047;&#x8BBE;&#x5B83;&#x5BF9;&#x90A3;&#x4E9B; base classes&#x7684;&#x5185;&#x5BB9;&#x6BEB;&#x65E0;&#x6240;&#x6089;&#x7684;&#x7F18;&#x6545;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-44%E5%B0%86%E4%B8%8E%E5%8F%82%E6%95%B0%E6%97%A0%E5%85%B3%E7%9A%84%E4%BB%A3%E7%A0%81%E6%8A%BD%E7%A6%BB-templates">&#x6761;&#x6B3E; 44&#xFF1A;&#x5C06;&#x4E0E;&#x53C2;&#x6570;&#x65E0;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x62BD;&#x79BB; templates</h3>

<ul>
<li>Templates &#x751F;&#x6210;&#x591A;&#x4E2A; classes &#x548C;&#x591A;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4EFB;&#x4F55; template &#x4EE3;&#x7801;&#x90FD;&#x4E0D;&#x8BE5;&#x4E0E;&#x67D0;&#x4E2A;&#x9020;&#x6210;&#x81A8;&#x80C0;&#x7684; template &#x53C2;&#x6570;&#x4EA7;&#x751F;&#x76F8;&#x4F9D;&#x5173;&#x7CFB;&#x3002;</li>
<li>&#x56E0;&#x975E;&#x7C7B;&#x578B;&#x6A21;&#x677F;&#x53C2;&#x6570;&#xFF08;non-type template parameters&#xFF09;&#x800C;&#x9020;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x81A8;&#x80C0;&#xFF0C;&#x5F80;&#x5F80;&#x53EF;&#x6D88;&#x9664;&#xFF0C;&#x505A;&#x6CD5;&#x662F;&#x4EE5;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x6216; class &#x6210;&#x5458;&#x53D8;&#x91CF;&#x66FF;&#x6362; template &#x53C2;&#x6570;&#x3002;</li>
<li>&#x56E0;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#xFF08;type parameters&#xFF09;&#x800C;&#x9020;&#x6210;&#x7684;&#x4EE3;&#x7801;&#x81A8;&#x80C0;&#xFF0C;&#x5F80;&#x5F80;&#x53EF;&#x964D;&#x4F4E;&#xFF0C;&#x505A;&#x6CD5;&#x662F;&#x8BA9;&#x5E26;&#x6709;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x4E8C;&#x8FDB;&#x5236;&#x8868;&#x8FF0;&#xFF08;binary representations&#xFF09;&#x7684;&#x5177;&#x73B0;&#x7C7B;&#x578B;&#xFF08;instantiation types&#xFF09;&#x5171;&#x4EAB;&#x5B9E;&#x73B0;&#x7801;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// Templates &#x662F;&#x8282;&#x7701;&#x65F6;&#x95F4;&#x548C;&#x907F;&#x514D;&#x4EE3;&#x7801;&#x91CD;&#x590D;&#x7684;&#x4E00;&#x4E2A;&#x5947;&#x65B9;&#x5999;&#x6CD5;&#x3002;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x952E;&#x5165; 20 &#x4E2A;&#x7C7B;&#x4F3C;&#x7684; classes</span>
<span class="token comment">// &#x800C;&#x6BCF;&#x4E00;&#x4E2A;&#x5E26;&#x6709; 15 &#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x4F60;&#x53EA;&#x9700;&#x8981;&#x952E;&#x5165;&#x4E00;&#x4E2A; class template&#xFF0C;&#x7559;&#x7ED9;&#x7F16;&#x8BD1;&#x5668;&#x53BB;</span>
<span class="token comment">// &#x5177;&#x73B0;&#x5316;&#x90A3; 20 &#x4E2A;&#x4F60;&#x9700;&#x8981;&#x7684;&#x76F8;&#x5173; classes &#x548C; 300 &#x4E2A;&#x51FD;&#x6570;&#x3002;</span>





<span class="token comment">// &#x7F16;&#x5199; templates &#x65F6;&#xFF0C;&#x4E5F;&#x662F;&#x505A;&#x76F8;&#x540C;&#x7684;&#x5206;&#x6790;&#xFF0C;&#x4EE5;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x907F;&#x514D;&#x91CD;&#x590D;&#xFF0C;&#x4F46;&#x5176;&#x4E2D;&#x6709;&#x4E2A;&#x7A8D;&#x95E8;&#x3002;</span>
<span class="token comment">// &#x5728; non-template &#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x91CD;&#x590D;&#x5341;&#x5206;&#x660E;&#x786E;&#xFF1A;&#x4F60;&#x53EF;&#x4EE5;&#x201C;&#x770B;&#x201D;&#x5230;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x6216;&#x4E24;&#x4E2A; classes</span>
<span class="token comment">// &#x4E4B;&#x95F4;&#x6709;&#x6240;&#x91CD;&#x590D;&#x3002;&#x7136;&#x800C;&#x5728; template &#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x91CD;&#x590D;&#x662F;&#x9690;&#x6666;&#x7684;&#xFF1A;&#x6BD5;&#x7ADF;&#x53EA;&#x5B58;&#x5728;&#x4E00;&#x4EFD; template &#x6E90;&#x7801;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x5FC5;&#x987B;&#x8BAD;&#x7EC3;&#x81EA;&#x5DF1;&#x53BB;&#x611F;&#x53D7;&#x5F53; template &#x88AB;&#x5177;&#x73B0;&#x5316;&#x591A;&#x6B21;&#x65F6;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x7684;&#x91CD;&#x590D;&#x3002;</span>

<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x60F3;&#x4E3A;&#x56FA;&#x5B9A;&#x5C3A;&#x5BF8;&#x7684;&#x6B63;&#x65B9;&#x77E9;&#x9635;&#x7F16;&#x5199;&#x4E00;&#x4E2A; template&#x3002;</span>
<span class="token comment">// &#x8BE5;&#x77E9;&#x9635;&#x7684;&#x6027;&#x8D28;&#x4E4B;&#x4E00;&#x662F;&#x652F;&#x6301;&#x9006;&#x77E9;&#x9635;&#x8FD0;&#x7B97;&#xFF08;matrix inversion&#xFF09;&#x3002;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token punctuation">,</span>            <span class="token comment">// template &#x652F;&#x6301; n x n &#x77E9;&#x9635;&#xFF0C;&#x5143;&#x7D20;&#x662F;</span>
         std<span class="token operator">::</span>size_t n<span class="token operator">&gt;</span>         <span class="token comment">// &#x7C7B;&#x578B;&#x4E3A; T &#x7684; objects&#xFF1B;&#x89C1;&#x4EE5;&#x4E0B;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrix</span> <span class="token punctuation">{</span>            <span class="token comment">// &#x5173;&#x4E8E; size_t &#x53C2;&#x6570;&#x7684;&#x4FE1;&#x606F;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &#x6C42;&#x9006;&#x77E9;&#x9635;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A; template &#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x53C2;&#x6570; T&#xFF0C;&#x9664;&#x6B64;&#x4E4B;&#x5916;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; size_t &#x7684;&#x53C2;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x662F;&#x4E2A;&#x975E;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#xFF08;non-type parameter&#xFF09;&#x3002;&#x8FD9;&#x79CD;&#x53C2;&#x6570;&#x548C;&#x7C7B;&#x578B;&#x53C2;&#x6570;&#x6BD4;&#x8D77;&#x6765;&#x8F83;&#x4E0D;&#x5E38;&#x89C1;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5B83;&#x4EEC;&#x5B8C;&#x5168;&#x5408;&#x6CD5;&#xFF0C;&#x800C;&#x4E14;&#x5C31;&#x50CF;&#x672C;&#x4F8B;&#x4E00;&#x6837;&#xFF0C;&#x76F8;&#x5F53;&#x81EA;&#x7136;&#x3002;</span>

<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x8003;&#x8651;&#x8FD9;&#x4E9B;&#x4EE3;&#x7801;&#xFF1A;</span>
SquareMatrix<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">&gt;</span> sm1<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
sm1<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x8C03;&#x7528; SquareMatrix&lt;double, 5&gt;::invert</span>
SquareMatrix<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token operator">&gt;</span> sm2<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
sm2<span class="token punctuation">.</span><span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// &#x8C03;&#x7528; SquareMatrix&lt;double, 10&gt;::invert</span>

<span class="token comment">// &#x8FD9;&#x4F1A;&#x5177;&#x73B0;&#x5316;&#x4E24;&#x4EFD; invert&#x3002;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x5E76;&#x975E;&#x5B8C;&#x5B8C;&#x5168;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x662F; 5 * 5 &#x77E9;&#x9635;</span>
<span class="token comment">// &#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x662F; 10 * 10 &#x77E9;&#x9635;&#xFF0C;&#x4F46;&#x9664;&#x4E86;&#x5E38;&#x91CF; 5 &#x548C; 10&#xFF0C;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F; template &#x5F15;&#x51FA;&#x4EE3;&#x7801;&#x81A8;&#x80C0;&#x7684;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x4F8B;&#x5B50;&#x3002;</span>





<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x770B;&#x5230;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x5B8C;&#x5168;&#x76F8;&#x540C;&#xFF0C;&#x53EA;&#x9664;&#x4E86;&#x4E00;&#x4E2A;&#x4F7F;&#x7528; 5 &#x800C;&#x53E6;&#x4E00;&#x4E2A;&#x4F7F;&#x7528; 10&#xFF0C;&#x4F60;&#x4F1A;&#x600E;&#x4E48;&#x505A;&#xFF1F;</span>
<span class="token comment">// &#x4F60;&#x7684;&#x672C;&#x80FD;&#x4F1A;&#x4E3A;&#x5B83;&#x4EEC;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x5E26;&#x6570;&#x503C;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x4EE5; 5 &#x548C; 10 &#x6765;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x5E26;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x4E0D;&#x91CD;&#x590D;&#x4EE3;&#x7801;&#x3002;&#x4F60;&#x7684;&#x672C;&#x80FD;&#x5F88;&#x597D;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5BF9; SquareMatrix &#x7684;&#x7B2C;&#x4E00;&#x6B21;&#x4FEE;&#x6539;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>                            <span class="token comment">// &#x4E0E;&#x5C3A;&#x5BF8;&#x65E0;&#x5173;&#x7684; base class&#xFF0C;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrixBase</span> <span class="token punctuation">{</span>                        <span class="token comment">// &#x7528;&#x4E8E;&#x6B63;&#x65B9;&#x5F62;&#x77E9;&#x9635;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">invert</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t matrixSize<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// &#x4EE5;&#x7ED9;&#x5B9A;&#x7684;&#x5C3A;&#x5BF8;&#x6C42;&#x9006;&#x77E9;&#x9635;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t n<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrix</span> <span class="token operator">:</span> <span class="token keyword">private</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">using</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>invert<span class="token punctuation">;</span>          <span class="token comment">// &#x907F;&#x514D;&#x906E;&#x63A9; base &#x7248;&#x7684;</span>
                                                <span class="token comment">// invert&#xFF1B;&#x89C1;&#x6761;&#x6B3E; 33</span>
    
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">void</span> <span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">invert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>          <span class="token comment">// &#x5236;&#x9020;&#x4E00;&#x4E2A; inline &#x8C03;&#x7528;&#xFF0C;&#x8C03;&#x7528;</span>
                                                <span class="token comment">// base class &#x7248;&#x7684; invert&#x3002;&#x7A0D;&#x540E;</span>
                                                <span class="token comment">// &#x8BF4;&#x660E;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD9;&#x513F;&#x51FA;&#x73B0; this-&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// SquareMatrixBase::invert &#x53EA;&#x662F;&#x4F01;&#x56FE;&#x6210;&#x4E3A;&#x201C;&#x907F;&#x514D; derived classes &#x4EE3;&#x7801;&#x91CD;&#x590D;&#x201D;</span>
<span class="token comment">// &#x7684;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EE5; protected &#x66FF;&#x6362; public&#x3002;&#x8C03;&#x7528;&#x5B83;&#x800C;&#x9020;&#x6210;&#x7684;&#x989D;&#x5916;&#x6210;&#x672C;&#x5E94;&#x8BE5;&#x662F; 0&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A; derived classes &#x7684; inverts &#x8C03;&#x7528; base class &#x7248;&#x672C;&#x65F6;&#x7528;&#x7684;&#x662F; inline &#x8C03;&#x7528;</span>
<span class="token comment">// &#xFF08;&#x8FD9;&#x91CC;&#x7684; inline &#x662F;&#x9690;&#x6666;&#x7684;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 30&#xFF09;&#x3002;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x201C;this-&gt;&#x201D;&#x8BB0;&#x53F7;&#xFF0C;&#x56E0;&#x4E3A;&#x82E5;&#x4E0D;&#x8FD9;&#x6837;&#x505A;&#xFF0C;</span>
<span class="token comment">// &#x4FBF;&#x5982;&#x6761;&#x6B3E; 43 &#x6240;&#x8BF4;&#xFF0C;&#x6A21;&#x677F;&#x5316;&#x57FA;&#x7C7B;&#xFF08;templatized base classes&#xFF0C;&#x4F8B;&#x5982; SquareMatrixBase&lt;T&gt;&#xFF09;</span>
<span class="token comment">// &#x5185;&#x7684;&#x51FD;&#x6570;&#x540D;&#x79F0;&#x4F1A;&#x88AB; derived classes &#x63A9;&#x76D6;&#x3002;&#x4E5F;&#x8BF7;&#x6CE8;&#x610F; SquareMatrix &#x548C;</span>
<span class="token comment">// SquareMatrixBase &#x4E4B;&#x95F4;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x662F; private&#x3002;&#x8FD9;&#x53CD;&#x5E94;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF1A;</span>
<span class="token comment">// &#x8FD9;&#x91CC;&#x7684; base class &#x53EA;&#x662F;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9; derived classes &#x5B9E;&#x73B0;&#xFF0C;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x8868;&#x73B0; SquareMatrix</span>
<span class="token comment">// &#x548C; SquareMatrixbase &#x4E4B;&#x95F4;&#x7684; is-a &#x5173;&#x7CFB;&#xFF08;&#x5173;&#x4E8E; private &#x7EE7;&#x627F;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 39&#xFF09;&#x3002;</span>

<span class="token comment">// SquareMatrixBase::invert &#x5982;&#x4F55;&#x77E5;&#x9053;&#x8BE5;&#x64CD;&#x4F5C;&#x4EC0;&#x4E48;&#x6570;&#x636E;&#xFF1F;&#x867D;&#x7136;&#x5B83;&#x4ECE;&#x53C2;&#x6570;&#x4E2D;&#x77E5;&#x9053;&#x77E9;&#x9635;&#x5C3A;&#x5BF8;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5B83;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x54EA;&#x4E2A;&#x7279;&#x5B9A;&#x77E9;&#x9635;&#x7684;&#x6570;&#x636E;&#x5728;&#x54EA;&#x513F;&#xFF1F;&#x60F3;&#x5FC5;&#x53EA;&#x6709; derived class &#x77E5;&#x9053;&#x3002;</span>
<span class="token comment">// Derived class &#x5982;&#x4F55;&#x8054;&#x7EDC;&#x5176; base class &#x505A;&#x9006;&#x8FD0;&#x7B97;&#x52A8;&#x4F5C;&#xFF1F;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x7684;&#x505A;&#x6CD5;&#x662F;&#x4E3A; SquareMatrixBase::invert &#x6DFB;&#x52A0;&#x53E6;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x4E5F;&#x8BB8;&#x662F;&#x4E2A;&#x6307;&#x9488;&#xFF0C;</span>
<span class="token comment">// &#x6307;&#x5411;&#x4E00;&#x5757;&#x7528;&#x6765;&#x653E;&#x7F6E;&#x77E9;&#x9635;&#x6570;&#x636E;&#x7684;&#x5185;&#x5B58;&#x8D77;&#x59CB;&#x70B9;&#x3002;&#x90A3;&#x884C;&#x5F97;&#x901A;&#xFF0C;&#x4F46;&#x5341;&#x4E4B;&#x516B;&#x4E5D; invert &#x4E0D;&#x662F;&#x552F;&#x4E00;&#x4E00;&#x4E2A;</span>
<span class="token comment">// &#x53EF;&#x5199;&#x4E3A;&#x201C;&#x5F62;&#x5F0F;&#x4E0E;&#x5C3A;&#x5BF8;&#x65E0;&#x5173;&#x5E76;&#x53EF;&#x79FB;&#x81F3; SquareMatrixBase &#x5185;&#x201D;&#x7684; SquareMatrix &#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x6709;&#x82E5;&#x5E72;&#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x552F;&#x4E00;&#x8981;&#x505A;&#x7684;&#x5C31;&#x662F;&#x627E;&#x51FA;&#x4FDD;&#x5B58;&#x77E9;&#x9635;&#x5143;&#x7D20;&#x503C;&#x5F97;&#x90A3;&#x5757;&#x5185;&#x5B58;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5BF9;&#x6240;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x51FD;&#x6570;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x53C2;&#x6570;&#xFF0C;&#x5374;&#x5F97;&#x4E00;&#x6B21;&#x53C8;&#x4E00;&#x6B21;&#x5730;&#x544A;&#x8BC9; SquareMatrixBase</span>
<span class="token comment">// &#x76F8;&#x540C;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x8FD9;&#x6837;&#x4F3C;&#x4E4E;&#x4E0D;&#x597D;&#x3002;</span>

<span class="token comment">// &#x53E6;&#x4E00;&#x4E2A;&#x529E;&#x6CD5;&#x662F;&#x4EE4; SquareMatrixBase &#x8D2E;&#x5B58;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x77E9;&#x9635;&#x6570;&#x503C;&#x6240;&#x5728;&#x7684;&#x5185;&#x5B58;&#x3002;</span>
<span class="token comment">// &#x800C;&#x53EA;&#x8981;&#x5B83;&#x5B58;&#x50A8;&#x4E86;&#x90A3;&#x4E9B;&#x4E1C;&#x897F;&#xFF0C;&#x4E5F;&#x5C31;&#x53EF;&#x80FD;&#x5B58;&#x50A8;&#x77E9;&#x9635;&#x5C3A;&#x5BF8;&#x3002;&#x6210;&#x679C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrixBase</span> <span class="token punctuation">{</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token function">SquareMatrixBase</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t n<span class="token punctuation">,</span> T<span class="token operator">*</span> pMem<span class="token punctuation">)</span>        <span class="token comment">// &#x5B58;&#x50A8;&#x77E9;&#x9635;&#x5927;&#x5C0F;&#x548C;&#x4E00;&#x4E2A;</span>
        <span class="token operator">:</span> <span class="token function">size</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pData</span><span class="token punctuation">(</span>pMem<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>                 <span class="token comment">// &#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x77E9;&#x9635;&#x6570;&#x503C;&#x3002;</span>

    <span class="token keyword">void</span> <span class="token function">setDataPtr</span><span class="token punctuation">(</span>T<span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span> pData <span class="token operator">=</span> ptr<span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token comment">// &#x91CD;&#x65B0;&#x8D4B;&#x503C;&#x7ED9; pData&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>size_t size<span class="token punctuation">;</span>                               <span class="token comment">// &#x77E9;&#x9635;&#x7684;&#x5927;&#x5C0F;&#x3002;</span>
    T<span class="token operator">*</span> pData<span class="token punctuation">;</span>                                       <span class="token comment">// &#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x77E9;&#x9635;&#x5185;&#x5BB9;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x5141;&#x8BB8; derived classes &#x51B3;&#x5B9A;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65B9;&#x5F0F;&#x3002;&#x67D0;&#x4E9B;&#x5B9E;&#x73B0;&#x7248;&#x672C;&#x4E5F;&#x8BB8;&#x4F1A;&#x51B3;&#x5B9A;&#x5C06;&#x77E9;&#x9635;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728;</span>
<span class="token comment">// SquareMatrix &#x5BF9;&#x8C61;&#x5185;&#x90E8;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t n<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrix</span> <span class="token operator">:</span> <span class="token keyword">private</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">SquareMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                  <span class="token comment">// &#x9001;&#x51FA;&#x77E9;&#x9635;&#x5927;&#x5C0F;&#x548C;</span>
        <span class="token operator">:</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>         <span class="token comment">// &#x6570;&#x636E;&#x6307;&#x9488;&#x7ED9; base class&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    T data<span class="token punctuation">[</span>n <span class="token operator">*</span> n<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#x4E0D;&#x9700;&#x8981;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x4F46;&#x5BF9;&#x8C61;&#x81EA;&#x8EAB;&#x53EF;&#x80FD;&#x975E;&#x5E38;&#x5927;&#x3002;&#x53E6;&#x4E00;&#x79CD;&#x505A;&#x6CD5;&#x662F;</span>
<span class="token comment">// &#x628A;&#x6BCF;&#x4E00;&#x4E2A;&#x4E3E;&#x77E9;&#x9635;&#x7684;&#x6570;&#x636E;&#x653E;&#x8FDB; heap&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x901A;&#x8FC7; new &#x6765;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF09;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t n<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SquareMatrix</span> <span class="token operator">:</span> <span class="token keyword">private</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">SquareMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                          <span class="token comment">// &#x5C06; base class &#x7684;&#x6570;&#x636E;&#x6307;&#x9488;&#x8BBE;&#x4E3A; null&#xFF0C;</span>
        <span class="token operator">:</span> SquareMatrixBase<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment">// &#x4E3A;&#x77E9;&#x9635;&#x5185;&#x5BB9;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;</span>
          <span class="token function">pData</span><span class="token punctuation">(</span><span class="token keyword">new</span> T<span class="token punctuation">[</span>n <span class="token operator">*</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment">// &#x5C06;&#x6307;&#x5411;&#x8BE5;&#x5185;&#x5B58;&#x7684;&#x6307;&#x9488;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#xFF0C;</span>
    <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">setDataPtr</span><span class="token punctuation">(</span>pData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x7136;&#x540E;&#x5C06;&#x5B83;&#x7684;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x4EA4;&#x7ED9; base class</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    boost<span class="token operator">::</span>scoped_array<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> pData<span class="token punctuation">;</span>           <span class="token comment">// &#x5173;&#x4E8E; boost::scoped_array&#xFF0C;</span>
                                            <span class="token comment">// &#x89C1;&#x6761;&#x6B3E; 13&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4E0D;&#x8BBA;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x4E8E;&#x4F55;&#x5904;&#xFF0C;&#x4ECE;&#x81A8;&#x80C0;&#x7684;&#x89D2;&#x5EA6;&#x68C0;&#x8BA8;&#x4E4B;&#xFF0C;&#x5173;&#x952E;&#x662F;&#x73B0;&#x5728;&#x8BB8;&#x591A;&#x2014;&#x2014;&#x8BF4;&#x4E0D;&#x5B9A;&#x662F;&#x6240;&#x6709;&#x2014;&#x2014;</span>
<span class="token comment">// SquareMatrix &#x6210;&#x5458;&#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x5355;&#x7EAF;&#x5730;&#x4EE5; inline &#x65B9;&#x5F0F;&#x8C03;&#x7528; base class &#x7248;&#x672C;&#xFF0C;</span>
<span class="token comment">// &#x540E;&#x8005;&#x7531;&#x201C;&#x6301;&#x6709;&#x540C;&#x578B;&#x5143;&#x7D20;&#x201D;&#xFF08;&#x4E0D;&#x8BBA;&#x77E9;&#x9635;&#x5927;&#x5C0F;&#xFF09;&#x4E4B;&#x6240;&#x6709;&#x77E9;&#x9635;&#x5171;&#x4EAB;&#x3002;&#x5728;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x4E0D;&#x540C;&#x5927;&#x5C0F;</span>
<span class="token comment">// &#x7684; SquareMatrix &#x5BF9;&#x8C61;&#x6709;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x6240;&#x4EE5;&#x5373;&#x4F7F;&#xFF08;&#x4F8B;&#x5982; SquareMatrix&lt;double, 5&gt;</span>
<span class="token comment">// &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x6CA1;&#x673A;&#x4F1A;&#x4F20;&#x9012;&#x4E00;&#x4E2A; SquareMatrix&lt;double, 5&gt; &#x5BF9;&#x8C61;&#x5230;&#x4E00;&#x4E2A;&#x671F;&#x671B;&#x83B7;&#x5F97;</span>
<span class="token comment">// SquareMatrix&lt;double, 10&gt; &#x7684;&#x51FD;&#x6570;&#x53BB;&#x3002;&#x5F88;&#x68D2;&#xFF0C;&#x5BF9;&#x5417;&#xFF1F;&#xFF09;</span>

<span class="token comment">// &#x662F;&#x7684;&#xFF0C;&#x5F88;&#x68D2;&#xFF0C;&#x4F46;&#x5FC5;&#x987B;&#x4ED8;&#x51FA;&#x4EE3;&#x4EF7;&#x3002;&#x786C;&#x662F;&#x7ED1;&#x7740;&#x77E9;&#x9635;&#x5C3A;&#x5BF8;&#x7684;&#x90A3;&#x4E2A; invert &#x7248;&#x672C;&#xFF0C;&#x6709;&#x53EF;&#x80FD;&#x751F;&#x6210;</span>
<span class="token comment">// &#x6BD4;&#x5171;&#x4EAB;&#x7248;&#x672C;&#xFF08;&#x5176;&#x4E2D;&#x5C3A;&#x5BF8;&#x4E43;&#x4EE5;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x6216;&#x5B58;&#x50A8;&#x5728;&#x5BF9;&#x8C61;&#x5185;&#xFF09;&#x66F4;&#x4F73;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x4F8B;&#x5982;&#x5728;&#x5C3A;&#x5BF8;</span>
<span class="token comment">// &#x4E13;&#x5C5E;&#x7248;&#x4E2D;&#xFF0C;&#x5C3A;&#x5BF8;&#x662F;&#x4E2A;&#x7F16;&#x8BD1;&#x671F;&#x5E38;&#x91CF;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x85C9;&#x7531;&#x5E38;&#x91CF;&#x7684;&#x5E7F;&#x4F20;&#x8FBE;&#x5230;&#x6700;&#x4F18;&#x5316;&#xFF0C;&#x5305;&#x62EC;&#x628A;&#x5B83;&#x4EEC;</span>
<span class="token comment">// &#x6298;&#x8FDB;&#x88AB;&#x751F;&#x6210;&#x6307;&#x4EE4;&#x4E2D;&#x6210;&#x4E3A;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x6570;&#x3002;&#x8FD9;&#x5728;&#x201C;&#x4E0E;&#x5C3A;&#x5BF8;&#x65E0;&#x5173;&#x201D;&#x7684;&#x7248;&#x672C;&#x4E2D;&#x662F;&#x65E0;&#x6CD5;&#x529E;&#x5230;&#x7684;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-45%E8%BF%90%E7%94%A8%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E6%A8%A1%E6%9D%BF%E6%8E%A5%E6%94%B6%E6%89%80%E6%9C%89%E5%85%BC%E5%AE%B9%E7%B1%BB%E5%9E%8B">&#x6761;&#x6B3E; 45&#xFF1A;&#x8FD0;&#x7528;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6A21;&#x677F;&#x63A5;&#x6536;&#x6240;&#x6709;&#x517C;&#x5BB9;&#x7C7B;&#x578B;</h3>

<ul>
<li>&#x8BF7;&#x4F7F;&#x7528; member function templates&#xFF08;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF09;&#x751F;&#x6210;&#x201C;&#x53EF;&#x63A5;&#x6536;&#x6240;&#x6709;&#x517C;&#x5BB9;&#x7C7B;&#x578B;&#x201D;&#x7684;&#x51FD;&#x6570;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F60;&#x58F0;&#x660E; member templates &#x7528;&#x4E8E;&#x201C;&#x6CDB;&#x5316; copy &#x6784;&#x9020;&#x201D;&#x6216;&#x201C;&#x6CDB;&#x5316; assignment &#x64CD;&#x4F5C;&#x201D;&#xFF0C;&#x4F60;&#x8FD8;&#x662F;&#x9700;&#x8981;&#x58F0;&#x660E;&#x6B63;&#x5E38;&#x7684; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x548C; copy assignment &#x64CD;&#x4F5C;&#x7B26;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x6240;&#x8C13;&#x667A;&#x80FD;&#x6307;&#x9488;&#xFF08;Smart pointers&#xFF09;&#x662F;&#x201C;&#x884C;&#x4E3A;&#x50CF;&#x6307;&#x9488;&#x201D;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x6307;&#x9488;&#x6CA1;&#x6709;&#x7684;&#x673A;&#x80FD;&#x3002;</span>

<span class="token comment">// &#x771F;&#x5B9E;&#x6307;&#x9488;&#x505A;&#x5F97;&#x5F88;&#x597D;&#x7684;&#x4E00;&#x4EF6;&#x4E8B;&#x662F;&#xFF0C;&#x652F;&#x6301;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#xFF08;implicit conversions&#xFF09;&#x3002;</span>
<span class="token comment">// Derived class &#x6307;&#x9488;&#x53EF;&#x4EE5;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A; base class &#x6307;&#x9488;&#xFF0C;&#x201C;&#x6307;&#x5411; non-const &#x5BF9;&#x8C61;&#x201D;</span>
<span class="token comment">// &#x7684;&#x6307;&#x9488;&#x53EF;&#x4EE5;&#x8F6C;&#x6362;&#x4E3A;&#x201C;&#x6307;&#x5411; const &#x5BF9;&#x8C61;&#x201D;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;&#x7B49;&#x7B49;&#x3002;</span>
<span class="token comment">// &#x4E0B;&#x9762;&#x662F;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x4E8E;&#x4E09;&#x5C42;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x7684;&#x4E00;&#x4E9B;&#x8F6C;&#x6362;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Top</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Middle</span> <span class="token operator">:</span> <span class="token keyword">public</span> Top <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Bottom</span> <span class="token operator">:</span> <span class="token keyword">public</span> Middle <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

Top<span class="token operator">*</span> pt1 <span class="token operator">=</span> <span class="token keyword">new</span> Middle<span class="token punctuation">;</span>                  <span class="token comment">// &#x5C06; Middle* &#x8F6C;&#x6362;&#x4E3A; Top*</span>
Top<span class="token operator">*</span> pt2 <span class="token operator">=</span> <span class="token keyword">new</span> Bottom<span class="token punctuation">;</span>                  <span class="token comment">// &#x5C06; Bottom* &#x8F6C;&#x6362;&#x4E3A; Top*</span>
<span class="token keyword">const</span> Top<span class="token operator">*</span> pct2 <span class="token operator">=</span> pt1<span class="token punctuation">;</span>                  <span class="token comment">// &#x5C06; Top* &#x8F6C;&#x6362;&#x4E3A; const Top*</span>

<span class="token comment">// &#x4F46;&#x5982;&#x679C;&#x60F3;&#x5728;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x7684;&#x667A;&#x80FD;&#x6307;&#x9488;&#x4E2D;&#x6A21;&#x62DF;&#x4E0A;&#x8FF0;&#x8F6C;&#x6362;&#xFF0C;&#x7A0D;&#x7A0D;&#x6709;&#x70B9;&#x9EBB;&#x70E6;&#x3002;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span>typnename T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SmartPtr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>                                 <span class="token comment">// &#x667A;&#x80FD;&#x6307;&#x9488;&#x901A;&#x5E38;</span>
    <span class="token keyword">explicit</span> <span class="token function">SmartPtr</span><span class="token punctuation">(</span>T<span class="token operator">*</span> realPtr<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x4EE5;&#x5185;&#x7F6E;&#xFF08;&#x539F;&#x59CB;&#xFF09;&#x6307;&#x9488;&#x5B8C;&#x6210;&#x521D;&#x59CB;&#x5316;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

SmartPtr<span class="token operator">&lt;</span>Top<span class="token operator">&gt;</span> pt1 <span class="token operator">=</span>                     <span class="token comment">// &#x5C06; SmartPtr&lt;Middle&gt; &#x8F6C;&#x6362;&#x4E3A;</span>
    SmartPtr<span class="token operator">&lt;</span>Middle<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> Middle<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// SmartPtr&lt;Top&gt;</span>
SmartPtr<span class="token operator">&lt;</span>Top<span class="token operator">&gt;</span> pt2 <span class="token operator">=</span>                     <span class="token comment">// &#x5C06; SmartPrt&lt;Bottom&gt; &#x8F6C;&#x6362;&#x4E3A;</span>
    SmartPtr<span class="token operator">&lt;</span>Bottom<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">new</span> Bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// SmartPtr&lt;Top&gt;</span>
SmartPrt<span class="token operator">&lt;</span><span class="token keyword">const</span> Top<span class="token operator">&gt;</span> pct2 <span class="token operator">=</span> pt1<span class="token punctuation">;</span>         <span class="token comment">// &#x5C06; SmartPtr&lt;Top&gt; &#x8F6C;&#x6362;&#x4E3A;</span>
                                        <span class="token comment">// SmartPrt&lt;const Top&gt;</span>

<span class="token comment">// &#x4F46;&#x662F;&#xFF0C;&#x540C;&#x4E00;&#x4E2A; template &#x7684;&#x4E0D;&#x540C;&#x5177;&#x73B0;&#x4F53;&#xFF08;instantiations&#xFF09;&#x4E4B;&#x95F4;&#x4E0D;&#x5B58;&#x5728;&#x4EC0;&#x4E48;&#x4E0E;&#x751F;&#x4FF1;&#x6765;&#x7684;&#x56FA;&#x6709;&#x5173;&#x7CFB;</span>
<span class="token comment">// &#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x610F;&#x6307;&#x5982;&#x679C;&#x4EE5;&#x5E26;&#x6709; base-derived &#x5173;&#x7CFB;&#x7684; B&#xFF0C;D &#x4E24;&#x7C7B;&#x578B;&#x5206;&#x522B;&#x5177;&#x73B0;&#x5316;&#x67D0;&#x4E2A; template&#xFF0C;</span>
<span class="token comment">// &#x4EA7;&#x751F;&#x51FA;&#x6765;&#x7684;&#x4E24;&#x4E2A;&#x5177;&#x73B0;&#x4F53;&#x4E0D;&#x5E26;&#x6709; base-derived &#x5173;&#x7CFB;&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x89C6; SmartPtr&lt;Middle&gt;</span>
<span class="token comment">// &#x548C; SmartPtr&lt;Top&gt; &#x4E3A;&#x5B8C;&#x5168;&#x4E0D;&#x540C;&#x7684; classes&#xFF0C;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x5E76;&#x4E0D;&#x6BD4;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;&#x5514;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;&#xB7;</span>
<span class="token comment">// &#x5E76;&#x4E0D;&#x6BD4; vector&lt;float&gt; &#x548C; Widget &#x66F4;&#x5BC6;&#x5207;&#xFF0C;&#x5475;&#x5475;&#x3002;&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x83B7;&#x5F97;&#x7684; SmartPtr</span>
<span class="token comment">// classes &#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#x80FD;&#x529B;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5C06;&#x5B83;&#x4EEC;&#x660E;&#x786E;&#x5730;&#x7F16;&#x5199;&#x51FA;&#x6765;&#x3002;</span>





<span class="token comment">// Templates &#x548C;&#x6CDB;&#x578B;&#x7F16;&#x7A0B;&#xFF08;Generic Programming&#xFF09;</span>

<span class="token comment">// &#x5728;&#x4E0A;&#x8FF0;&#x667A;&#x80FD;&#x6307;&#x9488;&#x5B9E;&#x4F8B;&#x4E2D;&#xFF0C;&#x6BCF;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x65B0;&#x5F0F;&#x667A;&#x80FD;&#x6307;&#x9488;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;&#x73B0;&#x5728;&#x6211;&#x4EEC;</span>
<span class="token comment">// &#x5E94;&#x8BE5;&#x5173;&#x6CE8;&#x5982;&#x4F55;&#x7F16;&#x5199;&#x667A;&#x80FD;&#x6307;&#x9488;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;&#x4F7F;&#x5176;&#x884C;&#x4E3A;&#x80FD;&#x591F;&#x6EE1;&#x8DB3;&#x6211;&#x4EEC;&#x7684;&#x8F6C;&#x578B;&#x9700;&#x8981;&#x3002;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x5F88;&#x5177;&#x5173;&#x952E;&#x7684;&#x89C2;&#x5BDF;&#x7ED3;&#x679C;&#x662F;&#xFF1A;&#x6211;&#x4EEC;&#x6C38;&#x8FDC;&#x65E0;&#x6CD5;&#x5199;&#x51FA;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6240;&#x6709;&#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;&#x5728;&#x4E0A;&#x8FF0;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x4E2D;&#xFF0C;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x6839;&#x636E;&#x4E00;&#x4E2A; SmartPtr&lt;Middle&gt; &#x6216;&#x4E00;&#x4E2A; SmartPtr&lt;Bottom&gt; &#x6784;&#x9020;&#x51FA;&#x4E00;&#x4E2A; SmartPrt&lt;Top&gt;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x7EE7;&#x627F;&#x4F53;&#x7CFB;&#x672A;&#x6765;&#x6709;&#x6240;&#x6269;&#x5145;&#xFF0C;SmartPtr&lt;Top&gt;&#x5BF9;&#x8C61;&#x53C8;&#x5FC5;&#x987B;&#x80FD;&#x591F;&#x6839;&#x636E;&#x5176;&#x4ED6;&#x667A;&#x80FD;&#x6307;&#x9488;</span>
<span class="token comment">// &#x6784;&#x9020;&#x81EA;&#x5DF1;&#x3002;&#x5047;&#x8BBE;&#x65E5;&#x540E;&#x6DFB;&#x52A0;&#x4E86;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">BelowBottom</span> <span class="token operator">:</span> <span class="token keyword">public</span> Bottom <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x56E0;&#x6B64;&#x5FC5;&#x987B;&#x4EE4; SmartPtr&lt;BelowBottom&gt; &#x5BF9;&#x8C61;&#x5F97;&#x4EE5;&#x751F;&#x6210;SmartPtr&lt;Top&gt; &#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6211;&#x4EEC;&#x5F53;&#x7136;&#x4E0D;&#x5E0C;&#x671B;&#x4E00;&#x518D;&#x4FEE;&#x6539; SmartPtr template &#x4EE5;&#x6EE1;&#x8DB3;&#x6B64;&#x7C7B;&#x9700;&#x6C42;&#x3002;</span>

<span class="token comment">// &#x5C31;&#x539F;&#x7406;&#x800C;&#x8A00;&#xFF0C;&#x6B64;&#x4F8B;&#x4E2D;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6570;&#x91CF;&#x6CA1;&#x6709;&#x6B62;&#x5C3D;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E2A; template &#x53EF;&#x88AB;&#x65E0;&#x9650;&#x91CF;&#x5177;&#x73B0;&#x5316;&#xFF0C;</span>
<span class="token comment">// &#x4EE5;&#x81F4;&#x751F;&#x6210;&#x65E0;&#x9650;&#x91CF;&#x51FD;&#x6570;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4F3C;&#x4E4E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x4E0D;&#x662F;&#x4E3A; SmartPtr &#x5199;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x662F;&#x4E3A;&#x5B83;&#x5199;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x6A21;&#x677F;&#x3002;&#x8FD9;&#x6837;&#x7684;&#x6A21;&#x677F;&#xFF08;templates&#xFF09;&#x662F;&#x6240;&#x8C13; member function</span>
<span class="token comment">// templates&#xFF08;&#x5E38;&#x7B80;&#x79F0;&#x4E3A; member templates&#xFF09;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x662F;&#x4E3A; class &#x751F;&#x6210;&#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SmartPtr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> U<span class="token operator">&gt;</span>                    <span class="token comment">// member templates</span>
    <span class="token function">SmartPtr</span><span class="token punctuation">(</span><span class="token keyword">const</span> SmartPtr<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span><span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x4E3A;&#x4E86;&#x751F;&#x6210; copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4EE5;&#x4E0A;&#x4EE3;&#x7801;&#x7684;&#x610F;&#x601D;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;&#x4EFB;&#x4F55;&#x7C7B;&#x578B; T &#x548C;&#x4EFB;&#x4F55;&#x7C7B;&#x578B; U&#xFF0C;&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x6839;&#x636E; SmartPtr&lt;U&gt; &#x751F;&#x6210;</span>
<span class="token comment">// &#x4E00;&#x4E2A; SmartPtr&lt;T&gt;&#x2014;&#x2014;&#x56E0;&#x4E3A; SmartPtr&lt;T&gt; &#x6709;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x63A5;&#x53D7;&#x4E00;&#x4E2A; SmartPtr&lt;U&gt; &#x53C2;&#x6570;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E00;&#x7C7B;&#x6784;&#x9020;&#x51FD;&#x6570;&#x6839;&#x636E;&#x5BF9;&#x8C61; u &#x521B;&#x5EFA;&#x5BF9;&#x8C61; t&#xFF08;&#x4F8B;&#x5982;&#x6839;&#x636E; SmartPtr&lt;U&gt; &#x521B;&#x5EFA;&#x4E00;&#x4E2A; SmartPtr&lt;T&gt;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C; u &#x548C; v &#x7684;&#x7C7B;&#x578B;&#x662F;&#x540C;&#x4E00;&#x4E2A; template &#x7684;&#x4E0D;&#x540C;&#x5177;&#x73B0;&#x4F53;&#xFF0C;&#x6709;&#x65F6;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A;</span>
<span class="token comment">// &#x6CDB;&#x5316;&#xFF08;generalized&#xFF09;copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x4E0A;&#x9762;&#x7684;&#x6CDB;&#x5316; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x5E76;&#x672A;&#x88AB;&#x58F0;&#x660E;&#x4E3A; explicit&#xFF0C;&#x90A3;&#x662F;&#x84C4;&#x610F;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x539F;&#x59CB;&#x6307;&#x9488;</span>
<span class="token comment">// &#x7C7B;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x8F6C;&#x6362;&#xFF08;&#x4F8B;&#x5982;&#x4ECE; derived class &#x6307;&#x9488;&#x8F6C;&#x4E3A; base class &#x6307;&#x9488;&#xFF09;&#x662F;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#xFF0C;</span>
<span class="token comment">// &#x65E0;&#x9700;&#x660E;&#x767D;&#x5199;&#x51FA;&#x8F6C;&#x578B;&#x52A8;&#x4F5C;&#xFF08;cast&#xFF09;&#xFF0C;&#x6240;&#x4EE5;&#x8BA9;&#x667A;&#x80FD;&#x6307;&#x9488;&#x4EFF;&#x6548;&#x8FD9;&#x79CD;&#x884C;&#x5F84;&#x4E5F;&#x5C5E;&#x5408;&#x7406;&#x3002;&#x5728;&#x6A21;&#x677F;&#x5316;</span>
<span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;templatized constructor&#xFF09;&#x4E2D;&#x7565;&#x53BB; explicit &#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x8FD9;&#x4E2A;&#x76EE;&#x7684;&#x3002;</span>





<span class="token comment">// &#x5B8C;&#x6210;&#x58F0;&#x660E;&#x4E4B;&#x540E;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E3A; SmartPtr &#x800C;&#x5199;&#x7684;&#x201C;&#x6CDB;&#x5316; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#x201D;&#x63D0;&#x4F9B;&#x7684;&#x4E1C;&#x897F;&#x6BD4;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x7684;&#x66F4;&#x591A;&#x3002;</span>
<span class="token comment">// &#x662F;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x6839;&#x636E;&#x4E00;&#x4E2A; SmartPtr&lt;Bottom&gt; &#x521B;&#x5EFA;&#x4E00;&#x4E2A; SmartPtr&lt;Top&gt;&#xFF0C;</span>
<span class="token comment">// &#x5374;&#x4E0D;&#x5E0C;&#x671B;&#x6839;&#x636E;&#x4E00;&#x4E2A; SmartPtr&lt;Top&gt; &#x521B;&#x5EFA;&#x4E00;&#x4E2A; SmartPtr&lt;Bottom&gt;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x90A3;&#x5BF9; public &#x7EE7;&#x627F;&#x800C;&#x8A00;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 32&#xFF09;&#x662F;&#x77DB;&#x76FE;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x4E0D;&#x5E0C;&#x671B;&#x6839;&#x636E;&#x4E00;&#x4E2A;</span>
<span class="token comment">// SmartPtr&lt;double&gt; &#x521B;&#x5EFA;&#x4E00;&#x4E2A; SmartPtr&lt;int&gt;&#xFF0C;&#x56E0;&#x4E3A;&#x73B0;&#x5B9E;&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x201C;&#x5C06; int* &#x8F6C;&#x6362;&#x4E3A; double*&#x201D;</span>
<span class="token comment">// &#x7684;&#x5BF9;&#x5E94;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x884C;&#x4E3A;&#x3002;&#x662F;&#x7684;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x4ECE;&#x67D0;&#x65B9;&#x9762;&#x5BF9;&#x8FD9;&#x4E00; member template</span>
<span class="token comment">// &#x6240;&#x521B;&#x5EFA;&#x7684;&#x6210;&#x5458;&#x51FD;&#x6570;&#x7FA4;&#x8FDB;&#x884C;&#x62E3;&#x9009;&#x6216;&#x7B5B;&#x9664;&#x3002;</span>

<span class="token comment">// &#x5047;&#x8BBE; SmartPtr &#x9075;&#x5FAA; auto_ptr &#x548C; tr1::shared_ptr &#x6240;&#x4EE5;&#x63D0;&#x4F9B;&#x7684;&#x699C;&#x6837;&#xFF0C;</span>
<span class="token comment">// &#x4E5F;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; get &#x6210;&#x5458;&#x51FD;&#x6570;&#xFF0C;&#x8FD4;&#x56DE;&#x667A;&#x80FD;&#x6307;&#x9488;&#x5BF9;&#x8C61;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 15&#xFF09;&#x6240;&#x6301;&#x6709;&#x7684;&#x90A3;&#x4E2A;&#x539F;&#x59CB;&#x6307;&#x9488;&#x7684;&#x526F;&#x672C;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x201C;&#x6784;&#x9020;&#x6A21;&#x677F;&#x201D;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#x4E2D;&#x7EA6;&#x675F;&#x8F6C;&#x6362;&#x884C;&#x4E3A;&#xFF0C;&#x4F7F;&#x5B83;&#x7B26;&#x5408;&#x6211;&#x4EEC;&#x7684;&#x671F;&#x671B;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">SmartPtr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> U<span class="token operator">&gt;</span>
    <span class="token function">SmartPtr</span><span class="token punctuation">(</span><span class="token keyword">const</span> SmartPtr<span class="token operator">&lt;</span>U<span class="token operator">&gt;</span><span class="token operator">&amp;</span> other<span class="token punctuation">)</span>      <span class="token comment">// &#x4EE5; other &#x7684; heldPtr</span>
        <span class="token operator">:</span> <span class="token function">heldPtr</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>      <span class="token comment">// &#x521D;&#x59CB;&#x5316; this &#x7684; heldPtr</span>
    T<span class="token operator">*</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> heldPtr<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    T<span class="token operator">*</span> heldPtr<span class="token punctuation">;</span>                             <span class="token comment">// &#x8FD9;&#x4E2A; SmartPtr &#x6301;&#x6709;&#x7684;&#x5185;&#x7F6E;&#xFF08;&#x539F;&#x59CB;&#xFF09;&#x6307;&#x9488;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6211;&#x4F7F;&#x7528;&#x6210;&#x5458;&#x521D;&#x503C;&#x5217;&#xFF08;member initialization list&#xFF09;&#x6765;&#x521D;&#x59CB;&#x5316; SmartPtr&lt;T&gt; &#x4E4B;&#x5185;&#x7C7B;&#x578B;&#x4E3A;</span>
<span class="token comment">// T* &#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x5E76;&#x4EE5;&#x7C7B;&#x578B;&#x4E3A; U* &#x7684;&#x6307;&#x9488;&#xFF08;&#x7531; SmartPtr&lt;U&gt; &#x6301;&#x6709;&#xFF09;&#x4F5C;&#x4E3A;&#x521D;&#x503C;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x53EA;&#x6709;&#x5F53;&#x201C;&#x5B58;&#x5728;&#x67D0;&#x4E2A;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x53EF;&#x5C06;&#x4E00;&#x4E2A; U* &#x6307;&#x9488;&#x8F6C;&#x4E3A;&#x4E00;&#x4E2A; T* &#x6307;&#x9488;&#x201D;&#x65F6;&#x624D;&#x80FD;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x90A3;&#x6B63;&#x662F;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x3002;&#x6700;&#x7EC8;&#x6548;&#x76CA;&#x662F; SmartPtr&lt;T&gt; &#x73B0;&#x5728;&#x6709;&#x4E86;&#x4E00;&#x4E2A;&#x6CDB;&#x5316; copy &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4E2A;&#x6784;&#x9020;&#x51FD;&#x6570;&#x53EA;&#x5728;&#x5176;&#x6240;&#x83B7;&#x5F97;&#x7684;&#x5B9E;&#x53C2;&#x96B6;&#x5C5E;&#x9002;&#x5F53;&#xFF08;&#x517C;&#x5BB9;&#xFF09;&#x7C7B;&#x578B;&#x65F6;&#x624D;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// member function templates&#xFF08;&#x6210;&#x5458;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF09;&#x7684;&#x6548;&#x7528;&#x4E0D;&#x9650;&#x4E8E;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x5B83;&#x4EEC;&#x5E38;&#x626E;&#x6F14;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x89D2;&#x8272;&#x662F;&#x652F;&#x6301;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#x3002;&#x4F8B;&#x5982; TR1 &#x7684; shared_ptr</span>
<span class="token comment">// &#xFF08;&#x89C1;&#x6761;&#x6B3E; 13&#xFF09;&#x652F;&#x6301;&#x6240;&#x6709;&#x201C;&#x6765;&#x81EA;&#x517C;&#x5BB9;&#x4E4B;&#x5185;&#x7F6E;&#x6307;&#x9488;&#x3001;tr1::shared_ptrs&#x3001;auto_ptrs &#x548C;</span>
<span class="token comment">// tr1::weak_ptrs&#xFF08;&#x89C1;&#x6761;&#x6B3E; 54&#xFF09;&#x201D;&#x7684;&#x6784;&#x9020;&#x884C;&#x4E3A;&#xFF0C;</span>
<span class="token comment">// &#x4EE5;&#x53CA;&#x6240;&#x6709;&#x6765;&#x81EA;&#x4E0A;&#x8FF0;&#x5404;&#x7269;&#xFF08;tr1::weak_ptrs &#x9664;&#x5916;&#xFF09;&#x7684;&#x8D4B;&#x503C;&#x64CD;&#x4F5C;&#x3002;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">shared_ptr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>                                   <span class="token comment">// &#x6784;&#x9020;&#xFF0C;&#x6765;&#x81EA;&#x4EFB;&#x4F55;&#x517C;&#x5BB9;&#x7684;</span>
        <span class="token keyword">explicit</span> <span class="token function">shared_ptr</span><span class="token punctuation">(</span>Y<span class="token operator">*</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x5185;&#x7F6E;&#x6307;&#x9488;&#x3001;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>
        <span class="token function">shared_ptr</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x6216; shared_ptr&#x3001;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>
        <span class="token keyword">explicit</span> <span class="token function">shared_ptr</span><span class="token punctuation">(</span>weak_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x6216;weak_ptr&#x3001;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>
        <span class="token keyword">explicit</span> <span class="token function">shared_ptr</span><span class="token punctuation">(</span>auto_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x6216; auto_ptr&#x3002;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>                                   <span class="token comment">// &#x8D4B;&#x503C;&#xFF0C;&#x6765;&#x81EA;&#x4EFB;&#x4F55;&#x517C;&#x5BB9;&#x7684;</span>
        shared_ptr<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// shared_ptr&#x3001;</span>
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>                                   <span class="token comment">// &#x6216; auto_ptr&#x3002;</span>
        shared_ptr<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span>auto_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x4E0B;&#x9762;&#x662F; tr1::shared_ptr &#x7684;&#x4E00;&#x4EFD;&#x5B9A;&#x4E49;&#x6458;&#x8981;&#xFF0C;&#x4F8B;&#x8BC1;&#x4E0A;&#x8FF0;&#x6240;&#x8A00;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">shared_ptr</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">shared_ptr</span><span class="token punctuation">(</span>shared_ptr <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
    
    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>                               <span class="token comment">// &#x6CDB;&#x5316; copy &#x6784;&#x9020;&#x51FD;&#x6570;</span>
    <span class="token function">shared_ptr</span><span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>

    shared_ptr<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span>shared_ptr <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// copy assignment.</span>

    <span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">Y</span><span class="token operator">&gt;</span>                               <span class="token comment">// &#x6CDB;&#x5316; copy assignment.</span>
    shared_ptr<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span>shared_ptr<span class="token operator">&lt;</span>Y<span class="token operator">&gt;</span> <span class="token keyword">const</span><span class="token operator">&amp;</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-46%E9%9C%80%E8%A6%81%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E6%97%B6%E8%AF%B7%E4%B8%BA%E6%A8%A1%E6%9D%BF%E5%AE%9A%E4%B9%89%E9%9D%9E%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0">&#x6761;&#x6B3E; 46&#xFF1A;&#x9700;&#x8981;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x65F6;&#x8BF7;&#x4E3A;&#x6A21;&#x677F;&#x5B9A;&#x4E49;&#x975E;&#x6210;&#x5458;&#x51FD;&#x6570;</h3>

<ul>
<li>&#x5F53;&#x6211;&#x4EEC;&#x7F16;&#x5199;&#x4E00;&#x4E2A; class template&#xFF0C;&#x800C;&#x5B83;&#x6240;&#x63D0;&#x4F9B;&#x4E4B;&#x201C;&#x4E0E;&#x6B64; template &#x76F8;&#x5173;&#x7684;&#x201D;&#x51FD;&#x6570;&#x652F;&#x6301;&#x201C;&#x6240;&#x6709;&#x53C2;&#x6570;&#x4E4B;&#x9690;&#x5F0F;&#x7C7B;&#x578B;&#x8F6C;&#x6362;&#x201D;&#x65F6;&#xFF0C;&#x8BF7;&#x5C06;&#x90A3;&#x4E9B;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#x4E3A;&#x201C;class template &#x5185;&#x90E8;&#x7684; friend &#x51FD;&#x6570;&#x201D;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Rational</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> numerator <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token comment">// &#x6761;&#x6B3E; 20 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x53C2;&#x6570;&#x4EE5;</span>
             <span class="token keyword">const</span> T<span class="token operator">&amp;</span> denominator <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// passed by reference &#x65B9;&#x5F0F;&#x4F20;&#x9012;&#xFF0C;</span>
    <span class="token keyword">const</span> T <span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>              <span class="token comment">// &#x6761;&#x6B3E; 28 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x8FD4;&#x56DE;&#x503C;</span>
    <span class="token keyword">const</span> T <span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>            <span class="token comment">// &#x4EE5; passed by value &#x65B9;&#x5F0F;&#x4F20;&#x9012;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                     <span class="token comment">// &#x6761;&#x6B3E; 3 &#x544A;&#x8BC9;&#x4F60;&#x4E3A;&#x4EC0;&#x4E48;&#x5B83;&#x4EEC;&#x662F; const&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token comment">// &#x5C31;&#x50CF;&#x6761;&#x6B3E; 24 &#x4E00;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x652F;&#x6301;&#x6DF7;&#x5408;&#x5F0F;&#xFF08;mixed-mode&#xFF09;&#x7B97;&#x672F;&#x8FD0;&#x7B97;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#x987A;&#x5229;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;&#x6211;&#x4EEC;&#x4E5F;&#x9884;&#x671F;&#x5B83;&#x4F1A;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x6B63;&#x5F0F;&#x6761;&#x6B3E; 24 &#x6240;&#x5217;&#x7684;&#x540C;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#xFF0C;</span>
<span class="token comment">// &#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F; Rational &#x548C; operator* &#x5982;&#x4ECA;&#x90FD;&#x6210;&#x4E86; templates&#xFF1A;</span>
Rational<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">oneHalf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// &#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x81EA;&#x6761;&#x6B3E; 24&#xFF0C;</span>
                                        <span class="token comment">// &#x552F;&#x4E00;&#x4E0D;&#x540C;&#x7684;&#x662F; Rational &#x6539;&#x4E3A; template&#x3002;</span>
Rational<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> result <span class="token operator">=</span> oneHalf <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>     <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// &#x4E0A;&#x8FF0;&#x5931;&#x8D25;&#x7ED9;&#x6211;&#x4EEC;&#x7684;&#x542F;&#x793A;&#x662F;&#xFF0C;&#x6A21;&#x677F;&#x5316;&#x7684; Rational &#x5185;&#x7684;&#x67D0;&#x4E9B;&#x4E1C;&#x897F;&#x4F3C;&#x4E4E;&#x548C;&#x5176; non-template &#x7248;&#x672C;&#x4E0D;&#x540C;&#x3002;</span>
<span class="token comment">// &#x4E8B;&#x5B9E;&#x7684;&#x786E;&#x5982;&#x6B64;&#x3002;&#x5728;&#x6761;&#x6B3E; 24 &#x5185;&#xFF0C;&#x7F16;&#x8BD1;&#x5668;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x5C1D;&#x8BD5;&#x8C03;&#x7528;&#x4EC0;&#x4E48;&#x51FD;&#x6570;&#xFF08;&#x5C31;&#x662F;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;</span>
<span class="token comment">// Rationals &#x53C2;&#x6570;&#x7684;&#x90A3;&#x4E2A; operator* &#x5566;&#xFF09;&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x7F16;&#x8BD1;&#x5668;&#x4E0D;&#x77E5;&#x9053;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x8C03;&#x7528;&#x54EA;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x7684;&#x662F;&#xFF0C;&#x5B83;&#x4EEC;&#x8BD5;&#x56FE;&#x60F3;&#x51FA;&#x4EC0;&#x4E48;&#x51FD;&#x6570;&#x88AB;&#x540D;&#x4E3A; operator* &#x7684; template &#x5177;&#x73B0;&#x5316;</span>
<span class="token comment">// &#xFF08;&#x4EA7;&#x751F;&#xFF09;&#x51FA;&#x6765;&#x3002;&#x5B83;&#x4EEC;&#x77E5;&#x9053;&#x5B83;&#x4EEC;&#x5E94;&#x8BE5;&#x53EF;&#x4EE5;&#x5177;&#x73B0;&#x5316;&#x67D0;&#x4E2A;&#x201C;&#x540D;&#x4E3A; operator* &#x5E76;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;</span>
<span class="token comment">// Rational&lt;T&gt; &#x53C2;&#x6570;&#x201D;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4F46;&#x4E3A;&#x5B8C;&#x6210;&#x8FD9;&#x4E00;&#x5177;&#x73B0;&#x5316;&#x884C;&#x52A8;&#xFF0C;&#x5FC5;&#x987B;&#x5148;&#x7B97;&#x51FA; T &#x662F;&#x4EC0;&#x4E48;&#x3002;</span>
<span class="token comment">// &#x95EE;&#x9898;&#x662F;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x80FD;&#x8010;&#x3002;</span>

<span class="token comment">// &#x53EA;&#x8981;&#x5229;&#x7528;&#x4E00;&#x4E2A;&#x4E8B;&#x5B9E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x7F13;&#x548C;&#x7F16;&#x8BD1;&#x5668;&#x5728; template &#x5B9E;&#x53C2;&#x63A8;&#x5BFC;&#x65B9;&#x9762;&#x53D7;&#x5230;&#x7684;&#x6311;&#x6218;&#xFF1A;</span>
<span class="token comment">// template class &#x5185;&#x7684; friend &#x58F0;&#x660E;&#x5F0F;&#x53EF;&#x4EE5;&#x6307;&#x6D89;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x51FD;&#x6570;&#x3002;&#x90A3;&#x610F;&#x5473; class Rational&lt;T&gt;</span>
<span class="token comment">// &#x53EF;&#x4EE5;&#x58F0;&#x660E; operator* &#x662F;&#x5B83;&#x7684;&#x4E00;&#x4E2A; friend &#x51FD;&#x6570;&#x3002;Class templates &#x5E76;&#x4E0D;&#x501A;&#x8D56;</span>
<span class="token comment">// template &#x5B9E;&#x53C2;&#x63A8;&#x5BFC;&#xFF08;&#x540E;&#x8005;&#x53EA;&#x65BD;&#x884C;&#x4E8E; function templates &#x8EAB;&#x4E0A;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x7F16;&#x8BD1;&#x5668;&#x603B;&#x662F;&#x80FD;&#x591F;&#x5728; class Rational&lt;T&gt; &#x5177;&#x73B0;&#x5316;&#x65F6;&#x5F97;&#x77E5; T&#x3002;&#x56E0;&#x6B64;&#xFF0C;</span>
<span class="token comment">// &#x4EE4; Rational&lt;T&gt; class &#x58F0;&#x660E;&#x9002;&#x5F53;&#x7684; operator* &#x4E3A;&#x5176; friend &#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x7B80;&#x5316;&#x6574;&#x4E2A;&#x95EE;&#x9898;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">friend</span> <span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>   <span class="token comment">// &#x58F0;&#x660E; operator* &#x51FD;&#x6570;&#xFF0C;</span>
                                     <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#x7EC6;&#x8282;&#x8BE6;&#x4E0B;&#x3002;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>                                <span class="token comment">// &#x5B9A;&#x4E49;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>   <span class="token comment">// operator* &#x51FD;&#x6570;&#x3002;</span>
                             <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token comment">// &#x73B0;&#x5728;&#x5BF9; operator* &#x7684;&#x6DF7;&#x5408;&#x5F0F;&#x8C03;&#x7528;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x5F53;&#x5BF9;&#x8C61; oneHalf &#x88AB;&#x58F0;&#x660E;&#x4E3A;</span>
<span class="token comment">// &#x4E00;&#x4E2A; Rational&lt;int&gt;&#xFF0C;class Rational&lt;int&gt; &#x4E8E;&#x662F;&#x88AB;&#x5177;&#x73B0;&#x5316;&#x51FA;&#x6765;&#xFF0C;&#x800C;&#x4F5C;&#x4E3A;&#x8FC7;&#x7A0B;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;</span>
<span class="token comment">// friend &#x51FD;&#x6570; operator*&#xFF08;&#x63A5;&#x53D7; Rational&lt;int&gt; &#x53C2;&#x6570;&#xFF09;&#x4E5F;&#x5C31;&#x88AB;&#x81EA;&#x52A8;&#x58F0;&#x660E;&#x51FA;&#x6765;&#x3002;</span>
<span class="token comment">// &#x540E;&#x8005;&#x8EAB;&#x4E3A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x800C;&#x975E;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF08;function template&#xFF09;&#xFF0C;&#x56E0;&#x6B64;&#x7F16;&#x8BD1;&#x5668;&#x53EF;&#x5728;&#x8C03;&#x7528;</span>
<span class="token comment">// &#x5B83;&#x65F6;&#x4F7F;&#x7528;&#x9690;&#x5F0F;&#x8F6C;&#x6362;&#x51FD;&#x6570;&#xFF08;&#x4F8B;&#x5982; Rational &#x7684; non-explicit &#x6784;&#x9020;&#x51FD;&#x6570;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x800C;&#x8FD9;&#x4FBF;&#x662F;&#x6DF7;&#x5408;&#x5F0F;&#x8C03;&#x7528;&#x4E4B;&#x6240;&#x4EE5;&#x6210;&#x529F;&#x7684;&#x539F;&#x56E0;&#x3002;</span>





<span class="token comment">// &#x4F46;&#x662F;&#xFF0C;&#x6B64;&#x60C5;&#x5883;&#x4E0B;&#x7684;&#x201C;&#x6210;&#x529F;&#x201D;&#x662F;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x5B57;&#x773C;&#xFF0C;&#x56E0;&#x4E3A;&#x867D;&#x7136;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#xFF0C;&#x5374;&#x65E0;&#x6CD5;&#x8FDE;&#x63A5;&#x3002;</span>
<span class="token comment">// &#x7A0D;&#x540E;&#x6211;&#x9A6C;&#x4E0A;&#x56DE;&#x6765;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x9996;&#x5148;&#x6211;&#x8981;&#x8C08;&#x8C08;&#x5728; Rational &#x5185;&#x58F0;&#x660E; operator* &#x7684;&#x8BED;&#x6CD5;&#x3002;</span>

<span class="token comment">// &#x5728;&#x4E00;&#x4E2A; class template &#x5185;&#xFF0C;template &#x540D;&#x79F0;&#x53EF;&#x88AB;&#x7528;&#x6765;&#x4F5C;&#x4E3A;&#x201C;template &#x548C;&#x5176;&#x53C2;&#x6570;&#x201D;&#x7684;</span>
<span class="token comment">// &#x7B80;&#x7565;&#x8868;&#x8FBE;&#x65B9;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x5728; Rational&lt;T&gt; &#x5185;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53EA;&#x5199; Rational &#x800C;&#x4E0D;&#x5FC5;&#x5199; Rational&lt;T&gt;&#x3002;</span>
<span class="token comment">// &#x672C;&#x4F8B;&#x4E2D;&#x7684; operator* &#x88AB;&#x58F0;&#x660E;&#x4E3A;&#x63A5;&#x6536;&#x5E76;&#x8FD4;&#x56DE; Rationals&#xFF08;&#x800C;&#x975E; Rational&lt;T&gt;s&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x5B83;&#x88AB;&#x58F0;&#x660E;&#x5982;&#x4E0B;&#xFF0C;&#x4E00;&#x6837;&#x6709;&#x6548;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">friend</span> <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                                        <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x6211;&#x4EEC;&#x610F;&#x56FE;&#x4EE4;&#x6B64; class &#x5916;&#x90E8;&#x7684; operator* template &#x63D0;&#x4F9B;&#x5B9A;&#x4E49;&#xFF0C;&#x4F46;&#x662F;&#x884C;&#x4E0D;&#x901A;&#x2014;&#x2014;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;</span>
<span class="token comment">// &#x58F0;&#x660E;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF08;&#x90A3;&#x6B63;&#x662F; Rational template &#x5185;&#x7684;&#x4F5C;&#x4E3A;&#xFF09;&#xFF0C;&#x5C31;&#x6709;&#x8D23;&#x4EFB;&#x5B9A;&#x4E49;&#x90A3;&#x4E2A;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#x65E2;&#x7136;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x5B9A;&#x4E49;&#x5F0F;&#xFF0C;&#x8FDE;&#x63A5;&#x5668;&#x5F53;&#x7136;&#x627E;&#x4E0D;&#x5230;&#x5B83;&#xFF01;</span>

<span class="token comment">// &#x6216;&#x8BB8;&#x6700;&#x7B80;&#x5355;&#x7684;&#x53EF;&#x884C;&#x529E;&#x6CD5;&#x5C31;&#x662F;&#x5C06; operator* &#x51FD;&#x6570;&#x672C;&#x4F53;&#x5408;&#x5E76;&#x81F3;&#x5176;&#x58F0;&#x660E;&#x5F0F;&#x5185;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">friend</span> <span class="token keyword">const</span> Rational <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                                     <span class="token keyword">const</span> Rational<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">Rational</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// &#x5B9E;&#x73B0;&#x7801;&#x4E0E;</span>
                        lhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// &#x6761;&#x6B3E; 24 &#x540C;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x201C;Rational &#x662F;&#x4E2A; template&#x201D;&#x8FD9;&#x4E00;&#x4E8B;&#x5B9E;&#x610F;&#x5473;&#x4E0A;&#x8FF0;&#x7684;&#x8F85;&#x52A9;&#x51FD;&#x6570;&#x901A;&#x5E38;&#x4E5F;&#x662F;&#x4E2A; template&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5B9A;&#x4E49;&#x4E86; Rational &#x7684;&#x5934;&#x6587;&#x4EF6;&#x4EE3;&#x7801;&#xFF0C;&#x5F88;&#x5178;&#x578B;&#x5730;&#x957F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span> <span class="token keyword">class</span> <span class="token class-name">Rational</span><span class="token punctuation">;</span>        <span class="token comment">// &#x58F0;&#x660E; Rational template</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">doMultiply</span><span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                             <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">Rational</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">friend</span> <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token keyword">operator</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>
                                        <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">doMultiply</span><span class="token punctuation">(</span>lhs<span class="token punctuation">,</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>        <span class="token comment">// &#x4EE4; friend &#x8C03;&#x7528; helper</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8BB8;&#x591A;&#x7F16;&#x8BD1;&#x5668;&#x5B9E;&#x8D28;&#x4E0A;&#x4F1A;&#x5F3A;&#x8FEB;&#x4F60;&#x628A;&#x6240;&#x6709; template &#x5B9A;&#x4E49;&#x5F0F;&#x653E;&#x8FDB;&#x5934;&#x6587;&#x4EF6;&#x5185;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x6216;&#x8BB8;&#x9700;&#x8981;&#x5728;&#x5934;&#x6587;&#x4EF6;&#x5185;&#x5B9A;&#x4E49; doMultiply&#xFF08;&#x4E00;&#x5982;&#x6761;&#x6B3E; 30 &#x6240;&#x8A00;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x6837;&#x7684; templates &#x4E0D;&#x9700;&#x975E;&#x5F97;&#x662F; inline &#x4E0D;&#x53EF;&#xFF09;&#xFF0C;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>                                        <span class="token comment">// &#x82E5;&#x6709;&#x5FC5;&#x8981;&#xFF0C;</span>
<span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">doMultiply</span><span class="token punctuation">(</span><span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span>        <span class="token comment">//  &#x5728;&#x5934;&#x6587;&#x4EF6;&#x5185;&#x5B9A;&#x4E49;</span>
                             <span class="token keyword">const</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>        <span class="token comment">// helper template</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> Rational<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>lhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">numerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                       lhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> rhs<span class="token punctuation">.</span><span class="token function">denominator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-47%E8%AF%B7%E4%BD%BF%E7%94%A8-traits-classes-%E8%A1%A8%E7%8E%B0%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF">&#x6761;&#x6B3E; 47&#xFF1A;&#x8BF7;&#x4F7F;&#x7528; traits classes &#x8868;&#x73B0;&#x7C7B;&#x578B;&#x4FE1;&#x606F;</h3>

<ul>
<li>Traits classes &#x4F7F;&#x5F97;&#x201C;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x201D;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x53EF;&#x7528;&#x3002;&#x4ED6;&#x4EEC;&#x4EE5; templates &#x548C;&#x201C;templates &#x7279;&#x5316;&#x201D;&#x5B8C;&#x6210;&#x5B9E;&#x73B0;&#x3002;</li>
<li>&#x6574;&#x5408;&#x91CD;&#x8F7D;&#x6280;&#x672F;&#xFF08;overloading&#xFF09;&#x540E;&#xFF0C;traits classes &#x6709;&#x53EF;&#x80FD;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x5BF9;&#x7C7B;&#x578B;&#x6267;&#x884C; if...else &#x6D4B;&#x8BD5;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// STL &#x4E3B;&#x8981;&#x7531;&#x201C;&#x7528;&#x4EE5;&#x8868;&#x73B0;&#x5BB9;&#x5668;&#x3001;&#x8FED;&#x4EE3;&#x5668;&#x548C;&#x7B97;&#x6CD5;&#x201D;&#x7684; templates &#x6784;&#x6210;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x4E5F;&#x8986;&#x76D6;&#x82E5;&#x5E72;&#x5DE5;&#x5177;&#x6027; templates&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; advance&#xFF0C;</span>
<span class="token comment">// &#x7528;&#x6765;&#x5C06;&#x67D0;&#x4E2A;&#x8FED;&#x4EE3;&#x5668;&#x79FB;&#x52A8;&#x67D0;&#x4E2A;&#x7ED9;&#x5B9A;&#x8DDD;&#x79BB;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span><span class="token punctuation">,</span> DistT<span class="token operator">&gt;</span>       <span class="token comment">// &#x5C06;&#x8FED;&#x4EE3;&#x5668;&#x5411;&#x524D;&#x79FB;&#x52A8; d &#x5355;&#x4F4D;&#x3002;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x5982;&#x679C; d &lt; 0 &#x5219;&#x5411;&#x540E;&#x79FB;&#x52A8;&#x3002;</span>





<span class="token comment">// &#x5BF9;&#x4E8E;&#x8FD9; 5 &#x79CD;&#x5206;&#x7C7B;&#xFF0C;C++ &#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x5206;&#x522B;&#x63D0;&#x4F9B;&#x4E13;&#x5C5E;&#x7684;&#x5377;&#x6807;&#x7ED3;&#x6784;&#xFF08;tag struct&#xFF09;&#x52A0;&#x4EE5;&#x786E;&#x8BA4;&#xFF1A;</span>
<span class="token keyword">struct</span> input_iterator_tag <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> output_iterator_tag <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> forward_iterator_tag <span class="token operator">:</span> <span class="token keyword">public</span> input_iterator_tag <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> bidirectional_iterator_tag <span class="token operator">:</span> <span class="token keyword">public</span> forward_iterator_tag <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> random_access_iterator_tag <span class="token operator">:</span> <span class="token keyword">public</span> bidirectional_iterator_tag <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x6211;&#x4EEC;&#x77E5;&#x9053; random access &#x8FED;&#x4EE3;&#x5668;&#x652F;&#x6301;&#x8FED;&#x4EE3;&#x5668;&#x7B97;&#x672F;&#x8FD0;&#x7B97;&#xFF0C;&#x53EA;&#x8017;&#x8D39;&#x5E38;&#x91CF;&#x65F6;&#x95F4;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x5982;&#x679C;&#x9762;&#x5BF9;&#x8FD9;&#x79CD;&#x8FED;&#x4EE3;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x8FD0;&#x7528;&#x5176;&#x4F18;&#x52BF;&#x3002;</span>
<span class="token comment">// &#x6211;&#x4EEC;&#x771F;&#x6B63;&#x5E0C;&#x671B;&#x7684;&#x662F;&#x4EE5;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0; advance&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>iter is a random access iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iter <span class="token operator">+=</span> d<span class="token punctuation">;</span>          <span class="token comment">// &#x9488;&#x5BF9; random access &#x8FED;&#x4EE3;&#x5668;&#x4F7F;&#x7528;&#x8FED;&#x4EE3;&#x5668;&#x7B97;&#x672F;&#x8FD0;&#x7B97;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x9488;&#x5BF9;&#x5176;&#x4ED6;&#x8FED;&#x4EE3;&#x5668;&#x5206;&#x7C7B;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">--</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token comment">// &#x53CD;&#x590D;&#x8C03;&#x7528; ++ &#x6216; --</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token operator">&gt;</span>        <span class="token comment">// template&#xFF0C;&#x7528;&#x6765;&#x5904;&#x7406;</span>
<span class="token keyword">struct</span> iterator_traits<span class="token punctuation">;</span>         <span class="token comment">// &#x8FED;&#x4EE3;&#x5668;&#x5206;&#x7C7B;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">deque</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">class</span> <span class="token class-name">iterator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">typedef</span> random_access_iterator_tag iterator_category<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// list &#x7684;&#x8FED;&#x4EE3;&#x5668;&#x53EF;&#x53CC;&#x5411;&#x884C;&#x8FDB;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x5E94;&#x8BE5;&#x662F;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">list</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">class</span> <span class="token class-name">iterator</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">typedef</span> bidirectional_iterator_tag iterator_category<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x81F3;&#x4E8E; iterator_traits&#xFF0C;&#x53EA;&#x662F;&#x9E66;&#x9E49;&#x5B66;&#x820C;&#x822C;&#x5730;&#x54CD;&#x5E94; iterator class &#x7684;&#x5D4C;&#x5957;&#x5F0F; typedef&#xFF1A;</span>

<span class="token comment">// &#x7C7B;&#x578B; IterT &#x7684; iterator_category &#x5176;&#x5B9E;&#x5C31;&#x662F;&#x7528;&#x6765;&#x8868;&#x73B0;&#x201C;IterT &#x8BF4;&#x5B83;&#x81EA;&#x5DF1;&#x662F;&#x4EC0;&#x4E48;&#x201D;&#x3002;</span>
<span class="token comment">// &#x5173;&#x4E8E; &#x201C;typedef typename&#x201D; &#x7684;&#x8FD0;&#x7528;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 42&#x3002;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> iterator_traits <span class="token punctuation">{</span>
    <span class="token keyword">typedef</span> <span class="token keyword">typename</span> IterT<span class="token operator">::</span>iterator_category iterator_category<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x8FD9;&#x5BF9;&#x7528;&#x6237;&#x81EA;&#x5B9A;&#x4E49;&#x7C7B;&#x578B;&#x884C;&#x5F97;&#x901A;&#xFF0C;&#x4F46;&#x5BF9;&#x6307;&#x9488;&#xFF08;&#x4E5F;&#x662F;&#x4E00;&#x79CD;&#x8FED;&#x4EE3;&#x5668;&#xFF09;&#x884C;&#x4E0D;&#x901A;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A;&#x6307;&#x9488;&#x4E0D;&#x53EF;&#x80FD;&#x5D4C;&#x5957; typedef&#x3002;iterator_traits &#x7684;&#x7B2C;&#x4E8C;&#x90E8;&#x5206;&#x5982;&#x4E0B;&#xFF0C;&#x4E13;&#x95E8;&#x7528;&#x6765;&#x5BF9;&#x4ED8;&#x6307;&#x9488;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x652F;&#x6301;&#x6307;&#x9488;&#x8FED;&#x4EE3;&#x5668;&#xFF0C;iterator_traits &#x7279;&#x522B;&#x9488;&#x5BF9;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x504F;&#x7279;&#x5316;&#x7248;&#x672C;</span>
<span class="token comment">// &#xFF08;partial template specialization&#xFF09;&#x3002;&#x7531;&#x4E8E;&#x6307;&#x9488;&#x7684;&#x884C;&#x5F84;&#x4E0E; random access</span>
<span class="token comment">// &#x8FED;&#x4EE3;&#x5668;&#x7C7B;&#x4F3C;&#xFF0C;&#x6240;&#x4EE5; iterator_traits &#x4E3A;&#x6307;&#x9488;&#x6307;&#x5B9A;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x7C7B;&#x578B;&#x662F;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token operator">&gt;</span>            <span class="token comment">// template &#x504F;&#x7279;&#x5316;</span>
<span class="token keyword">struct</span> iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">*</span><span class="token operator">&gt;</span>      <span class="token comment">// &#x9488;&#x5BF9;&#x5185;&#x7F6E;&#x6307;&#x9488;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">typedef</span> random_access_iterator_tag iterator_category<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x4F60;&#x5E94;&#x8BE5;&#x77E5;&#x9053;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x5E76;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A; traits class &#x4E86;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x786E;&#x8BA4;&#x82E5;&#x5E72;&#x4F60;&#x5E0C;&#x671B;&#x5C06;&#x6765;&#x53EF;&#x53D6;&#x5F97;&#x7684;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</span>
<span class="token comment">// &#x4F8B;&#x5982;&#x5BF9;&#x8FED;&#x4EE3;&#x5668;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5C06;&#x6765;&#x5F97;&#x5176;&#x5206;&#x7C7B;&#xFF08;category&#xFF09;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x4E3A;&#x8BE5;&#x4FE1;&#x606F;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#xFF08;&#x4F8B;&#x5982; iterator_category&#xFF09;&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; template &#x548C;&#x4E00;&#x7EC4;&#x7279;&#x5316;&#x7248;&#x672C;&#xFF08;&#x4F8B;&#x5982;&#x7A0D;&#x65E9;&#x8BF4;&#x7684; iterator_traits&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5185;&#x542B;&#x4F60;&#x5E0C;&#x671B;&#x652F;&#x6301;&#x7684;&#x7C7B;&#x578B;&#x76F8;&#x5173;&#x4FE1;&#x606F;&#x3002;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">typename</span> std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">&gt;</span><span class="token operator">::</span>iterator_category<span class="token punctuation">)</span>
        <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token operator">::</span>random_access_iterator_tag<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x867D;&#x7136;&#x8FD9;&#x770B;&#x8D77;&#x6765;&#x524D;&#x666F;&#x5149;&#x660E;&#xFF0C;&#x5176;&#x5B9E;&#x5E76;&#x975E;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x3002;&#x9996;&#x5148;&#x5B83;&#x4F1A;&#x5BFC;&#x81F4;&#x7F16;&#x8BD1;&#x95EE;&#x9898;&#xFF0C;</span>
<span class="token comment">// &#x4F46;&#x6211;&#x5C06;&#x5728;&#x6761;&#x6B3E; 48 &#x624D;&#x63A2;&#x8BA8;&#x8FD9;&#x4E00;&#x70B9;&#xFF0C;&#x6B64;&#x523B;&#x6709;&#x66F4;&#x6839;&#x672C;&#x7684;&#x95EE;&#x9898;&#x8981;&#x8003;&#x8651;&#x3002;</span>
<span class="token comment">// IterT &#x7C7B;&#x578B;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x83B7;&#x77E5;&#xFF0C;&#x6240;&#x4EE5; iterator_traits&lt;IterT&gt;::iterator_category</span>
<span class="token comment">// &#x4E5F;&#x53EF;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x786E;&#x5B9A;&#x3002;&#x4F46; if &#x8BED;&#x53E5;&#x5374;&#x662F;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x624D;&#x4F1A;&#x6838;&#x5B9A;&#x3002;</span>
<span class="token comment">// &#x4E3A;&#x4EC0;&#x4E48;&#x5C06;&#x53EF;&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x5B8C;&#x6210;&#x7684;&#x4E8B;&#x5EF6;&#x5230;&#x8FD0;&#x884C;&#x671F;&#x624D;&#x505A;&#x5462;&#xFF1F;</span>
<span class="token comment">// &#x8FD9;&#x4E0D;&#x4EC5;&#x6D6A;&#x8D39;&#x65F6;&#x95F4;&#xFF0C;&#x4E5F;&#x9020;&#x6210;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x81A8;&#x80C0;&#x3002;</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x771F;&#x6B63;&#x60F3;&#x8981;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x6761;&#x4EF6;&#x5F0F;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x4E00;&#x4E2A; if...else &#x8BED;&#x53E5;&#xFF09;&#x5224;&#x65AD;&#x201C;&#x7F16;&#x8BD1;&#x671F;&#x6838;&#x5B9A;&#x6210;&#x529F;&#x201D;&#x4E4B;&#x7C7B;&#x578B;&#x3002;</span>
<span class="token comment">// &#x6070;&#x5DE7; C++ &#x6709;&#x4E00;&#x4E2A;&#x53D6;&#x5F97;&#x8FD9;&#x79CD;&#x884C;&#x4E3A;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x91CD;&#x8F7D;&#xFF08;overloading&#xFF09;&#x3002;</span>

<span class="token comment">// &#x4E3A;&#x4E86;&#x8BA9; advance &#x7684;&#x884C;&#x4E3A;&#x5982;&#x6211;&#x4EEC;&#x6240;&#x671F;&#x671B;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x505A;&#x7684;&#x662F;&#x4EA7;&#x751F;&#x4E24;&#x7248;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x5185;&#x542B; advance &#x7684;&#x672C;&#x8D28;&#x5185;&#x5BB9;&#xFF0C;&#x4F46;&#x5404;&#x81EA;&#x63A5;&#x53D7;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x7684; iterator_category &#x5BF9;&#x8C61;&#x3002;</span>
<span class="token comment">// &#x6211;&#x5C06;&#x8FD9;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x53D6;&#x540D;&#x4E3A; doAdvance&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>        <span class="token comment">// &#x8FD9;&#x4EFD;&#x5B9E;&#x73B0;&#x7528;&#x4E8E;</span>
<span class="token keyword">void</span> <span class="token function">doAdvance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">,</span>            <span class="token comment">// random access</span>
               std<span class="token operator">::</span>random_access_iterator_tag<span class="token punctuation">)</span> <span class="token comment">// &#x8FED;&#x4EE3;&#x5668;</span>
<span class="token punctuation">{</span>
    iter <span class="token operator">+=</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>        <span class="token comment">// &#x8FD9;&#x4EFD;&#x5B9E;&#x73B0;&#x7528;&#x4E8E;</span>
<span class="token keyword">void</span> <span class="token function">doAdvance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">,</span>            <span class="token comment">// bidirectional</span>
               std<span class="token operator">::</span>bidirectional_iterator_tag<span class="token punctuation">)</span> <span class="token comment">// &#x8FED;&#x4EE3;&#x5668;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">--</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>        <span class="token comment">// &#x8FD9;&#x4EFD;&#x5B9E;&#x73B0;&#x7528;&#x4E8E;</span>
<span class="token keyword">void</span> <span class="token function">doAdvance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">,</span>            <span class="token comment">// input</span>
               std<span class="token operator">::</span>input_iterator_tag<span class="token punctuation">)</span>         <span class="token comment">// &#x8FED;&#x4EE3;&#x5668;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> std<span class="token operator">::</span><span class="token function">out_of_range</span><span class="token punctuation">(</span><span class="token string">&quot;Negative distance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &#x8BE6;&#x4E0B;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// advance &#x51FD;&#x6570;&#x89C4;&#x8303;&#x8BF4;&#xFF0C;&#x5982;&#x679C;&#x9762;&#x5BF9;&#x7684;&#x662F; random access &#x548C; bidirectional &#x8FED;&#x4EE3;&#x5668;&#xFF0C;</span>
<span class="token comment">// &#x5219;&#x63A5;&#x6536;&#x6B63;&#x8DDD;&#x79BB;&#x548C;&#x8D1F;&#x8DDD;&#x79BB;&#xFF1B;&#x4F46;&#x5982;&#x679C;&#x9762;&#x5BF9;&#x7684;&#x662F; forward &#x6216; input &#x8FED;&#x4EE3;&#x5668;&#xFF0C;</span>
<span class="token comment">// &#x5219;&#x79FB;&#x52A8;&#x8D1F;&#x8DDD;&#x79BB;&#x4F1A;&#x5BFC;&#x81F4;&#x4E0D;&#x660E;&#x786E;&#xFF08;&#x672A;&#x5B9A;&#x4E49;&#xFF09;&#x884C;&#x4E3A;&#x3002;&#x6211;&#x6240;&#x68C0;&#x9A8C;&#x8FC7;&#x7684;&#x5B9E;&#x73B0;&#x7801;&#x90FD;&#x5047;&#x8BBE; d &#x4E0D;&#x4E3A;&#x8D1F;&#xFF0C;</span>
<span class="token comment">// &#x4E8E;&#x662F;&#x76F4;&#x63A5;&#x8FDB;&#x5165;&#x4E00;&#x4E2A;&#x5197;&#x957F;&#x7684;&#x5FAA;&#x73AF;&#x8FED;&#x4EE3;&#xFF0C;&#x7B49;&#x5F85;&#x8BA1;&#x6570;&#x5668;&#x964D;&#x4E3A; 0&#x3002;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EE5;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x53D6;&#x800C;&#x4EE3;&#x4E4B;&#x3002;</span>
<span class="token comment">// &#x4E24;&#x79CD;&#x505A;&#x6CD5;&#x90FD;&#x6709;&#x6839;&#x636E;&#xFF0C;&#x4F46;&#x201C;&#x65E0;&#x6CD5;&#x9884;&#x8A00;&#x53D1;&#x751F;&#x4F55;&#x4E8B;&#x201D;&#x662F;&#x201C;&#x4E0D;&#x660E;&#x786E;&#x884C;&#x4E3A;&#x201D;&#x4E4B;&#x7978;&#x6E90;&#x6240;&#x5728;&#x3002;</span>

<span class="token comment">// &#x6709;&#x4E86;&#x8FD9;&#x4E9B; doAdvance &#x91CD;&#x8F7D;&#x7248;&#x672C;&#xFF0C;advance &#x9700;&#x8981;&#x505A;&#x7684;&#x53EA;&#x662F;&#x8C03;&#x7528;&#x5B83;&#x4EEC;&#x5E76;&#x989D;&#x5916;&#x4F20;&#x9012;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;</span>
<span class="token comment">// &#x540E;&#x8005;&#x5FC5;&#x987B;&#x5E26;&#x6709;&#x9002;&#x5F53;&#x7684;&#x8FED;&#x4EE3;&#x5668;&#x5206;&#x7C7B;&#x3002;&#x4E8E;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x8FD0;&#x7528;&#x91CD;&#x8F7D;&#x89E3;&#x6790;&#x673A;&#x5236;&#xFF08;overloading resolution&#xFF09;</span>
<span class="token comment">// &#x8C03;&#x7528;&#x9002;&#x5F53;&#x7684;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">doAdvance</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token keyword">typename</span> std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">iterator_category</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x73B0;&#x5728;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x603B;&#x7ED3;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; traits class &#x4E86;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x5EFA;&#x7ACB;&#x4E00;&#x7EC4;&#x91CD;&#x8F7D;&#x51FD;&#x6570;&#xFF08;&#x8EAB;&#x4EFD;&#x50CF;&#x52B3;&#x5DE5;&#xFF09;&#x6216;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF08;&#x4F8B;&#x5982; doAdvance&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5F7C;&#x6B64;&#x95F4;&#x7684;&#x5DEE;&#x5F02;&#x53EA;&#x5728;&#x4E8E;&#x5404;&#x81EA;&#x7684; traits &#x53C2;&#x6570;&#x3002;&#x4EE4;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x5B9E;&#x73B0;&#x7801;&#x4E0E;&#x5176;&#x63A5;&#x53D7;&#x4E4B; traits &#x4FE1;&#x606F;&#x76F8;&#x5E94;&#x548C;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;&#x63A7;&#x5236;&#x51FD;&#x6570;&#xFF08;&#x8EAB;&#x4EFD;&#x50CF;&#x5DE5;&#x5934;&#xFF09;&#x6216;&#x51FD;&#x6570;&#x6A21;&#x677F;&#xFF08;&#x4F8B;&#x5982; advance&#xFF09;&#xFF0C;&#x5B83;&#x8C03;&#x7528;&#x4E0A;&#x8FF0;&#x90A3;&#x4E9B;&#x201C;&#x52B3;&#x5DE5;&#x51FD;&#x6570;&#x201D;&#x5E76;&#x4F20;&#x9012; traits class &#x6240;&#x63D0;&#x4F9B;&#x7684;&#x4FE1;&#x606F;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-48%E8%AE%A4%E8%AF%86-template-%E5%85%83%E7%BC%96%E7%A8%8B">&#x6761;&#x6B3E; 48&#xFF1A;&#x8BA4;&#x8BC6; template &#x5143;&#x7F16;&#x7A0B;</h3>

<ul>
<li>Template metaprogramming&#xFF08;TMP&#xFF0C;&#x6A21;&#x677F;&#x5143;&#x7F16;&#x7A0B;&#xFF09;&#x53EF;&#x5C06;&#x5DE5;&#x4F5C;&#x7531;&#x8FD0;&#x884C;&#x671F;&#x79FB;&#x5F80;&#x7F16;&#x8BD1;&#x671F;&#xFF0C;&#x56E0;&#x800C;&#x5F97;&#x4EE5;&#x5B9E;&#x73B0;&#x65E9;&#x671F;&#x9519;&#x8BEF;&#x68C0;&#x6D4B;&#x548C;&#x66F4;&#x9AD8;&#x7684;&#x6267;&#x884C;&#x6548;&#x7387;&#x3002;</li>
<li>TMP &#x53EF;&#x88AB;&#x7528;&#x6765;&#x751F;&#x6210;&#x201C;&#x57FA;&#x4E8E;&#x653F;&#x7B56;&#x9009;&#x62E9;&#x7EC4;&#x5408;&#x201D;&#xFF08;based on combinations of policy choices&#xFF09;&#x7684;&#x5BA2;&#x6237;&#x5B9A;&#x5236;&#x4EE3;&#x7801;&#xFF0C;&#x4E5F;&#x53EF;&#x7528;&#x6765;&#x907F;&#x514D;&#x751F;&#x6210;&#x5BF9;&#x67D0;&#x4E9B;&#x7279;&#x6B8A;&#x7C7B;&#x578B;&#x5E76;&#x4E0D;&#x9002;&#x5408;&#x7684;&#x4EE3;&#x7801;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// Template metaprogramming&#xFF08;TMP&#xFF0C;&#x6A21;&#x677F;&#x5143;&#x7F16;&#x7A0B;&#xFF09;&#x662F;&#x7F16;&#x5199; template-based C++</span>
<span class="token comment">// &#x7A0B;&#x5E8F;&#x5E76;&#x6267;&#x884C;&#x4E0E;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x6240;&#x8C13; template metaprogram&#xFF08;&#x6A21;&#x677F;&#x5143;&#x7A0B;&#x5E8F;&#xFF09;</span>
<span class="token comment">// &#x662F;&#x4EE5; C++ &#x5199;&#x6210;&#x3001;&#x6267;&#x884C;&#x4E8E; C++ &#x7F16;&#x8BD1;&#x5668;&#x5185;&#x7684;&#x7A0B;&#x5E8F;&#x3002;&#x4E00;&#x65E6; TMP &#x7A0B;&#x5E8F;&#x7ED3;&#x675F;&#x6267;&#x884C;&#xFF0C;</span>
<span class="token comment">// &#x5176;&#x8F93;&#x51FA;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4ECE; templates &#x5177;&#x73B0;&#x51FA;&#x6765;&#x7684;&#x82E5;&#x5E72; C++ &#x6E90;&#x7801;&#xFF0C;&#x4FBF;&#x4F1A;&#x4E00;&#x5982;&#x5F80;&#x5E38;&#x5730;&#x88AB;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// TMP &#x6709;&#x4E24;&#x4E2A;&#x4F1F;&#x5927;&#x7684;&#x6548;&#x529B;&#x3002;&#x7B2C;&#x4E00;&#xFF0C;&#x5B83;&#x8BA9;&#x67D0;&#x4E9B;&#x4E8B;&#x60C5;&#x66F4;&#x5BB9;&#x6613;&#x3002;</span>
<span class="token comment">// &#x5982;&#x679C;&#x6CA1;&#x6709;&#x5B83;&#xFF0C;&#x90A3;&#x4E9B;&#x4E8B;&#x60C5;&#x5C06;&#x662F;&#x56F0;&#x96BE;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x3002;</span>
<span class="token comment">// &#x7B2C;&#x4E8C;&#xFF0C;&#x7531;&#x4E8E; template metaprograms &#x6267;&#x884C;&#x4E8E; C++ &#x7F16;&#x8BD1;&#x671F;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x5C06;&#x5DE5;&#x4F5C;&#x4ECE;&#x8FD0;&#x884C;&#x671F;&#x8F6C;&#x79FB;&#x5230;&#x7F16;&#x8BD1;&#x671F;&#x3002;</span>





<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>iter is a random access iterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iter <span class="token operator">+=</span> d<span class="token punctuation">;</span>          <span class="token comment">// &#x9488;&#x5BF9; random access &#x8FED;&#x4EE3;&#x5668;&#x4F7F;&#x7528;&#x8FED;&#x4EE3;&#x5668;&#x7B97;&#x672F;&#x8FD0;&#x7B97;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x9488;&#x5BF9;&#x5176;&#x4ED6;&#x8FED;&#x4EE3;&#x5668;&#x7C7B;&#x578B;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">--</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token comment">// &#x53CD;&#x590D;&#x8C03;&#x7528; ++ &#x6216; --</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; typeid &#x8BA9;&#x5176;&#x4E2D;&#x7684;&#x4F2A;&#x7801;&#x6210;&#x771F;&#xFF0C;&#x53D6;&#x5F97; C++ &#x5BF9;&#x6B64;&#x95EE;&#x9898;&#x7684;&#x4E00;&#x4E2A;&#x201C;&#x6B63;&#x5E38;&#x201D;&#x89E3;&#x51B3;</span>
<span class="token comment">// &#x65B9;&#x6848;&#x2014;&#x2014;&#x6240;&#x6709;&#x5DE5;&#x4F5C;&#x90FD;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x8FDB;&#x884C;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> IterT<span class="token punctuation">,</span> <span class="token keyword">typename</span> DistT<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>IterT<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> DistT d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeid</span><span class="token punctuation">(</span><span class="token keyword">typename</span> std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>IterT<span class="token operator">&gt;</span><span class="token operator">::</span>iterator_category<span class="token punctuation">)</span>
        <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token operator">::</span>random_access_iterator_tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iter <span class="token operator">+=</span> d<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>     <span class="token comment">// &#x9488;&#x5BF9;&#x5176;&#x4ED6;&#x8FED;&#x4EE3;&#x5668;&#x5206;&#x7C7B;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">--</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>            <span class="token comment">// &#x53CD;&#x590D;&#x8C03;&#x7528; ++ &#x6216; --</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6761;&#x6B3E; 47 &#x6307;&#x51FA;&#xFF0C;&#x8FD9;&#x4E2A; typeid-based &#x89E3;&#x6CD5;&#x7684;&#x6548;&#x7387;&#x6BD4; traits &#x89E3;&#x6CD5;&#x4F4E;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x65B9;&#x6848;&#x4E2D;&#xFF0C;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x7C7B;&#x578B;&#x6D4B;&#x8BD5;&#x53D1;&#x751F;&#x4E8E;&#x8FD0;&#x884C;&#x671F;&#x800C;&#x975E;&#x7F16;&#x8BD1;&#x671F;&#xFF0C;&#xFF08;2&#xFF09;&#x201C;&#x8FD0;&#x884C;&#x671F;&#x7C7B;&#x578B;&#x6D4B;&#x8BD5;&#x201D;&#x4EE3;&#x7801;&#x4F1A;&#x51FA;&#x73B0;&#x5728;</span>
<span class="token comment">// &#xFF08;&#x6216;&#x8BF4;&#x88AB;&#x8FDE;&#x63A5;&#x4E8E;&#xFF09;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x4E2D;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6B63;&#x53EF;&#x5F70;&#x663E; TMP &#x5982;&#x4F55;&#x80FD;&#x591F;&#x6BD4;&#x201C;&#x6B63;&#x5E38;&#x7684;&#x201D;</span>
<span class="token comment">// C++ &#x7A0B;&#x5E8F;&#x66F4;&#x9AD8;&#x6548;&#xFF0C;</span>
<span class="token comment">// &#x56E0;&#x4E3A; traits &#x89E3;&#x6CD5;&#x5C31;&#x662F; TMP&#x3002;&#x522B;&#x5FD8;&#x4E86;&#xFF0C;traits &#x5F15;&#x53D1;&#x201C;&#x7F16;&#x8BD1;&#x671F;&#x53D1;&#x751F;&#x4E8E;&#x7C7B;&#x578B;&#x8EAB;&#x4E0A;&#x7684; if...else &#x8BA1;&#x7B97;&#x201D;&#x3002;</span>

<span class="token comment">// &#x6761;&#x6B3E; 47 &#x66FE;&#x7ECF;&#x63D0;&#x8FC7; advance &#x7684; typeid-based &#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x7F16;&#x8BD1;&#x671F;&#x95EE;&#x9898;&#xFF0C;&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</span>
std<span class="token operator">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">::</span>iterator iter<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token function">advance</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// &#x79FB;&#x52A8; iter &#x5411;&#x524D;&#x8D70; 10 &#x4E2A;&#x5143;&#x7D20;&#xFF1B;</span>
                                <span class="token comment">// &#x4E0A;&#x8FF0;&#x5B9E;&#x73B0;&#x65E0;&#x6CD5;&#x901A;&#x8FC7;&#x7F16;&#x8BD1;&#x3002;</span>

<span class="token comment">// &#x4E0B;&#x6EE1;&#x8FD9;&#x4E00;&#x7248; advance &#x4FBF;&#x662F;&#x9488;&#x5BF9;&#x4E0A;&#x8FF0;&#x8C03;&#x7528;&#x800C;&#x4EA7;&#x751F;&#x7684;&#x3002;</span>
<span class="token comment">// &#x5C06; template &#x53C2;&#x6570; IterT &#x548C; DistT &#x5206;&#x522B;&#x66FF;&#x6362;&#x4E3A; iter &#x548C; 10 &#x7684;&#x7C7B;&#x578B;&#x4E4B;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x8FD9;&#x4E9B;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">advance</span><span class="token punctuation">(</span>std<span class="token operator">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">::</span>iterator<span class="token operator">&amp;</span> iter<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token operator">::</span>iterator_traits<span class="token operator">&lt;</span>std<span class="token operator">::</span>list<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">::</span>iterator<span class="token operator">&gt;</span><span class="token operator">::</span>iterator_category<span class="token punctuation">)</span>
        <span class="token operator">==</span> <span class="token keyword">typeid</span><span class="token punctuation">(</span>std<span class="token operator">::</span>random_access_iterator_tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        iter <span class="token operator">+=</span> d<span class="token punctuation">;</span>      <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">++</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">--</span>iter<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x95EE;&#x9898;&#x51FA;&#x5728;&#x6211;&#x6240;&#x5F3A;&#x8C03;&#x7684;&#x90A3;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E86; += &#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x90A3;&#x4FBF;&#x662F;&#x5C1D;&#x8BD5;&#x5728;&#x4E00;&#x4E2A; list&lt;int&gt;::iterator</span>
<span class="token comment">// &#x8EAB;&#x4E0A;&#x4F7F;&#x7528; +=&#xFF0C;&#x4F46; list&lt;int&gt;::iterator &#x662F; bidirectional &#x8FED;&#x4EE3;&#x5668;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 47&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5E76;&#x4E0D;&#x652F;&#x6301; +=&#x3002;&#x53EA;&#x6709; random access &#x8FED;&#x4EE3;&#x5668;&#x624D;&#x652F;&#x6301; +=&#x3002;</span>
<span class="token comment">// &#x4E0E;&#x6B64;&#x5BF9;&#x6BD4;&#x7684;&#x662F; traits-based TMP &#x89E3;&#x6CD5;&#xFF0C;&#x5176;&#x9488;&#x5BF9;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#x800C;&#x8FDB;&#x884C;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x88AB;&#x62C6;&#x5206;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x64CD;&#x4F5C;&#xFF08;&#x64CD;&#x4F5C;&#x7B26;&#xFF09;&#x90FD;&#x53EF;&#x65BD;&#x884C;&#x4E8E;&#x8BE5;&#x51FD;&#x6570;&#x6240;&#x5BF9;&#x4ED8;&#x7684;&#x7C7B;&#x578B;&#x3002;</span>





<span class="token comment">// TMP &#x7684;&#x9636;&#x4E58;&#x8FD0;&#x7B97;&#x793A;&#x8303;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x201C;&#x9012;&#x5F52;&#x6A21;&#x677F;&#x5177;&#x73B0;&#x5316;&#x201D;&#xFF08;recursive template instantiation&#xFF09;</span>
<span class="token comment">// &#x5B9E;&#x73B0;&#x5FAA;&#x73AF;&#xFF0C;&#x4EE5;&#x53CA;&#x5982;&#x4F55;&#x5728; TMP &#x4E2D;&#x521B;&#x5EFA;&#x548C;&#x4F7F;&#x7528;&#x53D8;&#x91CF;&#xFF1A;</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> n<span class="token operator">&gt;</span>                <span class="token comment">// &#x4E00;&#x822C;&#x60C5;&#x51B5;&#xFF1A;Factorial&lt;n&gt; &#x7684;&#x503C;&#x662F;</span>
<span class="token keyword">struct</span> Factorial <span class="token punctuation">{</span>                  <span class="token comment">// n &#x4E58;&#x4EE5; Factorial&lt;n - 1&gt; &#x7684;&#x503C;</span>
    <span class="token keyword">enum</span> <span class="token punctuation">{</span> value <span class="token operator">=</span> n <span class="token operator">*</span> Factorial<span class="token operator">&lt;</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token operator">&gt;</span><span class="token operator">::</span>value <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>                          <span class="token comment">// &#x7279;&#x6B8A;&#x60C5;&#x51B5;</span>
<span class="token keyword">struct</span> Factorial<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>               <span class="token comment">// Factorial&lt;0&gt; &#x7684;&#x503C;&#x662F; 1</span>
    <span class="token keyword">enum</span> <span class="token punctuation">{</span> value <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x4F60;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x4F7F;&#x7528; Factorial&#xFF1A;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> Factorial<span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;</span><span class="token operator">::</span>value<span class="token punctuation">;</span>       <span class="token comment">// &#x5370;&#x51FA; 120</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> Factorial<span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&gt;</span><span class="token operator">::</span>value<span class="token punctuation">;</span>      <span class="token comment">// &#x5370;&#x51FA; 3628800</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="8-%E5%AE%9A%E5%88%B6-new-%E5%92%8C-delete">8&#x3001;&#x5B9A;&#x5236; new &#x548C; delete</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-49%E4%BA%86%E8%A7%A3-new-handler-%E7%9A%84%E8%A1%8C%E4%B8%BA">&#x6761;&#x6B3E; 49&#xFF1A;&#x4E86;&#x89E3; new-handler &#x7684;&#x884C;&#x4E3A;</h3>

<ul>
<li>set_new_handler &#x5141;&#x8BB8;&#x5BA2;&#x6237;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x5206;&#x914D;&#x65E0;&#x6CD5;&#x83B7;&#x5F97;&#x6EE1;&#x8DB3;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#x3002;</li>
<li>Nothrow new &#x662F;&#x4E00;&#x4E2A;&#x9887;&#x4E3A;&#x5C40;&#x9650;&#x7684;&#x5DE5;&#x5177;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x5185;&#x5B58;&#x5206;&#x914D;&#xFF1B;&#x540E;&#x7EE7;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x8FD8;&#x662F;&#x53EF;&#x80FD;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x4E3A;&#x4E86;&#x6307;&#x5B9A;&#x8FD9;&#x4E2A;&#x201C;&#x7528;&#x4EE5;&#x5904;&#x7406;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x201D;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5BA2;&#x6237;&#x5FC5;&#x987B;&#x8C03;&#x7528; set_new_handler&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x662F;&#x58F0;&#x660E;&#x4E8E; &lt;new&gt; &#x7684;&#x4E00;&#x4E2A;&#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x51FD;&#x6570;&#xFF1A;</span>
<span class="token keyword">namespace</span> std <span class="token punctuation">{</span>
    <span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>new_handler<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_handler <span class="token function">set_new_handler</span><span class="token punctuation">(</span>new_handler p<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// new_handler &#x662F;&#x4E2A; typedef&#xFF0C;&#x5B9A;&#x4E49;&#x51FA;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x6CA1;&#x6709;&#x53C2;&#x6570;&#x4E5F;&#x4E0D;&#x8FD4;&#x56DE;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x3002;</span>
<span class="token comment">// set_new_handler &#x5219;&#x662F;&#x201C;&#x83B7;&#x5F97;&#x4E00;&#x4E2A; new_handler &#x5E76;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; new_handler&#x201D;&#x7684;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// set_new_handler &#x58F0;&#x660E;&#x5F0F;&#x5C3E;&#x7AEF;&#x7684; &#x201C;throw()&#x201D; &#x662F;&#x4E00;&#x4EFD;&#x5F02;&#x5E38;&#x660E;&#x7EC6;&#xFF0C;</span>
<span class="token comment">// &#x8868;&#x793A;&#x8BE5;&#x51FD;&#x6570;&#x4E0D;&#x629B;&#x51FA;&#x4EFB;&#x4F55;&#x5F02;&#x5E38;&#x2014;&#x2014;&#x867D;&#x7136;&#x4E8B;&#x5B9E;&#x66F4;&#x6709;&#x8DA3;&#x4E9B;&#xFF0C;&#x8BE6;&#x89C1;&#x6761;&#x6B3E; 29.</span>

<span class="token comment">// set_new_handler &#x7684;&#x53C2;&#x6570;&#x662F;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411; operator new &#x65E0;&#x6CD5;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x5185;&#x5B58;&#x65F6;</span>
<span class="token comment">// &#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x3002;&#x5176;&#x8FD4;&#x56DE;&#x503C;&#x4E5F;&#x662F;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411; set_new_handler &#x88AB;&#x8C03;&#x7528;&#x524D;&#x6B63;&#x5728;&#x6267;&#x884C;</span>
<span class="token comment">// &#xFF08;&#x4F46;&#x9A6C;&#x4E0A;&#x5C31;&#x8981;&#x88AB;&#x66FF;&#x6362;&#xFF09;&#x7684;&#x90A3;&#x4E2A; new-handler &#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x4F60;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x4F7F;&#x7528; set_new_handler&#xFF1A;</span>

<span class="token comment">// &#x4EE5;&#x4E0B;&#x662F;&#x5F53; operator new &#x65E0;&#x6CD5;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x5185;&#x5B58;&#x65F6;&#xFF0C;&#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;</span>
<span class="token keyword">void</span> <span class="token function">outOfMem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>cerr <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Unable to satisfy request for memory\n&quot;</span><span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>outOfMem<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span><span class="token operator">*</span> pBigDataArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">100000000L</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x5C31;&#x672C;&#x4F8B;&#x800C;&#x8A00;&#xFF0C;&#x5982;&#x679C; operator new &#x65E0;&#x6CD5;&#x4E3A; 100000000 &#x4E2A;&#x6574;&#x6570;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x7A7A;&#x95F4;&#xFF0C;</span>
<span class="token comment">// outOfMem &#x4F1A;&#x88AB;&#x8C03;&#x7528;&#xFF0C;&#x4E8E;&#x662F;&#x7A0B;&#x5E8F;&#x5728;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x4FE1;&#x606F;&#x4E4B;&#x540E;&#x592D;&#x6298;&#xFF08;abort&#xFF09;&#x3002;</span>





<span class="token comment">// &#x5F53; operator new &#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x4E0D;&#x65AD;&#x8C03;&#x7528; new-handler &#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x76F4;&#x5230;&#x627E;&#x5230;&#x8DB3;&#x591F;&#x5185;&#x5B58;&#x3002;&#x5F15;&#x8D77;&#x53CD;&#x590D;&#x8C03;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x663E;&#x793A;&#x4E8E;&#x6761;&#x6B3E; 51&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x9AD8;&#x7EA7;&#x63CF;&#x8FF0;&#x5DF2;&#x8DB3;&#x591F;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x7ED3;&#x8BBA;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x826F;&#x597D;&#x7684; new-handler &#x51FD;&#x6570;&#x5FC5;&#x987B;&#x505A;&#x4EE5;&#x4E0B;&#x4E8B;&#x60C5;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x8BA9;&#x66F4;&#x591A;&#x5185;&#x5B58;&#x53EF;&#x88AB;&#x4F7F;&#x7528;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x5B89;&#x88C5;&#x53E6;&#x4E00;&#x4E2A; new-handler&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x5378;&#x8F7D; new-handler&#x3002;</span>
<span class="token comment">// &#xFF08;4&#xFF09;&#x629B;&#x51FA; bad_alloc&#xFF08;&#x6216;&#x6D3E;&#x751F;&#x81EA; bad_alloc&#xFF09;&#x7684;&#x5F02;&#x5E38;&#x3002;</span>
<span class="token comment">// &#xFF08;5&#xFF09;&#x4E0D;&#x8FD4;&#x56DE;&#xFF0C;&#x901A;&#x5E38;&#x8C03;&#x7528; abort &#x6216; exit&#x3002;</span>





<span class="token comment">// &#x6709;&#x65F6;&#x5019;&#x4F60;&#x6216;&#x8BB8;&#x5E0C;&#x671B;&#x4EE5;&#x4E0D;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#x5904;&#x7406;&#x5185;&#x5B58;&#x5206;&#x914D;&#x5931;&#x8D25;&#x60C5;&#x51B5;&#xFF0C;&#x4F60;&#x5E0C;&#x671B;&#x89C6;&#x88AB;&#x5206;&#x914D;&#x7269;&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A; class &#x800C;&#x5B9A;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">X</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">outOfMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Y</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">outOfMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

X<span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> X<span class="token punctuation">;</span>      <span class="token comment">// &#x5982;&#x679C;&#x5206;&#x914D;&#x4E0D;&#x6210;&#x529F;&#xFF0C;</span>
                    <span class="token comment">// &#x8C03;&#x7528; X::outOfMemory</span>
Y<span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> Y<span class="token punctuation">;</span>      <span class="token comment">// &#x5982;&#x679C;&#x5206;&#x914D;&#x4E0D;&#x6210;&#x529F;&#xFF0C;</span>
                    <span class="token comment">// &#x8C03;&#x7528; Y::outOfMemory</span>





<span class="token comment">// &#x73B0;&#x5728;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x6253;&#x7B97;&#x5904;&#x7406; Widget class &#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x5931;&#x8D25;&#x60C5;&#x51B5;&#x3002;&#x9996;&#x5148;&#x4F60;&#x5FC5;&#x987B;</span>
<span class="token comment">// &#x767B;&#x5F55;&#x201C;&#x5F53; operator new &#x65E0;&#x6CD5;&#x4E3A;&#x4E00;&#x4E2A; Widget &#x5BF9;&#x8C61;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x5185;&#x5B58;&#x65F6;&#x201D;&#x8C03;&#x7528;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x9700;&#x8981;&#x58F0;&#x660E;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x4E3A; new_handler &#x7684; static &#x6210;&#x5458;&#xFF0C;&#x7528;&#x4EE5;&#x6307;&#x5411; class Widget</span>
<span class="token comment">// &#x7684; new-handler&#x3002;&#x770B;&#x8D77;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>new_handler <span class="token function">set_new_handler</span><span class="token punctuation">(</span>std<span class="token operator">::</span>new_handler p<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>new_handler currentHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Static &#x6210;&#x5458;&#x5FC5;&#x987B;&#x5728; class &#x5B9A;&#x4E49;&#x5F0F;&#x4E4B;&#x5916;&#x88AB;&#x5B9A;&#x4E49;&#xFF08;&#x9664;&#x975E;&#x5B83;&#x4EEC;&#x662F; const &#x800C;&#x4E14;&#x662F;&#x6574;&#x6570;&#x5F62;&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 2&#xFF09;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x9700;&#x8981;&#x8FD9;&#x4E48;&#x5199;&#xFF1A;</span>
std<span class="token operator">::</span>new_handler Widget<span class="token operator">::</span>currentHandler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// &#x5728; class &#x5B9E;&#x73B0;&#x6587;&#x4EF6;&#x5185;&#x521D;&#x59CB;&#x5316;&#x4E3A; null</span>

<span class="token comment">// Widget &#x5185;&#x7684; set_new_handler &#x51FD;&#x6570;&#x4F1A;&#x5C06;&#x5B83;&#x83B7;&#x5F97;&#x7684;&#x6307;&#x9488;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#xFF0C;</span>
<span class="token comment">// &#x7136;&#x540E;&#x8FD4;&#x56DE;&#x5148;&#x524D;&#xFF08;&#x5728;&#x6B64;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#xFF09;&#x5B58;&#x50A8;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x4E5F;&#x6B63;&#x662F;&#x6807;&#x51C6;&#x7248; set_new_handler &#x7684;&#x4F5C;&#x4E3A;&#xFF1A;</span>
std<span class="token operator">::</span>new_handler Widget<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>std<span class="token operator">::</span>new_handler p<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>new_handler oldHandler <span class="token operator">=</span> currentHandler<span class="token punctuation">;</span>
    currentHandler <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token keyword">return</span> oldHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6700;&#x540E;&#xFF0C;Widget &#x7684; operator new &#x505A;&#x4EE5;&#x4E0B;&#x4E8B;&#x60C5;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x8C03;&#x7528;&#x6807;&#x51C6; set_new_handler&#xFF0C;&#x544A;&#x77E5; Widget &#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x8C03;&#x7528; global operator new&#xFF0C;&#x6267;&#x884C;&#x5B9E;&#x9645;&#x4E4B;&#x5185;&#x5B58;&#x5206;&#x914D;&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x5982;&#x679C; global operator new &#x80FD;&#x591F;&#x5206;&#x914D;&#x8DB3;&#x591F;&#x4E00;&#x4E2A; Widget &#x5BF9;&#x8C61;&#x6240;&#x7528;&#x7684;&#x5185;&#x5B58;&#xFF0C;</span>
<span class="token comment">// Widget &#x7684; operator new &#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x5206;&#x914D;&#x6240;&#x5F97;&#x3002;</span>

<span class="token comment">// &#x4E0B;&#x9762;&#x4EE5; C++ &#x4EE3;&#x7801;&#x518D;&#x9610;&#x8FF0;&#x4E00;&#x6B21;&#x3002;&#x6211;&#x5C06;&#x4ECE;&#x8D44;&#x6E90;&#x5904;&#x7406;&#x7C7B;&#xFF08;resource-handling class&#xFF09;&#x5F00;&#x59CB;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x91CC;&#x9762;&#x53EA;&#x662F;&#x57FA;&#x7840;&#x6027; RAII &#x64CD;&#x4F5C;&#xFF0C;&#x5728;&#x6784;&#x9020;&#x8FC7;&#x7A0B;&#x4E2D;&#x83B7;&#x5F97;&#x4E00;&#x7B14;&#x8D44;&#x6E90;&#xFF0C;&#x5E76;&#x5728;&#x6790;&#x6784;&#x8FC7;&#x7A0B;&#x4E2D;&#x91CA;&#x8FD8;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 13&#xFF09;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">NewHandlerHolder</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">NewHandlerHolder</span><span class="token punctuation">(</span>std<span class="token operator">::</span>new_handler nh<span class="token punctuation">)</span>      <span class="token comment">// &#x53D6;&#x5F97;&#x76EE;&#x524D;&#x7684;</span>
        <span class="token operator">:</span> <span class="token function">handler</span><span class="token punctuation">(</span>nh<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>                                <span class="token comment">// new-handler&#x3002;</span>
    
    <span class="token operator">~</span><span class="token function">NewHandlerHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                 <span class="token comment">// &#x91CA;&#x653E;&#x5B83;</span>
    <span class="token punctuation">{</span> std<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token operator">::</span>new_handler handler<span class="token punctuation">;</span>                           <span class="token comment">// &#x8BB0;&#x5F55;&#x4E0B;&#x6765;</span>

    <span class="token function">NewHandlerHolder</span><span class="token punctuation">(</span><span class="token keyword">const</span> NewHandlerHolder<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// &#x963B;&#x6B62; copying</span>
    NewHandlerHolder<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> NewHandlerHolder<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#xFF08;&#x89C1;&#x6761;&#x6B3E; 14&#xFF09;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x5C31;&#x4F7F;&#x5F97; Widget&apos;s operator new &#x7684;&#x5B9E;&#x73B0;&#x76F8;&#x5F53;&#x7B80;&#x5355;&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> Widget<span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    NewHandlerHolder                                <span class="token comment">// &#x5B89;&#x88C5; Widget &#x7684;</span>
        <span class="token function">h</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>currentHandler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// new-handler.</span>
    <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// &#x5206;&#x914D;&#x5185;&#x5B58;&#x6216;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</span>
<span class="token punctuation">}</span>                                                   <span class="token comment">// &#x6062;&#x590D; global new-handler&#x3002;</span>

<span class="token comment">// Widget &#x7684;&#x5BA2;&#x6237;&#x5E94;&#x8BE5;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x4F7F;&#x7528;&#x5176; new-handling&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token function">outOfMem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// &#x51FD;&#x6570;&#x58F0;&#x660E;&#x3002;&#x6B64;&#x51FD;&#x6570;&#x5728;</span>
                                        <span class="token comment">// Widget &#x5BF9;&#x8C61;&#x5206;&#x914D;&#x5931;&#x8D25;&#x65F6;&#x88AB;&#x8C03;&#x7528;&#x3002;</span>

Widget<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>outOfMem<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8BBE;&#x5B9A; outOfMem &#x4E3A; Widget &#x7684;</span>
                                        <span class="token comment">// new-handling &#x51FD;&#x6570;&#x3002;</span>

Widget<span class="token operator">*</span> pw1 <span class="token operator">=</span> <span class="token keyword">new</span> Widget<span class="token punctuation">;</span>               <span class="token comment">// &#x5982;&#x679C;&#x5185;&#x5B58;&#x5206;&#x914D;&#x5931;&#x8D25;&#xFF0C;</span>
                                        <span class="token comment">// &#x8C03;&#x7528; outOfMem&#x3002;</span>

std<span class="token operator">::</span>string<span class="token operator">*</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>string<span class="token punctuation">;</span>      <span class="token comment">// &#x5982;&#x679C;&#x5185;&#x5B58;&#x5206;&#x914D;&#x5931;&#x8D25;&#xFF0C;</span>
                                        <span class="token comment">// &#x8C03;&#x7528; global new-handling &#x51FD;&#x6570;</span>
                                        <span class="token comment">// &#xFF08;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF09;&#x3002;</span>

Widget<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// &#x8BBE;&#x5B9A; Widget &#x4E13;&#x5C5E;&#x7684;</span>
                                        <span class="token comment">// new-handling &#x51FD;&#x6570;&#x4E3A; null&#x3002;</span>

Widget<span class="token operator">*</span> pw2 <span class="token operator">=</span> <span class="token keyword">new</span> Widget<span class="token punctuation">;</span>               <span class="token comment">// &#x5982;&#x679C;&#x5185;&#x5B58;&#x5206;&#x914D;&#x5931;&#x8D25;&#xFF0C;</span>
                                        <span class="token comment">// &#x7ACB;&#x523B;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;</span>
                                        <span class="token comment">// &#xFF08;class Widget &#x5E76;&#x6CA1;&#x6709;&#x4E13;&#x5C5E;&#x7684;</span>
                                        <span class="token comment">// new-handling &#x51FD;&#x6570;&#xFF09;&#x3002;</span>





<span class="token comment">// &#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x65B9;&#x6848;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x4E0D;&#x56E0; class &#x7684;&#x4E0D;&#x540C;&#x800C;&#x4E0D;&#x540C;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x5B83;&#x5904;&#x52A0;&#x4EE5;&#x590D;&#x7528;&#x662F;&#x4E2A;&#x5408;&#x7406;&#x7684;&#x6784;&#x60F3;&#x3002;</span>
<span class="token comment">// &#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x505A;&#x6CD5;&#x5C31;&#x662F;&#x5EFA;&#x7ACB;&#x8D77;&#x4E00;&#x4E2A;&#x201C;mixin&#x201D;&#x98CE;&#x683C;&#x7684; base class&#xFF0C;&#x8FD9;&#x79CD; base class &#x7528;&#x6765;</span>
<span class="token comment">// &#x5141;&#x8BB8; derived classes &#x7EE7;&#x627F;&#x5355;&#x4E00;&#x7279;&#x5B9A;&#x80FD;&#x529B;&#x2014;&#x2014;&#x5728;&#x672C;&#x4F8B;&#x4E2D;&#x662F;&#x201C;&#x8BBE;&#x5B9A; class &#x4E13;&#x5C5E;&#x4E4B;</span>
<span class="token comment">// new-handler&#x201D;&#x7684;&#x80FD;&#x529B;&#x3002;&#x7136;&#x540E;&#x5C06;&#x8FD9;&#x4E2A; base class &#x8F6C;&#x6362;&#x4E3A; template&#xFF0C;</span>
<span class="token comment">// &#x5982;&#x6B64;&#x4E00;&#x6765;&#x6BCF;&#x4E2A; derived class &#x5C06;&#x83B7;&#x5F97;&#x5B9E;&#x4F53;&#x4E92;&#x5F02;&#x7684; class data &#x590D;&#x4EF6;&#x3002;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x7684; base class &#x90E8;&#x5206;&#x8BA9; derived classes &#x7EE7;&#x627F;&#x5B83;&#x4EEC;&#x6240;&#x9700;&#x7684; set_new_handler</span>
<span class="token comment">// &#x548C; operator new&#xFF0C;&#x800C; template &#x90E8;&#x5206;&#x5219;&#x786E;&#x4FDD;&#x6BCF;&#x4E00;&#x4E2A; derived class &#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x5B9E;&#x4F53;</span>
<span class="token comment">// &#x4E92;&#x5F02;&#x7684; currentHandler &#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>            <span class="token comment">// &quot;mixin&quot; &#x98CE;&#x683C;&#x7684; base class&#xFF0C;&#x7528;&#x4EE5;&#x652F;&#x6301;</span>
<span class="token keyword">class</span> <span class="token class-name">NewHandlerSupport</span> <span class="token punctuation">{</span>       <span class="token comment">// class &#x4E13;&#x5C5E;&#x7684; set_new_handler</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>new_handler <span class="token function">set_new_handler</span><span class="token punctuation">(</span>std<span class="token operator">::</span>new_handler p<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                         <span class="token comment">// &#x5176;&#x4ED6;&#x7684; operator new &#x7248;&#x672C;&#x2014;&#x2014;&#x89C1;&#x6761;&#x6B3E; 52</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">static</span> std<span class="token operator">::</span>new_handler currentHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
std<span class="token operator">::</span>new_handler NewHandlerSupport<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>std<span class="token operator">::</span>new_handler p<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token operator">::</span>new_handler oldHandler <span class="token operator">=</span> currentHandler<span class="token punctuation">;</span>
    currentHandler <span class="token operator">=</span> p<span class="token punctuation">;</span>
    <span class="token keyword">return</span> oldHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
<span class="token keyword">void</span><span class="token operator">*</span> NewHandlerSupport<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    NewHandlerHolder <span class="token function">h</span><span class="token punctuation">(</span>std<span class="token operator">::</span><span class="token function">set_new_handler</span><span class="token punctuation">(</span>currentHandler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x4EE5;&#x4E0B;&#x5C06;&#x6BCF;&#x4E00;&#x4E2A; currentHandler &#x521D;&#x59CB;&#x5316;&#x4E3A; null</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> T<span class="token operator">&gt;</span>
std<span class="token operator">::</span>new_handler NewHandlerSupport<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">::</span>currentHandler <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// &#x6709;&#x4E86;&#x8FD9;&#x4E2A; class template&#xFF0C;&#x4E3A; Widget &#x6DFB;&#x52A0; set_new_handler &#x652F;&#x6301;&#x80FD;&#x529B;&#x5C31;&#x8F7B;&#x800C;&#x6613;&#x4E3E;&#x4E86;&#xFF1A;</span>
<span class="token comment">// &#x53EA;&#x8981;&#x4EE4; Widget &#x7EE7;&#x627F;&#x81EA; NewHandlerSupport&lt;Widget&gt; &#x5C31;&#x597D;&#xFF0C;&#x50CF;&#x4E0B;&#x9762;&#x8FD9;&#x6837;&#x3002;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token operator">:</span> <span class="token keyword">public</span> NewHandlerSupport<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token comment">// &#x548C;&#x5148;&#x524D;&#x4E00;&#x6837;&#xFF0C;&#x4F46;&#x4E0D;&#x5FC5;&#x58F0;&#x660E;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>                  <span class="token comment">// set_new_handler &#x6216; operator new</span>





<span class="token comment">// C++ &#x6807;&#x51C6;&#x59D4;&#x5458;&#x4F1A;&#x4E0D;&#x60F3;&#x629B;&#x5F03;&#x90A3;&#x4E9B;&#x201C;&#x4FA6;&#x6D4B; null&#x201D;&#x7684;&#x65CF;&#x7FA4;&#xFF0C;&#x4E8E;&#x662F;&#x63D0;&#x4F9B;&#x53E6;&#x4E00;&#x5F62;&#x5F0F;&#x7684; operator new&#xFF0C;</span>
<span class="token comment">// &#x8D1F;&#x8D23;&#x4F9B;&#x5E94;&#x4F20;&#x7EDF;&#x7684;&#x201C;&#x5206;&#x914D;&#x5931;&#x8D25;&#x4FBF;&#x8FD4;&#x56DE; null&#x201D;&#x884C;&#x4E3A;&#x3002;&#x8FD9;&#x4E2A;&#x5F62;&#x5F0F;&#x88AB;&#x79F0;&#x4E3A;&#x201C;nothrow&#x201D;&#x5F62;&#x5F0F;&#x2014;&#x2014;</span>
<span class="token comment">// &#x67D0;&#x79CD;&#x7A0B;&#x5EA6;&#x4E0A;&#x662F;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x5728; new &#x7684;&#x4F7F;&#x7528;&#x573A;&#x5408;&#x7528;&#x4E86; nothrow &#x5BF9;&#x8C61;&#xFF08;&#x5B9A;&#x4E49;&#x4E8E;&#x5934;&#x6587;&#x4EF6; &lt;new&gt;&#xFF09;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Widget<span class="token operator">*</span> pw1 <span class="token operator">=</span> <span class="token keyword">new</span> Widget<span class="token punctuation">;</span>                   <span class="token comment">// &#x5982;&#x679C;&#x5206;&#x914D;&#x5931;&#x8D25;&#xFF0C;&#x629B;&#x51FA; bad_alloc.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pw1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                           <span class="token comment">// &#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x4E00;&#x5B9A;&#x5931;&#x8D25;&#x3002;</span>
Widget<span class="token operator">&amp;</span> pw2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>nothrow<span class="token punctuation">)</span> Widget<span class="token punctuation">;</span>    <span class="token comment">// &#x5982;&#x679C;&#x5206;&#x914D; Widget &#x5931;&#x8D25;&#xFF0C;&#x8FD4;&#x56DE; 0&#x3002;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pw2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                           <span class="token comment">// &#x8FD9;&#x4E2A;&#x6D4B;&#x8BD5;&#x53EF;&#x80FD;&#x6210;&#x529F;</span>

<span class="token comment">// Nothrow new &#x5BF9;&#x5F02;&#x5E38;&#x7684;&#x5F3A;&#x5236;&#x4FDD;&#x8BC1;&#x6027;&#x5E76;&#x4E0D;&#x9AD8;&#x3002;</span>
<span class="token comment">// &#x7ED3;&#x8BBA;&#x662F;&#xFF1A;&#x4F7F;&#x7528; nothrow new &#x53EA;&#x80FD;&#x4FDD;&#x8BC1; operator new &#x4E0D;&#x629B;&#x63B7;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// &#x4E0D;&#x4FDD;&#x8BC1;&#x50CF;&#x201C;new (std::nothrow) Widget&#x201D; &#x8FD9;&#x6837;&#x7684;&#x8868;&#x8FBE;&#x5F0F;&#x7EDD;&#x4E0D;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x3002;</span>
<span class="token comment">// &#x56E0;&#x6B64;&#x4F60;&#x5176;&#x5B9E;&#x6CA1;&#x6709;&#x8FD0;&#x7528; nothrow new &#x7684;&#x9700;&#x8981;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-50%E4%BA%86%E8%A7%A3-new-%E5%92%8C-delete-%E7%9A%84%E5%90%88%E7%90%86%E6%9B%BF%E6%8D%A2%E6%97%B6%E6%9C%BA">&#x6761;&#x6B3E; 50&#xFF1A;&#x4E86;&#x89E3; new &#x548C; delete &#x7684;&#x5408;&#x7406;&#x66FF;&#x6362;&#x65F6;&#x673A;</h3>

<ul>
<li>&#x6709;&#x8BB8;&#x591A;&#x7406;&#x7531;&#x9700;&#x8981;&#x5199;&#x4E2A;&#x81EA;&#x5B9A;&#x7684; new &#x548C; delete&#xFF0C;&#x5305;&#x62EC;&#x6539;&#x5584;&#x6548;&#x80FD;&#x3001;&#x5BF9; heap &#x8FD0;&#x7528;&#x9519;&#x8BEF;&#x8FDB;&#x884C;&#x8C03;&#x8BD5;&#x3001;&#x6536;&#x96C6; heap &#x4F7F;&#x7528;&#x4FE1;&#x606F;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numebrs}" class="language-cpp line-numebrs"><span class="token comment">// &#x9996;&#x5148;&#xFF0C;&#x600E;&#x4E48;&#x4F1A;&#x6709;&#x4EBA;&#x60F3;&#x8981;&#x66FF;&#x6362;&#x7F16;&#x8BD1;&#x5668;&#x63D0;&#x4F9B;&#x7684; operator new &#x6216; operator delete &#x5462;&#xFF1F;</span>
<span class="token comment">// &#x4E0B;&#x9762;&#x662F;&#x4E09;&#x4E2A;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x7406;&#x7531;&#xFF1A;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x7528;&#x6765;&#x68C0;&#x6D4B;&#x8FD0;&#x7528;&#x4E0A;&#x7684;&#x9519;&#x8BEF;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x4E3A;&#x4E86;&#x5F3A;&#x5316;&#x6548;&#x80FD;&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x4E3A;&#x4E86;&#x6536;&#x96C6;&#x4F7F;&#x7528;&#x4E0A;&#x7684;&#x7EDF;&#x8BA1;&#x6570;&#x636E;&#x3002;</span>





<span class="token comment">// &#x89C2;&#x5FF5;&#x4E0A;&#xFF0C;&#x5199;&#x4E00;&#x4E2A;&#x5B9A;&#x5236; operator new &#x5341;&#x5206;&#x7B80;&#x5355;&#x3002;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x4E2A;&#x5FEB;&#x901F;&#x53D1;&#x5C55;</span>
<span class="token comment">// &#x5F97;&#x51FA;&#x7684;&#x521D;&#x9636;&#x6BB5; global operator new&#xFF0C;&#x4FC3;&#x8FDB;&#x5E76;&#x534F;&#x52A9;&#x68C0;&#x6D4B;&#x201C;overruns&#x201D;&#xFF08;&#x5199;&#x5165;&#x70B9;&#x5728;&#x5206;&#x914D;&#x533A;&#x5757;&#x5C3E;&#x7AEF;&#x4E4B;&#x540E;&#xFF09;</span>
<span class="token comment">// &#x6216;&#x201C;underruns&#x201D;&#xFF08;&#x5199;&#x5165;&#x70B9;&#x5728;&#x5206;&#x914D;&#x533A;&#x5757;&#x8D77;&#x70B9;&#x4E4B;&#x524D;&#xFF09;&#x3002;&#x5176;&#x4E2D;&#x8FD8;&#x5B58;&#x5728;&#x4E0D;&#x5C11;&#x5C0F;&#x9519;&#x8BEF;&#xFF0C;&#x7A0D;&#x540E;&#x6211;&#x4F1A;&#x5B8C;&#x5584;&#x5B83;&#x3002;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> signature <span class="token operator">=</span> <span class="token number">0xDEADBEEF</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> Byte<span class="token punctuation">;</span>
<span class="token comment">// &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4EE3;&#x7801;&#x8FD8;&#x6709;&#x82E5;&#x5E72;&#x5C0F;&#x9519;&#x8BEF;&#xFF0C;&#x8BE6;&#x4E0B;&#x3002;</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
    size_t realSize <span class="token operator">=</span> size <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// &#x589E;&#x52A0;&#x5927;&#x5C0F;&#xFF0C;&#x4F7F;&#x80FD;&#x591F;</span>
                                                    <span class="token comment">// &#x585E;&#x5165;&#x4E24;&#x4E2A; signatures&#x3002;</span>
    <span class="token keyword">void</span><span class="token operator">*</span> pMem <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>realSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pMem<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token function">bad_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// &#x5C06; signature &#x5199;&#x5165;&#x5185;&#x5B58;&#x7684;&#x6700;&#x524D;&#x6BB5;&#x843D;&#x548C;&#x6700;&#x540E;&#x6BB5;&#x843D;&#x3002;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>pMem<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> signature<span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">reinterpret_cast</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Byte<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>pMem<span class="token punctuation">)</span> <span class="token operator">+</span> realSize <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> signature<span class="token punctuation">;</span>

    <span class="token comment">// &#x8FD4;&#x56DE;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x6070;&#x4F4D;&#x4E8E;&#x7B2C;&#x4E00;&#x4E2A; signature &#x4E4B;&#x540E;&#x7684;&#x5185;&#x5B58;&#x4F4D;&#x7F6E;&#x3002;</span>
    <span class="token keyword">return</span> <span class="token keyword">static_cast</span><span class="token operator">&lt;</span>Byte<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>pMem<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6761;&#x6B3E; 51 &#x8BF4;&#x6240;&#x4EE5; operator news &#x90FD;&#x5E94;&#x8BE5;&#x5185;&#x542B;&#x4E00;&#x4E2A;&#x5FAA;&#x73AF;&#xFF0C;&#x53CD;&#x590D;&#x8C03;&#x7528;&#x67D0;&#x4E2A; new-handling &#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x91CC;&#x5374;&#x6CA1;&#x6709;&#x3002;</span>






<span class="token comment">// &#x672C;&#x6761;&#x6B3E;&#x7684;&#x4E3B;&#x9898;&#x662F;&#xFF0C;&#x4E86;&#x89E3;&#x4F55;&#x65F6;&#x53EF;&#x5728;&#x201C;&#x5168;&#x5C40;&#x6027;&#x7684;&#x201D;&#x6216;&#x201C;class &#x4E13;&#x5C5E;&#x7684;&#x201D;&#x57FA;&#x7840;&#x4E0A;&#x5408;&#x7406;&#x66FF;&#x6362;</span>
<span class="token comment">// &#x7F3A;&#x7701;&#x7684; new &#x548C; delete&#x3002;</span>
<span class="token comment">// &#xFF08;1&#xFF09;&#x4E3A;&#x4E86;&#x68C0;&#x6D4B;&#x8FD0;&#x7528;&#x9519;&#x8BEF;&#x3002;</span>
<span class="token comment">// &#xFF08;2&#xFF09;&#x4E3A;&#x4E86;&#x6536;&#x96C6;&#x52A8;&#x6001;&#x5206;&#x914D;&#x5185;&#x5B58;&#x4E4B;&#x4F7F;&#x7528;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;&#x3002;</span>
<span class="token comment">// &#xFF08;3&#xFF09;&#x4E3A;&#x4E86;&#x589E;&#x52A0;&#x5206;&#x914D;&#x548C;&#x5F52;&#x8FD8;&#x7684;&#x901F;&#x5EA6;&#x3002;</span>
<span class="token comment">// &#xFF08;4&#xFF09;&#x4E3A;&#x4E86;&#x964D;&#x4F4E;&#x7F3A;&#x7701;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x5668;&#x5E26;&#x6765;&#x7684;&#x7A7A;&#x95F4;&#x989D;&#x5916;&#x5F00;&#x9500;&#x3002;</span>
<span class="token comment">// &#xFF08;5&#xFF09;&#x4E3A;&#x4E86;&#x5F25;&#x8865;&#x7F3A;&#x7701;&#x5206;&#x914D;&#x5668;&#x4E2D;&#x7684;&#x975E;&#x6700;&#x4F73;&#x9F50;&#x4F4D;&#xFF08;suboptimal alignment&#xFF09;&#x3002;</span>
<span class="token comment">// &#xFF08;6&#xFF09;&#x4E3A;&#x4E86;&#x5C06;&#x76F8;&#x5173;&#x5BF9;&#x8C61;&#x6210;&#x7C07;&#x96C6;&#x4E2D;&#x3002;</span>
<span class="token comment">// &#xFF08;7&#xFF09;&#x4E3A;&#x4E86;&#x83B7;&#x5F97;&#x975E;&#x4F20;&#x7EDF;&#x7684;&#x884C;&#x4E3A;&#x3002;</span>
</pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-51%E7%BC%96%E5%86%99-new-%E5%92%8C-delete-%E6%97%B6%E9%9C%80%E5%9B%BA%E5%AE%88%E5%B8%B8%E8%A7%84">&#x6761;&#x6B3E; 51&#xFF1A;&#x7F16;&#x5199; new &#x548C; delete &#x65F6;&#x9700;&#x56FA;&#x5B88;&#x5E38;&#x89C4;</h3>

<ul>
<li>operator new &#x5E94;&#x8BE5;&#x5185;&#x542B;&#x4E00;&#x4E2A;&#x65E0;&#x7A77;&#x5FAA;&#x73AF;&#xFF0C;&#x5E76;&#x5728;&#x5176;&#x4E2D;&#x5C1D;&#x8BD5;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x65E0;&#x6CD5;&#x6EE1;&#x8DB3;&#x5185;&#x5B58;&#x9700;&#x6C42;&#xFF0C;&#x5C31;&#x8BE5;&#x8C03;&#x7528; new-handler&#x3002;&#x5B83;&#x4E5F;&#x5E94;&#x8BE5;&#x6709;&#x80FD;&#x529B;&#x5904;&#x7406; 0 bytes &#x7533;&#x8BF7;&#x3002;Class &#x4E13;&#x5C5E;&#x7248;&#x672C;&#x5219;&#x8FD8;&#x5E94;&#x8BE5;&#x5904;&#x7406; &#x201C;&#x6BD4;&#x6B63;&#x786E;&#x5927;&#x5C0F;&#x66F4;&#x5927;&#x7684;&#xFF08;&#x9519;&#x8BEF;&#xFF09;&#x7533;&#x8BF7;&#x201D;&#x3002;</li>
<li>operator delete &#x5E94;&#x8BE5;&#x5728;&#x6536;&#x5230; null &#x6307;&#x9488;&#x65F6;&#x4E0D;&#x505A;&#x4EFB;&#x4F55;&#x4E8B;&#x3002;Class &#x4E13;&#x5C5E;&#x7248;&#x672C;&#x5219;&#x8FD8;&#x5E94;&#x8BE5;&#x5904;&#x7406;&#x201C;&#x6BD4;&#x6B63;&#x786E;&#x5927;&#x5C0F;&#x66F4;&#x5927;&#x7684;&#xFF08;&#x9519;&#x8BEF;&#x7533;&#x8BF7;&#xFF09;&#x201D;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// C++ &#x89C4;&#x5B9A;&#xFF0C;&#x5373;&#x4F7F;&#x5BA2;&#x6237;&#x8981;&#x6C42; 0 bytes&#xFF0C;operator new &#x4E5F;&#x5F97;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5408;&#x6CD5;&#x6307;&#x9488;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x79CD;&#x770B;&#x4F3C;&#x8BE1;&#x5F02;&#x7684;&#x884C;&#x4E3A;&#x5176;&#x5B9E;&#x662F;&#x4E3A;&#x4E86;&#x7B80;&#x5316;&#x8BED;&#x8A00;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x3002;</span>
<span class="token comment">// &#x4E0B;&#x9762;&#x662F;&#x4E2A; non-member operator new &#x4F2A;&#x7801;&#xFF08;pseudocode&#xFF09;&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>                               <span class="token comment">// &#x4F60;&#x7684; operator new &#x53EF;&#x80FD;&#x63A5;&#x53D7;&#x989D;&#x5916;&#x53C2;&#x6570;</span>
    <span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// &#x5904;&#x7406; 0-byte &#x7533;&#x8BF7;</span>
        size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>               <span class="token comment">// &#x5C06;&#x5B83;&#x89C6;&#x4E3A; 1-byte &#x7533;&#x8BF7;&#x3002;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        &#x5C1D;&#x8BD5;&#x5206;&#x914D; size bytes<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>&#x5206;&#x914D;&#x6210;&#x529F;<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x5206;&#x914D;&#x5F97;&#x6765;&#x7684;&#x5185;&#x5B58;<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// &#x5206;&#x914D;&#x5931;&#x8D25;&#xFF1B;&#x627E;&#x51FA;&#x76EE;&#x524D;&#x7684; new-handling &#x51FD;&#x6570;&#xFF08;&#x89C1;&#x4E0B;&#xFF09;</span>
        new_handler globalHandler <span class="token operator">=</span> <span class="token function">set_new_handler</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">set_new_handler</span><span class="token punctuation">(</span>globalHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>globalHandler<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>globalHandler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">throw</span> std<span class="token operator">::</span><span class="token function">bad_alloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token comment">// &#x9488;&#x5BF9; class X &#x800C;&#x8BBE;&#x8BA1;&#x7684; operator new&#xFF0C;&#x5176;&#x884C;&#x4E3A;&#x5F88;&#x5178;&#x578B;&#x5730;&#x53EA;&#x4E3A;&#x5927;&#x5C0F;&#x521A;&#x597D;</span>
<span class="token comment">// &#x4E3A; sizeof(X) &#x7684;&#x5BF9;&#x8C61;&#x800C;&#x8BBE;&#x8BA1;&#x3002;&#x7136;&#x800C;&#x4E00;&#x65E6;&#x88AB;&#x7EE7;&#x627F;&#x4E0B;&#x53BB;&#xFF0C;&#x6709;&#x53EF;&#x80FD; base class</span>
<span class="token comment">// &#x7684; operator new &#x88AB;&#x8C03;&#x7528;&#x7528;&#x4EE5;&#x5206;&#x914D; derived class &#x5BF9;&#x8C61;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base     <span class="token comment">// &#x5047;&#x8BBE; Derived &#x672A;&#x58F0;&#x660E; operator new</span>
<span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
Derived<span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> Derived<span class="token punctuation">;</span>       <span class="token comment">// &#x8FD9;&#x91CC;&#x8C03;&#x7528;&#x7684;&#x662F; Base::operator new</span>

<span class="token comment">// &#x5982;&#x679C; Base class &#x4E13;&#x5C5E;&#x7684; operator new &#x5E76;&#x975E;&#x88AB;&#x8BBE;&#x8BA1;&#x7528;&#x6765;&#x5BF9;&#x4ED8;&#x4E0A;&#x8FF0;&#x60C5;&#x51B5;&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x5F80;&#x5F80;&#x5982;&#x6B64;&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x5904;&#x7406;&#x6B64;&#x60C5;&#x52BF;&#x7684;&#x6700;&#x4F73;&#x505A;&#x6CD5;&#x662F;&#x5C06;&#x201C;&#x5185;&#x5B58;&#x7533;&#x8BF7;&#x91CF;&#x9519;&#x8BEF;&#x201D;&#x7684;&#x8C03;&#x7528;&#x884C;&#x4E3A;&#x6539;&#x91C7;&#x6807;&#x51C6; operator new&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> Base<span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">!=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">// &#x5982;&#x679C;&#x5927;&#x5C0F;&#x9519;&#x8BEF;&#xFF0C;</span>
        <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// &#x4EE4;&#x6807;&#x51C6;&#x7684; operator new &#x8D77;&#x800C;&#x5904;&#x7406;&#x3002;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                                 <span class="token comment">// &#x5426;&#x5219;&#x5728;&#x8FD9;&#x91CC;&#x5904;&#x7406;&#x3002;</span>
<span class="token punctuation">}</span>

<span class="token comment">// operator delete &#x60C5;&#x51B5;&#x66F4;&#x7B80;&#x5355;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x552F;&#x4E00;&#x4E8B;&#x60C5;&#x5C31;&#x662F; C++ &#x4FDD;&#x8BC1;&#x201C;&#x5220;&#x9664; null &#x6307;&#x9488;&#x6C38;&#x8FDC;&#x5B89;&#x5168;&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x4F60;&#x5FC5;&#x987B;&#x5151;&#x73B0;&#x8FD9;&#x9879;&#x4FDD;&#x8BC1;&#x3002;&#x4E0B;&#x9762;&#x662F; non-member operator delete &#x7684;&#x4F2A;&#x7801;&#xFF08;pseudocode&#xFF09;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> rawMemory<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rawMemory <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>          <span class="token comment">// &#x5982;&#x679C;&#x5C06;&#x88AB;&#x5220;&#x9664;&#x7684;&#x662F;&#x4E2A; null &#x6307;&#x9488;&#xFF0C;</span>
                                        <span class="token comment">// &#x90A3;&#x5C31;&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x505A;&#x3002;</span>
    &#x73B0;&#x5728;&#xFF0C;&#x5F52;&#x8FD8; rawMemory &#x6240;&#x6307;&#x7684;&#x5185;&#x5B58;<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x7684; member &#x7248;&#x672C;&#x4E5F;&#x5F88;&#x7B80;&#x5355;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x591A;&#x52A0;&#x4E00;&#x4E2A;&#x52A8;&#x4F5C;&#x68C0;&#x67E5;&#x5668;&#x5220;&#x9664;&#x6570;&#x91CF;&#x3002;</span>
<span class="token comment">// &#x4E07;&#x4E00;&#x4F60;&#x7684; class &#x4E13;&#x5C5E;&#x7684; operator new &#x5C06;&#x5927;&#x5C0F;&#x6709;&#x8BEF;&#x7684;&#x5206;&#x914D;&#x884C;&#x4E3A;&#x8F6C;&#x4EA4;::operator new &#x6267;&#x884C;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x4E5F;&#x5FC5;&#x987B;&#x5C06;&#x5927;&#x5C0F;&#x6709;&#x8BEF;&#x7684;&#x5220;&#x9664;&#x884C;&#x4E3A;&#x8F6C;&#x4EA4; ::operator delete &#x6267;&#x884C;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> rawMemory<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> Base<span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> rawMemory<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rawMemory <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>         <span class="token comment">// &#x68C0;&#x67E5; null &#x6307;&#x9488;&#x3002;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">!=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// &#x5982;&#x679C;&#x5927;&#x5C0F;&#x9519;&#x8BEF;&#xFF0C;&#x4EE4;&#x6807;&#x51C6;&#x7248;</span>
        <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>rawMemory<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// operator delete &#x5904;&#x7406;&#x6B64;&#x4E00;&#x7533;&#x8BF7;&#x3002;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    &#x73B0;&#x5728;&#xFF0C;&#x5F52;&#x8FD8; rawMemory &#x6240;&#x6307;&#x7684;&#x5185;&#x5B58;<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &#x6709;&#x8DA3;&#x7684;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x5373;&#x5C06;&#x88AB;&#x5220;&#x9664;&#x7684;&#x5BF9;&#x8C61;&#x6D3E;&#x751F;&#x81EA;&#x67D0;&#x4E2A; base class &#x800C;&#x540E;&#x8005;&#x6B20;&#x7F3A; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48; C++ &#x4F20;&#x7ED9; operator delete &#x7684; size_t &#x6570;&#x503C;&#x53EF;&#x80FD;&#x4E0D;&#x6B63;&#x786E;&#x3002;</span>
<span class="token comment">// &#x8FD9;&#x662F;&#x201C;&#x8BA9;&#x4F60;&#x7684; base classes &#x62E5;&#x6709; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#x201D;&#x7684;&#x4E00;&#x4E2A;&#x591F;&#x597D;&#x7684;&#x7406;&#x7531;&#xFF1A;</span>
<span class="token comment">// &#x6761;&#x6B3E; 7&#x8FD8;&#x63D0;&#x8FC7;&#x4E00;&#x4E2A;&#x66F4;&#x597D;&#x7684;&#x7406;&#x7531;&#x3002;&#x6B64;&#x523B;&#x53EA;&#x8981;&#x4F60;&#x63D0;&#x9AD8;&#x8B66;&#x89C9;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x7684; base classes</span>
<span class="token comment">// &#x9057;&#x6F0F; virtual &#x6790;&#x6784;&#x51FD;&#x6570;&#xFF0C;operator delete &#x53EF;&#x80FD;&#x65E0;&#x6CD5;&#x6B63;&#x786E;&#x5DE5;&#x4F5C;&#x3002;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-52%E5%86%99%E4%BA%86-placement-new-%E4%B9%9F%E8%A6%81%E5%86%99-placement-delete">&#x6761;&#x6B3E; 52&#xFF1A;&#x5199;&#x4E86; placement new &#x4E5F;&#x8981;&#x5199; placement delete</h3>

<ul>
<li>&#x5F53;&#x4F60;&#x5199;&#x4E00;&#x4E2A; placement operator new&#xFF0C;&#x8BF7;&#x786E;&#x5B9A;&#x4E5F;&#x5199;&#x51FA;&#x4E86;&#x5BF9;&#x5E94;&#x7684; placement operator delete&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8FD9;&#x6837;&#x505A;&#xFF0C;&#x4F60;&#x7684;&#x7A0B;&#x5E8F;&#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;&#x9690;&#x5FAE;&#x800C;&#x65F6;&#x65AD;&#x65F6;&#x7EED;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;</li>
<li>&#x5F53;&#x4F60;&#x58F0;&#x660E; placement new &#x548C; placement delete&#xFF0C;&#x8BF7;&#x786E;&#x5B9A;&#x4E0D;&#x8981;&#x65E0;&#x610F;&#x8BC6;&#xFF08;&#x975E;&#x6545;&#x610F;&#xFF09;&#x5730;&#x906E;&#x63A9;&#x4E86;&#x5B83;&#x4EEC;&#x7684;&#x6B63;&#x5E38;&#x7248;&#x672C;&#x3002;</li>
</ul>
<pre data-role="codeBlock" data-info="cpp {.line-numbers}" class="language-cpp line-numbers"><span class="token comment">// &#x5F53;&#x4F60;&#x5199;&#x4E00;&#x4E2A; new &#x8868;&#x8FBE;&#x5F0F;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;</span>
Widget<span class="token operator">*</span> pw <span class="token operator">=</span> <span class="token keyword">new</span> Widget<span class="token punctuation">;</span>
<span class="token comment">// &#x5171;&#x6709;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x88AB;&#x8C03;&#x7528;&#xFF1A;&#x4E00;&#x4E2A;&#x662F;&#x7528;&#x4EE5;&#x5206;&#x914D;&#x5185;&#x5B58;&#x7684; operator new&#xFF0C;&#x4E00;&#x4E2A;&#x662F; Widget &#x7684; default &#x6784;&#x9020;&#x51FD;&#x6570;&#x3002;</span>

<span class="token comment">// &#x5047;&#x8BBE;&#x5176;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6210;&#x529F;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x51FD;&#x6570;&#x5374;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x65E2;&#x7136;&#x8FD9;&#x6837;&#xFF0C;</span>
<span class="token comment">// &#x6B65;&#x9AA4;&#x4E00;&#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x6240;&#x5F97;&#x5FC5;&#x987B;&#x53D6;&#x6D88;&#x5E76;&#x6062;&#x590D;&#x65E7;&#x89C2;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x9020;&#x6210;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF08;memory leak&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x5BA2;&#x6237;&#x6CA1;&#x6709;&#x80FD;&#x529B;&#x5F52;&#x8FD8;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C; Widget &#x6784;&#x9020;&#x51FD;&#x6570;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF0C;</span>
<span class="token comment">// pw &#x5C1A;&#x672A;&#x88AB;&#x8D4B;&#x503C;&#xFF0C;&#x5BA2;&#x6237;&#x624B;&#x4E0A;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x6307;&#x9488;&#x6307;&#x5411;&#x8BE5;&#x88AB;&#x5F52;&#x8FD8;&#x7684;&#x5185;&#x5B58;&#x3002;</span>
<span class="token comment">// &#x53D6;&#x6D88;&#x6B65;&#x9AA4;&#x4E00;&#x5E76;&#x6062;&#x590D;&#x65E7;&#x89C2;&#x7684;&#x8D23;&#x4EFB;&#x56E0;&#x6B64;&#x843D;&#x5230; C++ &#x8FD0;&#x884C;&#x671F;&#x7CFB;&#x7EDF;&#x8EAB;&#x4E0A;&#x3002;</span>

<span class="token comment">// &#x8FD0;&#x884C;&#x671F;&#x7CFB;&#x7EDF;&#x4F1A;&#x9AD8;&#x9AD8;&#x5174;&#x5174;&#x5730;&#x8C03;&#x7528;&#x6B65;&#x9AA4;&#x4E00;&#x6240;&#x8C03;&#x7528;&#x7684; operator new &#x7684;&#x76F8;&#x5E94; operator</span>
<span class="token comment">// delete &#x7248;&#x672C;&#xFF0C;&#x524D;&#x63D0;&#x5F53;&#x7136;&#x662F;&#x5B83;&#x5FC5;&#x987B;&#x77E5;&#x9053;&#x54EA;&#x4E00;&#x4E2A;&#xFF08;&#x56E0;&#x4E3A;&#x53EF;&#x80FD;&#x6709;&#x8BB8;&#x591A;&#x4E2A;&#xFF09;operator delete</span>
<span class="token comment">// &#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5982;&#x679C;&#x76EE;&#x524D;&#x9762;&#x5BF9;&#x7684;&#x662F;&#x62E5;&#x6709;&#x6B63;&#x786E;&#x7B7E;&#x540D;&#x5F0F;&#xFF08;signature&#xFF09;&#x7684; new &#x548C; delete&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x6B63;&#x5E38;&#x7684; operator new&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x5BF9;&#x5E94;&#x4E8E;&#x6B63;&#x5E38;&#x7684; operator delete&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> rawMemory<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// global &#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x7684;&#x6B63;&#x5E38;&#x7B7E;&#x540D;&#x5F0F;</span>
<span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>vodi<span class="token operator">*</span> rawMemory<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// class &#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x5178;&#x578B;&#x7684;&#x7B7E;&#x540D;&#x5F0F;&#x3002;</span>





<span class="token comment">// &#x7136;&#x800C;&#x5F53;&#x4F60;&#x5F00;&#x59CB;&#x58F0;&#x660E;&#x975E;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; operator new&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5E26;&#x6709;&#x9644;&#x52A0;&#x53C2;&#x6570;&#x7684; operator new&#xFF0C;</span>
<span class="token comment">// &#x201C;&#x7A76;&#x7ADF;&#x54EA;&#x4E00;&#x4E2A; delete &#x4F34;&#x968F;&#x8FD9;&#x4E2A; new&#x201D;&#x7684;&#x95EE;&#x9898;&#x4FBF;&#x6D6E;&#x73B0;&#x4E86;&#x3002;</span>

<span class="token comment">// &#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5047;&#x8BBE;&#x4F60;&#x5199;&#x4E86;&#x4E00;&#x4E2A; class &#x4E13;&#x5C5E;&#x7684; operator new&#xFF0C;&#x8981;&#x6C42;&#x63A5;&#x53D7;&#x4E00;&#x4E2A; ostream&#xFF0C;</span>
<span class="token comment">// &#x7528;&#x6765;&#x5FD7;&#x8BB0;&#xFF08;logged&#xFF09;&#x76F8;&#x5173;&#x5206;&#x914D;&#x4FE1;&#x606F;&#xFF0C;&#x540C;&#x65F6;&#x53C8;&#x5199;&#x4E86;&#x4E00;&#x4E2A;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; class &#x4E13;&#x5C5E; operator delete&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span> std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x975E;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; new</span>
    
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span> std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// &#x6B63;&#x5E38;&#x7684; class &#x4E13;&#x5C5E; delete</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x4E2A;&#x8BBE;&#x8BA1;&#x6709;&#x95EE;&#x9898;&#x3002;</span>

<span class="token comment">// &#x5982;&#x679C; operator new &#x63A5;&#x53D7;&#x7684;&#x53C2;&#x6570;&#x9664;&#x4E86;&#x4E00;&#x5B9A;&#x4F1A;&#x6709;&#x7684;&#x90A3;&#x4E2A; size_t &#x4E4B;&#x5916;&#x8FD8;&#x6709;&#x5176;&#x4ED6;&#xFF0C;</span>
<span class="token comment">// &#x8FD9;&#x4FBF;&#x662F;&#x4E2A;&#x6240;&#x8C13;&#x7684; placement new&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E0A;&#x8FF0;&#x7684; operator new &#x662F;&#x4E2A; placement &#x7248;&#x672C;&#x3002;</span>
<span class="token comment">// &#x4F17;&#x591A; placement new &#x7248;&#x672C;&#x4E2D;&#x7279;&#x522B;&#x6709;&#x7528;&#x7684;&#x4E00;&#x4E2A;&#x662F;&#x201C;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6307;&#x5411;&#x5BF9;&#x8C61;&#x8BE5;&#x88AB;&#x6784;&#x9020;&#x4E4B;&#x5904;&#x201D;&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x6837;&#x7684; operator new &#x957F;&#x76F8;&#x5982;&#x4E0B;&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// placement new</span>





Widget<span class="token operator">*</span> pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>cerr<span class="token punctuation">)</span> Widget<span class="token punctuation">;</span>    <span class="token comment">// &#x8C03;&#x7528; operator new &#x5E76;&#x4F20;&#x9012; cerr &#x4E3A;&#x5176;</span>
                                        <span class="token comment">// ostream &#x5B9E;&#x53C2;&#xFF1B;&#x8FD9;&#x4E2A;&#x52A8;&#x4F5C;&#x4F1A;&#x5728; Widget</span>
                                        <span class="token comment">// &#x6784;&#x9020;&#x51FD;&#x6570;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x65F6;&#x6CC4;&#x6F0F;&#x5185;&#x5B58;</span>
<span class="token comment">// &#x65E2;&#x7136;&#x8FD9;&#x91CC;&#x7684; operator new &#x63A5;&#x53D7;&#x7C7B;&#x578B;&#x4E3A; ostream&amp; &#x7684;&#x989D;&#x5916;&#x5B9E;&#x53C2;&#xFF0C;</span>
<span class="token comment">// &#x6240;&#x4EE5;&#x5BF9;&#x5E94;&#x7684; operator delete &#x5C31;&#x5E94;&#x8BE5;&#x662F;&#xFF1A;</span>
<span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">,</span> std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#x7C7B;&#x4F3C;&#x4E8E; new &#x7684; placement &#x7248;&#x672C;&#xFF0C;operator delete &#x5982;&#x679C;&#x63A5;&#x53D7;&#x989D;&#x5916;&#x53C2;&#x6570;&#xFF0C;&#x4FBF;&#x79F0;&#x4E3A; placement deletes&#x3002;</span>





<span class="token comment">// &#x89C4;&#x5219;&#x5F88;&#x7B80;&#x5355;&#xFF1A;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5E26;&#x989D;&#x5916;&#x53C2;&#x6570;&#x7684; operator new &#x6CA1;&#x6709;&#x201C;&#x5E26;&#x76F8;&#x540C;&#x989D;&#x5916;&#x53C2;&#x6570;&#x201D;&#x7684;&#x5BF9;&#x5E94;&#x7248; operator delete&#xFF0C;</span>
<span class="token comment">// &#x90A3;&#x4E48;&#x5F53; new &#x7684;&#x5185;&#x5B58;&#x5206;&#x914D;&#x52A8;&#x4F5C;&#x9700;&#x8981;&#x53D6;&#x6D88;&#x5E76;&#x6062;&#x590D;&#x65E7;&#x89C2;&#x65F6;&#x5C31;&#x6CA1;&#x6709;&#x4EFB;&#x4F55; operator delete</span>
<span class="token comment">// &#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x4E3A;&#x4E86;&#x6D88;&#x5F2D;&#x7A0D;&#x65E9;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;Widget &#x6709;&#x5FC5;&#x8981;</span>
<span class="token comment">// &#x58F0;&#x660E;&#x4E00;&#x4E2A; placement delete&#xFF0C;&#x5BF9;&#x5E94;&#x4E8E;&#x90A3;&#x4E2A;&#x6709;&#x5FD7;&#x8BB0;&#x529F;&#x80FD;&#xFF08;logging&#xFF09;&#x7684; placement new&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span> std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span> std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// &#x8FD9;&#x6837;&#x6539;&#x53D8;&#x4E4B;&#x540E;&#xFF0C;&#x5982;&#x679C;&#x4EE5;&#x4E0B;&#x8BED;&#x53E5;&#x5F15;&#x53D1; Widget &#x6784;&#x9020;&#x51FD;&#x6570;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF1A;</span>
Widget<span class="token operator">*</span> pw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>cerr<span class="token punctuation">)</span> Widget<span class="token punctuation">;</span>        <span class="token comment">// &#x4E00;&#x5982;&#x4EE5;&#x5F80;&#xFF0C;&#x4F46;&#x8FD9;&#x6B21;&#x4E0D;&#x518D;&#x6CC4;&#x6F0F;</span>
<span class="token comment">// &#x5BF9;&#x5E94;&#x7684; placement delete &#x4F1A;&#x88AB;&#x81EA;&#x52A8;&#x8C03;&#x7528;&#xFF0C;&#x8BA9; Widget &#x6709;&#x673A;&#x4F1A;&#x786E;&#x4FDD;&#x4E0D;&#x6CC4;&#x6F0F;&#x4EFB;&#x4F55;&#x5185;&#x5B58;&#x3002;</span>





<span class="token comment">// &#x7136;&#x800C;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#xFF08;&#x901A;&#x5E38;&#x5982;&#x6B64;&#xFF09;&#xFF0C;&#x800C;&#x5BA2;&#x6237;&#x4EE3;&#x7801;&#x4E2D;&#x6709;&#x4E2A;&#x5BF9;&#x5E94;&#x7684; delete&#xFF0C;&#x4F1A;&#x53D1;&#x751F;&#x4EC0;&#x4E48;&#x4E8B;&#xFF1A;</span>
<span class="token keyword">delete</span> pw<span class="token punctuation">;</span>          <span class="token comment">// &#x8C03;&#x7528;&#x6B63;&#x5E38;&#x7684; operator delete</span>

<span class="token comment">// &#x5C31;&#x5982;&#x4E0A;&#x4E00;&#x884C;&#x6CE8;&#x91CA;&#x6240;&#x8A00;&#xFF0C;&#x8C03;&#x7528;&#x7684;&#x662F;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; operator delete&#xFF0C;&#x800C;&#x975E;&#x5176; placement &#x7248;&#x672C;&#x3002;</span>
<span class="token comment">// placement delete &#x53EA;&#x6709;&#x5728;&#x201C;&#x4F34;&#x968F; placement new &#x8C03;&#x7528;&#x800C;&#x89E6;&#x53D1;&#x7684;&#x6784;&#x9020;&#x51FD;&#x6570;&#x201D;&#x51FA;&#x73B0;&#x5F02;&#x5E38;&#x65F6;</span>
<span class="token comment">// &#x624D;&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5BF9;&#x7740;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#xFF08;&#x4F8B;&#x5982;&#x4E0A;&#x8FF0;&#x7684; pw&#xFF09;&#x65BD;&#x884C; delete &#x7EDD;&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x8C03;&#x7528; placement delete&#x3002;</span>





<span class="token comment">// &#x9644;&#x5E26;&#x4E00;&#x63D0;&#xFF0C;&#x7531;&#x4E8E;&#x6210;&#x5458;&#x51FD;&#x6570;&#x7684;&#x540D;&#x79F0;&#x4F1A;&#x63A9;&#x76D6;&#x5176;&#x5916;&#x56F4;&#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x7684;&#x76F8;&#x540C;&#x540D;&#x79F0;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 33&#xFF09;&#xFF0C;</span>
<span class="token comment">// &#x4F60;&#x5FC5;&#x987B;&#x5C0F;&#x5FC3;&#x907F;&#x514D;&#x8BA9; class &#x4E13;&#x5C5E;&#x7684; news &#x63A9;&#x76D6;&#x5BA2;&#x6237;&#x671F;&#x671B;&#x7684;&#x5176;&#x4ED6; news&#xFF08;&#x5305;&#x62EC;&#x6B63;&#x5E38;&#x7248;&#x672C;&#xFF09;&#x3002;</span>
<span class="token comment">// &#x5047;&#x8BBE;&#x4F60;&#x6709;&#x4E00;&#x4E2A; base class&#xFF0C;&#x5176;&#x4E2D;&#x58F0;&#x660E;&#x552F;&#x4E00;&#x4E00;&#x4E2A; placement operator new&#xFF0C;</span>
<span class="token comment">// &#x5BA2;&#x6237;&#x7AEF;&#x4F1A;&#x53D1;&#x9001;&#x4ED6;&#x4EEC;&#x65E0;&#x6CD5;&#x4F7F;&#x7528;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; new&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span>
                             std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// &#x8FD9;&#x4E2A; new &#x4F1A;&#x906E;&#x63A9;&#x6B63;&#x5E38;&#x7684; global &#x5F62;&#x5F0F;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Base<span class="token operator">*</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> Base<span class="token punctuation">;</span>                <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x56E0;&#x4E3A;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; operator new &#x88AB;&#x63A9;&#x76D6;&#x3002;</span>
Base<span class="token operator">*</span> pb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>cerr<span class="token punctuation">)</span> Base<span class="token punctuation">;</span>    <span class="token comment">// &#x6B63;&#x786E;&#xFF0C;&#x8C03;&#x7528; Base &#x7684; placement new&#x3002;</span>

<span class="token comment">// &#x540C;&#x6837;&#x9053;&#x7406;&#xFF0C;derived classes &#x4E2D;&#x7684; operator news &#x4F1A;&#x63A9;&#x76D6; global &#x7248;&#x672C;</span>
<span class="token comment">// &#x548C;&#x7EE7;&#x627F;&#x800C;&#x5F97;&#x7684; operator new &#x7248;&#x672C;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Derived</span> <span class="token operator">:</span> <span class="token keyword">public</span> Base <span class="token punctuation">{</span>                       <span class="token comment">// &#x7EE7;&#x627F;&#x81EA;&#x5148;&#x524D;&#x7684; Base</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span>     <span class="token comment">// &#x91CD;&#x65B0;&#x58F0;&#x660E;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684;</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// &#x5F62;&#x5F0F;&#x7684; new</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Derived<span class="token operator">*</span> pd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>clog<span class="token punctuation">)</span> Derived<span class="token punctuation">;</span>      <span class="token comment">// &#x9519;&#x8BEF;&#xFF01;&#x56E0;&#x4E3A; Base &#x7684;</span>
                                            <span class="token comment">// placement new &#x88AB;&#x63A9;&#x76D6;&#x4E86;&#x3002;</span>
Derived<span class="token operator">*</span> pd <span class="token operator">=</span> <span class="token keyword">new</span> Derived<span class="token punctuation">;</span>                  <span class="token comment">// &#x6CA1;&#x95EE;&#x9898;&#xFF0C;&#x8C03;&#x7528; Derived &#x7684;</span>
                                            <span class="token comment">// operator new&#x3002;</span>





<span class="token comment">// &#x6761;&#x6B3E; 33 &#x66F4;&#x8BE6;&#x7EC6;&#x5730;&#x8BA8;&#x8BBA;&#x4E86;&#x8FD9;&#x79CD;&#x540D;&#x79F0;&#x906E;&#x63A9;&#x95EE;&#x9898;&#x3002;&#x5BF9;&#x4E8E;&#x64B0;&#x5199;&#x5185;&#x5B58;&#x5206;&#x914D;&#x51FD;&#x6570;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x8BB0;&#x4F4F;&#x7684;&#x662F;&#xFF0C;</span>
<span class="token comment">// &#x7F3A;&#x7701;&#x60C5;&#x51B5;&#x4E0B; C++ &#x5728; global &#x4F5C;&#x7528;&#x57DF;&#x5185;&#x63D0;&#x4F9B;&#x4EE5;&#x4E0B;&#x5F62;&#x5F0F;&#x7684; operator new&#xFF1A;</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// normal new.</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// placement new.</span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>nothrow_t<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// nothrow new&#xFF0C;&#x89C1;&#x6761;&#x6B3E; 49.</span>





<span class="token comment">// &#x5982;&#x679C;&#x4F60;&#x5728; class &#x5185;&#x58F0;&#x660E;&#x4EFB;&#x4F55; operator news&#xFF0C;&#x5B83;&#x4F1A;&#x906E;&#x63A9;&#x4E0A;&#x8FF0;&#x8FD9;&#x4E9B;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#x3002;</span>
<span class="token comment">// &#x9664;&#x975E;&#x4F60;&#x7684;&#x610F;&#x601D;&#x5C31;&#x662F;&#x8981;&#x963B;&#x6B62; class &#x7684;&#x5BA2;&#x6237;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x5F62;&#x5F0F;&#xFF0C;&#x5426;&#x5219;&#x8BF7;&#x786E;&#x4FDD;&#x5B83;&#x4EEC;&#x5728;&#x4F60;</span>
<span class="token comment">// &#x6240;&#x751F;&#x6210;&#x7684;&#x4EFB;&#x4F55;&#x5B9A;&#x5236;&#x578B; operator new &#x4E4B;&#x5916;&#x8FD8;&#x53EF;&#x7528;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684; operator new</span>
<span class="token comment">// &#x4E5F;&#x8BF7;&#x786E;&#x5B9A;&#x63D0;&#x4F9B;&#x5BF9;&#x5E94;&#x7684; operator delete&#x3002;&#x5982;&#x679C;&#x4F60;&#x5E0C;&#x671B;&#x8FD9;&#x4E9B;&#x51FD;&#x6570;&#x6709;&#x7740;&#x5E73;&#x5E38;&#x7684;&#x884C;&#x4E3A;&#xFF0C;</span>
<span class="token comment">// &#x53EA;&#x8981;&#x4EE4;&#x4F60;&#x7684; class &#x4E13;&#x5C5E;&#x7248;&#x672C;&#x8C03;&#x7528; global &#x7248;&#x672C;&#x5373;&#x53EF;&#x3002;</span>

<span class="token comment">// &#x5B8C;&#x6210;&#x4EE5;&#x4E0A;&#x6240;&#x8A00;&#x7684;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x505A;&#x6CD5;&#x662F;&#xFF0C;&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A; base class&#xFF0C;&#x5185;&#x542B;&#x6240;&#x6709;&#x6B63;&#x5E38;&#x5F62;&#x5F0F;&#x7684; new &#x548C; delete&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">StandardNewDeleteForms</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">// normal new/delete</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>pMemory<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// placement new/delete</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> ptr<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span>pMemory<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// nothrow new/delete</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>nothrow_t<span class="token operator">&amp;</span> nt<span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> nt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token operator">::</span>nothrow_t<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token operator">::</span>opereator <span class="token keyword">delete</span><span class="token punctuation">(</span>pMemory<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>





<span class="token comment">// &#x51E1;&#x662F;&#x60F3;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x5F62;&#x5F0F;&#x6269;&#x5145;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#x7684;&#x5BA2;&#x6237;&#xFF0C;&#x53EF;&#x5229;&#x7528;&#x7EE7;&#x627F;&#x673A;&#x5236;&#x53CA; using &#x58F0;&#x660E;&#x5F0F;&#xFF08;&#x89C1;&#x6761;&#x6B3E; 33&#xFF09;</span>
<span class="token comment">// &#x53D6;&#x5F97;&#x6807;&#x51C6;&#x5F62;&#x5F0F;&#xFF1A;</span>
<span class="token keyword">class</span> <span class="token class-name">Widget</span> <span class="token operator">:</span> <span class="token keyword">public</span> StandardNewDeleteForm <span class="token punctuation">{</span>               <span class="token comment">// &#x7EE7;&#x627F;&#x6807;&#x51C6;&#x5F62;&#x5F0F;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">using</span> StandardNewDeleteForms<span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">;</span>             <span class="token comment">// &#x8BA9;&#x8FD9;&#x4E9B;&#x5F62;&#x5F0F;&#x53EF;&#x89C1;</span>
    <span class="token keyword">using</span> StandardNewDeleteForm<span class="token operator">::</span><span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>std<span class="token operator">::</span>size_t size<span class="token punctuation">,</span>             <span class="token comment">// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;</span>
                              std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>      <span class="token comment">// placement new</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span>std<span class="token operator">::</span>bad_alloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> pMemory<span class="token punctuation">,</span>              <span class="token comment">// &#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;</span>
                                std<span class="token operator">::</span>ostream<span class="token operator">&amp;</span> logStream<span class="token punctuation">)</span>    <span class="token comment">// placement delet</span>
        <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><br>
<h2 class="mume-header" id="9-%E6%9D%82%E9%A1%B9%E8%AE%A8%E8%AE%BA">9&#x3001;&#x6742;&#x9879;&#x8BA8;&#x8BBA;</h2>

<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-53%E4%B8%8D%E8%A6%81%E8%BD%BB%E5%BF%BD%E7%BC%96%E8%AF%91%E5%99%A8%E7%9A%84%E8%AD%A6%E5%91%8A">&#x6761;&#x6B3E; 53&#xFF1A;&#x4E0D;&#x8981;&#x8F7B;&#x5FFD;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x8B66;&#x544A;</h3>

<ul>
<li>&#x4E25;&#x8083;&#x5BF9;&#x5F85;&#x7F16;&#x8BD1;&#x5668;&#x53D1;&#x51FA;&#x7684;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x3002;&#x52AA;&#x529B;&#x5728;&#x4F60;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x6700;&#x9AD8;&#xFF08;&#x6700;&#x4E25;&#x82DB;&#xFF09;&#x8B66;&#x544A;&#x7EA7;&#x522B;&#x4E0B;&#x4E89;&#x53D6;&#x201C;&#x65E0;&#x4EFB;&#x4F55;&#x8B66;&#x544A;&#x201D;&#x7684;&#x8363;&#x8A89;&#x3002;</li>
<li>&#x4E0D;&#x8981;&#x8FC7;&#x5EA6;&#x501A;&#x8D56;&#x7F16;&#x8BD1;&#x5668;&#x7684;&#x62A5;&#x8B66;&#x80FD;&#x529B;&#xFF0C;&#x56E0;&#x4E3A;&#x4E0D;&#x540C;&#x7684;&#x7F16;&#x8BD1;&#x5668;&#x5BF9;&#x5F85;&#x4E8B;&#x60C5;&#x7684;&#x6001;&#x5EA6;&#x5E76;&#x4E0D;&#x76F8;&#x540C;&#x3002;&#x4E00;&#x65E6;&#x79FB;&#x690D;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x7F16;&#x8BD1;&#x5668;&#x4E0A;&#xFF0C;&#x4F60;&#x539F;&#x672C;&#x501A;&#x8D56;&#x7684;&#x8B66;&#x544A;&#x4FE1;&#x606F;&#x6709;&#x53EF;&#x80FD;&#x6D88;&#x5931;&#x3002;</li>
</ul>
<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-54%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%86%9F%E6%82%89%E5%8C%85%E6%8B%AC-tr1-%E5%9C%A8%E5%86%85%E7%9A%84%E6%A0%87%E5%87%86%E7%A8%8B%E5%BA%8F%E5%BA%93">&#x6761;&#x6B3E; 54&#xFF1A;&#x8BA9;&#x81EA;&#x5DF1;&#x719F;&#x6089;&#x5305;&#x62EC; TR1 &#x5728;&#x5185;&#x7684;&#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;</h3>

<ul>
<li>C++ &#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x7684;&#x4E3B;&#x8981;&#x673A;&#x80FD;&#x7531; STL&#x3001;iostreams&#x3001;locales &#x7EC4;&#x6210;&#x3002;&#x5E76;&#x5305;&#x542B; C99 &#x6807;&#x51C6;&#x7A0B;&#x5E8F;&#x5E93;&#x3002;</li>
<li>TR1 &#x6DFB;&#x52A0;&#x4E86;&#x667A;&#x80FD;&#x6307;&#x9488;&#xFF08;&#x4F8B;&#x5982; tr1::shared_ptr&#xFF09;&#x3001;&#x4E00;&#x822C;&#x5316;&#x51FD;&#x6570;&#x6307;&#x9488;&#xFF08;tr1::function&#xFF09;&#x3001;hash-based &#x5BB9;&#x5668;&#x3001;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#xFF08;regular expressions&#xFF09;&#x4EE5;&#x53CA;&#x53E6;&#x5916; 10 &#x4E2A;&#x7EC4;&#x4EF6;&#x7684;&#x652F;&#x6301;&#x3002;</li>
<li>TR1 &#x81EA;&#x8EAB;&#x53EA;&#x662F;&#x4E00;&#x4EFD;&#x89C4;&#x8303;&#x3002;&#x4E3A;&#x83B7;&#x5F97; TR1 &#x63D0;&#x4F9B;&#x7684;&#x597D;&#x5904;&#xFF0C;&#x4F60;&#x9700;&#x8981;&#x4E00;&#x4EFD;&#x5B9E;&#x7269;&#x3002;&#x4E00;&#x4E2A;&#x597D;&#x7684;&#x5B9E;&#x7269;&#x6765;&#x6E90;&#x662F; Boost&#x3002;</li>
</ul>
<br>
<h3 class="mume-header" id="%E6%9D%A1%E6%AC%BE-55%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%86%9F%E6%82%89-boost">&#x6761;&#x6B3E; 55&#xFF1A;&#x8BA9;&#x81EA;&#x5DF1;&#x719F;&#x6089; Boost</h3>

<ul>
<li>Boost &#x662F;&#x4E00;&#x4E2A;&#x793E;&#x7FA4;&#xFF0C;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x7F51;&#x7AD9;&#x3002;&#x81F4;&#x529B;&#x4E8E;&#x514D;&#x8D39;&#x3001;&#x6E90;&#x7801;&#x5F00;&#x653E;&#x3001;&#x540C;&#x50DA;&#x590D;&#x5BA1;&#x7684; C++ &#x7A0B;&#x5E8F;&#x5E93;&#x5F00;&#x53D1;&#x3002;Boost &#x5728; C++ &#x6807;&#x51C6;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x626E;&#x6F14;&#x6DF1;&#x5177;&#x5F71;&#x54CD;&#x529B;&#x7684;&#x89D2;&#x8272;&#x3002;</li>
<li>Boost &#x63D0;&#x4F9B;&#x8BB8;&#x591A; TR1 &#x7EC4;&#x4EF6;&#x5B9E;&#x73B0;&#x54C1;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x8BB8;&#x591A;&#x7A0B;&#x5E8F;&#x5E93;&#x3002;</li>
</ul>
</font>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>